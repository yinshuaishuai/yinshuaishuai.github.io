<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/ys_ico.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/ys_ico.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ysymj.gitee.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="哔哩哔哩视频《SpringBoot2零基础入门教程》学习笔记，地址：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV19K4y1L7MT&#x2F;，本视频只有第一季（核心技术）没有第二季（响应式编程）。">
<meta property="og:type" content="article">
<meta property="og:title" content="尚硅谷SpringBoot2核心技术-核心功能(二)">
<meta property="og:url" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/index.html">
<meta property="og:site_name" content="YS">
<meta property="og:description" content="哔哩哔哩视频《SpringBoot2零基础入门教程》学习笔记，地址：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV19K4y1L7MT&#x2F;，本视频只有第一季（核心技术）没有第二季（响应式编程）。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/DispatcherServlet%E7%BB%A7%E6%89%BF%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/DispatcherServlet%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/HandlerMapping%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/Map&Model%E5%AF%B9%E8%B1%A1%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/Map&Model%E5%8F%82%E6%95%B0%E7%A4%BA%E6%84%8F%E5%9B%BE.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/HandlerAdapter%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%99%A8%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/HandlerMethodArgumentResolver%E6%8E%A5%E5%8F%A3%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E8%BF%94%E5%9B%9E%E5%80%BC%E5%A4%84%E7%90%86%E5%99%A8%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/springboot%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E5%99%A8%E5%9B%BE%E7%A4%BA1.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/springboot%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E5%99%A8%E5%9B%BE%E7%A4%BA2.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/Map&Model%E5%8F%82%E6%95%B0%E7%A4%BA%E6%84%8F%E5%9B%BE.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E6%95%B0%E6%8D%AE%E5%93%8D%E5%BA%94%E4%B8%8E%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E8%BF%94%E5%9B%9E%E5%80%BC%E8%A7%A3%E6%9E%90%E5%99%A8%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E8%BF%94%E5%9B%9E%E5%80%BC%E8%A7%A3%E6%9E%90%E5%99%A8%E5%86%85%E9%83%A8%E6%96%B9%E5%BC%8F%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E8%AF%B7%E6%B1%82%E5%A4%B4Accept%E5%8F%82%E6%95%B0%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/HttpMessageConverter%E6%96%B9%E6%B3%95%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E7%B3%BB%E7%BB%9F%E4%B8%AD%E9%BB%98%E8%AE%A4%E7%9A%84HttpMessageConverter%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/HttpMessageConverter%E5%A4%84%E7%90%86%E5%90%8E%E7%9A%84%E6%95%B0%E6%8D%AE%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E7%AE%A1%E7%90%86%E5%99%A8%E7%AD%96%E7%95%A5%E5%9B%BE%E7%A4%BA2.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E7%AE%A1%E7%90%86%E5%99%A8%E7%AD%96%E7%95%A5%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/HeaderContentNegotiationStrategy%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%94%AF%E6%8C%81%E7%9A%84%E5%AA%92%E4%BD%93%E7%B1%BB%E5%9E%8B%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E6%94%AF%E6%8C%81XML%E7%9A%84HttpMessageConverter%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%BA%E4%BA%8E%E5%8F%82%E6%95%B0%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E7%AD%96%E7%95%A5%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E8%A7%86%E5%9B%BE%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%99%A8%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/thymeleaf%E5%B1%9E%E6%80%A7%E4%BC%98%E5%85%88%E7%BA%A7%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/HandlerExecutionChain%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/springboot%E6%8B%A6%E6%88%AA%E5%99%A8%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%99%A8%E5%9B%BE%E7%A4%BA.png">
<meta property="article:published_time" content="2023-10-28T08:00:12.000Z">
<meta property="article:modified_time" content="2023-10-28T08:23:05.141Z">
<meta property="article:author" content="YS">
<meta property="article:tag" content="SpringBoot2">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/DispatcherServlet%E7%BB%A7%E6%89%BF%E5%9B%BE%E7%A4%BA.png">

<link rel="canonical" href="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>尚硅谷SpringBoot2核心技术-核心功能(二) | YS</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">YS</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">学无止境</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://ysymj.gitee.io/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.png">
      <meta itemprop="name" content="YS">
      <meta itemprop="description" content="学海无涯苦作舟">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          尚硅谷SpringBoot2核心技术-核心功能(二)
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-28 16:00:12 / 修改时间：16:23:05" itemprop="dateCreated datePublished" datetime="2023-10-28T16:00:12+08:00">2023-10-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">java框架</span></a>
                </span>
            </span>

          
            <span id="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/" class="post-meta-item leancloud_visitors" data-flag-title="尚硅谷SpringBoot2核心技术-核心功能(二)" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h1><h2 id="文件类型"><a href="#文件类型" class="headerlink" title="文件类型"></a>文件类型</h2><h3 id="properties"><a href="#properties" class="headerlink" title="properties"></a>properties</h3><p>同以前的properties用法<br>比如给user下的name赋值</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">user.name</span>=<span class="string">xxx</span></span><br></pre></td></tr></table></figure>

<h3 id="yaml"><a href="#yaml" class="headerlink" title="yaml"></a>yaml</h3><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><blockquote>
<p>YAML是“YAML Ain’t Markup Language”(YAML不是一种标记语言)的递归缩写。<br>在开发这种语言时，YAML的意思其实是：“Yet Another  Markup Language”(仍是一种标记语言)</p>
</blockquote>
<blockquote>
<p>非常时候用来做以数据为中心的配置文件</p>
</blockquote>
<h4 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h4><ul>
<li><code>key: value</code> kv之间有空格</li>
<li>大小写敏感</li>
<li>使用缩进表示层级关系</li>
<li>缩进不允许使用tab，只允许使用空格</li>
<li>缩进的空格数不重要，只要相同层级的元素左对齐即可</li>
<li>‘#’表示注释</li>
<li>字符串无需加引号，如果要加，’’与””表示字符串内容会被 转义/不转义</li>
</ul>
<h4 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h4><ul>
<li>字面量：单个的、不可再分的值，date、boolean、string、number、null</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">k:</span> <span class="string">v</span></span><br></pre></td></tr></table></figure>

<ul>
<li>对象：键值对的集合，map、hash、object</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 行内写法</span></span><br><span class="line"><span class="attr">k:</span> &#123;<span class="string">k1:v1</span>,<span class="string">k2:v2</span>,<span class="string">k3:v3</span>&#125;</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line"><span class="attr">k:</span> </span><br><span class="line">  <span class="attr">k1:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">k2:</span> <span class="string">v2</span></span><br><span class="line">  <span class="attr">k3:</span> <span class="string">v3</span></span><br></pre></td></tr></table></figure>

<ul>
<li>数组：一组按照次序排列的值，array、list、queue</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 行内写法</span></span><br><span class="line"><span class="attr">k:</span> [<span class="string">v1</span>,<span class="string">v2</span>,<span class="string">v3</span>]</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line"><span class="attr">k:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">v1</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">v2</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">v3</span></span><br></pre></td></tr></table></figure>

<h2 id="配置提示"><a href="#配置提示" class="headerlink" title="配置提示"></a>配置提示</h2><p>自定义的类和配置文件绑定一般没有提示<br>不过可以加入一下依赖就会有提示</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>不过这个注解只是在开发的时候使用，打包的时候并没有必要打进去，可以通过一下配置进行排除</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">excludes</span>&gt;</span>  </span><br><span class="line">                    <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>  </span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">                    <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="web开发"><a href="#web开发" class="headerlink" title="web开发"></a>web开发</h1><h2 id="SpringMVC自动配置概览"><a href="#SpringMVC自动配置概览" class="headerlink" title="SpringMVC自动配置概览"></a>SpringMVC自动配置概览</h2><p>Spring Boot provides auto-configuration for Spring MVC that <strong>works well with most applications.(大多场景我们都无需自定义配置)</strong><br>The auto-configuration adds the following features on top of Spring’s defaults:</p>
<ul>
<li>Inclusion of <code>ContentNegotiatingViewResolver</code> and <code>BeanNameViewResolver</code> beans.<ul>
<li>内容协商视图解析器和BeanName视图解析器</li>
</ul>
</li>
<li>Support for serving static resources, including support for WebJars (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-static-content">later in this document</a>)).<ul>
<li>静态资源（包括webjars）</li>
</ul>
</li>
</ul>
<ul>
<li>Automatic registration of <code>Converter</code>, <code>GenericConverter</code>, and <code>Formatter</code> beans.<ul>
<li>自动注册 <code>Converter，GenericConverter，Formatter</code></li>
</ul>
</li>
<li>Support for <code>HttpMessageConverters</code> (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-message-converters">later in this document</a>).<ul>
<li>支持 <code>HttpMessageConverters</code> （后来我们配合内容协商理解原理）</li>
</ul>
</li>
<li>Automatic registration of <code>MessageCodesResolver</code> (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-message-codes">later in this document</a>).<ul>
<li>自动注册 <code>MessageCodesResolver</code> （国际化用）</li>
</ul>
</li>
<li>Static <code>index.html</code> support.<ul>
<li>静态index.html 页支持</li>
</ul>
</li>
<li>Custom <code>Favicon</code> support (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-favicon">later in this document</a>).<ul>
<li>自定义 <code>Favicon</code></li>
</ul>
</li>
<li>Automatic use of a <code>ConfigurableWebBindingInitializer</code> bean (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-web-binding-initializer">later in this document</a>).<ul>
<li>自动使用 <code>ConfigurableWebBindingInitializer</code> ，（DataBinder负责将请求数据绑定到JavaBean上）</li>
</ul>
</li>
</ul>
<blockquote>
<p>If you want to keep those Spring Boot MVC customizations and make more <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.9.RELEASE/spring-framework-reference/web.html#mvc">MVC customizations</a> (interceptors, formatters, view controllers, and other features), you can add your own <code>@Configuration</code> class of type <code>WebMvcConfigurer</code> but <strong>without</strong> <code>@EnableWebMvc</code>.<br><strong>不用@EnableWebMvc注解。使用</strong> <code>**@Configuration**</code> <strong>+</strong> <code>**WebMvcConfigurer**</code> <strong>自定义规则</strong></p>
</blockquote>
<blockquote>
<p>If you want to provide custom instances of <code>RequestMappingHandlerMapping</code>, <code>RequestMappingHandlerAdapter</code>, or <code>ExceptionHandlerExceptionResolver</code>, and still keep the Spring Boot MVC customizations, you can declare a bean of type <code>WebMvcRegistrations</code> and use it to provide custom instances of those components.<br><strong>声明</strong> <code>**WebMvcRegistrations**</code> <strong>改变默认底层组件</strong></p>
</blockquote>
<blockquote>
<p>If you want to take complete control of Spring MVC, you can add your own <code>@Configuration</code> annotated with <code>@EnableWebMvc</code>, or alternatively add your own <code>@Configuration</code>-annotated <code>DelegatingWebMvcConfiguration</code> as described in the Javadoc of <code>@EnableWebMvc</code>.<br><strong>使用</strong> <code>**@EnableWebMvc+@Configuration+DelegatingWebMvcConfiguration 全面接管SpringMVC**</code></p>
</blockquote>
<h2 id="简单功能分析"><a href="#简单功能分析" class="headerlink" title="简单功能分析"></a>简单功能分析</h2><h3 id="静态资源访问"><a href="#静态资源访问" class="headerlink" title="静态资源访问"></a>静态资源访问</h3><h4 id="静态资源目录"><a href="#静态资源目录" class="headerlink" title="静态资源目录"></a>静态资源目录</h4><p>只要静态资源放在类路径下：<code>/static</code> (or <code>/public</code> or <code>/resources</code> or <code>/META-INF/resources</code>)<br>访问地址：当前项目根路径/+静态资源名（<a target="_blank" rel="noopener" href="http://127.0.0.1:8080/123.jpg%EF%BC%89">http://127.0.0.1:8080/123.jpg）</a></p>
<p>原理：静态映射<code>/**</code><br>接收到请求，先查找controller是否能够处理，如果不能处理，就把请求交给静态资源处理器；静态资源处理器也找不到则响应404页面（如果有rest路径和静态资源路径恰好相同，rest路径优先响应）</p>
<p>改变默认的静态资源路径</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span>  </span><br><span class="line">  <span class="attr">mvc:</span>  <span class="comment"># 修改静态资源访问前缀，默认没有前缀，现在的设置 /res/123.jpg</span></span><br><span class="line">    <span class="attr">static-path-pattern:</span> <span class="string">/res/**</span>  </span><br><span class="line">  <span class="attr">resources:</span>  <span class="comment"># 静态资源文件存放目录，已经废弃</span></span><br><span class="line">    <span class="attr">static-locations:</span> <span class="string">classpath:/ss/</span>  </span><br><span class="line">  <span class="attr">web:</span>  </span><br><span class="line">    <span class="attr">resources:</span>  <span class="comment"># 静态资源文件存放目录，推荐使用</span></span><br><span class="line">      <span class="attr">static-locations:</span> <span class="string">classpath:/public/</span></span><br></pre></td></tr></table></figure>

<h4 id="静态资源访问前缀"><a href="#静态资源访问前缀" class="headerlink" title="静态资源访问前缀"></a>静态资源访问前缀</h4><p>默认无前缀，下面配置需要访问（<a target="_blank" rel="noopener" href="http://127.0.0.1:8080/res/123.jpg%EF%BC%89">http://127.0.0.1:8080/res/123.jpg）</a></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span>  </span><br><span class="line">  <span class="attr">mvc:</span>  </span><br><span class="line">    <span class="attr">static-path-pattern:</span> <span class="string">/res/**</span>  </span><br></pre></td></tr></table></figure>

<h4 id="webjar"><a href="#webjar" class="headerlink" title="webjar"></a>webjar</h4><p>把静态资源以jar包的形式引入<br>自动映射 <code>/webjar/**</code> 文件夹<br><a target="_blank" rel="noopener" href="https://www.webjars.org/">WebJars - Web Libraries in Jars</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8080/webjars/**jquery/3.5.1/jquery.js">http://127.0.0.1:8080/webjars/**jquery/3.5.1/jquery.js</a>**<br>后面地址要按照依赖里面的包路径</p>
<h3 id="欢迎页支持"><a href="#欢迎页支持" class="headerlink" title="欢迎页支持"></a>欢迎页支持</h3><ul>
<li>静态资源路径下 index.html<ul>
<li>可以配置静态资源路径</li>
<li>但不可以配置静态资源访问前缀，否则导致index.html不能被默认访问到<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span>  </span><br><span class="line">  <span class="attr">mvc:</span>  </span><br><span class="line">    <span class="attr">static-path-pattern:</span> <span class="string">/res/**</span>   <span class="comment"># 这个配置会导致 welcome page功能失效</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="自定义Favicon"><a href="#自定义Favicon" class="headerlink" title="自定义Favicon"></a>自定义Favicon</h3><p>favicon.ico放在静态资源目录下即可自动访问<br><code>spring.mvc.static-path-pattern</code> 配置同样会导致该功能失效</p>
<h3 id="静态资源配置原理"><a href="#静态资源配置原理" class="headerlink" title="静态资源配置原理"></a>静态资源配置原理</h3><ul>
<li><p>springboot启动默认加载 xxxAutoConfiguration类（自动配置类）</p>
</li>
<li><p>SpringMVC功能的自动配置类 WebMvcAutoConfiguration，生效</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration(after = &#123; DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,  </span></span><br><span class="line"><span class="meta">       ValidationAutoConfiguration.class &#125;)</span>  </span><br><span class="line">       <span class="comment">//是一个servlet项目</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span>  </span><br><span class="line"><span class="comment">//项目中包含这三个类</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class &#125;)</span>  </span><br><span class="line"><span class="comment">//项目中不存在这个bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span>  </span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcAutoConfiguration</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>给容器中配了什么</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span>  </span><br><span class="line"><span class="meta">@Import(EnableWebMvcConfiguration.class)</span>  </span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123; WebMvcProperties.class, WebProperties.class &#125;)</span>  </span><br><span class="line"><span class="meta">@Order(0)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcAutoConfigurationAdapter</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span>, <span class="title">ServletContextAware</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>配置文件的相关属性和xxx进行了绑定</p>
<ul>
<li>WebMvcProperties == <strong>spring.mvc</strong></li>
<li>WebProperties == <strong>spring.web</strong></li>
</ul>
</li>
</ul>
<h4 id="配置类只有一个有参构造器"><a href="#配置类只有一个有参构造器" class="headerlink" title="配置类只有一个有参构造器"></a>配置类只有一个有参构造器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在只有一个构造器的情况下，创建这个bean会从容器中获取构造器中的所有参数</span></span><br><span class="line"><span class="comment">//WebProperties webProperties 获取和 spring.web绑定的所有的值的对象</span></span><br><span class="line"><span class="comment">//WebMvcProperties mvcProperties 获取和 spring.mvc绑定的所有的值的对象</span></span><br><span class="line"><span class="comment">//ListableBeanFactory beanFactory spring的beanFactory</span></span><br><span class="line"><span class="comment">//HttpMessageConverters 找到所有的 HttpMessageConverters</span></span><br><span class="line"><span class="comment">//ResourceHandlerRegistrationCustomizer 找到资源处理器</span></span><br><span class="line"><span class="comment">//DispatcherServletPath</span></span><br><span class="line"><span class="comment">//ServletRegistrationBean 给应用注册 servlet、filter....</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">WebMvcAutoConfigurationAdapter</span><span class="params">(WebProperties webProperties, WebMvcProperties mvcProperties,  </span></span></span><br><span class="line"><span class="params"><span class="function">       ListableBeanFactory beanFactory, ObjectProvider&lt;HttpMessageConverters&gt; messageConvertersProvider,  </span></span></span><br><span class="line"><span class="params"><span class="function">       ObjectProvider&lt;ResourceHandlerRegistrationCustomizer&gt; resourceHandlerRegistrationCustomizerProvider,  </span></span></span><br><span class="line"><span class="params"><span class="function">       ObjectProvider&lt;DispatcherServletPath&gt; dispatcherServletPath,  </span></span></span><br><span class="line"><span class="params"><span class="function">       ObjectProvider&lt;ServletRegistrationBean&lt;?&gt;&gt; servletRegistrations)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">this</span>.resourceProperties = webProperties.getResources();  </span><br><span class="line">    <span class="keyword">this</span>.mvcProperties = mvcProperties;  </span><br><span class="line">    <span class="keyword">this</span>.beanFactory = beanFactory;  </span><br><span class="line">    <span class="keyword">this</span>.messageConvertersProvider = messageConvertersProvider;  </span><br><span class="line">    <span class="keyword">this</span>.resourceHandlerRegistrationCustomizer = resourceHandlerRegistrationCustomizerProvider.getIfAvailable();  </span><br><span class="line">    <span class="keyword">this</span>.dispatcherServletPath = dispatcherServletPath;  </span><br><span class="line">    <span class="keyword">this</span>.servletRegistrations = servletRegistrations;  </span><br><span class="line">    <span class="keyword">this</span>.mvcProperties.checkConfiguration();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="资源处理的默认规则"><a href="#资源处理的默认规则" class="headerlink" title="资源处理的默认规则"></a>资源处理的默认规则</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;  </span><br><span class="line"><span class="comment">//spring.web.resources.add-mappings=false 配置可以禁用静态文件</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.resourceProperties.isAddMappings()) &#123;  </span><br><span class="line">       logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);  </span><br><span class="line">       <span class="keyword">return</span>;    &#125;  </span><br><span class="line">       <span class="comment">//webjars的规则，所以webjars的包只要进入后按固定规则就可以使用</span></span><br><span class="line">    addResourceHandler(registry, <span class="string">&quot;/webjars/**&quot;</span>, <span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);  </span><br><span class="line">    <span class="comment">//自定义的规则，如果没有自定义，则会使用默认的规则</span></span><br><span class="line">    addResourceHandler(registry, <span class="keyword">this</span>.mvcProperties.getStaticPathPattern(), (registration) -&gt; &#123;  </span><br><span class="line">       registration.addResourceLocations(<span class="keyword">this</span>.resourceProperties.getStaticLocations());  </span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">this</span>.servletContext != <span class="keyword">null</span>) &#123;  </span><br><span class="line">          ServletContextResource resource = <span class="keyword">new</span> ServletContextResource(<span class="keyword">this</span>.servletContext, SERVLET_LOCATION);  </span><br><span class="line">          registration.addResourceLocations(resource);  </span><br><span class="line">       &#125;  </span><br><span class="line">    &#125;);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Resources</span> </span>&#123;  </span><br><span class="line">  <span class="comment">//spring.mvc.static-path-pattern 配置默认值，静态资源默认位置</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] CLASSPATH_RESOURCE_LOCATIONS = &#123; <span class="string">&quot;classpath:/META-INF/resources/&quot;</span>,  </span><br><span class="line">          <span class="string">&quot;classpath:/resources/&quot;</span>, <span class="string">&quot;classpath:/static/&quot;</span>, <span class="string">&quot;classpath:/public/&quot;</span> &#125;;  </span><br><span class="line">	<span class="keyword">private</span> String[] staticLocations = CLASSPATH_RESOURCE_LOCATIONS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="欢迎的处理规则"><a href="#欢迎的处理规则" class="headerlink" title="欢迎的处理规则"></a>欢迎的处理规则</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> WelcomePageHandlerMapping <span class="title">welcomePageHandlerMapping</span><span class="params">(ApplicationContext applicationContext,  </span></span></span><br><span class="line"><span class="params"><span class="function">       FormattingConversionService mvcConversionService, ResourceUrlProvider mvcResourceUrlProvider)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> createWelcomePageHandlerMapping(applicationContext, mvcConversionService, mvcResourceUrlProvider,  </span><br><span class="line">          WelcomePageHandlerMapping::<span class="keyword">new</span>);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">private</span> &lt;T extends AbstractUrlHandlerMapping&gt; <span class="function">T <span class="title">createWelcomePageHandlerMapping</span><span class="params">(  </span></span></span><br><span class="line"><span class="params"><span class="function">       ApplicationContext applicationContext, FormattingConversionService mvcConversionService,  </span></span></span><br><span class="line"><span class="params"><span class="function">       ResourceUrlProvider mvcResourceUrlProvider, WelcomePageHandlerMappingFactory&lt;T&gt; factory)</span> </span>&#123;  </span><br><span class="line">    TemplateAvailabilityProviders templateAvailabilityProviders = <span class="keyword">new</span> TemplateAvailabilityProviders(  </span><br><span class="line">          applicationContext);  </span><br><span class="line">    String staticPathPattern = <span class="keyword">this</span>.mvcProperties.getStaticPathPattern();  </span><br><span class="line">    T handlerMapping = factory.create(templateAvailabilityProviders, applicationContext, getIndexHtmlResource(),  </span><br><span class="line">          staticPathPattern);  </span><br><span class="line">    handlerMapping.setInterceptors(getInterceptors(mvcConversionService, mvcResourceUrlProvider));  </span><br><span class="line">    handlerMapping.setCorsConfigurations(getCorsConfigurations());  </span><br><span class="line">    <span class="keyword">return</span> handlerMapping;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">WelcomePageHandlerMapping(TemplateAvailabilityProviders templateAvailabilityProviders,  </span><br><span class="line">       ApplicationContext applicationContext, Resource indexHtmlResource, String staticPathPattern) &#123;  </span><br><span class="line">    setOrder(<span class="number">2</span>);  </span><br><span class="line">    WelcomePage welcomePage = WelcomePage.resolve(templateAvailabilityProviders, applicationContext,  </span><br><span class="line">          indexHtmlResource, staticPathPattern);  </span><br><span class="line">    <span class="keyword">if</span> (welcomePage != WelcomePage.UNRESOLVED) &#123;  </span><br><span class="line">       logger.info(LogMessage.of(() -&gt; (!welcomePage.isTemplated()) ? <span class="string">&quot;Adding welcome page: &quot;</span> + indexHtmlResource  </span><br><span class="line">             : <span class="string">&quot;Adding welcome page template: index&quot;</span>));  </span><br><span class="line">       ParameterizableViewController controller = <span class="keyword">new</span> ParameterizableViewController();  </span><br><span class="line">       controller.setViewName(welcomePage.getViewName());  </span><br><span class="line">       setRootHandler(controller);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> WelcomePage <span class="title">resolve</span><span class="params">(TemplateAvailabilityProviders templateAvailabilityProviders,  </span></span></span><br><span class="line"><span class="params"><span class="function">       ApplicationContext applicationContext, Resource indexHtmlResource, String staticPathPattern)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (indexHtmlResource != <span class="keyword">null</span> &amp;&amp; <span class="string">&quot;/**&quot;</span>.equals(staticPathPattern)) &#123;  </span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> WelcomePage(<span class="string">&quot;forward:index.html&quot;</span>, <span class="keyword">false</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">if</span> (templateAvailabilityProviders.getProvider(<span class="string">&quot;index&quot;</span>, applicationContext) != <span class="keyword">null</span>) &#123;  </span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> WelcomePage(<span class="string">&quot;index&quot;</span>, <span class="keyword">true</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> UNRESOLVED;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从上面的代码可以看到，欢迎页的最终是在底层写死了 <code>/**</code> ，所以当我们自定义前缀后，无法匹配也就会导致欢迎页失效。</p>
<h4 id="favicon"><a href="#favicon" class="headerlink" title="favicon"></a>favicon</h4><p>favicon.ioc是浏览器进行处理的，默认会去根目录下寻找，如果加入了前缀，就会导致图标不在根目录下，也就会找不到。</p>
<h2 id="请求参数处理"><a href="#请求参数处理" class="headerlink" title="请求参数处理"></a>请求参数处理</h2><h3 id="请求映射"><a href="#请求映射" class="headerlink" title="请求映射"></a>请求映射</h3><h4 id="rest使用与原理"><a href="#rest使用与原理" class="headerlink" title="rest使用与原理"></a>rest使用与原理</h4><ul>
<li>xxxMapping</li>
<li>rest风格支持，使用HTTP请求方式动词来表示对资源的操作<ul>
<li>以前：/getUser 获取用户 /deleteUser 删除用户 /editUser修改用户 /saveUser 保存用户</li>
<li>现在：/user  GET-获取用户  DELETE-删除用户  PUT-修改用户  POST-保存用户</li>
<li>核心Filter，HiddenHttpMethodFilter （仅限于表单请求，表单只能发送post和get请求，可以使用这个Filter实现delete和put请求，现在一般都是前后端分离，可以直接发送对应的请求）<ul>
<li>用法：表单的meehod=post，隐藏域_method=put<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;delete&quot;</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;发送delete请求&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>SpringBoot中手动开启<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span>  </span><br><span class="line">  <span class="attr">mvc:</span>  </span><br><span class="line">    <span class="attr">hidden-method:</span>  </span><br><span class="line">      <span class="attr">filter:</span>  </span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>扩展：如何把_method定义成自己喜欢的名字<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> HiddenHttpMethodFilter <span class="title">hiddenHttpMethodFilter</span><span class="params">()</span></span>&#123;  </span><br><span class="line">    HiddenHttpMethodFilter methodFilter = <span class="keyword">new</span> HiddenHttpMethodFilter();  </span><br><span class="line">    methodFilter.setMethodParam(<span class="string">&quot;_m&quot;</span>);  </span><br><span class="line">    <span class="keyword">return</span> methodFilter;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
只需要定义一个Bean即可，spring默认的Filter上面标记了<code>@ConditionalOnMissingBean(HiddenHttpMethodFilter.class)</code>注解，当我们自定义了这个类型的Bean之后，springboot默认的就不会生效。</li>
</ul>
</li>
</ul>
<p><strong>rest原理：</strong></p>
<ul>
<li>表单提交会带上_method=PUT</li>
<li>请求过来被<code>HiddenHttpMethodFilter</code>拦截<ul>
<li>请求是否正常，并且是POST请求<ul>
<li>获取到_method的值</li>
<li>兼容一下请求：PUT, DELETE, PATCH</li>
<li>原生request（post），包装模式requestWrapper重写了getMethod方法，返回的是传入的值</li>
<li>过滤器链放行的时候用requestWrapper，以后调用getMethod方法调用的是requestWrapper的</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>rest使用客户端工具：</p>
<ul>
<li>如PostMan直接发送PUT、DELETE等方式请求，无需Filter</li>
</ul>
<h4 id="请求映射原理"><a href="#请求映射原理" class="headerlink" title="请求映射原理"></a>请求映射原理</h4><p><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/DispatcherServlet%E7%BB%A7%E6%89%BF%E5%9B%BE%E7%A4%BA.png" alt="DispatcherServlet继承图示"></p>
<p><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/DispatcherServlet%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E5%9B%BE%E7%A4%BA.png" alt="DispatcherServlet方法调用图示"><br>分析DispatcherServlet直接看doDispatch方法即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">    HttpServletRequest processedRequest = request;  </span><br><span class="line">    HandlerExecutionChain mappedHandler = <span class="keyword">null</span>;  </span><br><span class="line">    <span class="keyword">boolean</span> multipartRequestParsed = <span class="keyword">false</span>;  </span><br><span class="line">  </span><br><span class="line">    WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">try</span> &#123;  </span><br><span class="line">       ModelAndView mv = <span class="keyword">null</span>;  </span><br><span class="line">       Exception dispatchException = <span class="keyword">null</span>;  </span><br><span class="line">  </span><br><span class="line">       <span class="keyword">try</span> &#123;  </span><br><span class="line">          processedRequest = checkMultipart(request);  </span><br><span class="line">          multipartRequestParsed = (processedRequest != request);  </span><br><span class="line">  </span><br><span class="line">          <span class="comment">// 找到当前请求使用那个Handler（Controller的方法）处理</span></span><br><span class="line">          mappedHandler = getHandler(processedRequest);  </span><br><span class="line">          <span class="keyword">if</span> (mappedHandler == <span class="keyword">null</span>) &#123;  </span><br><span class="line">             noHandlerFound(processedRequest, response);  </span><br><span class="line">             <span class="keyword">return</span>;          </span><br><span class="line">             &#125;</span><br><span class="line">             <span class="comment">//HandlerMapping：处理器映射。/xxx --&gt; xxx</span></span><br><span class="line">             ....</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>springboot默认创建了6个HandlerMapping，其中RequestMappingHandlerMapping用来处理我们平时定义在Controller中的请求，保存了所有@RequestMapping和Handler的映射规则<br><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/HandlerMapping%E5%9B%BE%E7%A4%BA.png" alt="HandlerMapping图示"></p>
<p>所有的请求映射都在HandlerMapping中</p>
<ul>
<li>SpringBoot自动配置欢迎页的 WelcomePageHandlerMapping，访问/能访问到index.html</li>
<li>SpringBoot自动配置了默认的RequestMappingHandlerMapping</li>
<li>请求进来，挨个尝试所有的HandlerMapping看是否能处理请求信息<ul>
<li>如果有就找到这个请求对应的handler</li>
<li>如果没有就下一个HandlerMapping</li>
</ul>
</li>
<li>我们如果需要自定义的映射处理，也可以自己给容器中放HandlerMapping<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> HandlerExecutionChain <span class="title">getHandler</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.handlerMappings != <span class="keyword">null</span>) &#123;  </span><br><span class="line">       <span class="keyword">for</span> (HandlerMapping mapping : <span class="keyword">this</span>.handlerMappings) &#123;  </span><br><span class="line">          HandlerExecutionChain handler = mapping.getHandler(request);  </span><br><span class="line">          <span class="keyword">if</span> (handler != <span class="keyword">null</span>) &#123;  </span><br><span class="line">             <span class="keyword">return</span> handler;  </span><br><span class="line">          &#125;  </span><br><span class="line">       &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="普通参数与基本注解"><a href="#普通参数与基本注解" class="headerlink" title="普通参数与基本注解"></a>普通参数与基本注解</h3><h4 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h4><h5 id="PathVariable"><a href="#PathVariable" class="headerlink" title="@PathVariable"></a>@PathVariable</h5><ul>
<li>从请求路径中变量的值</li>
<li>可以使用变量名称一个一个获取</li>
<li>也可以使用<code>Map&lt;String,String&gt;</code>方式获取所有的值，key和value只能是String<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/test/&#123;id&#125;/t1/&#123;name&#125;&quot;)</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title">test</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id,  </span></span></span><br><span class="line"><span class="params"><span class="function">                               <span class="meta">@PathVariable(&quot;name&quot;)</span> String name,  </span></span></span><br><span class="line"><span class="params"><span class="function">                               <span class="meta">@PathVariable</span> Map&lt;String,String&gt; pv)</span></span>&#123; ... &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="RequestHeader"><a href="#RequestHeader" class="headerlink" title="@RequestHeader"></a>@RequestHeader</h5><ul>
<li>获取请求头中的信息</li>
<li>可以通过名称获取请求头中单个参数的信息</li>
<li>可以使用<code>Map&lt;String, String&gt;</code>获取所有请求头中的信息</li>
<li>可以使用<code>MultiValueMap&lt;String, String&gt;</code>（多值map）获取所有请求头中的信息</li>
<li>可以使用<code>HttpHeaders</code>获取请求中的信息<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/test&quot;)</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">test</span><span class="params">(<span class="meta">@RequestHeader(&quot;User-Agent&quot;)</span> String userAgent,  </span></span></span><br><span class="line"><span class="params"><span class="function">                                <span class="meta">@RequestHeader</span> Map&lt;String, String&gt; pv,  </span></span></span><br><span class="line"><span class="params"><span class="function">                                <span class="meta">@RequestHeader</span> MultiValueMap&lt;String, String&gt; mpv,  </span></span></span><br><span class="line"><span class="params"><span class="function">                                <span class="meta">@RequestHeader</span> HttpHeaders httpHeaders)</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="RequestParam"><a href="#RequestParam" class="headerlink" title="@RequestParam"></a>@RequestParam</h5><ul>
<li>/test?id=1&amp;name=liming&amp;hobby=篮球&amp;hobby=足球</li>
<li>从请求中获取参数</li>
<li>可以通过名称获取单个参数</li>
<li>如果有多个名称相同的参数，可以使用集合接收参数</li>
<li>可以使用<code>Map&lt;String, String&gt;</code>获取所有参数，不过多个相同名称的参数只会保留第一个</li>
<li>可以使用<code>MultiValueMap&lt;String, String&gt;</code>获取参数，同名参数会存放到集合中<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/test&quot;)</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">test</span><span class="params">(<span class="meta">@RequestParam(&quot;id&quot;)</span> Integer id,  </span></span></span><br><span class="line"><span class="params"><span class="function">                                <span class="meta">@RequestParam(&quot;name&quot;)</span> String name,  </span></span></span><br><span class="line"><span class="params"><span class="function">                                <span class="meta">@RequestParam(&quot;hobby&quot;)</span>List&lt;String&gt; hobby,  </span></span></span><br><span class="line"><span class="params"><span class="function">                                <span class="meta">@RequestParam</span> Map&lt;String,String&gt; pv,  </span></span></span><br><span class="line"><span class="params"><span class="function">                                <span class="meta">@RequestParam</span> MultiValueMap&lt;String,String&gt; mpv  </span></span></span><br><span class="line"><span class="params"><span class="function">                                )</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="CookieValue"><a href="#CookieValue" class="headerlink" title="@CookieValue"></a>@CookieValue</h5><ul>
<li>获取cookie中的值</li>
<li>可以通过cookie中的key获取Cookie中某个key的值</li>
<li>可以通过key获取Cookie中的Cookie对象<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/test&quot;)</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">test</span><span class="params">(<span class="meta">@CookieValue(&quot;cookie1&quot;)</span> String cookie1,  </span></span></span><br><span class="line"><span class="params"><span class="function">                                <span class="meta">@CookieValue(&quot;cookie2&quot;)</span>Cookie cookie2 )</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="RequestBody"><a href="#RequestBody" class="headerlink" title="@RequestBody"></a>@RequestBody</h5><ul>
<li>从请求中获取参数（因为只有post和put请求才有请求体，所以只有在这两种请求类型中使用）</li>
<li>把json串映射成<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/test&quot;)</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">test</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String,String&gt; content )</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="RequestAttribute"><a href="#RequestAttribute" class="headerlink" title="@RequestAttribute"></a>@RequestAttribute</h5><ul>
<li>从请求域中获取参数</li>
<li><code>forward</code>关键字转发，将一个请求转发到某个路径，两个请求公用的一个请求信息，所以可以从请求域中携带数据</li>
<li>可以使用注解获取，也可以直接使用request方法获取</li>
<li>一般用户前后端不分离的项目传值使用<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestController</span> </span>&#123;  </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/goto&quot;)</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">gotoPage</span><span class="params">(HttpServletRequest request)</span></span>&#123;  </span><br><span class="line">        request.setAttribute(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;小明&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;forward:/success&quot;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@ResponseBody</span>  </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/success&quot;)</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title">index</span><span class="params">(<span class="meta">@RequestAttribute(&quot;name&quot;)</span> String name)</span></span>&#123;  </span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();  </span><br><span class="line">        map.put(<span class="string">&quot;name&quot;</span>,name);  </span><br><span class="line">        <span class="keyword">return</span> map;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="MatrixVariable"><a href="#MatrixVariable" class="headerlink" title="@MatrixVariable"></a>@MatrixVariable</h5><ul>
<li>矩阵变量，需要绑定到路径变量中</li>
<li>语法：/cars/sell;low=34;brand=byd,audi,yd<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  /cars/sell;low=34;brand=byd,audi,yd  </span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/cars/&#123;path&#125;&quot;)</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">cars</span><span class="params">(<span class="meta">@MatrixVariable(&quot;low&quot;)</span> Integer low,  </span></span></span><br><span class="line"><span class="params"><span class="function">                                    <span class="meta">@MatrixVariable(&quot;brand&quot;)</span> List&lt;String&gt; brand,  </span></span></span><br><span class="line"><span class="params"><span class="function">                                    <span class="meta">@PathVariable(&quot;path&quot;)</span> String path)</span> </span>&#123;...&#125;</span><br></pre></td></tr></table></figure></li>
<li>矩阵变量是绑定在路径变量中的，路径变量可以设置多个，如果多个路径变量中有名称相同的矩阵变量，可以设置参数根据路径变量的名称获取矩阵变量，如果不设置，直接以矩阵变量名称获取，默认会获取到第一个<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// boss/1;age=12/2;age=34  </span></span><br><span class="line"> <span class="meta">@GetMapping(&quot;/boss/&#123;bossId&#125;/&#123;empId&#125;&quot;)</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">boss</span><span class="params">(<span class="meta">@MatrixVariable(value = &quot;age&quot;,pathVar = &quot;bossId&quot;)</span> Integer bossAge,  </span></span></span><br><span class="line"><span class="params"><span class="function">                                    <span class="meta">@MatrixVariable(value = &quot;age&quot;,pathVar = &quot;empId&quot;)</span>  Integer empAge)</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure></li>
<li>springboot默认禁用矩阵变量，需要手动配置开启<ul>
<li>路径处理是通过<code>UrlPathHelper</code>进行处理的</li>
<li>其中有一个变量<code>removeSemicolonContent</code>（是否移除分号），该变量默认为true需要修改成false<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义WebMvcConfigurer，替换springboot的默认定义</span></span><br><span class="line"><span class="comment">//也可以继承WebMvcConfigurer接口，实现其中的方法进行处理</span></span><br><span class="line"><span class="meta">@Bean</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">webMvcConfigurer</span><span class="params">()</span></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer()&#123;  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> </span>&#123;  </span><br><span class="line">            UrlPathHelper urlPathHelper = <span class="keyword">new</span> UrlPathHelper();  </span><br><span class="line">            urlPathHelper.setRemoveSemicolonContent(<span class="keyword">false</span>);  </span><br><span class="line">            configurer.setUrlPathHelper(urlPathHelper);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="Servlet-API"><a href="#Servlet-API" class="headerlink" title="Servlet API"></a>Servlet API</h4><p>WebRequest、ServletRequest、MultipartRequest、 HttpSession、javax.servlet.http.PushBuilder、Principal、InputStream、Reader、HttpMethod、Locale、TimeZone、ZoneId</p>
<p>ServletRequestMethodArgumentResolver 以上的部分参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsParameter</span><span class="params">(MethodParameter parameter)</span> </span>&#123;  </span><br><span class="line">    Class&lt;?&gt; paramType = parameter.getParameterType();  </span><br><span class="line">    <span class="keyword">return</span> (WebRequest.class.isAssignableFrom(paramType) ||  </span><br><span class="line">          ServletRequest.class.isAssignableFrom(paramType) ||  </span><br><span class="line">          MultipartRequest.class.isAssignableFrom(paramType) ||  </span><br><span class="line">          HttpSession.class.isAssignableFrom(paramType) ||  </span><br><span class="line">          (pushBuilder != <span class="keyword">null</span> &amp;&amp; pushBuilder.isAssignableFrom(paramType)) ||  </span><br><span class="line">          (Principal.class.isAssignableFrom(paramType) &amp;&amp; !parameter.hasParameterAnnotations()) ||  </span><br><span class="line">          InputStream.class.isAssignableFrom(paramType) ||  </span><br><span class="line">          Reader.class.isAssignableFrom(paramType) ||  </span><br><span class="line">          HttpMethod.class == paramType ||  </span><br><span class="line">          Locale.class == paramType ||  </span><br><span class="line">          TimeZone.class == paramType ||  </span><br><span class="line">          ZoneId.class == paramType);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="复杂参数"><a href="#复杂参数" class="headerlink" title="复杂参数"></a>复杂参数</h4><p><strong>Map</strong>、<strong>Model（map、model里面的数据会被放在request的请求域 request.setAttribute）</strong>、Errors/BindingResult、<strong>RedirectAttributes（ 重定向携带数据）</strong>、<strong>ServletResponse（response）</strong>、SessionStatus、UriComponentsBuilder、ServletUriComponentsBuilder</p>
<blockquote>
<p>Map&lt;String,Object&gt; map、Model model HttpServletRequest request都可以给request域中放数据</p>
</blockquote>
<p>示例代码如下，向Map、Model和request中分别放入参数，然后转发到另外一个接口，尝试能不能从request作用域中取出参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/params&quot;)</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">params</span><span class="params">(Map&lt;String,Object&gt; map,  </span></span></span><br><span class="line"><span class="params"><span class="function">                     Model model,  </span></span></span><br><span class="line"><span class="params"><span class="function">                     HttpServletRequest request,  </span></span></span><br><span class="line"><span class="params"><span class="function">                     HttpServletResponse response)</span></span>&#123;  </span><br><span class="line">    map.put(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;world6666&quot;</span>);  </span><br><span class="line">    model.addAttribute(<span class="string">&quot;world&quot;</span>,<span class="string">&quot;hello666&quot;</span>);  </span><br><span class="line">    request.setAttribute(<span class="string">&quot;message&quot;</span>,<span class="string">&quot;hello world&quot;</span>);  </span><br><span class="line">    Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">&quot;c1&quot;</span>,<span class="string">&quot;v1&quot;</span>);  </span><br><span class="line">    response.addCookie(cookie);  </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;forward:/success&quot;</span>;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">@ResponseBody</span>  </span><br><span class="line"><span class="meta">@GetMapping(&quot;/success&quot;)</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title">index</span><span class="params">(HttpServletRequest request)</span></span>&#123;  </span><br><span class="line">    Object hello = request.getAttribute(<span class="string">&quot;hello&quot;</span>);  </span><br><span class="line">    Object world = request.getAttribute(<span class="string">&quot;world&quot;</span>);  </span><br><span class="line">    Object message = request.getAttribute(<span class="string">&quot;message&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">    Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();  </span><br><span class="line">    map.put(<span class="string">&quot;hello&quot;</span>,hello);  </span><br><span class="line">    map.put(<span class="string">&quot;world&quot;</span>,world);  </span><br><span class="line">    map.put(<span class="string">&quot;message&quot;</span>,message);  </span><br><span class="line">    <span class="keyword">return</span> map;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Map、Model类型的参数，会返回<code>mavContainer.getModel()</code>;两种类型的参数，返回的是同一个对象，对象类型是<code>BindingAwareModelMap</code>，这个类既是Map又是Model(同时继承了Model和Map接口并做了相应实现)<ul>
<li>org.springframework.web.method.support.ModelAndViewContainer#getModel</li>
</ul>
</li>
</ul>
<p>第一个参数是Map参数，第二个是Model参数，他们获取到的是同一个对象<br><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/Map&Model%E5%AF%B9%E8%B1%A1%E5%9B%BE%E7%A4%BA.png" alt="Map&amp;Model对象图示"><br>可以看到Map和Model中存放的参数最终都会到同一个对象中<br><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/Map&Model%E5%8F%82%E6%95%B0%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="Map&amp;Model参数示意图"></p>
<h4 id="自定义对象参数"><a href="#自定义对象参数" class="headerlink" title="自定义对象参数"></a>自定义对象参数</h4><p>可以自动类型转换与格式化，可以级联封装。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *     姓名： &lt;input name=&quot;userName&quot;/&gt; &lt;br/&gt;</span></span><br><span class="line"><span class="comment"> *     年龄： &lt;input name=&quot;age&quot;/&gt; &lt;br/&gt;</span></span><br><span class="line"><span class="comment"> *     生日： &lt;input name=&quot;birth&quot;/&gt; &lt;br/&gt;</span></span><br><span class="line"><span class="comment"> *     宠物姓名：&lt;input name=&quot;pet.name&quot;/&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="comment"> *     宠物年龄：&lt;input name=&quot;pet.age&quot;/&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="keyword">private</span> Pet pet;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="POJO封装过程"><a href="#POJO封装过程" class="headerlink" title="POJO封装过程"></a>POJO封装过程</h3><p><strong>ServletModelAttributeMethodProcessor</strong><br>只是单体项目表单传参，前后端分离项目传的是json数据使用的是<strong>RequestResponseBodyMethodProcessor</strong></p>
<h3 id="参数处理原理"><a href="#参数处理原理" class="headerlink" title="参数处理原理"></a>参数处理原理</h3><ul>
<li>HandlerMapping中找到能处理请求的Handler（Controller.method()那个类的那个方法）</li>
<li>为当前Handler找到一个适配器HandlerAdapter；RequestMappingHandlerAdapter</li>
<li>适配器执行目标方法并确定方法参数的每一个值</li>
</ul>
<h4 id="HandlerAdapter"><a href="#HandlerAdapter" class="headerlink" title="HandlerAdapter"></a>HandlerAdapter</h4><p><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/HandlerAdapter%E5%9B%BE%E7%A4%BA.png" alt="HandlerAdapter图示"><br>0- 支持方法上标注了@RequestMapping注解的<br>1- 支持函数式编程<br>…..</p>
<h4 id="执行目标方法"><a href="#执行目标方法" class="headerlink" title="执行目标方法"></a>执行目标方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.servlet.DispatcherServlet#doDispatch</span></span><br><span class="line"><span class="comment">// Actually invoke the handler.  </span></span><br><span class="line">mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter#handleInternal</span></span><br><span class="line"><span class="comment">// 执行目标方法</span></span><br><span class="line">mav = invokeHandlerMethod(request, response, handlerMethod);</span><br><span class="line"></span><br><span class="line"><span class="comment">//org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod#invokeAndHandle</span></span><br><span class="line"><span class="comment">//真正执行目标方法</span></span><br><span class="line">Object returnValue = invokeForRequest(webRequest, mavContainer, providedArgs);</span><br><span class="line"></span><br><span class="line"><span class="comment">//org.springframework.web.method.support.InvocableHandlerMethod#invokeForRequest</span></span><br><span class="line"><span class="comment">//获取方法参数值，然后就会反射调用方法执行</span></span><br><span class="line">Object[] args = getMethodArgumentValues(request, mavContainer, providedArgs);</span><br></pre></td></tr></table></figure>

<h4 id="参数解析器-HandlerMethodArgumentResolver"><a href="#参数解析器-HandlerMethodArgumentResolver" class="headerlink" title="参数解析器-HandlerMethodArgumentResolver"></a>参数解析器-HandlerMethodArgumentResolver</h4><ul>
<li>确定要执行的木变更方法的每一个参数的值是什么；</li>
<li>springboot目标方法能够写多少中参数类型，取决于参数解析器（目前springboot一共有27种解析器）<br><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%99%A8%E5%9B%BE%E7%A4%BA.png" alt="参数解析器图示"></li>
</ul>
<p><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/HandlerMethodArgumentResolver%E6%8E%A5%E5%8F%A3%E5%9B%BE%E7%A4%BA.png" alt="HandlerMethodArgumentResolver接口图示"></p>
<ul>
<li>所有参数解析器的父接口</li>
<li>先调用<code>supportsParameter</code>方法判断当前解析器能不能解析该参数</li>
<li>如果能够解析，就调用<code>resolveArgument</code>方法进行解析</li>
</ul>
<h4 id="返回值处理器"><a href="#返回值处理器" class="headerlink" title="返回值处理器"></a>返回值处理器</h4><ul>
<li>springboot能够返回多少中返回值类型，也取决于返回值处理器<br><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E8%BF%94%E5%9B%9E%E5%80%BC%E5%A4%84%E7%90%86%E5%99%A8%E5%9B%BE%E7%A4%BA.png" alt="返回值处理器图示"></li>
</ul>
<h4 id="如何确定目标方法每一个参数的值"><a href="#如何确定目标方法每一个参数的值" class="headerlink" title="如何确定目标方法每一个参数的值"></a>如何确定目标方法每一个参数的值</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.method.support.InvocableHandlerMethod#getMethodArgumentValues</span></span><br><span class="line"><span class="keyword">protected</span> Object[] getMethodArgumentValues(NativeWebRequest request, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,  </span><br><span class="line">       Object... providedArgs) <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">  <span class="comment">//获取所有方法参数的声明</span></span><br><span class="line">    MethodParameter[] parameters = getMethodParameters();  </span><br><span class="line">    <span class="keyword">if</span> (ObjectUtils.isEmpty(parameters)) &#123;  </span><br><span class="line">       <span class="keyword">return</span> EMPTY_ARGS;  </span><br><span class="line">    &#125;  </span><br><span class="line">  <span class="comment">//声明参数值的存储数组</span></span><br><span class="line">    Object[] args = <span class="keyword">new</span> Object[parameters.length];  </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parameters.length; i++) &#123;  </span><br><span class="line">       MethodParameter parameter = parameters[i];  </span><br><span class="line">       parameter.initParameterNameDiscovery(<span class="keyword">this</span>.parameterNameDiscoverer);  </span><br><span class="line">       args[i] = findProvidedArgument(parameter, providedArgs);  </span><br><span class="line">       <span class="keyword">if</span> (args[i] != <span class="keyword">null</span>) &#123;  </span><br><span class="line">          <span class="keyword">continue</span>;  </span><br><span class="line">       &#125;  </span><br><span class="line">       <span class="comment">//判断参数解析器中有没有能够解析该参数的解析器</span></span><br><span class="line">       <span class="keyword">if</span> (!<span class="keyword">this</span>.resolvers.supportsParameter(parameter)) &#123;  </span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(formatArgumentError(parameter, <span class="string">&quot;No suitable resolver&quot;</span>));  </span><br><span class="line">       &#125;  </span><br><span class="line">       <span class="keyword">try</span> &#123;  </span><br><span class="line">          args[i] = <span class="keyword">this</span>.resolvers.resolveArgument(parameter, mavContainer, request, <span class="keyword">this</span>.dataBinderFactory);  </span><br><span class="line">       &#125;  </span><br><span class="line">       <span class="keyword">catch</span> (Exception ex) &#123;  </span><br><span class="line">          <span class="comment">// Leave stack trace for later, exception may actually be resolved and handled...  </span></span><br><span class="line">          <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;  </span><br><span class="line">             String exMsg = ex.getMessage();  </span><br><span class="line">             <span class="keyword">if</span> (exMsg != <span class="keyword">null</span> &amp;&amp; !exMsg.contains(parameter.getExecutable().toGenericString())) &#123;  </span><br><span class="line">                logger.debug(formatArgumentError(parameter, exMsg));  </span><br><span class="line">             &#125;  </span><br><span class="line">          &#125;  </span><br><span class="line">          <span class="keyword">throw</span> ex;  </span><br><span class="line">       &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> args;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="挨个判断所有的参数解析器那个支持解析这个参数"><a href="#挨个判断所有的参数解析器那个支持解析这个参数" class="headerlink" title="挨个判断所有的参数解析器那个支持解析这个参数"></a>挨个判断所有的参数解析器那个支持解析这个参数</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.method.support.HandlerMethodArgumentResolverComposite#getArgumentResolver</span></span><br><span class="line"><span class="comment">//循环所有解析器，挨个判断那个解析器能够解析这个参数</span></span><br><span class="line"><span class="meta">@Nullable</span>  </span><br><span class="line"><span class="function"><span class="keyword">private</span> HandlerMethodArgumentResolver <span class="title">getArgumentResolver</span><span class="params">(MethodParameter parameter)</span> </span>&#123;  </span><br><span class="line">    HandlerMethodArgumentResolver result = <span class="keyword">this</span>.argumentResolverCache.get(parameter);  </span><br><span class="line">    <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;  </span><br><span class="line">       <span class="keyword">for</span> (HandlerMethodArgumentResolver resolver : <span class="keyword">this</span>.argumentResolvers) &#123;  </span><br><span class="line">          <span class="keyword">if</span> (resolver.supportsParameter(parameter)) &#123;  </span><br><span class="line">             result = resolver;  </span><br><span class="line">             <span class="keyword">this</span>.argumentResolverCache.put(parameter, result);  </span><br><span class="line">             <span class="keyword">break</span>;          &#125;  </span><br><span class="line">       &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> result;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="解析这个参数的值"><a href="#解析这个参数的值" class="headerlink" title="解析这个参数的值"></a>解析这个参数的值</h5><blockquote>
<p>调用各自 <font color="#245bdb">HandlerMethodArgumentResolver</font> 的 <font color="#de7802">resolveArgument</font> 方法即可</p>
</blockquote>
<h6 id="自定义类型参数-封装POJO"><a href="#自定义类型参数-封装POJO" class="headerlink" title="自定义类型参数 封装POJO"></a>自定义类型参数 封装POJO</h6><p><strong>ServletModelAttributeMethodProcessor</strong> 这个参数处理器支持<br>是否为简单类型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isSimpleValueType</span><span class="params">(Class&lt;?&gt; type)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (Void.class != type &amp;&amp; <span class="keyword">void</span>.class != type &amp;&amp;</span><br><span class="line">				(ClassUtils.isPrimitiveOrWrapper(type) ||</span><br><span class="line">				Enum.class.isAssignableFrom(type) ||</span><br><span class="line">				CharSequence.class.isAssignableFrom(type) ||</span><br><span class="line">				Number.class.isAssignableFrom(type) ||</span><br><span class="line">				Date.class.isAssignableFrom(type) ||</span><br><span class="line">				Temporal.class.isAssignableFrom(type) ||</span><br><span class="line">				URI.class == type ||</span><br><span class="line">				URL.class == type ||</span><br><span class="line">				Locale.class == type ||</span><br><span class="line">				Class.class == type));</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title">resolveArgument</span><span class="params">(MethodParameter parameter, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,</span></span></span><br><span class="line"><span class="params"><span class="function">			NativeWebRequest webRequest, <span class="meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">		Assert.state(mavContainer != <span class="keyword">null</span>, <span class="string">&quot;ModelAttributeMethodProcessor requires ModelAndViewContainer&quot;</span>);</span><br><span class="line">		Assert.state(binderFactory != <span class="keyword">null</span>, <span class="string">&quot;ModelAttributeMethodProcessor requires WebDataBinderFactory&quot;</span>);</span><br><span class="line"></span><br><span class="line">		String name = ModelFactory.getNameForParameter(parameter);</span><br><span class="line">		ModelAttribute ann = parameter.getParameterAnnotation(ModelAttribute.class);</span><br><span class="line">		<span class="keyword">if</span> (ann != <span class="keyword">null</span>) &#123;</span><br><span class="line">			mavContainer.setBinding(name, ann.binding());</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Object attribute = <span class="keyword">null</span>;</span><br><span class="line">		BindingResult bindingResult = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (mavContainer.containsAttribute(name)) &#123;</span><br><span class="line">			attribute = mavContainer.getModel().get(name);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// Create attribute instance</span></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				attribute = createAttribute(name, parameter, binderFactory, webRequest);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">catch</span> (BindException ex) &#123;</span><br><span class="line">				<span class="keyword">if</span> (isBindExceptionRequired(parameter)) &#123;</span><br><span class="line">					<span class="comment">// No BindingResult parameter -&gt; fail with BindException</span></span><br><span class="line">					<span class="keyword">throw</span> ex;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">// Otherwise, expose null/empty value and associated BindingResult</span></span><br><span class="line">				<span class="keyword">if</span> (parameter.getParameterType() == Optional.class) &#123;</span><br><span class="line">					attribute = Optional.empty();</span><br><span class="line">				&#125;</span><br><span class="line">				bindingResult = ex.getBindingResult();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (bindingResult == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="comment">// Bean property binding and validation;</span></span><br><span class="line">			<span class="comment">// skipped in case of binding failure on construction.</span></span><br><span class="line">	<span class="comment">//web数据绑定器，将请求参数的值绑定到指定的javaBean中</span></span><br><span class="line">	<span class="comment">//利用它里面的Converters将请求数据转成指定的数据类型，再次封装到JavaBean中</span></span><br><span class="line">	</span><br><span class="line">			WebDataBinder binder = binderFactory.createBinder(webRequest, attribute, name);</span><br><span class="line">			<span class="keyword">if</span> (binder.getTarget() != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (!mavContainer.isBindingDisabled(name)) &#123;</span><br><span class="line">					bindRequestParameters(binder, webRequest);</span><br><span class="line">				&#125;</span><br><span class="line">				validateIfApplicable(binder, parameter);</span><br><span class="line">				<span class="keyword">if</span> (binder.getBindingResult().hasErrors() &amp;&amp; isBindExceptionRequired(binder, parameter)) &#123;</span><br><span class="line">					<span class="keyword">throw</span> <span class="keyword">new</span> BindException(binder.getBindingResult());</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// Value type adaptation, also covering java.util.Optional</span></span><br><span class="line">			<span class="keyword">if</span> (!parameter.getParameterType().isInstance(attribute)) &#123;</span><br><span class="line">				attribute = binder.convertIfNecessary(binder.getTarget(), parameter.getParameterType(), parameter);</span><br><span class="line">			&#125;</span><br><span class="line">			bindingResult = binder.getBindingResult();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Add resolved attribute and BindingResult at the end of the model</span></span><br><span class="line">		Map&lt;String, Object&gt; bindingResultModel = bindingResult.getModel();</span><br><span class="line">		mavContainer.removeAttributes(bindingResultModel);</span><br><span class="line">		mavContainer.addAllAttributes(bindingResultModel);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> attribute;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p><strong>GenericConversionService</strong>：在设置每一个值的时候，找它里面的所有Converter那个可以将这个数据类型（request带来参数的字符串）转换到指定的类型（javaBean–Integer）<br>byte–file</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Converter</span>&lt;<span class="title">S</span>, <span class="title">T</span>&gt;</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/springboot%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E5%99%A8%E5%9B%BE%E7%A4%BA1.png" alt="springboot字段类型转换器图示1"></p>
<p><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/springboot%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E5%99%A8%E5%9B%BE%E7%A4%BA2.png" alt="springboot字段类型转换器图示2"></p>
<p>未来我们可以给WebDataBinder里面放自己的Converter；<br><code>private static final class StringToNumber&lt;T extends Number&gt; implements Converter&lt;String, T&gt;</code><br>自定义Converter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1、WebMvcConfigurer定制化SpringMVC的功能</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">webMvcConfigurer</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> </span>&#123;</span><br><span class="line">            UrlPathHelper urlPathHelper = <span class="keyword">new</span> UrlPathHelper();</span><br><span class="line">            <span class="comment">// 不移除；后面的内容。矩阵变量功能就可以生效</span></span><br><span class="line">            urlPathHelper.setRemoveSemicolonContent(<span class="keyword">false</span>);</span><br><span class="line">            configurer.setUrlPathHelper(urlPathHelper);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFormatters</span><span class="params">(FormatterRegistry registry)</span> </span>&#123;</span><br><span class="line">            registry.addConverter(<span class="keyword">new</span> Converter&lt;String, Pet&gt;() &#123;</span><br><span class="line">	<span class="comment">//原本提交数据是通过 pet.name 和 pet.age 来进行绑定的</span></span><br><span class="line">	<span class="comment">//现在直接通过 pet=啊猫,3  这个种自定义格式</span></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> Pet <span class="title">convert</span><span class="params">(String source)</span> </span>&#123;</span><br><span class="line">                    <span class="comment">// 啊猫,3</span></span><br><span class="line">                    <span class="keyword">if</span>(!StringUtils.isEmpty(source))&#123;</span><br><span class="line">                        Pet pet = <span class="keyword">new</span> Pet();</span><br><span class="line">                        String[] split = source.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                        pet.setName(split[<span class="number">0</span>]);</span><br><span class="line">                        pet.setAge(Integer.parseInt(split[<span class="number">1</span>]));</span><br><span class="line">                        <span class="keyword">return</span> pet;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="目标方法执行完成"><a href="#目标方法执行完成" class="headerlink" title="目标方法执行完成"></a>目标方法执行完成</h4><p>目标方法执行完毕后，将所有的数据都存放在<code>ModelAndViewContainer</code>中，包含要去的页面地址View，还包含Model数据<br><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/Map&Model%E5%8F%82%E6%95%B0%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="Map&amp;Model参数示意图"></p>
<h4 id="处理派发结果"><a href="#处理派发结果" class="headerlink" title="处理派发结果"></a>处理派发结果</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.servlet.DispatcherServlet#doDispatch</span></span><br><span class="line"><span class="comment">//处理最终结果,结果已经被封装到了 mv 对象中</span></span><br><span class="line">processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.servlet.view.AbstractView#render</span></span><br><span class="line"><span class="comment">//合并相应结果</span></span><br><span class="line">renderMergedOutputModel(mergedModel, getRequestToExpose(request), response);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.servlet.view.InternalResourceView#renderMergedOutputModel</span></span><br><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">renderMergedOutputModel</span><span class="params">(  </span></span></span><br><span class="line"><span class="params"><span class="function">       Map&lt;String, Object&gt; model, HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Expose the model object as request attributes.  </span></span><br><span class="line">    <span class="comment">//暴露模型作为请求域属性（将Model和Map中的参数放到请求域中）</span></span><br><span class="line">    exposeModelAsRequestAttributes(model, request);  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Expose helpers as request attributes, if any.  </span></span><br><span class="line">    exposeHelpers(request);  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Determine the path for the request dispatcher.  </span></span><br><span class="line">    String dispatcherPath = prepareForRendering(request, response);  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Obtain a RequestDispatcher for the target resource (typically a JSP).  </span></span><br><span class="line">    RequestDispatcher rd = getRequestDispatcher(request, dispatcherPath);  </span><br><span class="line">    <span class="keyword">if</span> (rd == <span class="keyword">null</span>) &#123;  </span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">&quot;Could not get RequestDispatcher for [&quot;</span> + getUrl() +  </span><br><span class="line">             <span class="string">&quot;]: Check that the corresponding file exists within your web application archive!&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// If already included or response already committed, perform include, else forward.  </span></span><br><span class="line">    <span class="keyword">if</span> (useInclude(request, response)) &#123;  </span><br><span class="line">       response.setContentType(getContentType());  </span><br><span class="line">       <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;  </span><br><span class="line">          logger.debug(<span class="string">&quot;Including [&quot;</span> + getUrl() + <span class="string">&quot;]&quot;</span>);  </span><br><span class="line">       &#125;  </span><br><span class="line">       rd.include(request, response);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">else</span> &#123;  </span><br><span class="line">       <span class="comment">// Note: The forwarded resource is supposed to determine the content type itself.  </span></span><br><span class="line">       <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;  </span><br><span class="line">          logger.debug(<span class="string">&quot;Forwarding to [&quot;</span> + getUrl() + <span class="string">&quot;]&quot;</span>);  </span><br><span class="line">       &#125;  </span><br><span class="line">       rd.forward(request, response);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">exposeModelAsRequestAttributes</span><span class="params">(Map&lt;String, Object&gt; model,  </span></span></span><br><span class="line"><span class="params"><span class="function">       HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">  <span class="comment">//把Model中的所有数据挨个遍历放到了请求域中</span></span><br><span class="line">    model.forEach((name, value) -&gt; &#123;  </span><br><span class="line">       <span class="keyword">if</span> (value != <span class="keyword">null</span>) &#123;  </span><br><span class="line">          request.setAttribute(name, value);  </span><br><span class="line">       &#125;  </span><br><span class="line">       <span class="keyword">else</span> &#123;  </span><br><span class="line">          request.removeAttribute(name);  </span><br><span class="line">       &#125;  </span><br><span class="line">    &#125;);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="数据响应与内容协商"><a href="#数据响应与内容协商" class="headerlink" title="数据响应与内容协商"></a>数据响应与内容协商</h2><p><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E6%95%B0%E6%8D%AE%E5%93%8D%E5%BA%94%E4%B8%8E%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E5%9B%BE%E7%A4%BA.png" alt="数据响应与内容协商"></p>
<h3 id="响应JSON"><a href="#响应JSON" class="headerlink" title="响应JSON"></a>响应JSON</h3><h4 id="jackson-jar-ResponseBody"><a href="#jackson-jar-ResponseBody" class="headerlink" title="jackson.jar+@ResponseBody"></a>jackson.jar+@ResponseBody</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  引入web场景后，会自动引入json场景处理json数据  --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  springboot的json处理主要是依靠jackson进行处理的，所以json场景中引入了jackson的依赖  --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.datatype<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-datatype-jdk8<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.datatype<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-datatype-jsr310<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们只需要在controller方法或者类上面添加 <code>@ResponseBody</code> 注解，就会自动返回json格式数据</p>
<h5 id="返回值解析器"><a href="#返回值解析器" class="headerlink" title="返回值解析器"></a>返回值解析器</h5><p>springboot默认情况下有15个返回值解析器<br><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E8%BF%94%E5%9B%9E%E5%80%BC%E8%A7%A3%E6%9E%90%E5%99%A8%E5%9B%BE%E7%A4%BA.png" alt="返回值解析器图示"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod#invokeAndHandle </span></span><br><span class="line"><span class="keyword">try</span> &#123;  </span><br><span class="line">	<span class="comment">// 调用返回值处理器处理返回值</span></span><br><span class="line">    <span class="keyword">this</span>.returnValueHandlers.handleReturnValue(  </span><br><span class="line">          returnValue, getReturnValueType(returnValue), mavContainer, webRequest);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite</span></span><br><span class="line"><span class="comment">//获取返回值处理器，并对返回值进行处理</span></span><br><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleReturnValue</span><span class="params">(<span class="meta">@Nullable</span> Object returnValue, MethodParameter returnType,  </span></span></span><br><span class="line"><span class="params"><span class="function">       ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">  <span class="comment">//获取返回值处理器</span></span><br><span class="line">    HandlerMethodReturnValueHandler handler = selectHandler(returnValue, returnType);  </span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="keyword">null</span>) &#123;  </span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Unknown return value type: &quot;</span> + returnType.getParameterType().getName());  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">//处理返回值</span></span><br><span class="line">    handler.handleReturnValue(returnValue, returnType, mavContainer, webRequest);  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//获取返回值处理器</span></span><br><span class="line"><span class="meta">@Nullable</span>  </span><br><span class="line"><span class="function"><span class="keyword">private</span> HandlerMethodReturnValueHandler <span class="title">selectHandler</span><span class="params">(<span class="meta">@Nullable</span> Object value, MethodParameter returnType)</span> </span>&#123;  </span><br><span class="line"><span class="comment">//判断是否是异步返回</span></span><br><span class="line">    <span class="keyword">boolean</span> isAsyncValue = isAsyncReturnValue(value, returnType);  </span><br><span class="line">    <span class="comment">//循环所有的返回值处理器</span></span><br><span class="line">    <span class="keyword">for</span> (HandlerMethodReturnValueHandler handler : <span class="keyword">this</span>.returnValueHandlers) &#123;  </span><br><span class="line">       <span class="keyword">if</span> (isAsyncValue &amp;&amp; !(handler <span class="keyword">instanceof</span> AsyncHandlerMethodReturnValueHandler)) &#123;  </span><br><span class="line">          <span class="keyword">continue</span>;  </span><br><span class="line">       &#125;  </span><br><span class="line">       <span class="comment">//判断返回值处理器是否可以处理该返回值</span></span><br><span class="line">       <span class="keyword">if</span> (handler.supportsReturnType(returnType)) &#123;  </span><br><span class="line">          <span class="keyword">return</span> handler;  </span><br><span class="line">       &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//org.springframework.web.servlet.mvc.method.annotation.RequestResponseBodyMethodProcessor#handleReturnValue</span></span><br><span class="line"><span class="comment">//最终处理标记了ResponseBody注解的返回值的处理器</span></span><br><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleReturnValue</span><span class="params">(<span class="meta">@Nullable</span> Object returnValue, MethodParameter returnType,  </span></span></span><br><span class="line"><span class="params"><span class="function">       ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span>  </span></span><br><span class="line"><span class="function">       <span class="keyword">throws</span> IOException, HttpMediaTypeNotAcceptableException, HttpMessageNotWritableException </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    mavContainer.setRequestHandled(<span class="keyword">true</span>);  </span><br><span class="line">    ServletServerHttpRequest inputMessage = createInputMessage(webRequest);  </span><br><span class="line">    ServletServerHttpResponse outputMessage = createOutputMessage(webRequest);  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Try even with null return value. ResponseBodyAdvice could get involved.  </span></span><br><span class="line">    <span class="comment">//使用消息转换器进行写出操作</span></span><br><span class="line">    writeWithMessageConverters(returnValue, returnType, inputMessage, outputMessage);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="返回值解析器原理"><a href="#返回值解析器原理" class="headerlink" title="返回值解析器原理"></a>返回值解析器原理</h5><p><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E8%BF%94%E5%9B%9E%E5%80%BC%E8%A7%A3%E6%9E%90%E5%99%A8%E5%86%85%E9%83%A8%E6%96%B9%E5%BC%8F%E5%9B%BE%E7%A4%BA.png" alt="返回值解析器内部方式图示"></p>
<ul>
<li>1、返回值处理器判断是否支持这种返回值 supportsReturnType</li>
<li>2、返回值处理器调用 handleReturnValue 进行处理</li>
<li>3、RequestResponseBodyMethodProcessor 可以处理返回值标了@ResponseBody注解的<ul>
<li>1、利用MessageConverters进行处理将数据写为json<ul>
<li>1、内容协商（浏览器默认会以请求头的方式告诉服务器他能接受什么样的内容类型）</li>
<li>2、服务器最终根据自身能力，决定服务器能生成什么样的内容数据（浏览器可以接受<code>*/*</code>表示所有格式的数据）</li>
<li>3、springMVC会挨个遍历容器底层的 HttpMessageConverter ，看谁能够处理？<ul>
<li>1、得到MappingJackson2HttpMessageConverter可以将对象写为JSON</li>
<li>2、利用MappingJackson2HttpMessageConverter将对象转为JSON再写出去。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E8%AF%B7%E6%B1%82%E5%A4%B4Accept%E5%8F%82%E6%95%B0%E5%9B%BE%E7%A4%BA.png" alt="请求头Accept参数图示"></p>
<h4 id="SpringMVC到底支持哪些返回值"><a href="#SpringMVC到底支持哪些返回值" class="headerlink" title="SpringMVC到底支持哪些返回值"></a>SpringMVC到底支持哪些返回值</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ModelAndView</span><br><span class="line">Model</span><br><span class="line">View</span><br><span class="line">ResponseEntity</span><br><span class="line">ResponseBodyEmitter</span><br><span class="line">StreamingResponseBody</span><br><span class="line">HttpEntity</span><br><span class="line">HttpHeaders</span><br><span class="line">Callable</span><br><span class="line">DeferredResult</span><br><span class="line">ListenableFuture</span><br><span class="line">CompletionStage</span><br><span class="line">WebAsyncTask</span><br><span class="line">有 <span class="meta">@ModelAttribute</span> 注解，并且不是一个简单类型</span><br><span class="line">有 <span class="meta">@ResponseBody</span> 注解   ----&gt; RequestResponseBodyMethodProcessor</span><br></pre></td></tr></table></figure>

<h4 id="HttpMessageConverter原理"><a href="#HttpMessageConverter原理" class="headerlink" title="HttpMessageConverter原理"></a>HttpMessageConverter原理</h4><h5 id="MessageConverter规范"><a href="#MessageConverter规范" class="headerlink" title="MessageConverter规范"></a>MessageConverter规范</h5><p><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/HttpMessageConverter%E6%96%B9%E6%B3%95%E5%9B%BE%E7%A4%BA.png" alt="HttpMessageConverter方法图示"></p>
<p>HttpMessageConverter：看是否支持将此 Class 类型的对象，转为MediaType类型的数据<br>例如：将 Person 对象转为 JSON 或者将 JSON 转为 Person </p>
<h5 id="默认的MessageConverter"><a href="#默认的MessageConverter" class="headerlink" title="默认的MessageConverter"></a>默认的MessageConverter</h5><p><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E7%B3%BB%E7%BB%9F%E4%B8%AD%E9%BB%98%E8%AE%A4%E7%9A%84HttpMessageConverter%E5%9B%BE%E7%A4%BA.png" alt="系统中默认的HttpMessageConverter图示"><br>（每个MessageConverter中都会初始化自己能够支持的 MediaType ，Class类型匹配之后也需要支持的 MediaType 匹配才能处理）<br>0 - ByteArrayHttpMessageConverter 只支持返回类型为 byte[]类型的<br>1 - StringHttpMessageConverter 只支持返回值类型为 String 类型的<br>2 - StringHttpMessageConverter 只支持返回值类型为 String 类型的<br>3 - ResourceHttpMessageConverter 只支持返回值类型为 Resource 接口实现类的<br>4 - ResourceRegionHttpMessageConverter 只支持返回值类型为 ResourceRegion 或其子类<br>5 - SourceHttpMessageConverter 支持类型为：DOMSource、SAXSource、StAXSource、StreamSource、Source五种类型的<br>6 - FormHttpMessageConverter 只支持 MultiValueMap 类型<br>7 - MappingJackson2HttpMessageConverter 支持任何类型<br>8 - MappingJackson2HttpMessageConverter 支持任何类型<br>9 - Jaxb2RootElementHttpMessageConverter 标记了XmlRootElement注解（支持注解方式xml处理）</p>
<p>最终MappingJackson2HttpMessageConverter 把对象转为JSON（利用底层Jackson的ObjectMapper转换的）<br><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/HttpMessageConverter%E5%A4%84%E7%90%86%E5%90%8E%E7%9A%84%E6%95%B0%E6%8D%AE%E5%9B%BE%E7%A4%BA.png" alt="HttpMessageConverter处理后的数据图示"></p>
<h3 id="内容协商"><a href="#内容协商" class="headerlink" title="内容协商"></a>内容协商</h3><p>根据客户端接收能力不同，返回不同媒体类型的数据。</p>
<h4 id="引入xml依赖"><a href="#引入xml依赖" class="headerlink" title="引入xml依赖"></a>引入xml依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="postman分别测试返回json和xml"><a href="#postman分别测试返回json和xml" class="headerlink" title="postman分别测试返回json和xml"></a>postman分别测试返回json和xml</h4><p>只需要改变请求头中 Accept 字段，HTTP协议中规定的，告诉服务器本客户端可以接收的数据类型<br>Accept: application/xml 接收xml格式数据<br>Accept: application/json 接收json格式数据</p>
<h4 id="开启浏览器参数方式内容协商功能"><a href="#开启浏览器参数方式内容协商功能" class="headerlink" title="开启浏览器参数方式内容协商功能"></a>开启浏览器参数方式内容协商功能</h4><p>为了方便内容协商，开启基于请求参数的内容协商功能（浏览器在默认情况下是基于请求头的，但是浏览器的请求头没办法很方便的修改）</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span>  </span><br><span class="line">  <span class="attr">mvc:</span>  </span><br><span class="line">    <span class="attr">contentnegotiation:</span>  </span><br><span class="line">      <span class="attr">favor-parameter:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>只需要在路径上添加format参数指定想要的请求类型即可<br><a target="_blank" rel="noopener" href="http://127.0.0.1:8080/test/person?format=xml">http://127.0.0.1:8080/test/person?format=xml</a><br><a target="_blank" rel="noopener" href="http://127.0.0.1:8080/test/person?format=json">http://127.0.0.1:8080/test/person?format=json</a></p>
<p>新增了一个ParameterContentNegotiationStrategy策略，策略中默认要解析的参数名称为format，并且支持xml和json两种格式数据<br><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E7%AE%A1%E7%90%86%E5%99%A8%E7%AD%96%E7%95%A5%E5%9B%BE%E7%A4%BA2.png" alt="内容协商管理器策略图示2"></p>
<p>确定客户端接收什么样的内容类型：<br>1、ParameterContentNegotiationStrategy 策略优先确定是要返回json数据（获取请求头中的format的值）<br>2、最终进行内容协商返回给客户端json数据</p>
<h4 id="内容协商原理"><a href="#内容协商原理" class="headerlink" title="内容协商原理"></a>内容协商原理</h4><ul>
<li><p>1、判断当前响应头中是否已经又确定的媒体类型。MediaType</p>
</li>
<li><p>2、获取客户端（postMan、浏览器）支持接收的内容类型。（获取客户端Accept请求头字段）【application/xml】</p>
<ul>
<li>contentNegotiationManager 内容协商管理器 默认使用基于请求头的策略</li>
<li><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E7%AE%A1%E7%90%86%E5%99%A8%E7%AD%96%E7%95%A5%E5%9B%BE%E7%A4%BA.png" alt="内容协商管理器策略图示"></li>
<li>HeaderContentNegotiationStrategy 确定客户端可以接收的内容类型</li>
<li><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/HeaderContentNegotiationStrategy%E5%9B%BE%E7%A4%BA.png" alt="HeaderContentNegotiationStrategy图示"></li>
</ul>
</li>
<li><p>3、循环遍历当前系统中所有的HttpMessageConverter，看谁能支持操作这个对象（Person）</p>
</li>
<li><p>4、找到支持操作Person的Converter，把Converter支持的媒体类型统计出来。</p>
</li>
<li><p>5、客户端需要【application/xml】。服务端能力【10种、json、xml】</p>
</li>
<li><p><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%94%AF%E6%8C%81%E7%9A%84%E5%AA%92%E4%BD%93%E7%B1%BB%E5%9E%8B%E5%9B%BE%E7%A4%BA.png" alt="服务的支持的媒体类型图示"></p>
</li>
<li></li>
<li><p>6、进行内容协商匹配最佳媒体类型</p>
</li>
<li><p>7、再次循环所有的HttpMessageConverter找到支持处理返回值类型（Person）并且支持最佳媒体类型的Converter，调用它进行转化。</p>
</li>
</ul>
<p><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E6%94%AF%E6%8C%81XML%E7%9A%84HttpMessageConverter%E5%9B%BE%E7%A4%BA.png" alt="支持XML的HttpMessageConverter图示"></p>
<p>导入了jackson处理xml的依赖，xml的converter就会自动注入进来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//WebMvcConfigurationSupport</span></span><br><span class="line"><span class="comment">//通过判断类 com.fasterxml.jackson.dataformat.xml.XmlMapper 是否存在，来确定是否添加xml的处理器</span></span><br><span class="line"><span class="keyword">if</span> (jackson2XmlPresent) &#123;  </span><br><span class="line">    Jackson2ObjectMapperBuilder builder = Jackson2ObjectMapperBuilder.xml();  </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.applicationContext != <span class="keyword">null</span>) &#123;  </span><br><span class="line">       builder.applicationContext(<span class="keyword">this</span>.applicationContext);  </span><br><span class="line">    &#125;  </span><br><span class="line">    messageConverters.add(<span class="keyword">new</span> MappingJackson2XmlHttpMessageConverter(builder.build()));  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="自定义MessageConverter"><a href="#自定义MessageConverter" class="headerlink" title="自定义MessageConverter"></a>自定义MessageConverter</h4><p><strong>实现多协议数据兼容，json、xml、y-data(自定义类型)</strong><br>0、@ResponseBody 响应数据出去，调用 RequestResponseBodyMethodProcessor 处理<br>1、Processor处理方法返回值，通过HttpMessageConverter处理<br>2、所有 HttpMessageConverter 合起来可以支持各种媒体类型数据的操作（读、写）<br>3、内容协商找到最终的 HttpMessageConverter</p>
<p>springMVC的功能，都有一个入口给容器中添加自定义，WebMvcConfigurer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">webMvcConfigurer</span><span class="params">()</span></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer() &#123;  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;  </span><br><span class="line">            converters.add(<span class="keyword">new</span> YdataHttpMessageConverter());  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请求的时候只需要设置请求头就可以实现数据格式切换</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET http://127.0.0.1:8080/test/person  </span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/y-data</span><br></pre></td></tr></table></figure>

<p>自定义实现代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 自定义HttpMessageConverter  </span></span><br><span class="line"><span class="comment"> * 将 Person 类型转换成 字段1;字段2;字段3;.... 这种格式  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> YS  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/10/21  </span></span><br><span class="line"><span class="comment"> */</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YdataHttpMessageConverter</span> <span class="keyword">implements</span> <span class="title">HttpMessageConverter</span>&lt;<span class="title">Person</span>&gt; </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canRead</span><span class="params">(Class&lt;?&gt; clazz, MediaType mediaType)</span> </span>&#123;  </span><br><span class="line">        <span class="comment">//不在实现读取功能，直接返回false  </span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canWrite</span><span class="params">(Class&lt;?&gt; clazz, MediaType mediaType)</span> </span>&#123;  </span><br><span class="line">        <span class="comment">//处理所有Person类型的返回值  </span></span><br><span class="line">        <span class="keyword">return</span> clazz.isAssignableFrom(Person.class);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * 服务器要统计所有HttpMessageConverter都能写出哪些内容类型  </span></span><br><span class="line"><span class="comment">     * application/y-data  </span></span><br><span class="line"><span class="comment">     */</span>    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;MediaType&gt; <span class="title">getSupportedMediaTypes</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> MediaType.parseMediaTypes(<span class="string">&quot;application/y-data&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">read</span><span class="params">(Class&lt;? extends Person&gt; clazz, HttpInputMessage inputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotReadableException </span>&#123;  </span><br><span class="line">        <span class="comment">//读取不做处理  </span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(Person person, MediaType contentType, HttpOutputMessage outputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotWritableException </span>&#123;  </span><br><span class="line">        <span class="comment">//自定义协议数据写出  </span></span><br><span class="line">        String data = person.getUserName()+<span class="string">&quot;;&quot;</span>+person.getAge()+<span class="string">&quot;;&quot;</span>+person.getBirth();  </span><br><span class="line">        <span class="comment">//写出去  </span></span><br><span class="line">        OutputStream body = outputMessage.getBody();  </span><br><span class="line">        body.write(data.getBytes());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如何实现url参数形式切换数据格式？<br>自定义内容基于参数的内容协商策略<br><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%BA%E4%BA%8E%E5%8F%82%E6%95%B0%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E7%AD%96%E7%95%A5%E5%9B%BE%E7%A4%BA.png" alt="自定义基于参数内容协商策略图示"></p>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">webMvcConfigurer</span><span class="params">()</span></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer() &#123;  </span><br><span class="line">        <span class="comment">/**  </span></span><br><span class="line"><span class="comment">         * 自定义内容协商策略  </span></span><br><span class="line"><span class="comment">         */</span>  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureContentNegotiation</span><span class="params">(ContentNegotiationConfigurer configurer)</span> </span>&#123;  </span><br><span class="line">            <span class="comment">//使用springboot提供的基于参数的内容协商策略进行扩展  </span></span><br><span class="line">            Map&lt;String, MediaType&gt; mediaTypes = <span class="keyword">new</span> HashMap&lt;&gt;();  </span><br><span class="line">            mediaTypes.put(<span class="string">&quot;json&quot;</span>,MediaType.APPLICATION_JSON);  </span><br><span class="line">            mediaTypes.put(<span class="string">&quot;xml&quot;</span>,MediaType.APPLICATION_XML);  </span><br><span class="line">            mediaTypes.put(<span class="string">&quot;yd&quot;</span>,MediaType.parseMediaType(<span class="string">&quot;application/y-data&quot;</span>));  </span><br><span class="line">            <span class="comment">//指定支持解析哪些参数对应的哪些媒体类型  </span></span><br><span class="line">            ParameterContentNegotiationStrategy strategy = <span class="keyword">new</span> ParameterContentNegotiationStrategy(mediaTypes);  </span><br><span class="line">            configurer.strategies(Collections.singletonList(strategy));  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;  </span><br><span class="line">        <span class="comment">//自定义HttpMessageConverter</span></span><br><span class="line">            converters.add(<span class="keyword">new</span> YdataHttpMessageConverter());  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上，自定义了基于参数的内容协商策略之后，由于是进行了覆盖，所以导致基于请求头的内容协商策略失效。<br>我们添加一些其他的功能也有可能导致同样的事情发生，所以有些扩展需要谨慎使用。<br><strong>也可以使用如下配置来增加参数和媒体类型的对应：</strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span>  </span><br><span class="line">  <span class="attr">mvc:</span>  </span><br><span class="line">    <span class="attr">contentnegotiation:</span>  </span><br><span class="line">      <span class="comment"># 开启基于参数的内容协商策略  </span></span><br><span class="line">      <span class="attr">favor-parameter:</span> <span class="literal">true</span>  </span><br><span class="line">      <span class="comment"># 增加基于参数的内容协商策略中的参数和媒体类型的对应  </span></span><br><span class="line">      <span class="attr">media-types:</span>  </span><br><span class="line">        <span class="attr">yd:</span> <span class="string">application/y-data</span></span><br></pre></td></tr></table></figure>

<h2 id="视图解析与模板引擎"><a href="#视图解析与模板引擎" class="headerlink" title="视图解析与模板引擎"></a>视图解析与模板引擎</h2><p>试图解析：springboot默认不支持JSP，需要引入第三方模板引擎技术实现页面渲染。</p>
<h3 id="视图解析"><a href="#视图解析" class="headerlink" title="视图解析"></a>视图解析</h3><p><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E8%A7%86%E5%9B%BE%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F%E5%9B%BE%E7%A4%BA.png" alt="视图处理方式图示"></p>
<h4 id="视图解析原理流程"><a href="#视图解析原理流程" class="headerlink" title="视图解析原理流程"></a>视图解析原理流程</h4><ul>
<li>1、目标方法处理的过程中，所有数据都会被放在 <strong>ModelAndViewContainer</strong> 里面，包括数据和视图地址</li>
<li>2、方法的参数是一个自定义类型对象（从请求参数中确定的），也会放在 ModelAndViewContainer 里面</li>
<li>3、任何目标方法执行完成以后都会返回 <strong>ModelAndView</strong> （数据和视图地址）</li>
<li>4、processDispatchResult 处理派发结果（页面该如何响应）<ul>
<li>1、render(mv, request, response);进行页面渲染逻辑<ul>
<li>1、根据方法的String返回值得到 View 对象【定义了页面的渲染逻辑】<ul>
<li>1、循环所有的视图解析器尝试是否能根据当前返回值得到view对象</li>
<li><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%99%A8%E5%9B%BE%E7%A4%BA.png" alt="视图解析器图示"></li>
<li>2、得到了 <strong>login</strong> –&gt; ThymeleafView (根据返回值得到对应的view)</li>
<li>3、ContentNegotiatingViewResolver 里面包含了下面所有的视图解析器，内部还是利用下面所有视图解析器得到视图对象</li>
<li>4、view.render(mv.getModelInternal(), request, response); 视图对象调用自定义的 render 进行页面渲染工作<ul>
<li>RedirectView 如何渲染【重定向到一个页面】</li>
<li>1、获取目标url地址</li>
<li>2、response.sendRedirect(encodedURL); 重定向到啊对应页面</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>视图解析：</p>
<ul>
<li>返回值以 <code>forward:</code> 开始：new InternalResourceView(forwardUrl); –&gt; 转发，request.getRequestDispatcher(path).forward(request, response);</li>
<li>返回值以 <code>redirect:</code> 开始：new RedirectView() –&gt; render 就是重定向</li>
<li>返回值是普通字符串：new ThymeleafView() –&gt; 使用视图解析器，进行文本解析，然后将解析后的视图返回到输出流</li>
</ul>
<p>自定义视图解析器+自定义视图；</p>
<h3 id="模板引擎-Thymeleaf"><a href="#模板引擎-Thymeleaf" class="headerlink" title="模板引擎-Thymeleaf"></a>模板引擎-Thymeleaf</h3><h4 id="Thymeleaf简介"><a href="#Thymeleaf简介" class="headerlink" title="Thymeleaf简介"></a>Thymeleaf简介</h4><p>Thymeleaf is a modern server-side Java template engine for both web and standalone environments.<br><strong>现代化、服务端Java模板引擎</strong></p>
<h4 id="基本语法-1"><a href="#基本语法-1" class="headerlink" title="基本语法"></a>基本语法</h4><h5 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h5><table>
<thead>
<tr>
<th align="center">表达式名字</th>
<th align="center">语法</th>
<th align="center">用途</th>
</tr>
</thead>
<tbody><tr>
<td align="center">变量取值</td>
<td align="center">${…}</td>
<td align="center">获取请求域、session域、对象等值</td>
</tr>
<tr>
<td align="center">选择变量</td>
<td align="center">*{…}</td>
<td align="center">获取上下文对象值</td>
</tr>
<tr>
<td align="center">消息</td>
<td align="center">#{…}</td>
<td align="center">获取国际化等值</td>
</tr>
<tr>
<td align="center">链接</td>
<td align="center">@{…}</td>
<td align="center">生成链接</td>
</tr>
<tr>
<td align="center">片段表达式</td>
<td align="center">~{…}</td>
<td align="center">jsp:include作用，引入公共页面片段</td>
</tr>
</tbody></table>
<h5 id="字面量"><a href="#字面量" class="headerlink" title="字面量"></a>字面量</h5><p>文本值：’one text’ 单引号<br>数字：0，12，3.0 直接写数字即可<br>布尔值：true，false<br>空值：null<br>变量：one，two，变量不能有空格</p>
<h5 id="文本操作"><a href="#文本操作" class="headerlink" title="文本操作"></a>文本操作</h5><p>字符串拼接：+<br>变量替换：【The name is #{name}】</p>
<h5 id="数学运算"><a href="#数学运算" class="headerlink" title="数学运算"></a>数学运算</h5><p>运算符：+，-，*，/，%</p>
<h5 id="布尔运算"><a href="#布尔运算" class="headerlink" title="布尔运算"></a>布尔运算</h5><p>运算符：and，or<br>一元运算：!，not</p>
<h5 id="比较运算"><a href="#比较运算" class="headerlink" title="比较运算"></a>比较运算</h5><p>比较：&gt;, &lt;, &gt;=, &lt;=(gt, lt, ge, le)<br>等式：==，!= (eq, ne)</p>
<h5 id="条件运算"><a href="#条件运算" class="headerlink" title="条件运算"></a>条件运算</h5><p>if-then: (if) ? (then)<br>if-then-else:(if) ? (then) : (else)<br>Default:(value) ?: (defaultvalue)</p>
<h5 id="特殊操作"><a href="#特殊操作" class="headerlink" title="特殊操作"></a>特殊操作</h5><p>无操作：_</p>
<h4 id="设置属性值-th-attr"><a href="#设置属性值-th-attr" class="headerlink" title="设置属性值-th:attr"></a>设置属性值-th:attr</h4><p>设置单个值：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;subscribe.html&quot;</span> <span class="attr">th:attr</span>=<span class="string">&quot;action=@&#123;/subscribe&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Subscribe!&quot;</span> <span class="attr">th:attr</span>=<span class="string">&quot;value=#&#123;subscribe.submit&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>设置多个值：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;../../images/gtvglogo.png&quot;</span>  <span class="attr">th:attr</span>=<span class="string">&quot;src=@&#123;/images/gtvglogo.png&#125;,title=#&#123;logo&#125;,alt=#&#123;logo&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>以上两个的代替写法 th:xxx</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Subscribe!&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;#&#123;subscribe.submit&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;subscribe.html&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/subscribe&#125;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>所有h5兼容的标签写法：<br><a target="_blank" rel="noopener" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#setting-value-to-specific-attributes">https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#setting-value-to-specific-attributes</a></p>
<h4 id="迭代"><a href="#迭代" class="headerlink" title="迭代"></a>迭代</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;prod : $&#123;prods&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.name&#125;&quot;</span>&gt;</span>Onions<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.price&#125;&quot;</span>&gt;</span>2.41<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.inStock&#125;? #&#123;true&#125; : #&#123;false&#125;&quot;</span>&gt;</span>yes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;prod,iterStat : $&#123;prods&#125;&quot;</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;iterStat.odd&#125;? &#x27;odd&#x27;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.name&#125;&quot;</span>&gt;</span>Onions<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.price&#125;&quot;</span>&gt;</span>2.41<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.inStock&#125;? #&#123;true&#125; : #&#123;false&#125;&quot;</span>&gt;</span>yes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="条件运算-1"><a href="#条件运算-1" class="headerlink" title="条件运算"></a>条件运算</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;comments.html&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">th:href</span>=<span class="string">&quot;@&#123;/product/comments(prodId=$&#123;prod.id&#125;)&#125;&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #lists.isEmpty(prod.comments)&#125;&quot;</span>&gt;</span>view<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:switch</span>=<span class="string">&quot;$&#123;user.role&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;&#x27;admin&#x27;&quot;</span>&gt;</span>User is an administrator<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;#&#123;roles.manager&#125;&quot;</span>&gt;</span>User is a manager<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;*&quot;</span>&gt;</span>User is some other thing<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="属性优先级"><a href="#属性优先级" class="headerlink" title="属性优先级"></a>属性优先级</h4><p><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/thymeleaf%E5%B1%9E%E6%80%A7%E4%BC%98%E5%85%88%E7%BA%A7%E5%9B%BE%E7%A4%BA.png" alt="thymeleaf属性优先级图示"></p>
<h3 id="thymeleaf使用"><a href="#thymeleaf使用" class="headerlink" title="thymeleaf使用"></a>thymeleaf使用</h3><h4 id="引入Starter"><a href="#引入Starter" class="headerlink" title="引入Starter"></a>引入Starter</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="自动配置好了Thymeleaf"><a href="#自动配置好了Thymeleaf" class="headerlink" title="自动配置好了Thymeleaf"></a>自动配置好了Thymeleaf</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration(after = &#123; WebMvcAutoConfiguration.class, WebFluxAutoConfiguration.class &#125;)</span>  </span><br><span class="line"><span class="meta">@EnableConfigurationProperties(ThymeleafProperties.class)</span>  </span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; TemplateMode.class, SpringTemplateEngine.class &#125;)</span>  </span><br><span class="line"><span class="meta">@Import(&#123; TemplateEngineConfigurations.ReactiveTemplateEngineConfiguration.class,  </span></span><br><span class="line"><span class="meta">       TemplateEngineConfigurations.DefaultTemplateEngineConfiguration.class &#125;)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThymeleafAutoConfiguration</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure>

<p>自动配好的策略：</p>
<ul>
<li>1、所有thymeleaf的配置值都在 ThymeleafProperties org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration</li>
<li>2、配置好了 SpringTemplateEngine （模板引擎）org.springframework.boot.autoconfigure.thymeleaf.TemplateEngineConfigurations</li>
<li>3、配好了 ThymeleafViewResolver （视图解析器）org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration</li>
<li>4、我们只需要直接开发页面就可以了</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ThymeleafProperties中默认的前缀和后缀</span></span><br><span class="line"><span class="comment">//默认前缀，也就是页面文件需要存放的相对路径</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_PREFIX = <span class="string">&quot;classpath:/templates/&quot;</span>;  </span><br><span class="line"><span class="comment">//默认后缀，也就是页面文件默认的文件格式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_SUFFIX = <span class="string">&quot;.html&quot;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="页面开发"><a href="#页面开发" class="headerlink" title="页面开发"></a>页面开发</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span>哈哈<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;<span class="name">h2</span>&gt;</span>  </span><br><span class="line">	    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;www.haha.com&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;$&#123;link&#125;&quot;</span>&gt;</span>去百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  </span><br><span class="line">	    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;www.haha.com&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;link&#125;&quot;</span>&gt;</span>去百度2<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h2><h3 id="HandlerInterceptor接口"><a href="#HandlerInterceptor接口" class="headerlink" title="HandlerInterceptor接口"></a>HandlerInterceptor接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 登录检查  </span></span><br><span class="line"><span class="comment"> * 1、配置好拦截器需要拦截哪些请求  </span></span><br><span class="line"><span class="comment"> * 2、把这些配置放到容器中  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginHandlerInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * 目标方法执行之前  </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        <span class="comment">//登录检查逻辑  </span></span><br><span class="line">        HttpSession session = request.getSession();  </span><br><span class="line">        <span class="comment">//检查是否已经登录  </span></span><br><span class="line">        Object loginUser = session.getAttribute(<span class="string">&quot;loginUser&quot;</span>);  </span><br><span class="line">        <span class="comment">//登录信息不为空，放行  </span></span><br><span class="line">        <span class="keyword">if</span> (loginUser != <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">true</span>;  </span><br><span class="line">        <span class="comment">//拦截，未登录，跳转到登录页  </span></span><br><span class="line"><span class="comment">//        session.setAttribute(&quot;msg&quot;,&quot;请先登录!&quot;);  </span></span><br><span class="line">        request.setAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;请先登录!&quot;</span>);  </span><br><span class="line">        <span class="comment">//重定向到登录页面  </span></span><br><span class="line"><span class="comment">//        response.sendRedirect(&quot;/&quot;);  </span></span><br><span class="line">        <span class="comment">//在session中存放数据，使用重定向，会导致前端接收不到存放的数据  </span></span><br><span class="line">        <span class="comment">//将数据存放到请求域中，使用转发，前端可以正常拿到数据  </span></span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;/&quot;</span>).forward(request,response);  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * 目标方法执行完成之后  </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        HandlerInterceptor.<span class="keyword">super</span>.postHandle(request, response, handler, modelAndView);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * 页面渲染以后  </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        HandlerInterceptor.<span class="keyword">super</span>.afterCompletion(request, response, handler, ex);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置拦截器"><a href="#配置拦截器" class="headerlink" title="配置拦截器"></a>配置拦截器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 1、编写一个拦截器实现HandlerInterceptor接口  </span></span><br><span class="line"><span class="comment"> * 2、拦截器注册到容器中，（实现WebMvcConfigurer接口的addInterceptors方法）  </span></span><br><span class="line"><span class="comment"> * 3、指定拦截规则【如果是拦截所有，静态资源也会被拦截】  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="meta">@Configuration</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminWebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;  </span><br><span class="line">        <span class="comment">//添加自定义拦截器  </span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> LoginHandlerInterceptor())  </span><br><span class="line">                <span class="comment">//指定拦截路径  </span></span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>)<span class="comment">//拦截所有请求，静态资源也会被拦截，需要在下面放过静态资源  </span></span><br><span class="line">                <span class="comment">//指定需要放行的路径  </span></span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;login&quot;</span>,<span class="string">&quot;/css/**&quot;</span>,<span class="string">&quot;/fonts/**&quot;</span>,<span class="string">&quot;/images/**&quot;</span>,<span class="string">&quot;/js/**&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="拦截器原理"><a href="#拦截器原理" class="headerlink" title="拦截器原理"></a>拦截器原理</h3><ul>
<li>1、根据当前请求，找到 <strong>HandlerExecutionChain</strong> 【可以处理请求的handler以及handler的所有拦截器集合】</li>
<li>2、先<strong>顺序执行</strong>所有拦截器的 preHandle 方法<ul>
<li>1、如果当前拦截器的 preHandle 方法返回true，则执行下一个拦截器的 preHandle</li>
<li>2、如果当前拦截器preHandle 方法返回false，直接 <strong>倒序执行</strong>所有<strong>已经执行了的</strong>拦截器的 afterCompletion 方法</li>
</ul>
</li>
<li>3、如果任何一个拦截器返回false，则直接跳出不执行目标方法</li>
<li>4、所有拦截器都返回true，执行目标方法</li>
<li>5、倒序执行所有拦截器的postHandle方法，</li>
<li>6、前面的步骤有任何异常都会直接倒序执行afterCompletion</li>
<li>7、页面成功渲染完成以后，也会倒序触发 afterCompletion 方法</li>
</ul>
<p><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/HandlerExecutionChain%E5%9B%BE%E7%A4%BA.png" alt="HandlerExecutionChain"></p>
<p><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/springboot%E6%8B%A6%E6%88%AA%E5%99%A8%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%9B%BE%E7%A4%BA.png" alt="springboot拦截器执行流程图示"></p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h3 id="页面表单"><a href="#页面表单" class="headerlink" title="页面表单"></a>页面表单</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/upload&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span>  </span><br><span class="line">    邮箱:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span>  </span><br><span class="line">    名字:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span>  </span><br><span class="line">    头像:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span>  </span><br><span class="line">    生活照:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;photos&quot;</span> <span class="attr">multiple</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="文件上传代码"><a href="#文件上传代码" class="headerlink" title="文件上传代码"></a>文件上传代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/upload&quot;)</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(<span class="meta">@RequestParam</span> String email,  </span></span></span><br><span class="line"><span class="params"><span class="function">                     <span class="meta">@RequestParam</span> String username,  </span></span></span><br><span class="line"><span class="params"><span class="function">                     <span class="meta">@RequestPart</span> MultipartFile file,  </span></span></span><br><span class="line"><span class="params"><span class="function">                    <span class="meta">@RequestPart</span> MultipartFile[] photos )</span></span>&#123;  </span><br><span class="line">    log.info(<span class="string">&quot;接收到的信息:email=&#123;&#125;,username=&#123;&#125;,file=&#123;&#125;,photos=&#123;&#125;&quot;</span>,  </span><br><span class="line">            email,username,file.getSize(),photos.length);  </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;main&quot;</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自动配置原理"><a href="#自动配置原理" class="headerlink" title="自动配置原理"></a>自动配置原理</h3><p><strong>文件上传自动配置类-MultipartAutoConfiguration-MultipartProperties</strong> </p>
<ul>
<li>自动配置好了 <strong>StandardServletMultipartResolver</strong> （文件上传解析器）</li>
<li>原理步骤<ul>
<li>1、请求进来使用文件上传解析器判断（isMultipart）并封装（resolveMultipart，返回MultipartHttpServletRequest）文件上传请求</li>
<li>2、参数解析器来解析请求中的文件内容，并封装成<strong>MultipartFile</strong></li>
<li><img src="/2023/10/28/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%99%A8%E5%9B%BE%E7%A4%BA.png" alt="文件上传参数解析器图示"></li>
<li>3、将request中文件信息封装为Map；LinkedMultiValueMap&lt;String,List&lt;MultipartFile&gt;&gt;<br>FileCopyUtils，工具类，方便文件复制</li>
</ul>
</li>
</ul>
<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><h4 id="默认规则"><a href="#默认规则" class="headerlink" title="默认规则"></a>默认规则</h4><h4 id="定制错误处理逻辑"><a href="#定制错误处理逻辑" class="headerlink" title="定制错误处理逻辑"></a>定制错误处理逻辑</h4><h4 id="异常处理自动配置原理"><a href="#异常处理自动配置原理" class="headerlink" title="异常处理自动配置原理"></a>异常处理自动配置原理</h4><h4 id="异常处理步骤流程"><a href="#异常处理步骤流程" class="headerlink" title="异常处理步骤流程"></a>异常处理步骤流程</h4><h2 id="Web原生组件注入（Servlet、Filter、Listenter）"><a href="#Web原生组件注入（Servlet、Filter、Listenter）" class="headerlink" title="Web原生组件注入（Servlet、Filter、Listenter）"></a>Web原生组件注入（Servlet、Filter、Listenter）</h2><h3 id="使用Servlet-API"><a href="#使用Servlet-API" class="headerlink" title="使用Servlet API"></a>使用Servlet API</h3><h3 id="使用RegistrationBean"><a href="#使用RegistrationBean" class="headerlink" title="使用RegistrationBean"></a>使用RegistrationBean</h3><h2 id="嵌入式Servlet容器"><a href="#嵌入式Servlet容器" class="headerlink" title="嵌入式Servlet容器"></a>嵌入式Servlet容器</h2><h3 id="切换嵌入式Servlet"><a href="#切换嵌入式Servlet" class="headerlink" title="切换嵌入式Servlet"></a>切换嵌入式Servlet</h3><h3 id="定制Servlet容器"><a href="#定制Servlet容器" class="headerlink" title="定制Servlet容器"></a>定制Servlet容器</h3><h2 id="定制化原理"><a href="#定制化原理" class="headerlink" title="定制化原理"></a>定制化原理</h2><h3 id="定制化的常见方式"><a href="#定制化的常见方式" class="headerlink" title="定制化的常见方式"></a>定制化的常见方式</h3><h3 id="原理分析套路"><a href="#原理分析套路" class="headerlink" title="原理分析套路"></a>原理分析套路</h3><h1 id="数据访问"><a href="#数据访问" class="headerlink" title="数据访问"></a>数据访问</h1><h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h2><h3 id="数据源的自动配置-HikariDataSource"><a href="#数据源的自动配置-HikariDataSource" class="headerlink" title="数据源的自动配置-HikariDataSource"></a>数据源的自动配置-HikariDataSource</h3><h4 id="导入JDBC场景"><a href="#导入JDBC场景" class="headerlink" title="导入JDBC场景"></a>导入JDBC场景</h4><h4 id="分析自动配置"><a href="#分析自动配置" class="headerlink" title="分析自动配置"></a>分析自动配置</h4><h5 id="自动配置的类"><a href="#自动配置的类" class="headerlink" title="自动配置的类"></a>自动配置的类</h5><h4 id="修改配置项"><a href="#修改配置项" class="headerlink" title="修改配置项"></a>修改配置项</h4><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><h3 id="使用Druid数据源"><a href="#使用Druid数据源" class="headerlink" title="使用Druid数据源"></a>使用Druid数据源</h3><h4 id="druid官方github地址"><a href="#druid官方github地址" class="headerlink" title="druid官方github地址"></a>druid官方github地址</h4><h4 id="自定义方式"><a href="#自定义方式" class="headerlink" title="自定义方式"></a>自定义方式</h4><h5 id="创建数据源"><a href="#创建数据源" class="headerlink" title="创建数据源"></a>创建数据源</h5><h5 id="StatViewServlet"><a href="#StatViewServlet" class="headerlink" title="StatViewServlet"></a>StatViewServlet</h5><h5 id="StatFilter"><a href="#StatFilter" class="headerlink" title="StatFilter"></a>StatFilter</h5><h4 id="使用官方starter方式"><a href="#使用官方starter方式" class="headerlink" title="使用官方starter方式"></a>使用官方starter方式</h4><h5 id="引入druid-starter"><a href="#引入druid-starter" class="headerlink" title="引入druid-starter"></a>引入druid-starter</h5><h5 id="分析自动配置-1"><a href="#分析自动配置-1" class="headerlink" title="分析自动配置"></a>分析自动配置</h5><h5 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h5><h3 id="整合Mybatis操作"><a href="#整合Mybatis操作" class="headerlink" title="整合Mybatis操作"></a>整合Mybatis操作</h3><h4 id="配置模式"><a href="#配置模式" class="headerlink" title="配置模式"></a>配置模式</h4><h4 id="注解模式"><a href="#注解模式" class="headerlink" title="注解模式"></a>注解模式</h4><h4 id="混合模式"><a href="#混合模式" class="headerlink" title="混合模式"></a>混合模式</h4><h3 id="整合Mybatis-plus-完成CRUD"><a href="#整合Mybatis-plus-完成CRUD" class="headerlink" title="整合Mybatis-plus 完成CRUD"></a>整合Mybatis-plus 完成CRUD</h3><h4 id="什么是Mybatis-plus"><a href="#什么是Mybatis-plus" class="headerlink" title="什么是Mybatis-plus"></a>什么是Mybatis-plus</h4><h4 id="整合Mybatis-plus"><a href="#整合Mybatis-plus" class="headerlink" title="整合Mybatis-plus"></a>整合Mybatis-plus</h4><h4 id="CRUD功能"><a href="#CRUD功能" class="headerlink" title="CRUD功能"></a>CRUD功能</h4><h2 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL"></a>NoSQL</h2><h3 id="Redis自动配置"><a href="#Redis自动配置" class="headerlink" title="Redis自动配置"></a>Redis自动配置</h3><h3 id="RedisTemplate与Lettice"><a href="#RedisTemplate与Lettice" class="headerlink" title="RedisTemplate与Lettice"></a>RedisTemplate与Lettice</h3><h3 id="切换至jedis"><a href="#切换至jedis" class="headerlink" title="切换至jedis"></a>切换至jedis</h3><h1 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h1><h2 id="Junit5的变化"><a href="#Junit5的变化" class="headerlink" title="Junit5的变化"></a>Junit5的变化</h2><h2 id="Junit5常用的注解"><a href="#Junit5常用的注解" class="headerlink" title="Junit5常用的注解"></a>Junit5常用的注解</h2><h2 id="断言（assertions）"><a href="#断言（assertions）" class="headerlink" title="断言（assertions）"></a>断言（assertions）</h2><h3 id="简单断言"><a href="#简单断言" class="headerlink" title="简单断言"></a>简单断言</h3><h3 id="数组断言"><a href="#数组断言" class="headerlink" title="数组断言"></a>数组断言</h3><h3 id="组合断言"><a href="#组合断言" class="headerlink" title="组合断言"></a>组合断言</h3><h3 id="异常断言"><a href="#异常断言" class="headerlink" title="异常断言"></a>异常断言</h3><h3 id="超时断言"><a href="#超时断言" class="headerlink" title="超时断言"></a>超时断言</h3><h3 id="快速失败"><a href="#快速失败" class="headerlink" title="快速失败"></a>快速失败</h3><h2 id="前置条件（assumptions）"><a href="#前置条件（assumptions）" class="headerlink" title="前置条件（assumptions）"></a>前置条件（assumptions）</h2><h2 id="嵌套测试"><a href="#嵌套测试" class="headerlink" title="嵌套测试"></a>嵌套测试</h2><h2 id="参数化测试"><a href="#参数化测试" class="headerlink" title="参数化测试"></a>参数化测试</h2><h2 id="迁移指南"><a href="#迁移指南" class="headerlink" title="迁移指南"></a>迁移指南</h2><h1 id="指标监控"><a href="#指标监控" class="headerlink" title="指标监控"></a>指标监控</h1><h2 id="SpringBoot-Actuator"><a href="#SpringBoot-Actuator" class="headerlink" title="SpringBoot Actuator"></a>SpringBoot Actuator</h2><h3 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h3><h3 id="1-x和2-x的不同"><a href="#1-x和2-x的不同" class="headerlink" title="1.x和2.x的不同"></a>1.x和2.x的不同</h3><h3 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h3><h3 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h3><h2 id="Actuator-Endpoint"><a href="#Actuator-Endpoint" class="headerlink" title="Actuator Endpoint"></a>Actuator Endpoint</h2><h3 id="最常使用的端点"><a href="#最常使用的端点" class="headerlink" title="最常使用的端点"></a>最常使用的端点</h3><h3 id="Health-Endpoint"><a href="#Health-Endpoint" class="headerlink" title="Health Endpoint"></a>Health Endpoint</h3><h3 id="Metrics-Endpoint"><a href="#Metrics-Endpoint" class="headerlink" title="Metrics Endpoint"></a>Metrics Endpoint</h3><h3 id="管理Endpoints"><a href="#管理Endpoints" class="headerlink" title="管理Endpoints"></a>管理Endpoints</h3><h4 id="开启与禁用Endpoints"><a href="#开启与禁用Endpoints" class="headerlink" title="开启与禁用Endpoints"></a>开启与禁用Endpoints</h4><h4 id="暴露Endpoints"><a href="#暴露Endpoints" class="headerlink" title="暴露Endpoints"></a>暴露Endpoints</h4><h2 id="定制Endpoint"><a href="#定制Endpoint" class="headerlink" title="定制Endpoint"></a>定制Endpoint</h2><h3 id="定制Health信息"><a href="#定制Health信息" class="headerlink" title="定制Health信息"></a>定制Health信息</h3><h3 id="定制info信息"><a href="#定制info信息" class="headerlink" title="定制info信息"></a>定制info信息</h3><h4 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h4><h4 id="编写InfoContributor"><a href="#编写InfoContributor" class="headerlink" title="编写InfoContributor"></a>编写InfoContributor</h4><h2 id="定制Metrics信息"><a href="#定制Metrics信息" class="headerlink" title="定制Metrics信息"></a>定制Metrics信息</h2><h4 id="SpringBoot支持自动适配的Metrics"><a href="#SpringBoot支持自动适配的Metrics" class="headerlink" title="SpringBoot支持自动适配的Metrics"></a>SpringBoot支持自动适配的Metrics</h4><h4 id="增加定制Metrics"><a href="#增加定制Metrics" class="headerlink" title="增加定制Metrics"></a>增加定制Metrics</h4><h3 id="定制Endpoint-1"><a href="#定制Endpoint-1" class="headerlink" title="定制Endpoint"></a>定制Endpoint</h3><h1 id="原理解析"><a href="#原理解析" class="headerlink" title="原理解析"></a>原理解析</h1><h2 id="Profile功能"><a href="#Profile功能" class="headerlink" title="Profile功能"></a>Profile功能</h2><h3 id="application-profile功能"><a href="#application-profile功能" class="headerlink" title="application-profile功能"></a>application-profile功能</h3><h3 id="Profile条件装配功能"><a href="#Profile条件装配功能" class="headerlink" title="@Profile条件装配功能"></a>@Profile条件装配功能</h3><h3 id="profile分组"><a href="#profile分组" class="headerlink" title="profile分组"></a>profile分组</h3><h2 id="外部化配置"><a href="#外部化配置" class="headerlink" title="外部化配置"></a>外部化配置</h2><h3 id="外部配置源"><a href="#外部配置源" class="headerlink" title="外部配置源"></a>外部配置源</h3><h3 id="配置文件查找位置"><a href="#配置文件查找位置" class="headerlink" title="配置文件查找位置"></a>配置文件查找位置</h3><h3 id="配置文件加载顺序"><a href="#配置文件加载顺序" class="headerlink" title="配置文件加载顺序"></a>配置文件加载顺序</h3><h3 id="指定环境优先、外部优先、后面的可以覆盖前面的同名配置"><a href="#指定环境优先、外部优先、后面的可以覆盖前面的同名配置" class="headerlink" title="指定环境优先、外部优先、后面的可以覆盖前面的同名配置"></a>指定环境优先、外部优先、后面的可以覆盖前面的同名配置</h3><h2 id="自定义starter"><a href="#自定义starter" class="headerlink" title="自定义starter"></a>自定义starter</h2><h3 id="starter启动原理"><a href="#starter启动原理" class="headerlink" title="starter启动原理"></a>starter启动原理</h3><h3 id="自定义starter-1"><a href="#自定义starter-1" class="headerlink" title="自定义starter"></a>自定义starter</h3><h2 id="SpringBoot原理"><a href="#SpringBoot原理" class="headerlink" title="SpringBoot原理"></a>SpringBoot原理</h2><h3 id="SpringBoot启动过程"><a href="#SpringBoot启动过程" class="headerlink" title="SpringBoot启动过程"></a>SpringBoot启动过程</h3><h3 id="Application-Events-and-Listeners"><a href="#Application-Events-and-Listeners" class="headerlink" title="Application Events and Listeners"></a>Application Events and Listeners</h3><h3 id="ApplicationRunner-与-CommandLineRunner"><a href="#ApplicationRunner-与-CommandLineRunner" class="headerlink" title="ApplicationRunner 与 CommandLineRunner"></a>ApplicationRunner 与 CommandLineRunner</h3>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/SpringBoot2/" rel="tag"><i class="fa fa-tag"></i> SpringBoot2</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/07/15/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/" rel="prev" title="尚硅谷SpringBoot2核心技术-基础入门(一)">
      <i class="fa fa-chevron-left"></i> 尚硅谷SpringBoot2核心技术-基础入门(一)
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">1.</span> <span class="nav-text">配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.1.</span> <span class="nav-text">文件类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#properties"><span class="nav-number">1.1.1.</span> <span class="nav-text">properties</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#yaml"><span class="nav-number">1.1.2.</span> <span class="nav-text">yaml</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">基本语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">数据类型</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%8F%90%E7%A4%BA"><span class="nav-number">1.2.</span> <span class="nav-text">配置提示</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web%E5%BC%80%E5%8F%91"><span class="nav-number">2.</span> <span class="nav-text">web开发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SpringMVC%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E6%A6%82%E8%A7%88"><span class="nav-number">2.1.</span> <span class="nav-text">SpringMVC自动配置概览</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E5%8A%9F%E8%83%BD%E5%88%86%E6%9E%90"><span class="nav-number">2.2.</span> <span class="nav-text">简单功能分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE"><span class="nav-number">2.2.1.</span> <span class="nav-text">静态资源访问</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%9B%AE%E5%BD%95"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">静态资源目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E5%89%8D%E7%BC%80"><span class="nav-number">2.2.1.2.</span> <span class="nav-text">静态资源访问前缀</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#webjar"><span class="nav-number">2.2.1.3.</span> <span class="nav-text">webjar</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AC%A2%E8%BF%8E%E9%A1%B5%E6%94%AF%E6%8C%81"><span class="nav-number">2.2.2.</span> <span class="nav-text">欢迎页支持</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Favicon"><span class="nav-number">2.2.3.</span> <span class="nav-text">自定义Favicon</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="nav-number">2.2.4.</span> <span class="nav-text">静态资源配置原理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%B1%BB%E5%8F%AA%E6%9C%89%E4%B8%80%E4%B8%AA%E6%9C%89%E5%8F%82%E6%9E%84%E9%80%A0%E5%99%A8"><span class="nav-number">2.2.4.1.</span> <span class="nav-text">配置类只有一个有参构造器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B5%84%E6%BA%90%E5%A4%84%E7%90%86%E7%9A%84%E9%BB%98%E8%AE%A4%E8%A7%84%E5%88%99"><span class="nav-number">2.2.4.2.</span> <span class="nav-text">资源处理的默认规则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AC%A2%E8%BF%8E%E7%9A%84%E5%A4%84%E7%90%86%E8%A7%84%E5%88%99"><span class="nav-number">2.2.4.3.</span> <span class="nav-text">欢迎的处理规则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#favicon"><span class="nav-number">2.2.4.4.</span> <span class="nav-text">favicon</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86"><span class="nav-number">2.3.</span> <span class="nav-text">请求参数处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E6%98%A0%E5%B0%84"><span class="nav-number">2.3.1.</span> <span class="nav-text">请求映射</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#rest%E4%BD%BF%E7%94%A8%E4%B8%8E%E5%8E%9F%E7%90%86"><span class="nav-number">2.3.1.1.</span> <span class="nav-text">rest使用与原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E6%98%A0%E5%B0%84%E5%8E%9F%E7%90%86"><span class="nav-number">2.3.1.2.</span> <span class="nav-text">请求映射原理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%99%AE%E9%80%9A%E5%8F%82%E6%95%B0%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%B3%A8%E8%A7%A3"><span class="nav-number">2.3.2.</span> <span class="nav-text">普通参数与基本注解</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3"><span class="nav-number">2.3.2.1.</span> <span class="nav-text">注解</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#PathVariable"><span class="nav-number">2.3.2.1.1.</span> <span class="nav-text">@PathVariable</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RequestHeader"><span class="nav-number">2.3.2.1.2.</span> <span class="nav-text">@RequestHeader</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RequestParam"><span class="nav-number">2.3.2.1.3.</span> <span class="nav-text">@RequestParam</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#CookieValue"><span class="nav-number">2.3.2.1.4.</span> <span class="nav-text">@CookieValue</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RequestBody"><span class="nav-number">2.3.2.1.5.</span> <span class="nav-text">@RequestBody</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RequestAttribute"><span class="nav-number">2.3.2.1.6.</span> <span class="nav-text">@RequestAttribute</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#MatrixVariable"><span class="nav-number">2.3.2.1.7.</span> <span class="nav-text">@MatrixVariable</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Servlet-API"><span class="nav-number">2.3.2.2.</span> <span class="nav-text">Servlet API</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%8D%E6%9D%82%E5%8F%82%E6%95%B0"><span class="nav-number">2.3.2.3.</span> <span class="nav-text">复杂参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%B9%E8%B1%A1%E5%8F%82%E6%95%B0"><span class="nav-number">2.3.2.4.</span> <span class="nav-text">自定义对象参数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#POJO%E5%B0%81%E8%A3%85%E8%BF%87%E7%A8%8B"><span class="nav-number">2.3.3.</span> <span class="nav-text">POJO封装过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86%E5%8E%9F%E7%90%86"><span class="nav-number">2.3.4.</span> <span class="nav-text">参数处理原理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HandlerAdapter"><span class="nav-number">2.3.4.1.</span> <span class="nav-text">HandlerAdapter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E7%9B%AE%E6%A0%87%E6%96%B9%E6%B3%95"><span class="nav-number">2.3.4.2.</span> <span class="nav-text">执行目标方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%99%A8-HandlerMethodArgumentResolver"><span class="nav-number">2.3.4.3.</span> <span class="nav-text">参数解析器-HandlerMethodArgumentResolver</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">2.3.4.4.</span> <span class="nav-text">返回值处理器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E7%A1%AE%E5%AE%9A%E7%9B%AE%E6%A0%87%E6%96%B9%E6%B3%95%E6%AF%8F%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E7%9A%84%E5%80%BC"><span class="nav-number">2.3.4.5.</span> <span class="nav-text">如何确定目标方法每一个参数的值</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8C%A8%E4%B8%AA%E5%88%A4%E6%96%AD%E6%89%80%E6%9C%89%E7%9A%84%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%99%A8%E9%82%A3%E4%B8%AA%E6%94%AF%E6%8C%81%E8%A7%A3%E6%9E%90%E8%BF%99%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="nav-number">2.3.4.5.1.</span> <span class="nav-text">挨个判断所有的参数解析器那个支持解析这个参数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90%E8%BF%99%E4%B8%AA%E5%8F%82%E6%95%B0%E7%9A%84%E5%80%BC"><span class="nav-number">2.3.4.5.2.</span> <span class="nav-text">解析这个参数的值</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E5%8F%82%E6%95%B0-%E5%B0%81%E8%A3%85POJO"><span class="nav-number">2.3.4.5.2.1.</span> <span class="nav-text">自定义类型参数 封装POJO</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E5%AE%8C%E6%88%90"><span class="nav-number">2.3.4.6.</span> <span class="nav-text">目标方法执行完成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E6%B4%BE%E5%8F%91%E7%BB%93%E6%9E%9C"><span class="nav-number">2.3.4.7.</span> <span class="nav-text">处理派发结果</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%93%8D%E5%BA%94%E4%B8%8E%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="nav-number">2.4.</span> <span class="nav-text">数据响应与内容协商</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%8D%E5%BA%94JSON"><span class="nav-number">2.4.1.</span> <span class="nav-text">响应JSON</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#jackson-jar-ResponseBody"><span class="nav-number">2.4.1.1.</span> <span class="nav-text">jackson.jar+@ResponseBody</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="nav-number">2.4.1.1.1.</span> <span class="nav-text">返回值解析器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC%E8%A7%A3%E6%9E%90%E5%99%A8%E5%8E%9F%E7%90%86"><span class="nav-number">2.4.1.1.2.</span> <span class="nav-text">返回值解析器原理</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SpringMVC%E5%88%B0%E5%BA%95%E6%94%AF%E6%8C%81%E5%93%AA%E4%BA%9B%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="nav-number">2.4.1.2.</span> <span class="nav-text">SpringMVC到底支持哪些返回值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HttpMessageConverter%E5%8E%9F%E7%90%86"><span class="nav-number">2.4.1.3.</span> <span class="nav-text">HttpMessageConverter原理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#MessageConverter%E8%A7%84%E8%8C%83"><span class="nav-number">2.4.1.3.1.</span> <span class="nav-text">MessageConverter规范</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E7%9A%84MessageConverter"><span class="nav-number">2.4.1.3.2.</span> <span class="nav-text">默认的MessageConverter</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="nav-number">2.4.2.</span> <span class="nav-text">内容协商</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%95%E5%85%A5xml%E4%BE%9D%E8%B5%96"><span class="nav-number">2.4.2.1.</span> <span class="nav-text">引入xml依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#postman%E5%88%86%E5%88%AB%E6%B5%8B%E8%AF%95%E8%BF%94%E5%9B%9Ejson%E5%92%8Cxml"><span class="nav-number">2.4.2.2.</span> <span class="nav-text">postman分别测试返回json和xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E5%90%AF%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8F%82%E6%95%B0%E6%96%B9%E5%BC%8F%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E5%8A%9F%E8%83%BD"><span class="nav-number">2.4.2.3.</span> <span class="nav-text">开启浏览器参数方式内容协商功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E5%8E%9F%E7%90%86"><span class="nav-number">2.4.2.4.</span> <span class="nav-text">内容协商原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89MessageConverter"><span class="nav-number">2.4.2.5.</span> <span class="nav-text">自定义MessageConverter</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E4%B8%8E%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="nav-number">2.5.</span> <span class="nav-text">视图解析与模板引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90"><span class="nav-number">2.5.1.</span> <span class="nav-text">视图解析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%8E%9F%E7%90%86%E6%B5%81%E7%A8%8B"><span class="nav-number">2.5.1.1.</span> <span class="nav-text">视图解析原理流程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E-Thymeleaf"><span class="nav-number">2.5.2.</span> <span class="nav-text">模板引擎-Thymeleaf</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Thymeleaf%E7%AE%80%E4%BB%8B"><span class="nav-number">2.5.2.1.</span> <span class="nav-text">Thymeleaf简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95-1"><span class="nav-number">2.5.2.2.</span> <span class="nav-text">基本语法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">2.5.2.2.1.</span> <span class="nav-text">表达式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AD%97%E9%9D%A2%E9%87%8F"><span class="nav-number">2.5.2.2.2.</span> <span class="nav-text">字面量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%96%87%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">2.5.2.2.3.</span> <span class="nav-text">文本操作</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%95%B0%E5%AD%A6%E8%BF%90%E7%AE%97"><span class="nav-number">2.5.2.2.4.</span> <span class="nav-text">数学运算</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B8%83%E5%B0%94%E8%BF%90%E7%AE%97"><span class="nav-number">2.5.2.2.5.</span> <span class="nav-text">布尔运算</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97"><span class="nav-number">2.5.2.2.6.</span> <span class="nav-text">比较运算</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E8%BF%90%E7%AE%97"><span class="nav-number">2.5.2.2.7.</span> <span class="nav-text">条件运算</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E6%93%8D%E4%BD%9C"><span class="nav-number">2.5.2.2.8.</span> <span class="nav-text">特殊操作</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%80%BC-th-attr"><span class="nav-number">2.5.2.3.</span> <span class="nav-text">设置属性值-th:attr</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%AD%E4%BB%A3"><span class="nav-number">2.5.2.4.</span> <span class="nav-text">迭代</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E8%BF%90%E7%AE%97-1"><span class="nav-number">2.5.2.5.</span> <span class="nav-text">条件运算</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7%E4%BC%98%E5%85%88%E7%BA%A7"><span class="nav-number">2.5.2.6.</span> <span class="nav-text">属性优先级</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#thymeleaf%E4%BD%BF%E7%94%A8"><span class="nav-number">2.5.3.</span> <span class="nav-text">thymeleaf使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%95%E5%85%A5Starter"><span class="nav-number">2.5.3.1.</span> <span class="nav-text">引入Starter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%A5%BD%E4%BA%86Thymeleaf"><span class="nav-number">2.5.3.2.</span> <span class="nav-text">自动配置好了Thymeleaf</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91"><span class="nav-number">2.5.3.3.</span> <span class="nav-text">页面开发</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="nav-number">2.6.</span> <span class="nav-text">拦截器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HandlerInterceptor%E6%8E%A5%E5%8F%A3"><span class="nav-number">2.6.1.</span> <span class="nav-text">HandlerInterceptor接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="nav-number">2.6.2.</span> <span class="nav-text">配置拦截器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8%E5%8E%9F%E7%90%86"><span class="nav-number">2.6.3.</span> <span class="nav-text">拦截器原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">2.7.</span> <span class="nav-text">文件上传</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2%E8%A1%A8%E5%8D%95"><span class="nav-number">2.7.1.</span> <span class="nav-text">页面表单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%BB%A3%E7%A0%81"><span class="nav-number">2.7.2.</span> <span class="nav-text">文件上传代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="nav-number">2.7.3.</span> <span class="nav-text">自动配置原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="nav-number">2.8.</span> <span class="nav-text">异常处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-number">2.8.1.</span> <span class="nav-text">错误处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E8%A7%84%E5%88%99"><span class="nav-number">2.8.1.1.</span> <span class="nav-text">默认规则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E5%88%B6%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E9%80%BB%E8%BE%91"><span class="nav-number">2.8.1.2.</span> <span class="nav-text">定制错误处理逻辑</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="nav-number">2.8.1.3.</span> <span class="nav-text">异常处理自动配置原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%AD%A5%E9%AA%A4%E6%B5%81%E7%A8%8B"><span class="nav-number">2.8.1.4.</span> <span class="nav-text">异常处理步骤流程</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web%E5%8E%9F%E7%94%9F%E7%BB%84%E4%BB%B6%E6%B3%A8%E5%85%A5%EF%BC%88Servlet%E3%80%81Filter%E3%80%81Listenter%EF%BC%89"><span class="nav-number">2.9.</span> <span class="nav-text">Web原生组件注入（Servlet、Filter、Listenter）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Servlet-API"><span class="nav-number">2.9.1.</span> <span class="nav-text">使用Servlet API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8RegistrationBean"><span class="nav-number">2.9.2.</span> <span class="nav-text">使用RegistrationBean</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B5%8C%E5%85%A5%E5%BC%8FServlet%E5%AE%B9%E5%99%A8"><span class="nav-number">2.10.</span> <span class="nav-text">嵌入式Servlet容器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%87%E6%8D%A2%E5%B5%8C%E5%85%A5%E5%BC%8FServlet"><span class="nav-number">2.10.1.</span> <span class="nav-text">切换嵌入式Servlet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E5%88%B6Servlet%E5%AE%B9%E5%99%A8"><span class="nav-number">2.10.2.</span> <span class="nav-text">定制Servlet容器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E5%88%B6%E5%8C%96%E5%8E%9F%E7%90%86"><span class="nav-number">2.11.</span> <span class="nav-text">定制化原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E5%88%B6%E5%8C%96%E7%9A%84%E5%B8%B8%E8%A7%81%E6%96%B9%E5%BC%8F"><span class="nav-number">2.11.1.</span> <span class="nav-text">定制化的常见方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E5%A5%97%E8%B7%AF"><span class="nav-number">2.11.2.</span> <span class="nav-text">原理分析套路</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE"><span class="nav-number">3.</span> <span class="nav-text">数据访问</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL"><span class="nav-number">3.1.</span> <span class="nav-text">SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%BA%90%E7%9A%84%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE-HikariDataSource"><span class="nav-number">3.1.1.</span> <span class="nav-text">数据源的自动配置-HikariDataSource</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5JDBC%E5%9C%BA%E6%99%AF"><span class="nav-number">3.1.1.1.</span> <span class="nav-text">导入JDBC场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="nav-number">3.1.1.2.</span> <span class="nav-text">分析自动配置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%9A%84%E7%B1%BB"><span class="nav-number">3.1.1.2.1.</span> <span class="nav-text">自动配置的类</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="nav-number">3.1.1.3.</span> <span class="nav-text">修改配置项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95"><span class="nav-number">3.1.1.4.</span> <span class="nav-text">测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Druid%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="nav-number">3.1.2.</span> <span class="nav-text">使用Druid数据源</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#druid%E5%AE%98%E6%96%B9github%E5%9C%B0%E5%9D%80"><span class="nav-number">3.1.2.1.</span> <span class="nav-text">druid官方github地址</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E5%BC%8F"><span class="nav-number">3.1.2.2.</span> <span class="nav-text">自定义方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="nav-number">3.1.2.2.1.</span> <span class="nav-text">创建数据源</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#StatViewServlet"><span class="nav-number">3.1.2.2.2.</span> <span class="nav-text">StatViewServlet</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#StatFilter"><span class="nav-number">3.1.2.2.3.</span> <span class="nav-text">StatFilter</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%AE%98%E6%96%B9starter%E6%96%B9%E5%BC%8F"><span class="nav-number">3.1.2.3.</span> <span class="nav-text">使用官方starter方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BC%95%E5%85%A5druid-starter"><span class="nav-number">3.1.2.3.1.</span> <span class="nav-text">引入druid-starter</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%86%E6%9E%90%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE-1"><span class="nav-number">3.1.2.3.2.</span> <span class="nav-text">分析自动配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="nav-number">3.1.2.3.3.</span> <span class="nav-text">配置示例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B4%E5%90%88Mybatis%E6%93%8D%E4%BD%9C"><span class="nav-number">3.1.3.</span> <span class="nav-text">整合Mybatis操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.1.3.1.</span> <span class="nav-text">配置模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.1.3.2.</span> <span class="nav-text">注解模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%B7%E5%90%88%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.1.3.3.</span> <span class="nav-text">混合模式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B4%E5%90%88Mybatis-plus-%E5%AE%8C%E6%88%90CRUD"><span class="nav-number">3.1.4.</span> <span class="nav-text">整合Mybatis-plus 完成CRUD</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFMybatis-plus"><span class="nav-number">3.1.4.1.</span> <span class="nav-text">什么是Mybatis-plus</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B4%E5%90%88Mybatis-plus"><span class="nav-number">3.1.4.2.</span> <span class="nav-text">整合Mybatis-plus</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CRUD%E5%8A%9F%E8%83%BD"><span class="nav-number">3.1.4.3.</span> <span class="nav-text">CRUD功能</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NoSQL"><span class="nav-number">3.2.</span> <span class="nav-text">NoSQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="nav-number">3.2.1.</span> <span class="nav-text">Redis自动配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RedisTemplate%E4%B8%8ELettice"><span class="nav-number">3.2.2.</span> <span class="nav-text">RedisTemplate与Lettice</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%87%E6%8D%A2%E8%87%B3jedis"><span class="nav-number">3.2.3.</span> <span class="nav-text">切换至jedis</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="nav-number">4.</span> <span class="nav-text">单元测试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Junit5%E7%9A%84%E5%8F%98%E5%8C%96"><span class="nav-number">4.1.</span> <span class="nav-text">Junit5的变化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Junit5%E5%B8%B8%E7%94%A8%E7%9A%84%E6%B3%A8%E8%A7%A3"><span class="nav-number">4.2.</span> <span class="nav-text">Junit5常用的注解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%AD%E8%A8%80%EF%BC%88assertions%EF%BC%89"><span class="nav-number">4.3.</span> <span class="nav-text">断言（assertions）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E6%96%AD%E8%A8%80"><span class="nav-number">4.3.1.</span> <span class="nav-text">简单断言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E7%BB%84%E6%96%AD%E8%A8%80"><span class="nav-number">4.3.2.</span> <span class="nav-text">数组断言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E6%96%AD%E8%A8%80"><span class="nav-number">4.3.3.</span> <span class="nav-text">组合断言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E6%96%AD%E8%A8%80"><span class="nav-number">4.3.4.</span> <span class="nav-text">异常断言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B6%85%E6%97%B6%E6%96%AD%E8%A8%80"><span class="nav-number">4.3.5.</span> <span class="nav-text">超时断言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E5%A4%B1%E8%B4%A5"><span class="nav-number">4.3.6.</span> <span class="nav-text">快速失败</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%EF%BC%88assumptions%EF%BC%89"><span class="nav-number">4.4.</span> <span class="nav-text">前置条件（assumptions）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B5%8C%E5%A5%97%E6%B5%8B%E8%AF%95"><span class="nav-number">4.5.</span> <span class="nav-text">嵌套测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E5%8C%96%E6%B5%8B%E8%AF%95"><span class="nav-number">4.6.</span> <span class="nav-text">参数化测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%81%E7%A7%BB%E6%8C%87%E5%8D%97"><span class="nav-number">4.7.</span> <span class="nav-text">迁移指南</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7"><span class="nav-number">5.</span> <span class="nav-text">指标监控</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SpringBoot-Actuator"><span class="nav-number">5.1.</span> <span class="nav-text">SpringBoot Actuator</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-1"><span class="nav-number">5.1.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-x%E5%92%8C2-x%E7%9A%84%E4%B8%8D%E5%90%8C"><span class="nav-number">5.1.2.</span> <span class="nav-text">1.x和2.x的不同</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8"><span class="nav-number">5.1.3.</span> <span class="nav-text">如何使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="nav-number">5.1.4.</span> <span class="nav-text">可视化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Actuator-Endpoint"><span class="nav-number">5.2.</span> <span class="nav-text">Actuator Endpoint</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E5%B8%B8%E4%BD%BF%E7%94%A8%E7%9A%84%E7%AB%AF%E7%82%B9"><span class="nav-number">5.2.1.</span> <span class="nav-text">最常使用的端点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Health-Endpoint"><span class="nav-number">5.2.2.</span> <span class="nav-text">Health Endpoint</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Metrics-Endpoint"><span class="nav-number">5.2.3.</span> <span class="nav-text">Metrics Endpoint</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%A1%E7%90%86Endpoints"><span class="nav-number">5.2.4.</span> <span class="nav-text">管理Endpoints</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E5%90%AF%E4%B8%8E%E7%A6%81%E7%94%A8Endpoints"><span class="nav-number">5.2.4.1.</span> <span class="nav-text">开启与禁用Endpoints</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9A%B4%E9%9C%B2Endpoints"><span class="nav-number">5.2.4.2.</span> <span class="nav-text">暴露Endpoints</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E5%88%B6Endpoint"><span class="nav-number">5.3.</span> <span class="nav-text">定制Endpoint</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E5%88%B6Health%E4%BF%A1%E6%81%AF"><span class="nav-number">5.3.1.</span> <span class="nav-text">定制Health信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E5%88%B6info%E4%BF%A1%E6%81%AF"><span class="nav-number">5.3.2.</span> <span class="nav-text">定制info信息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">5.3.2.1.</span> <span class="nav-text">编写配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E5%86%99InfoContributor"><span class="nav-number">5.3.2.2.</span> <span class="nav-text">编写InfoContributor</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E5%88%B6Metrics%E4%BF%A1%E6%81%AF"><span class="nav-number">5.4.</span> <span class="nav-text">定制Metrics信息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SpringBoot%E6%94%AF%E6%8C%81%E8%87%AA%E5%8A%A8%E9%80%82%E9%85%8D%E7%9A%84Metrics"><span class="nav-number">5.4.0.1.</span> <span class="nav-text">SpringBoot支持自动适配的Metrics</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A2%9E%E5%8A%A0%E5%AE%9A%E5%88%B6Metrics"><span class="nav-number">5.4.0.2.</span> <span class="nav-text">增加定制Metrics</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E5%88%B6Endpoint-1"><span class="nav-number">5.4.1.</span> <span class="nav-text">定制Endpoint</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90"><span class="nav-number">6.</span> <span class="nav-text">原理解析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Profile%E5%8A%9F%E8%83%BD"><span class="nav-number">6.1.</span> <span class="nav-text">Profile功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#application-profile%E5%8A%9F%E8%83%BD"><span class="nav-number">6.1.1.</span> <span class="nav-text">application-profile功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Profile%E6%9D%A1%E4%BB%B6%E8%A3%85%E9%85%8D%E5%8A%9F%E8%83%BD"><span class="nav-number">6.1.2.</span> <span class="nav-text">@Profile条件装配功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#profile%E5%88%86%E7%BB%84"><span class="nav-number">6.1.3.</span> <span class="nav-text">profile分组</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%96%E9%83%A8%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="nav-number">6.2.</span> <span class="nav-text">外部化配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE%E6%BA%90"><span class="nav-number">6.2.1.</span> <span class="nav-text">外部配置源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE%E4%BD%8D%E7%BD%AE"><span class="nav-number">6.2.2.</span> <span class="nav-text">配置文件查找位置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F"><span class="nav-number">6.2.3.</span> <span class="nav-text">配置文件加载顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A%E7%8E%AF%E5%A2%83%E4%BC%98%E5%85%88%E3%80%81%E5%A4%96%E9%83%A8%E4%BC%98%E5%85%88%E3%80%81%E5%90%8E%E9%9D%A2%E7%9A%84%E5%8F%AF%E4%BB%A5%E8%A6%86%E7%9B%96%E5%89%8D%E9%9D%A2%E7%9A%84%E5%90%8C%E5%90%8D%E9%85%8D%E7%BD%AE"><span class="nav-number">6.2.4.</span> <span class="nav-text">指定环境优先、外部优先、后面的可以覆盖前面的同名配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89starter"><span class="nav-number">6.3.</span> <span class="nav-text">自定义starter</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#starter%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86"><span class="nav-number">6.3.1.</span> <span class="nav-text">starter启动原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89starter-1"><span class="nav-number">6.3.2.</span> <span class="nav-text">自定义starter</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SpringBoot%E5%8E%9F%E7%90%86"><span class="nav-number">6.4.</span> <span class="nav-text">SpringBoot原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SpringBoot%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">6.4.1.</span> <span class="nav-text">SpringBoot启动过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Application-Events-and-Listeners"><span class="nav-number">6.4.2.</span> <span class="nav-text">Application Events and Listeners</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ApplicationRunner-%E4%B8%8E-CommandLineRunner"><span class="nav-number">6.4.3.</span> <span class="nav-text">ApplicationRunner 与 CommandLineRunner</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="YS"
      src="/images/author.png">
  <p class="site-author-name" itemprop="name">YS</p>
  <div class="site-description" itemprop="description">学海无涯苦作舟</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">56</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">YS</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'SsNHix8sOQXkmksOkIvo0jkf-gzGzoHsz',
      appKey     : 'BCtPpmnU41TOE7Wr5O0CJFgS',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
