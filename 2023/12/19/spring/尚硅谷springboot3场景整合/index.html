<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.4.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/ys_ico.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/ys_ico.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.css" integrity="sha256-6cQIC71/iBIYXFK+0RHAvwmjwWzkWd+r7v/BX3/vZDc=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"ysymj.gitee.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.19.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="哔哩哔哩视频《尚硅谷SpringBoot零基础教程，面试&amp;加薪必会springboot3》学习笔记，地址：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1Es4y1q7B">
<meta property="og:type" content="article">
<meta property="og:title" content="尚硅谷springboot3场景整合">
<meta property="og:url" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/index.html">
<meta property="og:site_name" content="YS">
<meta property="og:description" content="哔哩哔哩视频《尚硅谷SpringBoot零基础教程，面试&amp;加薪必会springboot3》学习笔记，地址：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1Es4y1q7B">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/OpenApi3%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/RPC%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E5%BC%82%E6%AD%A5%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E8%A7%A3%E8%80%A6%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E5%89%8A%E5%B3%B0%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E7%BC%93%E5%86%B2%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/kafka%E6%B6%88%E6%81%AF%E6%A8%A1%E5%BC%8F%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/kafka%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/kafka%E7%9F%A5%E8%AF%86%E7%82%B9.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E8%BF%87%E6%BB%A4%E5%99%A8%E9%93%BE%E6%9E%B6%E6%9E%84%E7%A4%BA%E6%84%8F%E5%9B%BE.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/FilterChainProxy%E7%A4%BA%E6%84%8F%E5%9B%BE.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/SecurityFilterChain%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E7%9B%91%E6%8E%A7%E6%95%B0%E6%8D%AE%E6%B5%81%E5%90%91%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E7%9B%91%E6%8E%A7%E6%95%88%E6%9E%9C%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E7%BC%96%E8%AF%91%E4%B8%8E%E8%A7%A3%E9%87%8A%E8%AF%AD%E8%A8%80%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E6%8A%80%E6%9C%AF%E5%88%97%E8%A1%A8%E5%9B%BE1.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E6%8A%80%E6%9C%AF%E5%88%97%E8%A1%A8%E5%9B%BE2.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/JVM%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/java%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E7%A4%BA%E6%84%8F%E5%9B%BE.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E8%AF%A6%E7%BB%86%E6%B5%81%E7%A8%8B%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E5%88%86%E5%B1%82%E7%BC%96%E8%AF%91%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/GraalVM%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E5%8E%9F%E7%90%86%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/VisualStudio%E5%AE%89%E8%A3%85%E5%9B%BE%E7%A4%BA1.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/VisualStudio%E5%AE%89%E8%A3%85%E5%9B%BE%E7%A4%BA2.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/VisualStudio%E5%AE%89%E8%A3%85%E5%9B%BE%E7%A4%BA3.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/VisualStudio%E5%AE%89%E8%A3%85%E5%9B%BE%E7%A4%BA4.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/GraalVM%E5%AE%89%E8%A3%85%E5%9B%BE%E7%A4%BA1.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/GraalVM%E5%AE%89%E8%A3%85%E5%9B%BE%E7%A4%BA2.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/GraalVM%E5%AE%89%E8%A3%85%E5%9B%BE%E7%A4%BA3.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/GraalVM%E5%AE%89%E8%A3%85%E5%9B%BE%E7%A4%BA4.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/native-tools%E7%BB%88%E7%AB%AF%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E7%9F%A5%E8%AF%86%E7%82%B9%E5%9B%BE%E7%A4%BA.png">
<meta property="article:published_time" content="2023-12-19T12:59:47.000Z">
<meta property="article:modified_time" content="2024-01-14T02:45:55.307Z">
<meta property="article:author" content="YS">
<meta property="article:tag" content="springboot3">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/OpenApi3%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A4%BA.png">


<link rel="canonical" href="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/","path":"2023/12/19/spring/尚硅谷springboot3场景整合/","title":"尚硅谷springboot3场景整合"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>尚硅谷springboot3场景整合 | YS</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">YS</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">学无止境</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="nav-number">1.</span> <span class="nav-text">环境准备</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#NoSQL"><span class="nav-number">2.</span> <span class="nav-text">NoSQL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis%E6%95%B4%E5%90%88"><span class="nav-number">2.1.</span> <span class="nav-text">Redis整合</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88"><span class="nav-number">2.1.1.</span> <span class="nav-text">场景整合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="nav-number">2.1.2.</span> <span class="nav-text">自动配置原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E5%88%B6%E5%8C%96"><span class="nav-number">2.1.3.</span> <span class="nav-text">定制化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E6%9C%BA%E5%88%B6"><span class="nav-number">2.1.3.1.</span> <span class="nav-text">序列化机制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#redis%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">2.1.3.2.</span> <span class="nav-text">redis客户端</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%8F%82%E8%80%83"><span class="nav-number">2.1.3.3.</span> <span class="nav-text">配置参考</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3"><span class="nav-number">3.</span> <span class="nav-text">接口文档</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenAPI3%E4%B8%8ESwagger"><span class="nav-number">3.1.</span> <span class="nav-text">OpenAPI3与Swagger</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#OpenAPI3%E6%9E%B6%E6%9E%84"><span class="nav-number">3.1.1.</span> <span class="nav-text">OpenAPI3架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B4%E5%90%88"><span class="nav-number">3.1.2.</span> <span class="nav-text">整合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-number">3.1.3.</span> <span class="nav-text">使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="nav-number">3.1.3.1.</span> <span class="nav-text">常用注解</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Docket%E9%85%8D%E7%BD%AE"><span class="nav-number">3.1.3.2.</span> <span class="nav-text">Docket配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#OpenApi%E9%85%8D%E7%BD%AE"><span class="nav-number">3.1.3.3.</span> <span class="nav-text">OpenApi配置</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#springFox%E8%BF%81%E7%A7%BB"><span class="nav-number">3.1.4.</span> <span class="nav-text">springFox迁移</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E5%8F%98%E5%8C%96"><span class="nav-number">3.1.4.1.</span> <span class="nav-text">注解变化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Docket%E9%85%8D%E7%BD%AE-1"><span class="nav-number">3.1.4.2.</span> <span class="nav-text">Docket配置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%A5%E5%89%8D%E5%86%99%E6%B3%95"><span class="nav-number">3.1.4.2.1.</span> <span class="nav-text">以前写法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%96%B0%E5%86%99%E6%B3%95"><span class="nav-number">3.1.4.2.2.</span> <span class="nav-text">新写法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0OpenAPI%E7%BB%84%E4%BB%B6"><span class="nav-number">3.1.4.2.3.</span> <span class="nav-text">添加OpenAPI组件</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8"><span class="nav-number">4.</span> <span class="nav-text">远程调用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#RestClient"><span class="nav-number">4.1.</span> <span class="nav-text">RestClient</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="nav-number">4.1.1.</span> <span class="nav-text">创建与配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%93%8D%E5%BA%94"><span class="nav-number">4.1.2.</span> <span class="nav-text">获取响应</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E8%AF%B7%E6%B1%82%E4%BD%93"><span class="nav-number">4.1.3.</span> <span class="nav-text">定义请求体</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WebClient"><span class="nav-number">4.2.</span> <span class="nav-text">WebClient</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%8E%E9%85%8D%E7%BD%AE-1"><span class="nav-number">4.2.1.</span> <span class="nav-text">创建与配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%93%8D%E5%BA%94-1"><span class="nav-number">4.2.2.</span> <span class="nav-text">获取响应</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E8%AF%B7%E6%B1%82%E4%BD%93-1"><span class="nav-number">4.2.3.</span> <span class="nav-text">定义请求体</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HTTP-Interface"><span class="nav-number">4.3.</span> <span class="nav-text">HTTP Interface</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="nav-number">4.3.1.</span> <span class="nav-text">导入依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E6%8E%A5%E5%8F%A3"><span class="nav-number">4.3.2.</span> <span class="nav-text">定义接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86-amp-%E6%B5%8B%E8%AF%95"><span class="nav-number">4.3.3.</span> <span class="nav-text">创建代理&amp;测试</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#WebClient-1"><span class="nav-number">4.3.3.1.</span> <span class="nav-text">WebClient</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RestClient-1"><span class="nav-number">4.3.3.2.</span> <span class="nav-text">RestClient</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E6%9C%8D%E5%8A%A1"><span class="nav-number">5.</span> <span class="nav-text">消息服务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97-%E5%9C%BA%E6%99%AF"><span class="nav-number">5.1.</span> <span class="nav-text">消息队列-场景</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5"><span class="nav-number">5.1.1.</span> <span class="nav-text">异步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E8%80%A6"><span class="nav-number">5.1.2.</span> <span class="nav-text">解耦</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8A%E5%B3%B0"><span class="nav-number">5.1.3.</span> <span class="nav-text">削峰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%86%B2"><span class="nav-number">5.1.4.</span> <span class="nav-text">缓冲</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97-Kafka"><span class="nav-number">5.2.</span> <span class="nav-text">消息队列-Kafka</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E6%A8%A1%E5%BC%8F"><span class="nav-number">5.2.1.</span> <span class="nav-text">消息模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kafka%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">5.2.2.</span> <span class="nav-text">Kafka工作原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SpringBoot%E6%95%B4%E5%90%88"><span class="nav-number">5.2.3.</span> <span class="nav-text">SpringBoot整合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81"><span class="nav-number">5.2.4.</span> <span class="nav-text">消息发送</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E7%9B%91%E5%90%AC"><span class="nav-number">5.2.5.</span> <span class="nav-text">消息监听</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE"><span class="nav-number">5.2.6.</span> <span class="nav-text">参数配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86-1"><span class="nav-number">5.2.7.</span> <span class="nav-text">自动配置原理</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web%E5%AE%89%E5%85%A8"><span class="nav-number">6.</span> <span class="nav-text">web安全</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-Security"><span class="nav-number">6.1.</span> <span class="nav-text">Spring Security</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E6%9E%B6%E6%9E%84"><span class="nav-number">6.1.1.</span> <span class="nav-text">安全架构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%A4%E8%AF%81%EF%BC%9AAuthentication"><span class="nav-number">6.1.1.1.</span> <span class="nav-text">认证：Authentication</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%88%E6%9D%83%EF%BC%9AAuthorization"><span class="nav-number">6.1.1.2.</span> <span class="nav-text">授权：Authorization</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%94%BB%E5%87%BB%E9%98%B2%E6%8A%A4"><span class="nav-number">6.1.1.3.</span> <span class="nav-text">攻击防护</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%EF%BC%9A%E6%9D%83%E9%99%90%E6%A8%A1%E5%9E%8B"><span class="nav-number">6.1.1.4.</span> <span class="nav-text">扩展：权限模型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#BAC-Role-Based-Access-Controll"><span class="nav-number">6.1.1.4.1.</span> <span class="nav-text">BAC(Role Based Access Controll)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ACL-Access-Controll-List"><span class="nav-number">6.1.1.4.2.</span> <span class="nav-text">ACL(Access Controll List)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Security%E5%8E%9F%E7%90%86"><span class="nav-number">6.1.2.</span> <span class="nav-text">Spring Security原理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E9%93%BE%E6%9E%B6%E6%9E%84"><span class="nav-number">6.1.2.1.</span> <span class="nav-text">过滤器链架构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#FilterChainProxy"><span class="nav-number">6.1.2.2.</span> <span class="nav-text">FilterChainProxy</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SecurityFilterChain"><span class="nav-number">6.1.2.3.</span> <span class="nav-text">SecurityFilterChain</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-1"><span class="nav-number">6.1.3.</span> <span class="nav-text">使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HttpSecurity"><span class="nav-number">6.1.3.1.</span> <span class="nav-text">HttpSecurity</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MethodSecurity"><span class="nav-number">6.1.3.2.</span> <span class="nav-text">MethodSecurity</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E6%88%98"><span class="nav-number">6.1.4.</span> <span class="nav-text">实战</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="nav-number">6.1.4.1.</span> <span class="nav-text">引入依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2"><span class="nav-number">6.1.4.2.</span> <span class="nav-text">页面</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%A6%96%E9%A1%B5"><span class="nav-number">6.1.4.2.1.</span> <span class="nav-text">首页</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Hello%E9%A1%B5"><span class="nav-number">6.1.4.2.2.</span> <span class="nav-text">Hello页</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%99%BB%E5%BD%95%E9%A1%B5"><span class="nav-number">6.1.4.2.3.</span> <span class="nav-text">登录页</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="nav-number">6.1.4.3.</span> <span class="nav-text">配置类</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE%E6%8E%A7%E5%88%B6"><span class="nav-number">6.1.4.3.1.</span> <span class="nav-text">视图控制</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Security%E9%85%8D%E7%BD%AE"><span class="nav-number">6.1.4.3.2.</span> <span class="nav-text">Security配置</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%94%B9%E9%80%A0Hello%E9%A1%B5"><span class="nav-number">6.1.4.4.</span> <span class="nav-text">改造Hello页</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7"><span class="nav-number">7.</span> <span class="nav-text">可观测性</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SpringBoot-Actuator"><span class="nav-number">7.1.</span> <span class="nav-text">SpringBoot Actuator</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E6%88%98-1"><span class="nav-number">7.1.1.</span> <span class="nav-text">实战</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF%E5%BC%95%E5%85%A5"><span class="nav-number">7.1.1.1.</span> <span class="nav-text">场景引入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9A%B4%E9%9C%B2%E6%8C%87%E6%A0%87"><span class="nav-number">7.1.1.2.</span> <span class="nav-text">暴露指标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE"><span class="nav-number">7.1.1.3.</span> <span class="nav-text">访问数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Endpoint"><span class="nav-number">7.1.2.</span> <span class="nav-text">Endpoint</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E7%AB%AF%E7%82%B9"><span class="nav-number">7.1.2.1.</span> <span class="nav-text">常用端点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E5%88%B6%E7%AB%AF%E7%82%B9"><span class="nav-number">7.1.2.2.</span> <span class="nav-text">定制端点</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#HealthEndpoint"><span class="nav-number">7.1.2.2.1.</span> <span class="nav-text">HealthEndpoint</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#MetricsEndpoint"><span class="nav-number">7.1.2.2.2.</span> <span class="nav-text">MetricsEndpoint</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%91%E6%8E%A7%E6%A1%88%E4%BE%8B%E8%90%BD%E5%9C%B0"><span class="nav-number">7.2.</span> <span class="nav-text">监控案例落地</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-Prometheus-Grafana"><span class="nav-number">7.2.1.</span> <span class="nav-text">安装 Prometheus + Grafana</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96-1"><span class="nav-number">7.2.2.</span> <span class="nav-text">导入依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEPrometheus%E6%8B%89%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="nav-number">7.2.3.</span> <span class="nav-text">配置Prometheus拉取数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-Grafana-%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF"><span class="nav-number">7.2.4.</span> <span class="nav-text">配置 Grafana 监控面板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%88%E6%9E%9C"><span class="nav-number">7.2.5.</span> <span class="nav-text">效果</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#AOT"><span class="nav-number">8.</span> <span class="nav-text">AOT</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#AOT%E4%B8%8EJIT"><span class="nav-number">8.1.</span> <span class="nav-text">AOT与JIT</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Complier-%E4%B8%8E-Interpreter"><span class="nav-number">8.1.1.</span> <span class="nav-text">Complier 与 Interpreter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AOT%E4%B8%8EJIT%E5%AF%B9%E6%AF%94"><span class="nav-number">8.1.2.</span> <span class="nav-text">AOT与JIT对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JVM%E6%9E%B6%E6%9E%84"><span class="nav-number">8.1.3.</span> <span class="nav-text">JVM架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java%E7%9A%84%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="nav-number">8.1.4.</span> <span class="nav-text">Java的执行过程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E6%A6%82%E8%A6%81"><span class="nav-number">8.1.4.1.</span> <span class="nav-text">流程概要</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%A6%E7%BB%86%E6%B5%81%E7%A8%8B"><span class="nav-number">8.1.4.2.</span> <span class="nav-text">详细流程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JVM%E7%BC%96%E8%AF%91%E5%99%A8"><span class="nav-number">8.1.5.</span> <span class="nav-text">JVM编译器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E5%B1%82%E7%BC%96%E8%AF%91"><span class="nav-number">8.1.6.</span> <span class="nav-text">分层编译</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GeaalVM"><span class="nav-number">8.2.</span> <span class="nav-text">GeaalVM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%B6%E6%9E%84"><span class="nav-number">8.2.1.</span> <span class="nav-text">架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">8.2.2.</span> <span class="nav-text">安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#VisualStudio"><span class="nav-number">8.2.2.1.</span> <span class="nav-text">VisualStudio</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GraalVM"><span class="nav-number">8.2.2.2.</span> <span class="nav-text">GraalVM</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-1"><span class="nav-number">8.2.2.2.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-number">8.2.2.2.2.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96"><span class="nav-number">8.2.2.2.3.</span> <span class="nav-text">依赖</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81"><span class="nav-number">8.2.2.2.4.</span> <span class="nav-text">验证</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95"><span class="nav-number">8.2.3.</span> <span class="nav-text">测试</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="nav-number">8.2.3.1.</span> <span class="nav-text">创建项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E9%95%9C%E5%83%8F"><span class="nav-number">8.2.3.2.</span> <span class="nav-text">编译镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Linux%E5%B9%B3%E5%8F%B0%E6%B5%8B%E8%AF%95"><span class="nav-number">8.2.3.3.</span> <span class="nav-text">Linux平台测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SpringBoot%E6%95%B4%E5%90%88-1"><span class="nav-number">8.3.</span> <span class="nav-text">SpringBoot整合</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E5%AF%BC%E5%85%A5"><span class="nav-number">8.3.1.</span> <span class="nav-text">依赖导入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90native-image"><span class="nav-number">8.3.2.</span> <span class="nav-text">生成native-image</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="nav-number">8.3.3.</span> <span class="nav-text">常见问题</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="YS"
      src="/images/author.png">
  <p class="site-author-name" itemprop="name">YS</p>
  <div class="site-description" itemprop="description">学海无涯苦作舟</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">62</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.png">
      <meta itemprop="name" content="YS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YS">
      <meta itemprop="description" content="学海无涯苦作舟">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="尚硅谷springboot3场景整合 | YS">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          尚硅谷springboot3场景整合
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-12-19 20:59:47" itemprop="dateCreated datePublished" datetime="2023-12-19T20:59:47+08:00">2023-12-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-01-14 10:45:55" itemprop="dateModified" datetime="2024-01-14T10:45:55+08:00">2024-01-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/java%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">java框架</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>37k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:06</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><p> <strong>Docker 安装</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br><span class="line"></span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line"></span><br><span class="line">sudo systemctl enable docker --now</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">测试工作</span></span><br><span class="line">docker ps</span><br><span class="line"><span class="meta">#</span><span class="bash">  批量安装所有软件</span></span><br><span class="line">docker compose  </span><br></pre></td></tr></table></figure>

<p><strong>创建<code>/prod</code>文件夹，准备以下文件</strong></p>
<p> <strong>prometheus.yml</strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">15s</span></span><br><span class="line">  <span class="attr">evaluation_interval:</span> <span class="string">15s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;prometheus&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;redis&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;redis:6379&#x27;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kafka&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;kafka:9092&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p> <strong>docker-compose.yml</strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.9&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">backend</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">zookeeper:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bitnami/zookeeper:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">zookeeper</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ZOOKEEPER_CLIENT_PORT:</span> <span class="number">2181</span></span><br><span class="line">      <span class="attr">ZOOKEEPER_TICK_TIME:</span> <span class="number">2000</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">backend</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bitnami/kafka:3.4.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kafka</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">zookeeper</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9092:9092&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ALLOW_PLAINTEXT_LISTENER:</span> <span class="literal">yes</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_ZOOKEEPER_CONNECT:</span> <span class="string">zookeeper:2181</span></span><br><span class="line">      <span class="attr">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">backend</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">kafka-ui:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">provectuslabs/kafka-ui:latest</span></span><br><span class="line">    <span class="attr">container_name:</span>  <span class="string">kafka-ui</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">kafka</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">KAFKA_CLUSTERS_0_NAME:</span> <span class="string">dev</span></span><br><span class="line">      <span class="attr">KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS:</span> <span class="string">kafka:9092</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">backend</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">prometheus:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">prom/prometheus:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">prometheus</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./prometheus.yml:/etc/prometheus/prometheus.yml</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9090:9090&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">backend</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">grafana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/grafana:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">grafana</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">prometheus</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3000:3000&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">backend</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">backend:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">backend</span></span><br></pre></td></tr></table></figure>

<p> <strong>启动环境</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose -f docker-compose.yml up -d</span><br></pre></td></tr></table></figure>

<p><strong>验证</strong></p>
<ul>
<li>Redis：你的ip:6379<ul>
<li>填写表单，下载官方可视化工具：</li>
<li><a target="_blank" rel="noopener" href="https://redis.com/redis-enterprise/redis-insight/#insight-form">https://redis.com/redis-enterprise/redis-insight/#insight-form</a></li>
</ul>
</li>
<li>Kafka：你的ip:9092<ul>
<li>idea安装大数据插件</li>
</ul>
</li>
<li>Prometheus：你的ip:9090<ul>
<li>直接浏览器访问</li>
</ul>
</li>
<li>Grafana：你的ip:3000<ul>
<li>直接浏览器访问</li>
</ul>
</li>
</ul>
<h1 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL"></a>NoSQL</h1><h2 id="Redis整合"><a href="#Redis整合" class="headerlink" title="Redis整合"></a>Redis整合</h2><h3 id="场景整合"><a href="#场景整合" class="headerlink" title="场景整合"></a>场景整合</h3><p>依赖导入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.data.redis.host</span>=<span class="string">192.168.96.136  </span></span><br><span class="line"><span class="meta">spring.data.redis.port</span>=<span class="string">6379  </span></span><br><span class="line"><span class="meta">spring.data.redis.password</span>=<span class="string"></span></span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">redisTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    redisTemplate.opsForValue().set(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;1234&quot;</span>);</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;1234&quot;</span>,redisTemplate.opsForValue().get(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>redisTemplate</code>针对redis各种数据结构的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//普通字符串  </span></span><br><span class="line">redisTemplate.opsForValue();  </span><br><span class="line"><span class="comment">//列表  </span></span><br><span class="line">redisTemplate.opsForList();  </span><br><span class="line"><span class="comment">//集合  </span></span><br><span class="line">redisTemplate.opsForSet();  </span><br><span class="line"><span class="comment">//有序集合  </span></span><br><span class="line">redisTemplate.opsForZSet();  </span><br><span class="line"><span class="comment">//hash-map结构  </span></span><br><span class="line">redisTemplate.opsForHash();</span><br></pre></td></tr></table></figure>

<h3 id="自动配置原理"><a href="#自动配置原理" class="headerlink" title="自动配置原理"></a>自动配置原理</h3><ol>
<li><code>\META-INF\spring\org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>中导入了<code>RedisAutoConfiguration</code>、<code>RedisReactiveAutoConfiguration</code>、<code>RedisRepositoriesAutoConfiguration</code>，所有属性绑定在<code>RedisProperties</code>中</li>
<li><code>RedisReactiveAutoConfiguration</code>属于响应式编程，<code>RedisRepositoriesAutoConfiguration</code>属于JPA操作</li>
<li><code>RedisAutoConfiguration</code> 配置了以下组件：<ul>
<li><code>LettuceConnectionConfiguration</code>：给容器中注入了连接工厂<code>LettuceConnectionFactory</code>和操作redis的客户端<code>DefaultClientResources</code>。</li>
<li><code>RedisTemplate&lt;Object, Object&gt;</code>：可以给redis中存储任意对象，默认使用jdk默认的序列化方式。</li>
<li><code>StringRedisTemplate</code>：给redis中存储字符串，如果要存对象，需要开发人员自己进行序列化，key-value都是字符进行操作。</li>
</ul>
</li>
</ol>
<h3 id="定制化"><a href="#定制化" class="headerlink" title="定制化"></a>定制化</h3><h4 id="序列化机制"><a href="#序列化机制" class="headerlink" title="序列化机制"></a>序列化机制</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppRedisConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 允许Object类型的key-value，都可以被转为json进行存储。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> redisConnectionFactory 自动配置好了连接工厂</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;</span><br><span class="line">        RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="comment">//把对象转为json字符串的序列化工具</span></span><br><span class="line">        template.setDefaultSerializer(<span class="keyword">new</span> GenericJackson2JsonRedisSerializer());</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="redis客户端"><a href="#redis客户端" class="headerlink" title="redis客户端"></a>redis客户端</h4><blockquote>
<p>RedisTemplate、StringRedisTemplate ：操作redis的工具类</p>
<ul>
<li>要从redis的连接工厂获取连接才能操作redis</li>
<li>redis客户端<ul>
<li>Lettuce：默认</li>
<li>Jedis：可以使用以下切换</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 将默认的Lettuce从依赖中排除，然后引入Jedis依赖，即可将客户端切换成Jedis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.cliets<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="配置参考"><a href="#配置参考" class="headerlink" title="配置参考"></a>配置参考</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.data.redis.host</span>=<span class="string">192.168.96.136</span></span><br><span class="line"><span class="meta">spring.data.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="comment">#spring.data.redis.client-type=lettuce</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#设置lettuce的底层参数</span></span><br><span class="line"><span class="comment">#spring.data.redis.lettuce.pool.enabled=true</span></span><br><span class="line"><span class="comment">#spring.data.redis.lettuce.pool.max-active=8</span></span><br><span class="line"><span class="comment"># 如果只有某一个客户端的依赖，不需要设置此项会自动使用；</span></span><br><span class="line"><span class="comment"># 如果存在多个客户端的依赖，不设置此项默认使用Lettuce，设置了则使用指定客户端</span></span><br><span class="line"><span class="meta">spring.data.redis.client-type</span>=<span class="string">jedis</span></span><br><span class="line"><span class="meta">spring.data.redis.jedis.pool.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">spring.data.redis.jedis.pool.max-active</span>=<span class="string">8</span></span><br></pre></td></tr></table></figure>

<h1 id="接口文档"><a href="#接口文档" class="headerlink" title="接口文档"></a>接口文档</h1><h2 id="OpenAPI3与Swagger"><a href="#OpenAPI3与Swagger" class="headerlink" title="OpenAPI3与Swagger"></a>OpenAPI3与Swagger</h2><blockquote>
<p>Swagger可以快速生成实时接口文档，方便前后端开发人员进行协调沟通，遵循OpenAPI规范。<br>文档：<a target="_blank" rel="noopener" href="https://springdoc.org/">OpenAPI 3 Library for spring-boot (springdoc.org)</a></p>
</blockquote>
<h3 id="OpenAPI3架构"><a href="#OpenAPI3架构" class="headerlink" title="OpenAPI3架构"></a>OpenAPI3架构</h3><p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/OpenApi3%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A4%BA.png" alt="OpenApi3架构图示"></p>
<h3 id="整合"><a href="#整合" class="headerlink" title="整合"></a>整合</h3><p>导入场景</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springdoc/springdoc-openapi-starter-webmvc-ui --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springdoc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springdoc-openapi-starter-webmvc-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /api-docs endpoint custom path 默认 /v3/api-docs</span></span><br><span class="line"><span class="meta">springdoc.api-docs.path</span>=<span class="string">/api-docs</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># swagger 相关配置在  springdoc.swagger-ui</span></span><br><span class="line"><span class="comment"># swagger-ui custom path</span></span><br><span class="line"><span class="meta">springdoc.swagger-ui.path</span>=<span class="string">/swagger-ui.html</span></span><br><span class="line"></span><br><span class="line"><span class="meta">springdoc.show-actuator</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><h4 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h4><table>
<thead>
<tr>
<th align="center">注解</th>
<th>标注位置</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">@Tag</td>
<td>controller类</td>
<td>标识controller作用</td>
</tr>
<tr>
<td align="center">@Parameter</td>
<td>参数</td>
<td>标识参数作用</td>
</tr>
<tr>
<td align="center">@Parameters</td>
<td>参数</td>
<td>参数多重说明</td>
</tr>
<tr>
<td align="center">@Schema</td>
<td>model层的JavaBean</td>
<td>描述模型作用以及每个属性</td>
</tr>
<tr>
<td align="center">@Operation</td>
<td>方法</td>
<td>描述方法作用</td>
</tr>
<tr>
<td align="center">@ApiResponse</td>
<td>方法</td>
<td>描述方法响应状态码等</td>
</tr>
<tr>
<td align="center"></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="Docket配置"><a href="#Docket配置" class="headerlink" title="Docket配置"></a>Docket配置</h4><blockquote>
<p>如果有多个Docket，配置如下</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置分组，匹配某一种类型的请求路径放在一个组内，可以在页面切换查看</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> GroupedOpenApi <span class="title">publicApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> GroupedOpenApi.builder()</span><br><span class="line">              .group(<span class="string">&quot;springshop-public&quot;</span>)</span><br><span class="line">              .pathsToMatch(<span class="string">&quot;/public/**&quot;</span>)</span><br><span class="line">              .build();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> GroupedOpenApi <span class="title">adminApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> GroupedOpenApi.builder()</span><br><span class="line">              .group(<span class="string">&quot;springshop-admin&quot;</span>)</span><br><span class="line">              .pathsToMatch(<span class="string">&quot;/admin/**&quot;</span>)</span><br><span class="line">              .addMethodFilter(method -&gt; method.isAnnotationPresent(Admin.class))</span><br><span class="line">              .build();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果只有一个Docket，可以配置如下</p>
</blockquote>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">springdoc.packagesToScan</span>=<span class="string">package1, package2</span></span><br><span class="line"><span class="meta">springdoc.pathsToMatch</span>=<span class="string">/v1, /api/balance/**</span></span><br></pre></td></tr></table></figure>

<h4 id="OpenApi配置"><a href="#OpenApi配置" class="headerlink" title="OpenApi配置"></a>OpenApi配置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> OpenAPI <span class="title">springShopOpenAPI</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> OpenAPI()</span><br><span class="line">            .info(<span class="keyword">new</span> Info().title(<span class="string">&quot;SpringShop API&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;Spring shop sample application&quot;</span>)</span><br><span class="line">            .version(<span class="string">&quot;v0.0.1&quot;</span>)</span><br><span class="line">            .license(<span class="keyword">new</span> License().name(<span class="string">&quot;Apache 2.0&quot;</span>).url(<span class="string">&quot;http://springdoc.org&quot;</span>)))</span><br><span class="line">            .externalDocs(<span class="keyword">new</span> ExternalDocumentation()</span><br><span class="line">            .description(<span class="string">&quot;SpringShop Wiki Documentation&quot;</span>)</span><br><span class="line">            .url(<span class="string">&quot;https://springshop.wiki.github.org/docs&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="springFox迁移"><a href="#springFox迁移" class="headerlink" title="springFox迁移"></a>springFox迁移</h3><h4 id="注解变化"><a href="#注解变化" class="headerlink" title="注解变化"></a>注解变化</h4><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>原注解</td>
<td>现注解</td>
<td>作用</td>
</tr>
<tr>
<td>@Api</td>
<td>@Tag</td>
<td>描述Controller</td>
</tr>
<tr>
<td>@ApiIgnore</td>
<td>@Parameter(hidden = true)  <br>@Operation(hidden = true)  <br>@Hidden</td>
<td>描述忽略操作</td>
</tr>
<tr>
<td>@ApiImplicitParam</td>
<td>@Parameter</td>
<td>描述参数</td>
</tr>
<tr>
<td>@ApiImplicitParams</td>
<td>@Parameters</td>
<td>描述参数</td>
</tr>
<tr>
<td>@ApiModel</td>
<td>@Schema</td>
<td>描述对象</td>
</tr>
<tr>
<td>@ApiModelProperty(hidden = true)</td>
<td>@Schema(accessMode = READ_ONLY)</td>
<td>描述对象属性</td>
</tr>
<tr>
<td>@ApiModelProperty</td>
<td>@Schema</td>
<td>描述对象属性</td>
</tr>
<tr>
<td>@ApiOperation(value = “foo”, notes = “bar”)</td>
<td>@Operation(summary = “foo”, description = “bar”)</td>
<td>描述方法</td>
</tr>
<tr>
<td>@ApiParam</td>
<td>@Parameter</td>
<td>描述参数</td>
</tr>
<tr>
<td>@ApiResponse(code = 404, message = “foo”)</td>
<td>@ApiResponse(responseCode = “404”, description = “foo”)</td>
<td>描述响应</td>
</tr>
</tbody></table>
<h4 id="Docket配置-1"><a href="#Docket配置-1" class="headerlink" title="Docket配置"></a>Docket配置</h4><h5 id="以前写法"><a href="#以前写法" class="headerlink" title="以前写法"></a>以前写法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Docket <span class="title">publicApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">            .select()</span><br><span class="line">            .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;org.github.springshop.web.public&quot;</span>))</span><br><span class="line">            .paths(PathSelectors.regex(<span class="string">&quot;/public.*&quot;</span>))</span><br><span class="line">            .build()</span><br><span class="line">            .groupName(<span class="string">&quot;springshop-public&quot;</span>)</span><br><span class="line">            .apiInfo(apiInfo());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Docket <span class="title">adminApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">            .select()</span><br><span class="line">            .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;org.github.springshop.web.admin&quot;</span>))</span><br><span class="line">            .paths(PathSelectors.regex(<span class="string">&quot;/admin.*&quot;</span>))</span><br><span class="line">            .apis(RequestHandlerSelectors.withMethodAnnotation(Admin.class))</span><br><span class="line">            .build()</span><br><span class="line">            .groupName(<span class="string">&quot;springshop-admin&quot;</span>)</span><br><span class="line">            .apiInfo(apiInfo());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="新写法"><a href="#新写法" class="headerlink" title="新写法"></a>新写法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> GroupedOpenApi <span class="title">publicApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> GroupedOpenApi.builder()</span><br><span class="line">            .group(<span class="string">&quot;springshop-public&quot;</span>)</span><br><span class="line">            .pathsToMatch(<span class="string">&quot;/public/**&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> GroupedOpenApi <span class="title">adminApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> GroupedOpenApi.builder()</span><br><span class="line">            .group(<span class="string">&quot;springshop-admin&quot;</span>)</span><br><span class="line">            .pathsToMatch(<span class="string">&quot;/admin/**&quot;</span>)</span><br><span class="line">            .addOpenApiMethodFilter(method -&gt; method.isAnnotationPresent(Admin.class))</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="添加OpenAPI组件"><a href="#添加OpenAPI组件" class="headerlink" title="添加OpenAPI组件"></a>添加OpenAPI组件</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> OpenAPI <span class="title">springShopOpenAPI</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> OpenAPI()</span><br><span class="line">            .info(<span class="keyword">new</span> Info().title(<span class="string">&quot;SpringShop API&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;Spring shop sample application&quot;</span>)</span><br><span class="line">            .version(<span class="string">&quot;v0.0.1&quot;</span>)</span><br><span class="line">            .license(<span class="keyword">new</span> License().name(<span class="string">&quot;Apache 2.0&quot;</span>).url(<span class="string">&quot;http://springdoc.org&quot;</span>)))</span><br><span class="line">            .externalDocs(<span class="keyword">new</span> ExternalDocumentation()</span><br><span class="line">            .description(<span class="string">&quot;SpringShop Wiki Documentation&quot;</span>)</span><br><span class="line">            .url(<span class="string">&quot;https://springshop.wiki.github.org/docs&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="远程调用"><a href="#远程调用" class="headerlink" title="远程调用"></a>远程调用</h1><p><strong>RPC（Remote Procedure Call）：远程过程调用</strong><br><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/RPC%E5%9B%BE%E7%A4%BA.png" alt="RPC图示"><br><strong>本地过程调用</strong>：a(); b(); a(){b();};不同方法都在<strong>同一个JVM运行</strong><br><strong>远程过程调用：</strong></p>
<ul>
<li>服务提供者</li>
<li>服务消费者</li>
<li>通过连接对方服务器进行请求/响应，来实现调用效果</li>
</ul>
<p>API/SDK的区别是什么？</p>
<ul>
<li>api：接口（Application Programming Interface）<ul>
<li>远程提供功能</li>
</ul>
</li>
<li>sdk：工具包（Software Development Kit）<ul>
<li>导入jar包，直接调用功能即可</li>
</ul>
</li>
</ul>
<blockquote>
<p>开发过程中，我们经常需要调用别人写的功能</p>
<ul>
<li>如果是内部微服务，可以通过依赖cloud、注册中心、openfeign等进行调用</li>
<li>如果是外部暴露的，可以发送http请求、或遵循外部协议进行调用</li>
</ul>
<p>SpringBoot 整合提供了很多方式进行远程调用</p>
<ul>
<li>轻量级客户端方式<ul>
<li>RestTemplate：普通开发</li>
<li>RestClient：阻塞式</li>
<li>WebClient：响应式编程开发</li>
<li>Http Interface：声明式编程</li>
</ul>
</li>
<li>Spring Cloud分布式解决方案方式<ul>
<li>Spring Cloud OpenFeign</li>
</ul>
</li>
<li>第三方框架<ul>
<li>Dubbo</li>
<li>gRPC</li>
<li>…</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="RestClient"><a href="#RestClient" class="headerlink" title="RestClient"></a>RestClient</h2><h3 id="创建与配置"><a href="#创建与配置" class="headerlink" title="创建与配置"></a>创建与配置</h3><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- RestClient也是在web场景中，是spring6.1提供的新功能 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建<code>RestClient</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建RestClient并设置url</span></span><br><span class="line">RestClient restClient = RestClient.create(<span class="string">&quot;http://127.0.0.1:8081/get&quot;</span>);</span><br><span class="line"><span class="comment">//或者</span></span><br><span class="line">RestClient restClient = RestClient.builder().baseUrl(<span class="string">&quot;http://127.0.0.1:8081/get&quot;</span>).build();</span><br><span class="line"><span class="comment">//或者创建时不设置，基础路径，调用时再设置</span></span><br><span class="line">RestClient restClient = RestClient.builder().build();  </span><br></pre></td></tr></table></figure>
<p><font color="#ff0000">更多参数可以参考WebClient</font></p>
<h3 id="获取响应"><a href="#获取响应" class="headerlink" title="获取响应"></a>获取响应</h3><p>通过<code>retrieve()</code>方法来声明如何提取响应数据。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">RestClient restClient = RestClient.create(<span class="string">&quot;http://127.0.0.1:8081&quot;</span>);</span><br><span class="line"><span class="comment">//获取完整数据</span></span><br><span class="line">ResponseEntity&lt;Person&gt; entity = restClient.post().uri(<span class="string">&quot;/get&quot;</span>)  </span><br><span class="line">        .contentType(MediaType.APPLICATION_JSON)  </span><br><span class="line">        .body(person).retrieve().toEntity(Person.class);</span><br><span class="line"><span class="comment">//只获取body中的数据</span></span><br><span class="line">Person person1 = restClient.post().uri(<span class="string">&quot;/get&quot;</span>)  </span><br><span class="line">        .contentType(MediaType.APPLICATION_JSON)  </span><br><span class="line">        .body(person).retrieve().body(Person.class);</span><br></pre></td></tr></table></figure>

<h3 id="定义请求体"><a href="#定义请求体" class="headerlink" title="定义请求体"></a>定义请求体</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">String name = <span class="string">&quot;小红书&quot;</span>;  </span><br><span class="line">Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();  </span><br><span class="line">map.put(<span class="string">&quot;name&quot;</span>,name);  </span><br><span class="line"><span class="comment">//可以使用map进行传值（根据名称对应）</span></span><br><span class="line"><span class="comment">//Person person1 = restClient.post().uri(&quot;/&#123;name&#125;/get&quot;, map)  </span></span><br><span class="line"><span class="comment">//也可以使用可变数组进行传值（根据顺序对应）</span></span><br><span class="line">Person person1 = restClient.post().uri(<span class="string">&quot;/&#123;name&#125;/get&quot;</span>, <span class="string">&quot;小红书&quot;</span>)</span><br><span class="line">		<span class="comment">//也可以在请求头中设置参数</span></span><br><span class="line">        .header(<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>)  </span><br><span class="line">        .contentType(MediaType.APPLICATION_JSON)  </span><br><span class="line">        <span class="comment">//设置body</span></span><br><span class="line">        .body(person)</span><br><span class="line">        .retrieve()</span><br><span class="line">        <span class="comment">//设置响应body的接受类型</span></span><br><span class="line">        .body(Person.class);</span><br></pre></td></tr></table></figure>

<h2 id="WebClient"><a href="#WebClient" class="headerlink" title="WebClient"></a>WebClient</h2><blockquote>
<p>非阻塞、响应式HTTP客户端</p>
</blockquote>
<h3 id="创建与配置-1"><a href="#创建与配置-1" class="headerlink" title="创建与配置"></a>创建与配置</h3><p>发请求：</p>
<ul>
<li>请求方式：GET/POST/DELETE/XXX</li>
<li>请求路径：/xxx</li>
<li>请求参数：aa=bb&amp;cc=dd&amp;xxx</li>
<li>请求头：aa=bb,cc=dd</li>
<li>请求体</li>
</ul>
<p>创建<code>WebClient</code>非常简单：</p>
<ul>
<li><code>WebClient.create()</code></li>
<li><code>WebClient.create(String baseUrl)</code><br>还可以使用<code>WebClient.builder()</code>配置更多参数项：</li>
<li><code>uriBuilderFactory()</code>：自定义<code>uriBuilderFactory</code>，定义baseUrl</li>
<li><code>defaultUriVariables()</code> ：默认url变量</li>
<li><code>defaultHeader()</code>：每个请求默认头</li>
<li><code>defaultCookie()</code>：每个请求默认Cookie</li>
<li><code>defaultRequest()</code>：<code>Consumer</code>自定义每个请求</li>
<li><code>filter()</code>：过滤client发送的每个请求</li>
<li><code>exchangeStrategies()</code>：HTTP消息 reader/writer 自定义</li>
<li><code>clientConnector()</code>：HTTP client库设置</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WebClient client = WebClient.create(<span class="string">&quot;https://example.org&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="获取响应-1"><a href="#获取响应-1" class="headerlink" title="获取响应"></a>获取响应</h3><p><font color="#ff0000">retrieve()</font>方法用来声明如何提取响应数据，比如</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取响应完整信息</span></span><br><span class="line">WebClient client = WebClient.create(<span class="string">&quot;https://example.org&quot;</span>);</span><br><span class="line"></span><br><span class="line">Mono&lt;ResponseEntity&lt;Person&gt;&gt; result = client.get()</span><br><span class="line">        .uri(<span class="string">&quot;/persons/&#123;id&#125;&quot;</span>, id).accept(MediaType.APPLICATION_JSON)</span><br><span class="line">        .retrieve()</span><br><span class="line">        .toEntity(Person.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//只获取body</span></span><br><span class="line">WebClient client = WebClient.create(<span class="string">&quot;https://example.org&quot;</span>);</span><br><span class="line"></span><br><span class="line">Mono&lt;Person&gt; result = client.get()</span><br><span class="line">        .uri(<span class="string">&quot;/persons/&#123;id&#125;&quot;</span>, id).accept(MediaType.APPLICATION_JSON)</span><br><span class="line">        .retrieve()</span><br><span class="line">        .bodyToMono(Person.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//stream数据</span></span><br><span class="line">Flux&lt;Quote&gt; result = client.get()</span><br><span class="line">        .uri(<span class="string">&quot;/quotes&quot;</span>).accept(MediaType.TEXT_EVENT_STREAM)</span><br><span class="line">        .retrieve()</span><br><span class="line">        .bodyToFlux(Quote.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义错误处理</span></span><br><span class="line">Mono&lt;Person&gt; result = client.get()</span><br><span class="line">        .uri(<span class="string">&quot;/persons/&#123;id&#125;&quot;</span>, id).accept(MediaType.APPLICATION_JSON)</span><br><span class="line">        .retrieve()</span><br><span class="line">        .onStatus(HttpStatus::is4xxClientError, response -&gt; ...)</span><br><span class="line">        .onStatus(HttpStatus::is5xxServerError, response -&gt; ...)</span><br><span class="line">        .bodyToMono(Person.class);</span><br></pre></td></tr></table></figure>

<h3 id="定义请求体-1"><a href="#定义请求体-1" class="headerlink" title="定义请求体"></a>定义请求体</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1、响应式-单个数据</span></span><br><span class="line">Mono&lt;Person&gt; personMono = ... ;</span><br><span class="line"></span><br><span class="line">Mono&lt;Void&gt; result = client.post()</span><br><span class="line">        .uri(<span class="string">&quot;/persons/&#123;id&#125;&quot;</span>, id)</span><br><span class="line">        .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">        .body(personMono, Person.class)</span><br><span class="line">        .retrieve()</span><br><span class="line">        .bodyToMono(Void.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2、响应式-多个数据</span></span><br><span class="line">Flux&lt;Person&gt; personFlux = ... ;</span><br><span class="line"></span><br><span class="line">Mono&lt;Void&gt; result = client.post()</span><br><span class="line">        .uri(<span class="string">&quot;/persons/&#123;id&#125;&quot;</span>, id)</span><br><span class="line">        .contentType(MediaType.APPLICATION_STREAM_JSON)</span><br><span class="line">        .body(personFlux, Person.class)</span><br><span class="line">        .retrieve()</span><br><span class="line">        .bodyToMono(Void.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3、普通对象</span></span><br><span class="line">Person person = ... ;</span><br><span class="line"></span><br><span class="line">Mono&lt;Void&gt; result = client.post()</span><br><span class="line">        .uri(<span class="string">&quot;/persons/&#123;id&#125;&quot;</span>, id)</span><br><span class="line">        .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">        .bodyValue(person)</span><br><span class="line">        .retrieve()</span><br><span class="line">        .bodyToMono(Void.class);</span><br></pre></td></tr></table></figure>

<h2 id="HTTP-Interface"><a href="#HTTP-Interface" class="headerlink" title="HTTP Interface"></a>HTTP Interface</h2><blockquote>
<p>Spring允许我们通过定义接口的方式，给任意位置发送http请求，实现远程调用，可以用来简化HTTP远程访问，需要<code>webflux</code>场景才可（web场景可以使用<code>RestClient</code>）</p>
</blockquote>
<h3 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a>导入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="定义接口"><a href="#定义接口" class="headerlink" title="定义接口"></a>定义接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BingService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetExchange(url = &quot;/search&quot;)</span></span><br><span class="line">    <span class="function">String <span class="title">search</span><span class="params">(<span class="meta">@RequestParam(&quot;q&quot;)</span> String keyword)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建代理-amp-测试"><a href="#创建代理-amp-测试" class="headerlink" title="创建代理&amp;测试"></a>创建代理&amp;测试</h3><h4 id="WebClient-1"><a href="#WebClient-1" class="headerlink" title="WebClient"></a>WebClient</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boot05TaskApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//1、创建客户端</span></span><br><span class="line">        WebClient client = WebClient.builder()</span><br><span class="line">                .baseUrl(<span class="string">&quot;https://cn.bing.com&quot;</span>)</span><br><span class="line">                .codecs(clientCodecConfigurer -&gt; &#123;</span><br><span class="line">                    clientCodecConfigurer</span><br><span class="line">                            .defaultCodecs()</span><br><span class="line">                            .maxInMemorySize(<span class="number">256</span>*<span class="number">1024</span>*<span class="number">1024</span>);</span><br><span class="line">                            <span class="comment">//响应数据量太大有可能会超出BufferSize，所以这里设置的大一点</span></span><br><span class="line">                &#125;)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">//2、创建工厂</span></span><br><span class="line">        HttpServiceProxyFactory factory = HttpServiceProxyFactory</span><br><span class="line">                .builder(WebClientAdapter.forClient(client)).build();</span><br><span class="line">        <span class="comment">//3、获取代理对象</span></span><br><span class="line">        BingService bingService = factory.createClient(BingService.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、测试调用</span></span><br><span class="line">        Mono&lt;String&gt; search = bingService.search(<span class="string">&quot;尚硅谷&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">        search.subscribe(str -&gt; System.out.println(str));</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">100000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="RestClient-1"><a href="#RestClient-1" class="headerlink" title="RestClient"></a>RestClient</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HttpServiceProxyFactory factory = HttpServiceProxyFactory.builder().exchangeAdapter(RestClientAdapter.create(RestClient.builder().build())).build(); </span><br><span class="line"></span><br><span class="line">PersonInterface personInterface = factory.createClient(PersonInterface.class)</span><br><span class="line">Person person = personInterface.get();</span><br></pre></td></tr></table></figure>
<h1 id="消息服务"><a href="#消息服务" class="headerlink" title="消息服务"></a>消息服务</h1><p><a target="_blank" rel="noopener" href="https://kafka.apache.org/documentation/">Apache Kafka</a></p>
<h2 id="消息队列-场景"><a href="#消息队列-场景" class="headerlink" title="消息队列-场景"></a>消息队列-场景</h2><h3 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h3><p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E5%BC%82%E6%AD%A5%E5%9B%BE%E7%A4%BA.png" alt="异步图示"></p>
<h3 id="解耦"><a href="#解耦" class="headerlink" title="解耦"></a>解耦</h3><p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E8%A7%A3%E8%80%A6%E5%9B%BE%E7%A4%BA.png" alt="解耦图示"></p>
<h3 id="削峰"><a href="#削峰" class="headerlink" title="削峰"></a>削峰</h3><p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E5%89%8A%E5%B3%B0%E5%9B%BE%E7%A4%BA.png" alt="削峰图示"></p>
<h3 id="缓冲"><a href="#缓冲" class="headerlink" title="缓冲"></a>缓冲</h3><p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E7%BC%93%E5%86%B2%E5%9B%BE%E7%A4%BA.png" alt="缓冲图示"></p>
<h2 id="消息队列-Kafka"><a href="#消息队列-Kafka" class="headerlink" title="消息队列-Kafka"></a>消息队列-Kafka</h2><h3 id="消息模式"><a href="#消息模式" class="headerlink" title="消息模式"></a>消息模式</h3><p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/kafka%E6%B6%88%E6%81%AF%E6%A8%A1%E5%BC%8F%E5%9B%BE%E7%A4%BA.png" alt="kafka消息模式图示"></p>
<h3 id="Kafka工作原理"><a href="#Kafka工作原理" class="headerlink" title="Kafka工作原理"></a>Kafka工作原理</h3><p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/kafka%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%9B%BE%E7%A4%BA.png" alt="kafka工作原理图示"></p>
<h3 id="SpringBoot整合"><a href="#SpringBoot整合" class="headerlink" title="SpringBoot整合"></a>SpringBoot整合</h3><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-kafka/reference/index.html">Spring Kafka</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.kafka.bootstrap-servers</span>=<span class="string">192.168.96.136:9092</span></span><br></pre></td></tr></table></figure>
<h3 id="消息发送"><a href="#消息发送" class="headerlink" title="消息发送"></a>消息发送</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boot07KafkaApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    KafkaTemplate kafkaTemplate;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        StopWatch watch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">        watch.start();</span><br><span class="line">        CompletableFuture[] futures = <span class="keyword">new</span> CompletableFuture[<span class="number">10000</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">            CompletableFuture send = kafkaTemplate.send(<span class="string">&quot;order&quot;</span>, <span class="string">&quot;order.create.&quot;</span>+i, <span class="string">&quot;订单创建了：&quot;</span>+i);</span><br><span class="line">            futures[i]=send;</span><br><span class="line">        &#125;</span><br><span class="line">        CompletableFuture.allOf(futures).join();</span><br><span class="line">        watch.stop();</span><br><span class="line">        System.out.println(<span class="string">&quot;总耗时：&quot;</span>+watch.getTotalTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.kafka.core.KafkaTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> KafkaTemplate&lt;String, String&gt; kafkaTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">(KafkaTemplate&lt;String, String&gt; kafkaTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.kafkaTemplate = kafkaTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">someMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.kafkaTemplate.send(<span class="string">&quot;someTopic&quot;</span>, <span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="消息监听"><a href="#消息监听" class="headerlink" title="消息监听"></a>消息监听</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderMsgListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaListener(topics = &quot;order&quot;,groupId = &quot;order-service&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listen</span><span class="params">(ConsumerRecord record)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;收到消息：&quot;</span>+record); <span class="comment">//可以监听到发给kafka的新消息，以前的拿不到</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaListener(groupId = &quot;order-service-2&quot;,topicPartitions = &#123;</span></span><br><span class="line"><span class="meta">            @TopicPartition(topic = &quot;order&quot;,partitionOffsets = &#123;</span></span><br><span class="line"><span class="meta">                    @PartitionOffset(partition = &quot;0&quot;,initialOffset = &quot;0&quot;)</span></span><br><span class="line"><span class="meta">            &#125;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenAll</span><span class="params">(ConsumerRecord record)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;收到partion-0消息：&quot;</span>+record);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="参数配置"><a href="#参数配置" class="headerlink" title="参数配置"></a>参数配置</h3><p>消费者</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.kafka.consumer.value-deserializer</span>=<span class="string">org.springframework.kafka.support.serializer.JsonDeserializer</span></span><br><span class="line"><span class="meta">spring.kafka.consumer.properties[spring.json.value.default.type]</span>=<span class="string">com.example.Invoice</span></span><br><span class="line"><span class="meta">spring.kafka.consumer.properties[spring.json.trusted.packages]</span>=<span class="string">com.example.main,com.example.another</span></span><br></pre></td></tr></table></figure>

<p>生产者</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#序列化</span></span><br><span class="line"><span class="meta">spring.kafka.producer.value-serializer</span>=<span class="string">org.springframework.kafka.support.serializer.JsonSerializer</span></span><br><span class="line"><span class="meta">spring.kafka.producer.properties[spring.json.add.type.headers]</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure>

<h3 id="自动配置原理-1"><a href="#自动配置原理-1" class="headerlink" title="自动配置原理"></a>自动配置原理</h3><p>kafka 自动配置在`KafkaAutoConfiguration</p>
<ol>
<li>容器中放了 <code>KafkaTemplate</code> 可以进行消息收发</li>
<li>容器中放了 <code>KafkaAdmin</code> 可以进行 Kafka 的管理，比如创建 topic 等</li>
<li>kafka 的配置在 <code>KafkaProperties</code> 中</li>
<li><code>@EnableKafka</code>可以开启基于注解的模式</li>
</ol>
<p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/kafka%E7%9F%A5%E8%AF%86%E7%82%B9.png" alt="kafka知识点"></p>
<h1 id="web安全"><a href="#web安全" class="headerlink" title="web安全"></a>web安全</h1><ul>
<li>Apache Shiro</li>
<li>Spring Security</li>
<li>自研：Filter</li>
</ul>
<h2 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h2><h3 id="安全架构"><a href="#安全架构" class="headerlink" title="安全架构"></a>安全架构</h3><h4 id="认证：Authentication"><a href="#认证：Authentication" class="headerlink" title="认证：Authentication"></a>认证：Authentication</h4><blockquote>
<p>who are you?  你是谁<br>登录系统，用户系统</p>
</blockquote>
<h4 id="授权：Authorization"><a href="#授权：Authorization" class="headerlink" title="授权：Authorization"></a>授权：Authorization</h4><blockquote>
<p>what are you allowed to do? 你能做什么？<br>权限管理，用户授权</p>
</blockquote>
<h4 id="攻击防护"><a href="#攻击防护" class="headerlink" title="攻击防护"></a>攻击防护</h4><blockquote>
<ul>
<li>XSS（Cross-site scripting）</li>
<li>CSRF（Cross-site request forgery）</li>
<li>CORS（Cross-Origin Resource Sharimg）</li>
<li>SQL注入</li>
<li>…</li>
</ul>
</blockquote>
<h4 id="扩展：权限模型"><a href="#扩展：权限模型" class="headerlink" title="扩展：权限模型"></a>扩展：权限模型</h4><h5 id="BAC-Role-Based-Access-Controll"><a href="#BAC-Role-Based-Access-Controll" class="headerlink" title="BAC(Role Based Access Controll)"></a>BAC(Role Based Access Controll)</h5><p>用户 -&gt; 角色 -&gt; 权限</p>
<blockquote>
<p>一个用户拥有一个或者多个角色，每个角色下拥有不同的权限。<br>用户不直接对应权限，而是对应角色，然后由角色再对应权限。</p>
</blockquote>
<h5 id="ACL-Access-Controll-List"><a href="#ACL-Access-Controll-List" class="headerlink" title="ACL(Access Controll List)"></a>ACL(Access Controll List)</h5><p>用户 -&gt; 权限</p>
<blockquote>
<p>用户直接和权限对应，直接给用户分配对应权限。</p>
</blockquote>
<h3 id="Spring-Security原理"><a href="#Spring-Security原理" class="headerlink" title="Spring Security原理"></a>Spring Security原理</h3><h4 id="过滤器链架构"><a href="#过滤器链架构" class="headerlink" title="过滤器链架构"></a>过滤器链架构</h4><blockquote>
<p>Spring Security 利用 <code>FilterChainProxy</code> 封装一系列拦截器链，实现各种安全拦截功能。<br>Servlet 三大组件：<code>Servlet</code>、<code>Filter</code>、<code>Listenter</code></p>
</blockquote>
<p>当接收到一个请求，会经过各种<code>Filter</code>，也会经过Security提供的<code>FilterChainProxy(过滤器链)</code>。<br><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E8%BF%87%E6%BB%A4%E5%99%A8%E9%93%BE%E6%9E%B6%E6%9E%84%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="过滤器链架构示意图"></p>
<h4 id="FilterChainProxy"><a href="#FilterChainProxy" class="headerlink" title="FilterChainProxy"></a>FilterChainProxy</h4><p><code>FilterChainProxy</code> 过滤器链，允许用户针对不同的请求定义不同的过滤器链。<br><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/FilterChainProxy%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="FilterChainProxy示意图"></p>
<h4 id="SecurityFilterChain"><a href="#SecurityFilterChain" class="headerlink" title="SecurityFilterChain"></a>SecurityFilterChain</h4><p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/SecurityFilterChain%E5%9B%BE%E7%A4%BA.png" alt="SecurityFilterChain图示"></p>
<h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><h4 id="HttpSecurity"><a href="#HttpSecurity" class="headerlink" title="HttpSecurity"></a>HttpSecurity</h4><p>早期版本的Security需要实现<code>WebSecurityConfigurerAdapter</code>接口，<code>才能操作HttpSecurity</code>，最新版的只需要直接注入即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  </span><br><span class="line"><span class="meta">@Order(SecurityProperties.BASIC_AUTH_ORDER - 10)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationConfigurerAdapter</span> </span>&#123;  </span><br><span class="line">    <span class="meta">@Bean</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> SecurityFilterChain <span class="title">securityFilterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        http.authorizeHttpRequests((request) -&gt; &#123;  </span><br><span class="line">        <span class="comment">//必须拥有某一个角色才能访问某一个路径</span></span><br><span class="line">            request.requestMatchers(<span class="string">&quot;/match1/user&quot;</span>).hasRole(<span class="string">&quot;USER&quot;</span>)  </span><br><span class="line">                    .requestMatchers(<span class="string">&quot;/match2/spam&quot;</span>).hasRole(<span class="string">&quot;SPAM&quot;</span>)  </span><br><span class="line">                    <span class="comment">//所有请求都必须登录之后才能访问（除了上面配置的）</span></span><br><span class="line">                    .anyRequest().authenticated();  </span><br><span class="line">        &#125;);  </span><br><span class="line">        <span class="keyword">return</span> http.build();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="MethodSecurity"><a href="#MethodSecurity" class="headerlink" title="MethodSecurity"></a>MethodSecurity</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">//开启方法注解，可以通过注解来限制必须存在某些角色或者权限的时候才能访问某个方法</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity(securedEnabled = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleSecureApplication</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Secured(&quot;ROLE_USER&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">secure</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello Security&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>核心：</p>
<ul>
<li><code>@EnableMethodSecurity</code> ：开启全局方法安全配置<ul>
<li><code>@Secured</code>：方法鉴权（不常用）</li>
<li><code>@PreAuthorize</code>：方法鉴权，在方法调用之前</li>
<li><code>@PostAuthorize</code>：方法鉴权，在方法调用之后</li>
</ul>
</li>
<li><code>UserDetailsService</code>：<ul>
<li>去数据库查询用户详细信息的service（用户基本信息、用户角色、用户权限）</li>
</ul>
</li>
</ul>
<p>Security场景的自动配置类：</p>
<ul>
<li><code>SecurityAutoConfiguration</code><ul>
<li>Security有关的配置在：<code>SecurityProperties</code>，以<code>spring.security</code>开头</li>
<li><code>SpringBootWebSecurityConfiguration</code><ul>
<li>默认的 <code>SecurityFilterChain</code> ，提供了一些默认的安全策略<ul>
<li>所有的请求都需要认证</li>
<li>开启了表单登录</li>
<li>开启了httpbasic登录</li>
</ul>
</li>
<li><code>@EnableWebSecurity</code>  生效<ul>
<li><code>WebSecurityConfiguration</code><ul>
<li>web安全配置（生效）</li>
</ul>
</li>
<li><code>SpringWebMvcImportSelector</code></li>
<li><code>OAuth2ImportSelector</code></li>
<li><code>HttpSecurityConfiguration</code><ul>
<li>http安全配置（生效）</li>
</ul>
</li>
<li><code>@EnableGlobalAuthentication</code><ul>
<li>开启全局认证（生效）</li>
<li><code>AuthenticationConfiguration</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>SecurityDataConfiguration</code>   未生效</li>
</ul>
</li>
<li><code>SecurityFilterAutoConfiguration</code></li>
</ul>
<h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><h4 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf.extras<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-springsecurity6<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Temporary explicit version to fix Thymeleaf bug --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="页面"><a href="#页面" class="headerlink" title="页面"></a>页面</h4><h5 id="首页"><a href="#首页" class="headerlink" title="首页"></a>首页</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Click <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/hello&#125;&quot;</span>&gt;</span>here<span class="tag">&lt;/<span class="name">a</span>&gt;</span> to see a greeting.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="Hello页"><a href="#Hello页" class="headerlink" title="Hello页"></a>Hello页</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="登录页"><a href="#登录页" class="headerlink" title="登录页"></a>登录页</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;https://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Spring Security Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;param.error&#125;&quot;</span>&gt;</span>Invalid username and password.<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;param.logout&#125;&quot;</span>&gt;</span>You have been logged out.<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/login&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span> User Name : <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> /&gt;</span> <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span> Password: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> /&gt;</span> <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Sign In&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="配置类"><a href="#配置类" class="headerlink" title="配置类"></a>配置类</h4><h5 id="视图控制"><a href="#视图控制" class="headerlink" title="视图控制"></a>视图控制</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.securingweb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ViewControllerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/home&quot;</span>).setViewName(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/hello&quot;</span>).setViewName(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/login&quot;</span>).setViewName(<span class="string">&quot;login&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Security配置"><a href="#Security配置" class="headerlink" title="Security配置"></a>Security配置</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.security.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.provisioning.InMemoryUserDetailsManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.SecurityFilterChain;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lfy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-03-08 16:54</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSecurityConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SecurityFilterChain <span class="title">securityFilterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        http</span><br><span class="line">                .authorizeHttpRequests((requests) -&gt; requests</span><br><span class="line">                        .requestMatchers(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/home&quot;</span>).permitAll()</span><br><span class="line">                        .anyRequest().authenticated()</span><br><span class="line">                )</span><br><span class="line">                .formLogin((form) -&gt; form</span><br><span class="line">                        .loginPage(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">                        .permitAll()</span><br><span class="line">                )</span><br><span class="line">                .logout((logout) -&gt; logout.permitAll());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> http.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDetailsService <span class="title">userDetailsService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        UserDetails user =</span><br><span class="line">                User.withDefaultPasswordEncoder()</span><br><span class="line">                        .username(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">                        .password(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">                        .roles(<span class="string">&quot;USER&quot;</span>)</span><br><span class="line">                        .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> InMemoryUserDetailsManager(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="改造Hello页"><a href="#改造Hello页" class="headerlink" title="改造Hello页"></a>改造Hello页</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:th</span>=<span class="string">&quot;https://www.thymeleaf.org&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:sec</span>=<span class="string">&quot;https://www.thymeleaf.org/thymeleaf-extras-springsecurity6&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:inline</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">      Hello <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:remove</span>=<span class="string">&quot;tag&quot;</span> <span class="attr">sec:authentication</span>=<span class="string">&quot;name&quot;</span>&gt;</span>thymeleaf<span class="tag">&lt;/<span class="name">span</span>&gt;</span>!</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/logout&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Sign Out&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="可观测性"><a href="#可观测性" class="headerlink" title="可观测性"></a>可观测性</h1><blockquote>
<p>可观测性 Observability</p>
</blockquote>
<p>对线上应用进行观测、监控、预警….</p>
<ul>
<li>健康状态【组件状态、存活状态】Health</li>
<li>运行指标【cpu、内存、垃圾收集、吞吐量、响应成功率】Metrics</li>
<li>链路追踪</li>
<li>…<h2 id="SpringBoot-Actuator"><a href="#SpringBoot-Actuator" class="headerlink" title="SpringBoot Actuator"></a>SpringBoot Actuator</h2></li>
</ul>
<h3 id="实战-1"><a href="#实战-1" class="headerlink" title="实战"></a>实战</h3><h4 id="场景引入"><a href="#场景引入" class="headerlink" title="场景引入"></a>场景引入</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="暴露指标"><a href="#暴露指标" class="headerlink" title="暴露指标"></a>暴露指标</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">enabled-by-default:</span> <span class="literal">true</span> <span class="comment">#暴露所有端点信息</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span>  <span class="comment">#以web方式暴露</span></span><br></pre></td></tr></table></figure>
<h4 id="访问数据"><a href="#访问数据" class="headerlink" title="访问数据"></a>访问数据</h4><ul>
<li>访问 <a target="_blank" rel="noopener" href="http://localhost:8080/actuator/">http://localhost:8080/actuator</a>；展示出所有可以用的监控端点</li>
<li><a target="_blank" rel="noopener" href="http://localhost:8080/actuator/beans">http://localhost:8080/actuator/beans</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost:8080/actuator/configprops">http://localhost:8080/actuator/configprops</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost:8080/actuator/metrics">http://localhost:8080/actuator/metrics</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost:8080/actuator/metrics/jvm.gc.pause">http://localhost:8080/actuator/metrics/jvm.gc.pause</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost:8080/actuator/metrics">http://localhost:8080/actuator/</a>endpointName/detailPath</li>
</ul>
<h3 id="Endpoint"><a href="#Endpoint" class="headerlink" title="Endpoint"></a>Endpoint</h3><h4 id="常用端点"><a href="#常用端点" class="headerlink" title="常用端点"></a>常用端点</h4><table>
<thead>
<tr>
<th>ID</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>auditevents</code></td>
<td>暴露当前应用程序的审核事件信息。需要一个<code>AuditEventRepository组件</code>。</td>
</tr>
<tr>
<td><code>beans</code></td>
<td>显示应用程序中所有Spring Bean的完整列表。</td>
</tr>
<tr>
<td><code>caches</code></td>
<td>暴露可用的缓存。</td>
</tr>
<tr>
<td><code>conditions</code></td>
<td>显示自动配置的所有条件信息，包括匹配或不匹配的原因。</td>
</tr>
<tr>
<td><code>configprops</code></td>
<td>显示所有<code>@ConfigurationProperties</code>。</td>
</tr>
<tr>
<td><code>env</code></td>
<td>暴露Spring的属性<code>ConfigurableEnvironment</code></td>
</tr>
<tr>
<td><code>flyway</code></td>
<td>显示已应用的所有Flyway数据库迁移。  <br>需要一个或多个<code>Flyway</code>组件。</td>
</tr>
<tr>
<td><code>health</code></td>
<td>显示应用程序运行状况信息。</td>
</tr>
<tr>
<td><code>httptrace</code></td>
<td>显示HTTP跟踪信息（默认情况下，最近100个HTTP请求-响应）。需要一个<code>HttpTraceRepository</code>组件。</td>
</tr>
<tr>
<td><code>info</code></td>
<td>显示应用程序信息。</td>
</tr>
<tr>
<td><code>integrationgraph</code></td>
<td>显示Spring <code>integrationgraph</code> 。需要依赖<code>spring-integration-core</code>。</td>
</tr>
<tr>
<td><code>loggers</code></td>
<td>显示和修改应用程序中日志的配置。</td>
</tr>
<tr>
<td><code>liquibase</code></td>
<td>显示已应用的所有Liquibase数据库迁移。需要一个或多个<code>Liquibase</code>组件。</td>
</tr>
<tr>
<td><code>metrics</code></td>
<td>显示当前应用程序的“指标”信息。</td>
</tr>
<tr>
<td><code>mappings</code></td>
<td>显示所有<code>@RequestMapping</code>路径列表。</td>
</tr>
<tr>
<td><code>scheduledtasks</code></td>
<td>显示应用程序中的计划任务。</td>
</tr>
<tr>
<td><code>sessions</code></td>
<td>允许从Spring Session支持的会话存储中检索和删除用户会话。需要使用Spring Session的基于Servlet的Web应用程序。</td>
</tr>
<tr>
<td><code>shutdown</code></td>
<td>使应用程序正常关闭。默认禁用。</td>
</tr>
<tr>
<td><code>startup</code></td>
<td>显示由<code>ApplicationStartup</code>收集的启动步骤数据。需要使用<code>SpringApplication</code>进行配置<code>BufferingApplicationStartup</code>。</td>
</tr>
<tr>
<td><code>threaddump</code></td>
<td>执行线程转储。</td>
</tr>
<tr>
<td><code>heapdump</code></td>
<td>返回<code>hprof</code>堆转储文件。</td>
</tr>
<tr>
<td><code>jolokia</code></td>
<td>通过HTTP暴露JMX bean（需要引入Jolokia，不适用于WebFlux）。需要引入依赖<code>jolokia-core</code>。</td>
</tr>
<tr>
<td><code>logfile</code></td>
<td>返回日志文件的内容（如果已设置<code>logging.file.name</code>或<code>logging.file.path</code>属性）。支持使用HTTP<code>Range</code>标头来检索部分日志文件的内容。</td>
</tr>
<tr>
<td><code>prometheus</code></td>
<td>以Prometheus服务器可以抓取的格式公开指标。需要依赖<code>micrometer-registry-prometheus</code>。</td>
</tr>
</tbody></table>
<p>重要端点：<code>threaddump</code>、<code>heapdump</code>、<code>metrics</code></p>
<h4 id="定制端点"><a href="#定制端点" class="headerlink" title="定制端点"></a>定制端点</h4><ul>
<li>健康监控：返回存活、死亡</li>
<li>指标监控：次数、率</li>
</ul>
<h5 id="HealthEndpoint"><a href="#HealthEndpoint" class="headerlink" title="HealthEndpoint"></a>HealthEndpoint</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.health.Health;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.health.HealthIndicator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHealthIndicator</span> <span class="keyword">implements</span> <span class="title">HealthIndicator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Health <span class="title">health</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> errorCode = check(); <span class="comment">// perform some specific health check</span></span><br><span class="line">        <span class="keyword">if</span> (errorCode != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Health.down().withDetail(<span class="string">&quot;Error Code&quot;</span>, errorCode).build();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Health.up().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">构建Health</span><br><span class="line">Health build = Health.down()</span><br><span class="line">                .withDetail(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;error service&quot;</span>)</span><br><span class="line">                .withDetail(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;500&quot;</span>)</span><br><span class="line">                .withException(<span class="keyword">new</span> RuntimeException())</span><br><span class="line">                .build();</span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">    <span class="attr">endpoint:</span>  </span><br><span class="line">      <span class="attr">health:</span>  </span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span>  </span><br><span class="line">        <span class="attr">show-details:</span> <span class="string">always</span> <span class="comment">#总是显示详细信息。可显示每个模块的状态信息</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyComHealthIndicator</span> <span class="keyword">extends</span> <span class="title">AbstractHealthIndicator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 真实的检查方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> builder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doHealthCheck</span><span class="params">(Health.Builder builder)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//mongodb。  获取连接进行测试</span></span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">// 检查完成</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="number">1</span> == <span class="number">2</span>)&#123;</span><br><span class="line"><span class="comment">//            builder.up(); //健康</span></span><br><span class="line">            builder.status(Status.UP);</span><br><span class="line">            map.put(<span class="string">&quot;count&quot;</span>,<span class="number">1</span>);</span><br><span class="line">            map.put(<span class="string">&quot;ms&quot;</span>,<span class="number">100</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//            builder.down();</span></span><br><span class="line">            builder.status(Status.OUT_OF_SERVICE);</span><br><span class="line">            map.put(<span class="string">&quot;err&quot;</span>,<span class="string">&quot;连接超时&quot;</span>);</span><br><span class="line">            map.put(<span class="string">&quot;ms&quot;</span>,<span class="number">3000</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        builder.withDetail(<span class="string">&quot;code&quot;</span>,<span class="number">100</span>)</span><br><span class="line">                .withDetails(map);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="MetricsEndpoint"><a href="#MetricsEndpoint" class="headerlink" title="MetricsEndpoint"></a>MetricsEndpoint</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyService</span></span>&#123;</span><br><span class="line">    Counter counter;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyService</span><span class="params">(MeterRegistry meterRegistry)</span></span>&#123;</span><br><span class="line">         counter = meterRegistry.counter(<span class="string">&quot;myservice.method.running.counter&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        counter.increment();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="监控案例落地"><a href="#监控案例落地" class="headerlink" title="监控案例落地"></a>监控案例落地</h2><p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E7%9B%91%E6%8E%A7%E6%95%B0%E6%8D%AE%E6%B5%81%E5%90%91%E5%9B%BE%E7%A4%BA.png" alt="监控数据流向图示"></p>
<h3 id="安装-Prometheus-Grafana"><a href="#安装-Prometheus-Grafana" class="headerlink" title="安装 Prometheus + Grafana"></a>安装 Prometheus + Grafana</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">安装prometheus:时序数据库</span></span><br><span class="line">docker run -p 9090:9090 -d \</span><br><span class="line">-v pc:/etc/prometheus \</span><br><span class="line">prom/prometheus</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">安装grafana；默认账号密码 admin:admin</span></span><br><span class="line">docker run -d --name=grafana -p 3000:3000 grafana/grafana</span><br></pre></td></tr></table></figure>
<h3 id="导入依赖-1"><a href="#导入依赖-1" class="headerlink" title="导入依赖"></a>导入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.micrometer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>micrometer-registry-prometheus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span> <span class="comment">#暴露所有监控的端点</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure>

<p>访问： <a target="_blank" rel="noopener" href="http://localhost:8001/actuator/prometheus">http://localhost:8001/actuator/prometheus</a> 验证，返回 prometheus 格式的所有指标</p>
<ul>
<li>部署java应用</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">安装上传工具</span></span><br><span class="line">yum install lrzsz</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">安装openjdk</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载openjdk</span></span><br><span class="line">wget https://download.oracle.com/java/17/latest/jdk-17_linux-x64_bin.tar.gz</span><br><span class="line"></span><br><span class="line">mkdir -p /opt/java</span><br><span class="line">tar -xzf jdk-17_linux-x64_bin.tar.gz -C /opt/java/</span><br><span class="line">sudo vi /etc/profile</span><br><span class="line"><span class="meta">#</span><span class="bash">加入以下内容</span></span><br><span class="line">export JAVA_HOME=/opt/java/jdk-17.0.7</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">环境变量生效</span></span><br><span class="line">source /etc/profile</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 后台启动java应用</span></span><br><span class="line">nohup java -jar boot3-14-actuator-0.0.1-SNAPSHOT.jar &gt; output.log 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>确认可以访问到： <a target="_blank" rel="noopener" href="http://127.0.0.1:9999/actuator/prometheus">http://192.18.96.136:9999/actuator/prometheus</a></p>
<h3 id="配置Prometheus拉取数据"><a href="#配置Prometheus拉取数据" class="headerlink" title="配置Prometheus拉取数据"></a>配置Prometheus拉取数据</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 修改 prometheus.yml 配置文件</span></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;spring-boot-actuator-exporter&#x27;</span></span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">&#x27;/actuator/prometheus&#x27;</span> <span class="comment">#指定抓取的路径</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.200.1:8001&#x27;</span>]</span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">nodename:</span> <span class="string">&#x27;app-demo&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置-Grafana-监控面板"><a href="#配置-Grafana-监控面板" class="headerlink" title="配置 Grafana 监控面板"></a>配置 Grafana 监控面板</h3><ul>
<li>添加数据源（Prometheus）</li>
<li>添加面板。可去 dashboard 市场找一个自己喜欢的面板，也可以自己开发面板;<a target="_blank" rel="noopener" href="https://grafana.com/grafana/dashboards/?plcmt=footer">Dashboards | Grafana Labs</a><h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3></li>
</ul>
<p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E7%9B%91%E6%8E%A7%E6%95%88%E6%9E%9C%E5%9B%BE%E7%A4%BA.png" alt="监控效果图示"></p>
<h1 id="AOT"><a href="#AOT" class="headerlink" title="AOT"></a>AOT</h1><h2 id="AOT与JIT"><a href="#AOT与JIT" class="headerlink" title="AOT与JIT"></a>AOT与JIT</h2><p><font color="#ff0000">AOT</font>：Ahead-of-Time(提取<strong>编译</strong>)：程序执行前，全部被编译成机器码<br><font color="#ff0000">JIT</font>：Just in Time(即时<strong>编译</strong>)：程序边编译，边运行</p>
<p>编译：</p>
<ul>
<li>源代码（.c、.cpp、.go、.java…）===&gt; 编译 ===&gt; 机器码</li>
</ul>
<p>语言：</p>
<ul>
<li>编译型语言：编译器</li>
<li>解释型语言：解释器</li>
</ul>
<h3 id="Complier-与-Interpreter"><a href="#Complier-与-Interpreter" class="headerlink" title="Complier 与 Interpreter"></a>Complier 与 Interpreter</h3><p>Java：半编译半解释<br><a target="_blank" rel="noopener" href="https://anycodes.cn/editor">在线编程</a></p>
<p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E7%BC%96%E8%AF%91%E4%B8%8E%E8%A7%A3%E9%87%8A%E8%AF%AD%E8%A8%80%E5%9B%BE%E7%A4%BA.png" alt="编译与解释语言图示"></p>
<table>
<thead>
<tr>
<th>对比项</th>
<th>编译器</th>
<th>解释器</th>
</tr>
</thead>
<tbody><tr>
<td><strong>机器执行速度</strong></td>
<td><strong>快</strong>，因为源代码只需被转换一次</td>
<td><strong>慢</strong>，因为每行代码都需要被解释执行</td>
</tr>
<tr>
<td><strong>开发效率</strong></td>
<td><strong>慢</strong>，因为需要耗费大量时间编译</td>
<td><strong>快</strong>，无需花费时间生成目标代码，更快的开发和测试</td>
</tr>
<tr>
<td><strong>调试</strong></td>
<td><strong>难以调试</strong>编译器生成的目标代码</td>
<td><strong>容易调试</strong>源代码，因为解释器一行一行地执行</td>
</tr>
<tr>
<td><strong>可移植性（跨平台）</strong></td>
<td>不同平台需要重新编译目标平台代码</td>
<td>同一份源码可以跨平台执行，因为每个平台会开发对应的解释器</td>
</tr>
<tr>
<td><strong>学习难度</strong></td>
<td>相对较高，需要了解源代码、编译器以及目标机器的知识</td>
<td>相对较低，无需了解机器的细节</td>
</tr>
<tr>
<td><strong>错误检查</strong></td>
<td>编译器可以在编译代码时检查错误</td>
<td>解释器只能在执行代码时检查错误</td>
</tr>
<tr>
<td><strong>运行时增强</strong></td>
<td>无</td>
<td>可以<strong>动态增强</strong></td>
</tr>
</tbody></table>
<h3 id="AOT与JIT对比"><a href="#AOT与JIT对比" class="headerlink" title="AOT与JIT对比"></a>AOT与JIT对比</h3><table>
<thead>
<tr>
<th></th>
<th>JIT</th>
<th>AOT</th>
</tr>
</thead>
<tbody><tr>
<td>优点</td>
<td>1.具备<strong>实时调整</strong>能力  <br>2.生成<strong>最优机器指令</strong>  <br>3.根据代码运行情况<strong>优化内存占用</strong></td>
<td>1.速度快，优化了运行时编译时间和内存消耗  <br>2.程序初期就能达最高性能  <br>3.加快程序启动速度</td>
</tr>
<tr>
<td>缺点</td>
<td>1.运行期边编译<strong>速度慢</strong>  <br>2.初始编译不能达到<strong>最高性能</strong></td>
<td>1.程序第一次编译占用时间长  <br>2.牺牲<strong>高级语言</strong>一些特性</td>
</tr>
</tbody></table>
<p>在OpenJDK的官方Wiki上，介绍了HotSpot虚拟机一个相对全面的、<strong>即时编译器（JIT）</strong> 中采用的<a target="_blank" rel="noopener" href="https://wiki.openjdk.org/display/HotSpot/PerformanceTacticIndex">优化技术列表</a><br><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E6%8A%80%E6%9C%AF%E5%88%97%E8%A1%A8%E5%9B%BE1.png" alt="技术列表图1"></p>
<p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E6%8A%80%E6%9C%AF%E5%88%97%E8%A1%A8%E5%9B%BE2.png" alt="技术列表图"></p>
<p>可使用：<code>-XX:+PrintCompilation</code> 打印JIT编译信息</p>
<h3 id="JVM架构"><a href="#JVM架构" class="headerlink" title="JVM架构"></a>JVM架构</h3><p>.java ====&gt; .class ====&gt; 机器码<br><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/JVM%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A4%BA.png" alt="JVM架构图示"></p>
<p><strong>JVM：既有解释器，又有编译器（JIT：即时编译）</strong></p>
<h3 id="Java的执行过程"><a href="#Java的执行过程" class="headerlink" title="Java的执行过程"></a>Java的执行过程</h3><p>建议阅读：</p>
<ul>
<li>美团技术：<a target="_blank" rel="noopener" href="https://tech.meituan.com/2020/10/22/java-jit-practice-in-meituan.html">https://tech.meituan.com/2020/10/22/java-jit-practice-in-meituan.html</a></li>
<li>openjdk官网：<a target="_blank" rel="noopener" href="https://wiki.openjdk.org/display/HotSpot/Compiler">https://wiki.openjdk.org/display/HotSpot/Compiler</a></li>
</ul>
<h4 id="流程概要"><a href="#流程概要" class="headerlink" title="流程概要"></a>流程概要</h4><p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/java%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="java代码执行流程示意图"></p>
<h4 id="详细流程"><a href="#详细流程" class="headerlink" title="详细流程"></a>详细流程</h4><p>热点代码：调用次数非常多的代码<br><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E8%AF%A6%E7%BB%86%E6%B5%81%E7%A8%8B%E5%9B%BE%E7%A4%BA.png" alt="详细流程图示"></p>
<h3 id="JVM编译器"><a href="#JVM编译器" class="headerlink" title="JVM编译器"></a>JVM编译器</h3><p>JVM中集成了两种编译器，<code>Client Compiler</code>和<code>Server Compiler</code></p>
<ul>
<li><code>Client Compiler</code>注重启动速度和局部的优化</li>
<li><code>Server Compiler</code>更加关注全局优化，性能更好，但</li>
</ul>
<p><code>Client Compiler</code></p>
<ul>
<li><code>HotSpot VM</code>带有一个 <code>Client Compiler</code> <code>C1</code>编译器</li>
<li>这种编译器启动速度快，但是性能比较 <code>Server Compiler</code> 来说会差一点</li>
<li>编译后的机器码执行效率没有<code>C2</code>的高</li>
</ul>
<p><code>Server Compiler</code></p>
<ul>
<li>HotSpot虚拟机中使用的<code>Server Compiler</code>有两种：<code>C2</code>和<code>Graal</code></li>
<li>在HotSpot VM中，默认的<code>Server Compiler</code>是<code>C2</code>编译器</li>
</ul>
<h3 id="分层编译"><a href="#分层编译" class="headerlink" title="分层编译"></a>分层编译</h3><p>Java7开始引入了分层编译（Tiered Compiler）的概念，它结合了C1和C2的优势，追求启动速度和峰值性能的一个平衡。分层编译将JVM的执行状态分为了五个层次，五个层次分别是：</p>
<ul>
<li>解释执行；</li>
<li>执行不带profiling的C1代码；</li>
<li>执行仅带方法调用次数以及循环回边执行次数的profiling的C1代码；</li>
<li>执行带所有profiling的C1代码；</li>
<li>执行C2代码。</li>
</ul>
<p>profiling就是收集能够反映程序执行状态的数据。其中最基本的统计数据就是方法的调用次数，以及循环回边的执行次数。<br><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E5%88%86%E5%B1%82%E7%BC%96%E8%AF%91%E5%9B%BE%E7%A4%BA.png" alt="分层编译图示"></p>
<ul>
<li>图中第①条路径，代表编译的一般情况，<strong>热点方法</strong>从解释执行到被3层的C1编译，最后被4层的C2编译。</li>
<li>如果<strong>方法比较小</strong>(比如java服务中常见的<strong>getter/setter</strong>方法)，3层的profiling没有收集到有价值的数据，JVM就会断定该方法对于C1代码和C2代码执行效率相同，就会执行图中第②条路径。在这种情况下，JVM会在3层编译之后，放弃进入C2编译，*<em>直接选择用1层的C1编译运行</em>***。</li>
<li>在<strong>C1忙碌</strong>的情况下，执行图中第③条路径，在解释执行过程中对程序进行<strong>profiling</strong>，根据信息直接由第4层的<strong>C2编译</strong>。</li>
<li>前文中提到C1中的执行效率是<strong>1层&gt;2层&gt;3层</strong>，<strong>第3层</strong>一般要比<strong>第2层</strong>慢35%以上，所以在<strong>C2忙碌</strong>的情况下，执行图中第④条路径。这时方法会被2层的C1编译，然后再被3层的C1编译，以减少方法在<strong>3层</strong>的执行时间。</li>
<li>如果<strong>编译器</strong>做了一些比较<strong>激进的优化</strong>，比如分支预测，在实际运行时<strong>发现预测出错</strong>，这时就会进行<strong>反优化</strong>，重新进入<strong>解释执行</strong>，图中第⑤条执行路径代码的就是<strong>反优化</strong>。</li>
</ul>
<p>总的来说，C1编译速度更快，C2的编译质量更高，分层编译的不同编译路径，也就是JVM根据当前服务的运行情况来寻找当前服务的最佳平衡点的一个过程。从JDK8开始，JVM默认开始分层编译。</p>
<p>存在的问题：</p>
<ul>
<li>java应用如果用jar，解释执行，热点代码才编译成机器码；初始启动速度慢，初始处理请求数量少。</li>
<li>大型云平台，要求每一种应用都必须秒级启动，每个应用都要求效率高。</li>
</ul>
<p>希望的效果：</p>
<ul>
<li>java应用也能提前被编译成机器码，随时急速启动，一启动就急速运行，最高性能</li>
<li>编译成机器码的好处：<ul>
<li>在其他服务器不需要安装Java环境，可以直接运行（同类型服务器）</li>
</ul>
</li>
</ul>
<p>原生镜像：native-image （机器码、本地镜像）</p>
<ul>
<li>把应用打包成能适配本机平台的可执行文件（机器码、本地镜像）</li>
</ul>
<h2 id="GeaalVM"><a href="#GeaalVM" class="headerlink" title="GeaalVM"></a>GeaalVM</h2><p><a target="_blank" rel="noopener" href="https://www.graalvm.org/">GraalVM</a></p>
<blockquote>
<p><strong>GraalVM</strong>是一个高性能的<strong>JDK</strong>，旨在<strong>加速</strong>用Java和其他JVM语言编写的<strong>应用程序</strong>的执行，同时还提供JavaScript、Python和许多其他流行语言的运行时。<br><strong>GraalVM</strong>提供了<strong>两种</strong>运行<strong>Java应用程序</strong>的方式：</p>
<ul>
<li><ol>
<li>在HotSpot JVM上使用<strong>Graal即时（JIT）</strong> 编译器</li>
</ol>
</li>
<li><ol start="2">
<li>作为<strong>预先编译（AOT）</strong> 的本机<strong>可执行文件</strong>运行（<strong>本地镜像</strong>）<br>GraalVM的多语言能力使得在单个应用程序中混合多种编程语言成为可能，同时消除了外部语言调用的成本。</li>
</ol>
</li>
</ul>
</blockquote>
<h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h3><p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/GraalVM%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A4%BA.png" alt="GraalVM架构图示"></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ul>
<li>跨平台提供原生镜像原理<br><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E5%8E%9F%E7%90%86%E5%9B%BE%E7%A4%BA.png" alt="跨平台原理图示"></li>
</ul>
<h4 id="VisualStudio"><a href="#VisualStudio" class="headerlink" title="VisualStudio"></a>VisualStudio</h4><p>GraalVM在Window平台上打包原生镜像需要依赖于<a target="_blank" rel="noopener" href="https://visualstudio.microsoft.com/zh-hans/free-developer-offers/">Visual Studio </a>环境</p>
<p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/VisualStudio%E5%AE%89%E8%A3%85%E5%9B%BE%E7%A4%BA1.png" alt="VisualStudio安装图示1"></p>
<p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/VisualStudio%E5%AE%89%E8%A3%85%E5%9B%BE%E7%A4%BA2.png" alt="VisualStudio安装图示2"><br>别选中文<br><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/VisualStudio%E5%AE%89%E8%A3%85%E5%9B%BE%E7%A4%BA3.png" alt="VisualStudio安装图示3"></p>
<p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/VisualStudio%E5%AE%89%E8%A3%85%E5%9B%BE%E7%A4%BA4.png" alt="VisualStudio安装图示4"></p>
<p>记住安装地址。</p>
<h4 id="GraalVM"><a href="#GraalVM" class="headerlink" title="GraalVM"></a>GraalVM</h4><h5 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h5><p>下载 GraalVM + native-image<br><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/GraalVM%E5%AE%89%E8%A3%85%E5%9B%BE%E7%A4%BA1.png" alt="GraalVM安装图示1"></p>
<p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/GraalVM%E5%AE%89%E8%A3%85%E5%9B%BE%E7%A4%BA2.png" alt="GraalVM安装图示2"></p>
<p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/GraalVM%E5%AE%89%E8%A3%85%E5%9B%BE%E7%A4%BA3.png" alt="GraalVM安装图示3"></p>
<p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/GraalVM%E5%AE%89%E8%A3%85%E5%9B%BE%E7%A4%BA4.png" alt="GraalVM安装图示4"></p>
<h5 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h5><p>修改 JAVA_HOME 与 path，指向新的bin（GraalVM是用来平替JDK的）<br>修改后打开cmd执行<code>java --version</code>命令，验证环境为GraalVM提供的即可。</p>
<h5 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h5><p>最新版的GraalVM中已经携带了<code>native-image</code>，无需再进行下面的安装配置<br>安装 native-image 依赖：</p>
<ol>
<li>网络环境好：参考：<a target="_blank" rel="noopener" href="https://www.graalvm.org/latest/reference-manual/native-image/#install-native-image">https://www.graalvm.org/latest/reference-manual/native-image/#install-native-image</a></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gu install native-image</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>网络不好，使用我们下载的离线jar;<code>native-image-xxx.jar</code>文件<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gu install --file native-image-installable-svm-java17-windows-amd64-22.3.2.jar</span><br></pre></td></tr></table></figure>
<h5 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">native-image</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><h4 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h4><p>创建普通java项目，编写HelloWorld类</p>
<ul>
<li>使用<code>mvn clean package</code>进行打包</li>
<li>确认jar包是否可以执行<code>java -jar xxx.jar</code></li>
</ul>
<p>普通maven项目打可执行jar可以使用插件<code>maven-jar-plugin</code>指定主类入口</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">archive</span>&gt;</span>  </span><br><span class="line">                    <span class="tag">&lt;<span class="name">manifest</span>&gt;</span>  </span><br><span class="line">                        <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.ys.App<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span>  </span><br><span class="line">                    <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;/<span class="name">archive</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>或者使用插件<code>maven-shade-plugin</code>，可以把依赖的jar也一起打进jar包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-shade-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span>  </span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span>  </span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span>  </span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>shade<span class="tag">&lt;/<span class="name">goal</span>&gt;</span>  </span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span>  </span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span>  </span><br><span class="line">                        <span class="tag">&lt;<span class="name">transformers</span>&gt;</span>  </span><br><span class="line">                            <span class="tag">&lt;<span class="name">transformer</span>  </span></span><br><span class="line"><span class="tag">                                    <span class="attr">implementation</span>=<span class="string">&quot;org.apache.maven.plugins.shade.resource.ManifestResourceTransformer&quot;</span>&gt;</span>  </span><br><span class="line">                                <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.ys.App<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span>  </span><br><span class="line">                            <span class="tag">&lt;/<span class="name">transformer</span>&gt;</span>  </span><br><span class="line">                        <span class="tag">&lt;/<span class="name">transformers</span>&gt;</span>  </span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="编译镜像"><a href="#编译镜像" class="headerlink" title="编译镜像"></a>编译镜像</h4><ul>
<li>编译为原生镜像（native-image）:使用<code>native-tools</code>终端<br><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/native-tools%E7%BB%88%E7%AB%AF%E5%9B%BE%E7%A4%BA.png" alt="native-tools终端图示"></li>
</ul>
<p><code>-H:-CheckToolchain</code>环境检查，打包之前会自动检查本地环境，检查有可能会不通过，如果确认本地环境没有问题，那么可以添加此参数跳过环境检查</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">通过jar包打原生镜像，需要指定入口主类，通过入口编译整个jar</span></span><br><span class="line">native-image -H:-CheckToolchain -cp boot3-09-common-1.0-SNAPSHOT.jar com.ys.App -o App</span><br><span class="line"><span class="meta">#</span><span class="bash">通过class字节文件打包原生镜像</span></span><br><span class="line">native-image -H:-CheckToolchain -cp classes com.ys.App -o App</span><br></pre></td></tr></table></figure>

<h4 id="Linux平台测试"><a href="#Linux平台测试" class="headerlink" title="Linux平台测试"></a>Linux平台测试</h4><ul>
<li>安装gcc等环境<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install lrzsz</span><br><span class="line">sudo yum install gcc glibc-devel zlib-devel</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li>下载安装配置Linux下的GraalVM、native-image<ul>
<li>下载：<a target="_blank" rel="noopener" href="https://www.graalvm.org/downloads/">https://www.graalvm.org/downloads/</a></li>
<li>安装：GraalVM、native-image</li>
<li>配置：JAVA环境变量为GraalVM</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf graalvm-ce-java17-linux-amd64-22.3.2.tar.gz -C /opt/java/</span><br><span class="line"></span><br><span class="line">sudo vim /etc/profile</span><br><span class="line"><span class="meta">#</span><span class="bash">修改以下内容</span></span><br><span class="line">export JAVA_HOME=/opt/java/graalvm-ce-java17-22.3.2</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>

<ul>
<li><p>安装native-image</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gu install --file native-image-installable-svm-java17-linux-amd64-22.3.2.jar</span><br></pre></td></tr></table></figure></li>
<li><p>使用native-image编译jar为原生程序</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">native-image -cp xxx.jar org.example.App</span><br></pre></td></tr></table></figure>
<h2 id="SpringBoot整合-1"><a href="#SpringBoot整合-1" class="headerlink" title="SpringBoot整合"></a>SpringBoot整合</h2><p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E5%9C%BA%E6%99%AF%E6%95%B4%E5%90%88/%E7%9F%A5%E8%AF%86%E7%82%B9%E5%9B%BE%E7%A4%BA.png"></p>
<h3 id="依赖导入"><a href="#依赖导入" class="headerlink" title="依赖导入"></a>依赖导入</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.graalvm.buildtools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>native-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="生成native-image"><a href="#生成native-image" class="headerlink" title="生成native-image"></a>生成native-image</h3><ol>
<li>运行aot提前处理命令: <code>mvn springboot:process</code></li>
<li>运行native打包: <code>mvn -Pnative native:build</code><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 推荐加上 -Pnative</span></span><br><span class="line">mvn -Pnative native:build -f pom.xml</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h3><p>可能提示如下各种错误，无法构建原生镜像，需要配置环境变量；</p>
<ul>
<li>出现<code>cl.exe</code>找不到</li>
<li>出现乱码</li>
<li>提示<code>no include path set</code></li>
<li>提示<code>fatal error LNK1104: cannot open file &#39;LIBCMT.lib&#39;</code></li>
<li>提示各种其他找不到</li>
</ul>
<p>需要修改三个环境变量：<code>Path</code>、<code>INCLUDE</code>、<code>lib</code></p>
<ul>
<li>Path：添加如下值<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\APP\develop\VS\Enterprise\VC\Tools\MSVC\14.35.32215\bin\Hostx64\x64</span><br></pre></td></tr></table></figure></li>
<li>新建<code>INCLUDE</code>环境变量(个人电脑win11下不存在在对应路径无法配置)：值为<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Microsoft Visual Studio\2022\Community\VC\Tools\MSVC\14.33.31629\include;C:\Program Files (x86)\Windows Kits\10\Include\10.0.19041.0\shared;C:\Program Files (x86)\Windows Kits\10\Include\10.0.19041.0\ucrt;C:\Program Files (x86)\Windows Kits\10\Include\10.0.19041.0\um;C:\Program Files (x86)\Windows Kits\10\Include\10.0.19041.0\winrt</span><br></pre></td></tr></table></figure></li>
<li>新建<code>lib</code>环境变量（不存在对应路径），值为<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Microsoft Visual Studio\2022\Community\VC\Tools\MSVC\14.33.31629\lib\x64;C:\Program Files (x86)\Windows Kits\10\Lib\10.0.19041.0\um\x64;C:\Program Files (x86)\Windows Kits\10\Lib\10.0.19041.0\ucrt\x64</span><br></pre></td></tr></table></figure></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/springboot3/" rel="tag"># springboot3</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/" rel="prev" title="尚硅谷springboot3核心特性-核心原理(五)">
                  <i class="fa fa-angle-left"></i> 尚硅谷springboot3核心特性-核心原理(五)
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
<hr>
<div id="comment-container"></div>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script>
    new Valine({
        el: '#comment-container',
        appId: 'SsNHix8sOQXkmksOkIvo0jkf-gzGzoHsz',
        appKey: 'BCtPpmnU41TOE7Wr5O0CJFgS'
    })
</script>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">YS</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">735k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">22:17</span>
  </span>
</div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.2/anime.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.umd.js" integrity="sha256-ytMJGN3toR+a84u7g7NuHm91VIR06Q41kMWDr2pq7Zo=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>



  





</body>
</html>
