<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.4.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/ys_ico.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/ys_ico.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.css" integrity="sha256-6cQIC71/iBIYXFK+0RHAvwmjwWzkWd+r7v/BX3/vZDc=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"ysymj.gitee.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.19.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="哔哩哔哩视频《尚硅谷SpringBoot零基础教程，面试&amp;加薪必会springboot3》学习笔记，地址：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1Es4y1q7B">
<meta property="og:type" content="article">
<meta property="og:title" content="尚硅谷springboot3核心特性-Web开发(二)">
<meta property="og:url" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-Web%E5%BC%80%E5%8F%91/index.html">
<meta property="og:site_name" content="YS">
<meta property="og:description" content="哔哩哔哩视频《尚硅谷SpringBoot零基础教程，面试&amp;加薪必会springboot3》学习笔记，地址：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1Es4y1q7B">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-Web%E5%BC%80%E5%8F%91/WebMvcConfigurer%E6%96%B9%E6%B3%95%E7%A4%BA%E6%84%8F%E5%9B%BE.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-Web%E5%BC%80%E5%8F%91/%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-Web%E5%BC%80%E5%8F%91/%E9%BB%98%E8%AE%A4HttpMessageConverter%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-Web%E5%BC%80%E5%8F%91/8%E4%B8%AA%E9%BB%98%E8%AE%A4HttpMessageConverter%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-Web%E5%BC%80%E5%8F%91/%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F%E6%B5%81%E7%A8%8B%E5%AF%B9%E6%AF%94%E5%9B%BE.png">
<meta property="og:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-Web%E5%BC%80%E5%8F%91/springboot%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6%E5%9B%BE%E7%A4%BA.png">
<meta property="article:published_time" content="2023-12-19T12:26:38.000Z">
<meta property="article:modified_time" content="2023-12-31T01:38:49.591Z">
<meta property="article:author" content="YS">
<meta property="article:tag" content="springboot3">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-Web%E5%BC%80%E5%8F%91/WebMvcConfigurer%E6%96%B9%E6%B3%95%E7%A4%BA%E6%84%8F%E5%9B%BE.png">


<link rel="canonical" href="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-Web%E5%BC%80%E5%8F%91/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-Web%E5%BC%80%E5%8F%91/","path":"2023/12/19/spring/尚硅谷springboot3核心特性-Web开发/","title":"尚硅谷springboot3核心特性-Web开发(二)"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>尚硅谷springboot3核心特性-Web开发(二) | YS</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">YS</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">学无止境</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#WebMvcAutoConfiguration%E5%8E%9F%E7%90%86"><span class="nav-number">1.</span> <span class="nav-text">WebMvcAutoConfiguration原理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%95%88%E6%9D%A1%E4%BB%B6"><span class="nav-number">1.1.</span> <span class="nav-text">生效条件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%88%E6%9E%9C"><span class="nav-number">1.2.</span> <span class="nav-text">效果</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WebMvcConfigurer%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.3.</span> <span class="nav-text">WebMvcConfigurer接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%A7%84%E5%88%99%E6%BA%90%E7%A0%81"><span class="nav-number">1.4.</span> <span class="nav-text">静态资源规则源码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EnableWebMvcConfiguration%E6%BA%90%E7%A0%81"><span class="nav-number">1.5.</span> <span class="nav-text">EnableWebMvcConfiguration源码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%AE%B9%E5%99%A8%E4%B8%AD%E6%94%BE%E4%B8%80%E4%B8%AAWebMvcConfigurer%E5%B0%B1%E8%83%BD%E9%85%8D%E7%BD%AE%E5%BA%95%E5%B1%82%E8%A1%8C%E4%B8%BA"><span class="nav-number">1.6.</span> <span class="nav-text">为什么容器中放一个WebMvcConfigurer就能配置底层行为</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WebMvcConfigurationSupport"><span class="nav-number">1.7.</span> <span class="nav-text">WebMvcConfigurationSupport</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Web%E5%9C%BA%E6%99%AF"><span class="nav-number">2.</span> <span class="nav-text">Web场景</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="nav-number">2.1.</span> <span class="nav-text">自动配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E6%95%88%E6%9E%9C"><span class="nav-number">2.2.</span> <span class="nav-text">默认效果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="nav-number">3.</span> <span class="nav-text">静态资源</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E8%A7%84%E5%88%99"><span class="nav-number">3.1.</span> <span class="nav-text">默认规则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%98%A0%E5%B0%84"><span class="nav-number">3.1.1.</span> <span class="nav-text">静态资源映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%BC%93%E5%AD%98"><span class="nav-number">3.1.2.</span> <span class="nav-text">静态资源缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AC%A2%E8%BF%8E%E9%A1%B5"><span class="nav-number">3.1.3.</span> <span class="nav-text">欢迎页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Facicon"><span class="nav-number">3.1.4.</span> <span class="nav-text">Facicon</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E5%AE%9E%E9%AA%8C"><span class="nav-number">3.1.5.</span> <span class="nav-text">缓存实验</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%A7%84%E5%88%99"><span class="nav-number">3.2.</span> <span class="nav-text">自定义静态资源规则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="nav-number">3.2.1.</span> <span class="nav-text">配置方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E6%96%B9%E5%BC%8F"><span class="nav-number">3.2.2.</span> <span class="nav-text">代码方式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B7%AF%E5%BE%84%E5%8C%B9%E9%85%8D"><span class="nav-number">4.</span> <span class="nav-text">路径匹配</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Ant%E9%A3%8E%E6%A0%BC%E8%B7%AF%E5%BE%84%E7%94%A8%E6%B3%95"><span class="nav-number">4.1.</span> <span class="nav-text">Ant风格路径用法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E5%BC%8F%E5%88%87%E6%8D%A2"><span class="nav-number">4.2.</span> <span class="nav-text">模式切换</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="nav-number">5.</span> <span class="nav-text">内容协商</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E7%AB%AF%E5%86%85%E5%AE%B9%E9%80%82%E9%85%8D"><span class="nav-number">5.1.</span> <span class="nav-text">多端内容适配</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E8%A7%84%E5%88%99-1"><span class="nav-number">5.1.1.</span> <span class="nav-text">默认规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%88%E6%9E%9C%E6%BC%94%E7%A4%BA"><span class="nav-number">5.1.2.</span> <span class="nav-text">效果演示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%8D%8F%E5%95%86%E8%A7%84%E5%88%99%E4%B8%8E%E6%94%AF%E6%8C%81%E7%B1%BB%E5%9E%8B"><span class="nav-number">5.1.3.</span> <span class="nav-text">配置协商规则与支持类型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%86%85%E5%AE%B9%E8%BF%94%E5%9B%9E"><span class="nav-number">5.2.</span> <span class="nav-text">自定义内容返回</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A2%9E%E5%8A%A0yaml%E8%BF%94%E5%9B%9E%E6%94%AF%E6%8C%81"><span class="nav-number">5.2.1.</span> <span class="nav-text">增加yaml返回支持</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%80%83%EF%BC%9A%E5%A6%82%E4%BD%95%E5%A2%9E%E5%8A%A0%E5%85%B6%E4%BB%96"><span class="nav-number">5.2.2.</span> <span class="nav-text">思考：如何增加其他</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HttpMessageConverter%E7%9A%84%E7%A4%BA%E4%BE%8B%E5%86%99%E6%B3%95"><span class="nav-number">5.2.3.</span> <span class="nav-text">HttpMessageConverter的示例写法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E5%8E%9F%E7%90%86-HttpMessageConverter"><span class="nav-number">5.3.</span> <span class="nav-text">内容协商原理-HttpMessageConverter</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ResponseBody-%E7%94%B1-HttpMessageConverter-%E5%A4%84%E7%90%86"><span class="nav-number">5.3.1.</span> <span class="nav-text">@ResponseBody 由 HttpMessageConverter 处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WebMvcAutoConfiguration-%E6%8F%90%E4%BE%9B%E5%87%A0%E7%A7%8D%E9%BB%98%E8%AE%A4-HttpMessageConverter"><span class="nav-number">5.3.2.</span> <span class="nav-text">WebMvcAutoConfiguration 提供几种默认 HttpMessageConverter</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="nav-number">6.</span> <span class="nav-text">模板引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Thymeleaf%E6%95%B4%E5%90%88"><span class="nav-number">6.1.</span> <span class="nav-text">Thymeleaf整合</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95"><span class="nav-number">6.2.</span> <span class="nav-text">基础语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E7%94%A8%E6%B3%95"><span class="nav-number">6.2.1.</span> <span class="nav-text">核心用法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%E7%A4%BA%E4%BE%8B"><span class="nav-number">6.2.2.</span> <span class="nav-text">语法示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7%E8%AE%BE%E7%BD%AE"><span class="nav-number">6.3.</span> <span class="nav-text">属性设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%81%8D%E5%8E%86"><span class="nav-number">6.4.</span> <span class="nav-text">遍历</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A4%E6%96%AD"><span class="nav-number">6.5.</span> <span class="nav-text">判断</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#th-if"><span class="nav-number">6.5.1.</span> <span class="nav-text">th:if</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#th-switch"><span class="nav-number">6.5.2.</span> <span class="nav-text">th:switch</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7%E4%BC%98%E5%85%88%E7%BA%A7"><span class="nav-number">6.6.</span> <span class="nav-text">属性优先级</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%8C%E5%86%85%E5%86%99%E6%B3%95"><span class="nav-number">6.7.</span> <span class="nav-text">行内写法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E9%80%89%E6%8B%A9"><span class="nav-number">6.8.</span> <span class="nav-text">变量选择</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E5%B8%83%E5%B1%80"><span class="nav-number">6.9.</span> <span class="nav-text">模板布局</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%BD%E9%99%85%E5%8C%96"><span class="nav-number">7.</span> <span class="nav-text">国际化</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-number">8.</span> <span class="nav-text">错误处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E6%9C%BA%E5%88%B6"><span class="nav-number">8.1.</span> <span class="nav-text">默认机制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E5%93%8D%E5%BA%94"><span class="nav-number">8.2.</span> <span class="nav-text">自定义错误响应</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89json%E5%93%8D%E5%BA%94"><span class="nav-number">8.2.1.</span> <span class="nav-text">自定义json响应</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%B5%E9%9D%A2%E5%93%8D%E5%BA%94"><span class="nav-number">8.2.2.</span> <span class="nav-text">自定义页面响应</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E6%88%98"><span class="nav-number">8.3.</span> <span class="nav-text">最佳实战</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%AE%B9%E5%99%A8"><span class="nav-number">9.</span> <span class="nav-text">嵌入式容器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="nav-number">9.1.</span> <span class="nav-text">自动配置原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89"><span class="nav-number">9.2.</span> <span class="nav-text">自定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E6%88%98-1"><span class="nav-number">9.3.</span> <span class="nav-text">最佳实战</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%A8%E9%9D%A2%E6%8E%A5%E7%AE%A1SpringMVC"><span class="nav-number">10.</span> <span class="nav-text">全面接管SpringMVC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#WebMvcAutoConfiguration%E5%88%B0%E5%BA%95%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E4%BA%86%E5%93%AA%E4%BA%9B%E8%A7%84%E5%88%99"><span class="nav-number">10.1.</span> <span class="nav-text">WebMvcAutoConfiguration到底自动配置了哪些规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WebMvcConfigurer-%E5%8A%9F%E8%83%BD"><span class="nav-number">10.2.</span> <span class="nav-text">WebMvcConfigurer 功能</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E6%88%98-2"><span class="nav-number">11.</span> <span class="nav-text">最佳实战</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="nav-number">11.1.</span> <span class="nav-text">三种方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%A4%E7%A7%8D%E6%A8%A1%E5%BC%8F"><span class="nav-number">11.2.</span> <span class="nav-text">两种模式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Web%E6%96%B0%E7%89%B9%E6%80%A7"><span class="nav-number">12.</span> <span class="nav-text">Web新特性</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Problemdetails"><span class="nav-number">12.1.</span> <span class="nav-text">Problemdetails</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8Fweb"><span class="nav-number">12.2.</span> <span class="nav-text">函数式web</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF"><span class="nav-number">12.2.1.</span> <span class="nav-text">场景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E7%B1%BB"><span class="nav-number">12.2.2.</span> <span class="nav-text">核心类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="nav-number">12.2.3.</span> <span class="nav-text">示例</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="YS"
      src="/images/author.png">
  <p class="site-author-name" itemprop="name">YS</p>
  <div class="site-description" itemprop="description">学海无涯苦作舟</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">63</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://ysymj.gitee.io/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-Web%E5%BC%80%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.png">
      <meta itemprop="name" content="YS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YS">
      <meta itemprop="description" content="学海无涯苦作舟">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="尚硅谷springboot3核心特性-Web开发(二) | YS">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          尚硅谷springboot3核心特性-Web开发(二)
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-12-19 20:26:38" itemprop="dateCreated datePublished" datetime="2023-12-19T20:26:38+08:00">2023-12-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-12-31 09:38:49" itemprop="dateModified" datetime="2023-12-31T09:38:49+08:00">2023-12-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/java%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">java框架</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>38k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:09</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><blockquote>
<p>SpringBoot的web开发能力，由SpringMVC提供。</p>
</blockquote>
<h1 id="WebMvcAutoConfiguration原理"><a href="#WebMvcAutoConfiguration原理" class="headerlink" title="WebMvcAutoConfiguration原理"></a>WebMvcAutoConfiguration原理</h1><h2 id="生效条件"><a href="#生效条件" class="headerlink" title="生效条件"></a>生效条件</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在这些自动配置之后加载</span></span><br><span class="line"><span class="meta">@AutoConfiguration(after = &#123; DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,  </span></span><br><span class="line"><span class="meta">       ValidationAutoConfiguration.class &#125;)</span>  </span><br><span class="line"><span class="comment">//如果是web应用就生效，类型SERVLET、REACTIVE响应式编程</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span>  </span><br><span class="line"><span class="comment">//类路径中要有这些类才会生效</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class &#125;)</span>  </span><br><span class="line"><span class="comment">//容器中没有这个类型的Bean才会生效 </span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span> </span><br><span class="line"><span class="comment">//优先级</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span>  </span><br><span class="line"><span class="meta">@ImportRuntimeHints(WebResourcesRuntimeHints.class)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcAutoConfiguration</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><ol>
<li>放了两个Filter<ul>
<li><code>HiddenHttpMethodFilter</code>：页面表单提交rest请求（GET、POST、PUT、DELETE）</li>
<li><code>FormContentFilter</code>：表单内容Filter，（servlet规范中，只有get、post请求，这个filter就是为了处理put和delete请求）GET(数据放url后面)、POST（数据放请求体）请求可以携带数据，PUT、DELETE的请求体数据会被忽略</li>
</ul>
</li>
<li>给容器中放了一个<code>WebMvcConfigurer</code>组件，给SpringMVC添加各种定制功能<ul>
<li>所有的功能最终会和配置文件进行绑定</li>
<li><code>WebMvcProperties</code>：<code>spring.mvc</code>配置文件</li>
<li><code>WebProperties</code>：<code>spring.web</code>配置文件</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span>  </span><br><span class="line"><span class="meta">@Import(EnableWebMvcConfiguration.class)</span>  <span class="comment">//额外导入了其他配置</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123; WebMvcProperties.class, WebProperties.class &#125;)</span>  </span><br><span class="line"><span class="meta">@Order(0)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcAutoConfigurationAdapter</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span>, <span class="title">ServletContextAware</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="WebMvcConfigurer接口"><a href="#WebMvcConfigurer接口" class="headerlink" title="WebMvcConfigurer接口"></a>WebMvcConfigurer接口</h2><p>提供了配置SpringMVC底层的所有组件入口</p>
<p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-Web%E5%BC%80%E5%8F%91/WebMvcConfigurer%E6%96%B9%E6%B3%95%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="WebMvcConfigurer方法示意图"></p>
<h2 id="静态资源规则源码"><a href="#静态资源规则源码" class="headerlink" title="静态资源规则源码"></a>静态资源规则源码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.resourceProperties.isAddMappings()) &#123;  </span><br><span class="line">       logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);  </span><br><span class="line">       <span class="keyword">return</span>;    &#125;  </span><br><span class="line">    addResourceHandler(registry, <span class="keyword">this</span>.mvcProperties.getWebjarsPathPattern(),  </span><br><span class="line">          <span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);  </span><br><span class="line">    addResourceHandler(registry, <span class="keyword">this</span>.mvcProperties.getStaticPathPattern(), (registration) -&gt; &#123;  </span><br><span class="line">       registration.addResourceLocations(<span class="keyword">this</span>.resourceProperties.getStaticLocations());  </span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">this</span>.servletContext != <span class="keyword">null</span>) &#123;  </span><br><span class="line">          ServletContextResource resource = <span class="keyword">new</span> ServletContextResource(<span class="keyword">this</span>.servletContext, SERVLET_LOCATION);  </span><br><span class="line">          registration.addResourceLocations(resource);  </span><br><span class="line">       &#125;  </span><br><span class="line">    &#125;);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>规则一：访问<code>/webjars/**</code>路径就去<code>classpath:/META-INF/resources/webjars/</code>下找资源<ul>
<li>maven导入依赖</li>
<li><a target="_blank" rel="noopener" href="https://www.webjars.org/">WebJars</a></li>
</ul>
</li>
<li>规则二：访问<code>/**</code>路径就去静态资源默认的四个位置找资源<ul>
<li>classpath:/META-INF/resources/</li>
<li>classpath:/resources/</li>
<li>classpath:/static/</li>
<li>classpath:/public/</li>
</ul>
</li>
<li>规则三：静态资源，默认都有缓存规则的设置<ul>
<li>所有缓存的设置，都可以通过配置文件修改<code>spring.web</code></li>
<li><code>cachePeriod</code>：缓存周期，多久不用找服务器要新的，默认没有，以s为单位</li>
<li><code>cacheControl</code>：HTTP缓存控制；<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching#%E6%A6%82%E8%A7%88">HTTP 缓存 - HTTP | MDN </a></li>
<li><code>useLastModified</code>：是否使用最后一次修改（判断最后修改时间，如果未修改使用缓存），配合HTTP Cache规则</li>
</ul>
</li>
</ol>
<blockquote>
<p>如果浏览器访问了一个静态资源<code>index.js</code>，如果服务器上这个资源没有发生变化，下次访问的时候就可以直接让浏览器用自己缓存中的东西，而不用给服务器发请求。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">registration.setCachePeriod(getSeconds(<span class="keyword">this</span>.resourceProperties.getCache().getPeriod()));  </span><br><span class="line">registration.setCacheControl(<span class="keyword">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl());  </span><br><span class="line">registration.setUseLastModified(<span class="keyword">this</span>.resourceProperties.getCache().isUseLastModified());</span><br></pre></td></tr></table></figure>

<h2 id="EnableWebMvcConfiguration源码"><a href="#EnableWebMvcConfiguration源码" class="headerlink" title="EnableWebMvcConfiguration源码"></a>EnableWebMvcConfiguration源码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SpringBoot 给容器中放了一个 WebMvcConfigurationSupport 组件</span></span><br><span class="line"><span class="comment">//我们如果自己放了 WebMvcConfigurationSupport 组件，Boot的 WebMvcAutoConfiguration 都会失效</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span>  </span><br><span class="line"><span class="meta">@EnableConfigurationProperties(WebProperties.class)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EnableWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title">DelegatingWebMvcConfiguration</span> <span class="keyword">implements</span> <span class="title">ResourceLoaderAware</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>在这个配置类里面，会放一个组件<code>WelcomePageHandlerMapping</code>（欢迎页）</p>
<ol>
<li><code>HandlerMapping</code>：根据请求路径寻找那个handler能处理请求<ul>
<li><code>WelcomePageHandlerMapping</code>：<ul>
<li>访问<code>/**</code>路径下的所有请求，都在以前四个静态资源路径下找，欢迎页也一样</li>
<li>找<code>index.html</code>：只要静态资源的位置由一个<code>index.html</code>页面，项目启动默认访问</li>
<li>静态资源路径下找不到，会去根路径下找，如果还是找不到，会尝试从容器中找名称为<code>index</code>的视图</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="为什么容器中放一个WebMvcConfigurer就能配置底层行为"><a href="#为什么容器中放一个WebMvcConfigurer就能配置底层行为" class="headerlink" title="为什么容器中放一个WebMvcConfigurer就能配置底层行为"></a>为什么容器中放一个<code>WebMvcConfigurer</code>就能配置底层行为</h2><ul>
<li><code>WebMvcConfigurer</code> 是一个自动配置类，它里面有一个<code>EnableWebMvcConfiguration</code></li>
<li><code>EnableWebMvcConfiguration</code>继承了<code>DelegatingWebMvcConfiguration</code>，这两个都生效</li>
<li><code>DelegatingWebMvcConfiguration</code>里面有一个<code>WebMvcConfigurerComposite</code>属性，该属性的setter方法会注入一个<code>List&lt;WebMvcConfigurer&gt;</code>类型的变量，spring会自动在容器中寻找所有的<code>WebMvcConfigurer</code>类型的Bean</li>
<li>别人调用<code>DelegatingWebMvcConfiguration</code>的方法配置底层规则，而它调用所有<code>WebMvcConfigurer</code>的配置方法。</li>
</ul>
<h2 id="WebMvcConfigurationSupport"><a href="#WebMvcConfigurationSupport" class="headerlink" title="WebMvcConfigurationSupport"></a><code>WebMvcConfigurationSupport</code></h2><p>提供了很多的默认设置。<br>判断系统中是否有相应的类：如果有，就加入相应的<code>HttpMessageConverter</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jackson2Present = ClassUtils.isPresent(<span class="string">&quot;com.fasterxml.jackson.databind.ObjectMapper&quot;</span>, classLoader) &amp;&amp;  </span><br><span class="line">       ClassUtils.isPresent(<span class="string">&quot;com.fasterxml.jackson.core.JsonGenerator&quot;</span>, classLoader);  </span><br><span class="line">jackson2XmlPresent = ClassUtils.isPresent(<span class="string">&quot;com.fasterxml.jackson.dataformat.xml.XmlMapper&quot;</span>, classLoader);  </span><br><span class="line">jackson2SmilePresent = ClassUtils.isPresent(<span class="string">&quot;com.fasterxml.jackson.dataformat.smile.SmileFactory&quot;</span>, classLoader);</span><br></pre></td></tr></table></figure>

<h1 id="Web场景"><a href="#Web场景" class="headerlink" title="Web场景"></a>Web场景</h1><h2 id="自动配置"><a href="#自动配置" class="headerlink" title="自动配置"></a>自动配置</h2><p>1、整合web场景</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、引入了<code>autoconfigure</code>自动配置功能<br>3、<code>@EnableAutoConfiguration</code>注解使用<code>@Import(AutoConfigurationImportSelector.class)</code>批量导入组件<br>4、加载<code>META-INF\spring\org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>文件中配置的所有组件<br>5、所有自动配置类如下(只有web相关)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.web.client.RestClientAutoConfiguration  </span><br><span class="line">org.springframework.boot.autoconfigure.web.client.RestTemplateAutoConfiguration  </span><br><span class="line">org.springframework.boot.autoconfigure.web.embedded.EmbeddedWebServerFactoryCustomizerAutoConfiguration  </span><br><span class="line">===========以下是响应式web场景和现在没有关系==========</span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.HttpHandlerAutoConfiguration  </span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.ReactiveMultipartAutoConfiguration  </span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.ReactiveWebServerFactoryAutoConfiguration  </span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.WebFluxAutoConfiguration  </span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.WebSessionIdResolverAutoConfiguration  </span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.error.ErrorWebFluxAutoConfiguration  </span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.function.client.ClientHttpConnectorAutoConfiguration  </span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.function.client.WebClientAutoConfiguration  </span><br><span class="line">=========以上是响应式web场景==========</span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration  </span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.ServletWebServerFactoryAutoConfiguration  </span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration  </span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.HttpEncodingAutoConfiguration  </span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.MultipartAutoConfiguration  </span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration</span><br></pre></td></tr></table></figure>

<p>6、绑定了配置文件的一堆配置项</p>
<ul>
<li>SpringMvc的所有配置<code>spring.mvc</code></li>
<li>Web场景通用配置<code>spring.web</code></li>
<li>文件上传配置<code>spring.servlet.multipart</code></li>
<li>服务器的配置<code>server</code>:比如：编码方式</li>
</ul>
<h2 id="默认效果"><a href="#默认效果" class="headerlink" title="默认效果"></a>默认效果</h2><p>默认配置：</p>
<ol>
<li>包含了 <code>ContentNegotiatingViewResolver</code> 和 <code>BeanNameViewResolver</code> 组件，<strong>方便视图解析</strong></li>
<li><strong>默认的静态资源处理机制</strong>： 静态资源放在 <code>static</code> 文件夹下即可直接访问</li>
<li><strong>自动注册</strong>了 <code>Converter</code>,<code>GenericConverter</code>,<code>Formatter</code>组件，适配常见<strong>数据类型转换</strong>和<strong>格式化需求</strong></li>
<li><strong>支持</strong> <code>HttpMessageConverters</code>，可以<strong>方便返回</strong><code>json</code>等<strong>数据类型</strong></li>
<li><strong>注册</strong> <code>MessageCodesResolver</code>，方便<strong>国际化</strong>及错误消息处理</li>
<li><strong>支持 静态</strong> <code>index.html</code></li>
<li><strong>自动使用</strong><code>ConfigurableWebBindingInitializer</code>，实现<code>消息处理</code>、<code>数据绑定</code>、<code>类型转化</code>、<code>数据校验</code>等功能</li>
</ol>
<p><strong>重要：</strong></p>
<blockquote>
<ul>
<li>如果想保持 <strong>boot mvc 的默认配置</strong>，并且自定义更多的 mvc 配置，如：<strong>interceptors</strong>, <strong>formatters</strong>, <strong>view controllers</strong> 等。可以使用<font color="#c00000">@Configuration</font>注解添加一个<font color="#c00000">WebMvcConfigurer</font> 类型的配置类，并不要标注 <font color="#c00000">@EnableWebMvc</font></li>
<li>如果想保持 boot mvc 的默认配置，但要自定义核心组件实例，比如：<font color="#c00000">RequestMappingHandlerMapping</font>,<font color="#c00000">RequestMappingHandlerAdapter</font>, 或<font color="#c00000">ExceptionHandlerExceptionResolver</font>，给容器中放一个 <font color="#c00000">WebMvcRegistrations</font> 组件即可</li>
<li>如果想全面接管 Spring MVC，<font color="#c00000">@Configuration</font> 标注一个配置类，并加上 <font color="#c00000">@EnableWebMvc</font> 注解，实现 <font color="#c00000">WebMvcConfigurer</font> 接口</li>
</ul>
</blockquote>
<h1 id="静态资源"><a href="#静态资源" class="headerlink" title="静态资源"></a>静态资源</h1><h2 id="默认规则"><a href="#默认规则" class="headerlink" title="默认规则"></a>默认规则</h2><h3 id="静态资源映射"><a href="#静态资源映射" class="headerlink" title="静态资源映射"></a>静态资源映射</h3><p>静态资源映射规则在 <font color="#c00000">WebMvcAutoConfiguration</font> 中进行了定义：</p>
<ol>
<li><code>/webjars/**</code> 的所有路径 资源都在 <code>classpath:/META-INF/resources/webjars/</code></li>
<li><code>/**</code> 的所有路径 资源都在 <code>classpath:/META-INF/resources/</code>、<code>classpath:/resources/</code>、<code>classpath:/static/</code>、<code>classpath:/public/</code></li>
<li>所有静态资源都定义了<font color="#c00000">缓存规则</font>。【浏览器访问过一次，就会缓存一段时间】，但此功能参数无默认值<ul>
<li><code>period</code>： 缓存间隔。 默认 0S；</li>
<li><code>cacheControl</code>：缓存控制。 默认无；</li>
<li><code>useLastModified</code>：是否使用<code>lastModified</code>头。 默认 false；</li>
</ul>
</li>
</ol>
<h3 id="静态资源缓存"><a href="#静态资源缓存" class="headerlink" title="静态资源缓存"></a>静态资源缓存</h3><ol>
<li>所有静态资源都定义了<font color="#c00000">缓存规则</font>。【浏览器访问过一次，就会缓存一段时间】，但此功能参数无默认值<ul>
<li><code>period</code>： 缓存间隔。 默认 0S；</li>
<li><code>cacheControl</code>：缓存控制。 默认无；</li>
<li><code>useLastModified</code>：是否使用<code>lastModified</code>头。 默认 false；</li>
</ul>
</li>
</ol>
<h3 id="欢迎页"><a href="#欢迎页" class="headerlink" title="欢迎页"></a>欢迎页</h3><p>欢迎页规则在 <code>WebMvcAutoConfiguration</code> 中进行了定义：</p>
<ul>
<li>在静态资源目录下找<code>index.html</code></li>
<li>没有就在<code>templates</code>下找<code>index</code>模板页</li>
</ul>
<h3 id="Facicon"><a href="#Facicon" class="headerlink" title="Facicon"></a>Facicon</h3><ul>
<li>在静态资源目录下找<code>favicon.ico</code>（是浏览器发起的）</li>
</ul>
<h3 id="缓存实验"><a href="#缓存实验" class="headerlink" title="缓存实验"></a>缓存实验</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">9000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#1、spring.web：</span></span><br><span class="line"><span class="comment"># 1.配置国际化的区域信息</span></span><br><span class="line"><span class="comment"># 2.静态资源策略(开启、处理链、缓存)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#开启静态资源映射规则</span></span><br><span class="line"><span class="meta">spring.web.resources.add-mappings</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#设置缓存</span></span><br><span class="line"><span class="comment">#spring.web.resources.cache.period=3600</span></span><br><span class="line"><span class="comment">##缓存详细合并项控制，覆盖period配置：</span></span><br><span class="line"><span class="comment">## 浏览器第一次请求服务器，服务器告诉浏览器此资源缓存7200秒，7200秒以内的所有此资源访问不用发给服务器请求，7200秒以后发请求给服务器</span></span><br><span class="line"><span class="meta">spring.web.resources.cache.cachecontrol.max-age</span>=<span class="string">7200</span></span><br><span class="line"><span class="comment">#使用资源 last-modified 时间，来对比服务器和浏览器的资源是否相同没有变化。相同返回 304</span></span><br><span class="line"><span class="meta">spring.web.resources.cache.use-last-modified</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<h2 id="自定义静态资源规则"><a href="#自定义静态资源规则" class="headerlink" title="自定义静态资源规则"></a>自定义静态资源规则</h2><blockquote>
<p>自定义静态资源路径、自定义缓存规则</p>
</blockquote>
<h3 id="配置方式"><a href="#配置方式" class="headerlink" title="配置方式"></a>配置方式</h3><p><code>spring.mvc</code>：静态资源访问前缀路径<br><code>spring.web</code>：</p>
<ul>
<li>静态资源目录</li>
<li>静态资源缓存策略</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、spring.web：</span></span><br><span class="line"><span class="comment"># 1.配置国际化的区域信息</span></span><br><span class="line"><span class="comment"># 2.静态资源策略(开启、处理链、缓存)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#开启静态资源映射规则</span></span><br><span class="line"><span class="meta">spring.web.resources.add-mappings</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#设置缓存</span></span><br><span class="line"><span class="meta">spring.web.resources.cache.period</span>=<span class="string">3600</span></span><br><span class="line"><span class="comment">##缓存详细合并项控制，覆盖period配置：</span></span><br><span class="line"><span class="comment">## 浏览器第一次请求服务器，服务器告诉浏览器此资源缓存7200秒，7200秒以内的所有此资源访问不用发给服务器请求，7200秒以后发请求给服务器</span></span><br><span class="line"><span class="meta">spring.web.resources.cache.cachecontrol.max-age</span>=<span class="string">7200</span></span><br><span class="line"><span class="comment">## 共享缓存</span></span><br><span class="line"><span class="meta">spring.web.resources.cache.cachecontrol.cache-public</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#使用资源 last-modified 时间，来对比服务器和浏览器的资源是否相同没有变化。相同返回 304</span></span><br><span class="line"><span class="meta">spring.web.resources.cache.use-last-modified</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#自定义静态资源文件夹位置</span></span><br><span class="line"><span class="meta">spring.web.resources.static-locations</span>=<span class="string">classpath:/a/,classpath:/b/,classpath:/static/</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#2、 spring.mvc</span></span><br><span class="line"><span class="comment">## 2.1. 自定义webjars路径前缀</span></span><br><span class="line"><span class="meta">spring.mvc.webjars-path-pattern</span>=<span class="string">/wj/**</span></span><br><span class="line"><span class="comment">## 2.2. 静态资源访问路径前缀</span></span><br><span class="line"><span class="meta">spring.mvc.static-path-pattern</span>=<span class="string">/static/**</span></span><br></pre></td></tr></table></figure>

<h3 id="代码方式"><a href="#代码方式" class="headerlink" title="代码方式"></a>代码方式</h3><ul>
<li>容器中只要有一个<code>WebMvcConfigurer</code>组件，配置的底层行为都会生效</li>
<li>@EnableWebMvc //禁用boot的默认配置</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">//这是一个配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//保留以前规则</span></span><br><span class="line">        <span class="comment">//自己写新的规则。</span></span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/static/**&quot;</span>)</span><br><span class="line">                .addResourceLocations(<span class="string">&quot;classpath:/a/&quot;</span>,<span class="string">&quot;classpath:/b/&quot;</span>)</span><br><span class="line">                .setCacheControl(CacheControl.maxAge(<span class="number">1180</span>, TimeUnit.SECONDS));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">//这是一个配置类,给容器中放一个 WebMvcConfigurer 组件，就能自定义底层</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span>  /*<span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span>*/ </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">webMvcConfigurer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">                registry.addResourceHandler(<span class="string">&quot;/static/**&quot;</span>)</span><br><span class="line">                        .addResourceLocations(<span class="string">&quot;classpath:/a/&quot;</span>, <span class="string">&quot;classpath:/b/&quot;</span>)</span><br><span class="line">                        .setCacheControl(CacheControl.maxAge(<span class="number">1180</span>, TimeUnit.SECONDS));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="路径匹配"><a href="#路径匹配" class="headerlink" title="路径匹配"></a>路径匹配</h1><blockquote>
<p>Spring5.3之后加入了更多的<font color="#c00000">请求路径匹配</font>的实现策略；<br>以前只支持<font color="#c00000">AntPathMatcher</font>策略，现在提供了<font color="#c00000">PathPatternParser</font>策略，并且可以让我们指定到底使用哪种策略，默认<font color="#c00000">PathPatternParser</font></p>
</blockquote>
<h2 id="Ant风格路径用法"><a href="#Ant风格路径用法" class="headerlink" title="Ant风格路径用法"></a>Ant风格路径用法</h2><p>Ant风格的路径模式语法具有一些规则：</p>
<ul>
<li><code>*</code>：表示任意数量的字符</li>
<li><code>?</code>：表示任意一个字符</li>
<li><code>**</code>：表示任意数量的目录</li>
<li><code>&#123;&#125;</code>：表示一个命名的模式占位符</li>
<li><code>[]</code>：表示字符集合，例如[a-z]表示所有小写字母</li>
</ul>
<p>例如：</p>
<ul>
<li><code>*.html</code> 匹配任意名称，扩展名为<code>.html</code>的文件</li>
<li><code>/folder1/*/*.java</code> 匹配在<code>folder1</code>目录下的任意两级目录下的<code>.java</code>文件</li>
<li><code>/folder2/**/*.jsp</code> 匹配在<code>folder2</code>目录下任意目录深度的<code>.jsp</code>文件</li>
<li><code>/&#123;typr&#125;/&#123;id&#125;.html</code> 匹配任意文件名为<code>&#123;id&#125;.html</code>，在任意命名的<code>&#123;type&#125;</code>目录下的文件</li>
</ul>
<p>注意：Ant风格的路径模式语法中的特殊字符需要转移，如：</p>
<ul>
<li>要匹配文件路径中的星号，需要转义为<code>\\*</code></li>
<li>要匹配文件路径中的文化，需要转义为<code>\\?</code></li>
</ul>
<h2 id="模式切换"><a href="#模式切换" class="headerlink" title="模式切换"></a>模式切换</h2><blockquote>
<p><code>AntPathMatcher</code> 与 <code>PathPatternParser</code></p>
<ul>
<li><code>PathPatternParser</code> 在jmh基准测试下，有6<del>8倍吞吐量提升，降低30%</del>40%空间分配率</li>
<li><code>PathPatternParser</code> 兼容 <code>AntPathMatcher</code> 语法，并支持更多类型的路径模式</li>
<li><code>PathPatternParser</code> <code>**</code>多段匹配的支持，仅允许是使用在表达式末尾</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/a*/b?/&#123;p1:[a-f]+&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(HttpServletRequest request, </span></span></span><br><span class="line"><span class="params"><span class="function">                    <span class="meta">@PathVariable(&quot;p1&quot;)</span> String path)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">&quot;路径变量p1： &#123;&#125;&quot;</span>, path);</span><br><span class="line">    <span class="comment">//获取请求路径</span></span><br><span class="line">    String uri = request.getRequestURI();</span><br><span class="line">    <span class="keyword">return</span> uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结：</p>
<ul>
<li>使用默认的路径匹配规则，是由 <code>PathPatternParser</code> 提供的</li>
<li>如果路径中间需要<code>**</code>，替换成ant风格路径<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 改变路径匹配策略：</span></span><br><span class="line"><span class="comment"># ant_path_matcher 老版策略；</span></span><br><span class="line"><span class="comment"># path_pattern_parser 新版策略；</span></span><br><span class="line"><span class="meta">spring.mvc.pathmatch.matching-strategy</span>=<span class="string">ant_path_matcher</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="内容协商"><a href="#内容协商" class="headerlink" title="内容协商"></a>内容协商</h1><blockquote>
<p>一套系统适配多端数据返回</p>
</blockquote>
<p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-Web%E5%BC%80%E5%8F%91/%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E5%9B%BE%E7%A4%BA.png" alt="内容协商图示"></p>
<h2 id="多端内容适配"><a href="#多端内容适配" class="headerlink" title="多端内容适配"></a>多端内容适配</h2><h3 id="默认规则-1"><a href="#默认规则-1" class="headerlink" title="默认规则"></a>默认规则</h3><ul>
<li>SpringBoot多端内容适配<ul>
<li>基于<font color="#c00000">请求头</font>内容协商（默认开启）<ul>
<li>客户端向服务端发送请求，携带HTTP标准的Accept请求头<ul>
<li>Accept：<code>application/json</code>、<code>text/xml</code>、<code>text/yaml</code></li>
<li>服务端根据客户端请求头期望的数据类型进行动态返回</li>
</ul>
</li>
</ul>
</li>
<li>基于<font color="#c00000">请求参数</font>内容协商（需要自己开启）<ul>
<li>发送请<code>GET /project/spring-boot?format=json</code></li>
<li>匹配到<code>@GetMapping(&quot;/project/spring-boot&quot;)</code></li>
<li>根据参数协商，优先返回json类型数据【需要开启参数匹配设置】</li>
<li>发送请求<code>GET /project/spring-boot?format=xml</code>,优先返回xml类型数据</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="效果演示"><a href="#效果演示" class="headerlink" title="效果演示"></a>效果演示</h3><blockquote>
<p>请求同一个接口，可以返回json和xml不同格式数据</p>
</blockquote>
<ol>
<li>引入支持写出xml内容的依赖（springboot默认情况下是不支持的）</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>标注注解<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JacksonXmlRootElement</span>  <span class="comment">// 可以写出为xml文档</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>开启基于请求参数的内容协商<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启基于请求参数的内容协商功能。 默认参数名：format。 默认此功能不开启</span></span><br><span class="line"><span class="meta">spring.mvc.contentnegotiation.favor-parameter</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># 指定内容协商时使用的参数名。默认是 format</span></span><br><span class="line"><span class="meta">spring.mvc.contentnegotiation.parameter-name</span>=<span class="string">type</span></span><br></pre></td></tr></table></figure></li>
<li>效果<br><code>http://127.0.0.1:8080/person?format=json</code><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;userName&quot;</span>: <span class="string">&quot;小明&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;email&quot;</span>: <span class="string">&quot;1234.qq.com&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;age&quot;</span>: <span class="number">12</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><code>http://127.0.0.1:8080/person?format=xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Person</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>1<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userName</span>&gt;</span>小明<span class="tag">&lt;/<span class="name">userName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">email</span>&gt;</span>1234.qq.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">age</span>&gt;</span>12<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Person</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置协商规则与支持类型"><a href="#配置协商规则与支持类型" class="headerlink" title="配置协商规则与支持类型"></a>配置协商规则与支持类型</h3><h2 id="自定义内容返回"><a href="#自定义内容返回" class="headerlink" title="自定义内容返回"></a>自定义内容返回</h2><h3 id="增加yaml返回支持"><a href="#增加yaml返回支持" class="headerlink" title="增加yaml返回支持"></a>增加yaml返回支持</h3><p>导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-yaml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>把对象写出YAML</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">    Person person = <span class="keyword">new</span> Person();</span><br><span class="line">    person.setId(<span class="number">1L</span>);</span><br><span class="line">    person.setUserName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    person.setEmail(<span class="string">&quot;aaa@qq.com&quot;</span>);</span><br><span class="line">    person.setAge(<span class="number">18</span>);</span><br><span class="line"></span><br><span class="line">    YAMLFactory factory = <span class="keyword">new</span> YAMLFactory().disable(YAMLGenerator.Feature.WRITE_DOC_START_MARKER);</span><br><span class="line">    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper(factory);</span><br><span class="line"></span><br><span class="line">    String s = mapper.writeValueAsString(person);</span><br><span class="line">    System.out.println(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加配置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#新增一种媒体类型</span></span><br><span class="line"><span class="meta">spring.mvc.contentnegotiation.media-types.yaml</span>=<span class="string">text/yaml</span></span><br></pre></td></tr></table></figure>

<p>增加<code>HttpMessageConverter</code>组件，专门负责把对象写出为yaml格式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">webMvcConfigurer</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer() &#123;</span><br><span class="line">        <span class="meta">@Override</span> <span class="comment">//配置一个能把对象转为yaml的messageConverter</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class="line">            converters.add(<span class="keyword">new</span> MyYamlHttpMessageConverter());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="思考：如何增加其他"><a href="#思考：如何增加其他" class="headerlink" title="思考：如何增加其他"></a>思考：如何增加其他</h3><ul>
<li>配置媒体类型支持<ul>
<li><code>spring.mvc.contentnegotiation.media-types.yaml=text/yaml</code></li>
<li>编写对应的<code>HttpMessageConverter</code>，要告诉boot整个支持的媒体类型<ul>
<li>按照上的示例</li>
</ul>
</li>
<li>把自定义的<code>HttpMessageConverter</code>组件加入到底层<ul>
<li>容器中国放一个<code>WebMvcConfigurer</code>组件，并配置底层的<code>HttpMessageConverter</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="HttpMessageConverter的示例写法"><a href="#HttpMessageConverter的示例写法" class="headerlink" title="HttpMessageConverter的示例写法"></a>HttpMessageConverter的示例写法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyYamlHttpMessageConverter</span> <span class="keyword">extends</span> <span class="title">AbstractHttpMessageConverter</span>&lt;<span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ObjectMapper objectMapper = <span class="keyword">null</span>; <span class="comment">//把对象转成yaml</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyYamlHttpMessageConverter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//告诉SpringBoot这个MessageConverter支持哪种媒体类型  //媒体类型</span></span><br><span class="line">        <span class="keyword">super</span>(<span class="keyword">new</span> MediaType(<span class="string">&quot;text&quot;</span>, <span class="string">&quot;yaml&quot;</span>, Charset.forName(<span class="string">&quot;UTF-8&quot;</span>)));</span><br><span class="line">        YAMLFactory factory = <span class="keyword">new</span> YAMLFactory()</span><br><span class="line">                .disable(YAMLGenerator.Feature.WRITE_DOC_START_MARKER);</span><br><span class="line">        <span class="keyword">this</span>.objectMapper = <span class="keyword">new</span> ObjectMapper(factory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//只要是对象类型，不是基本类型</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  <span class="comment">//@RequestBody</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">readInternal</span><span class="params">(Class&lt;?&gt; clazz, HttpInputMessage inputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotReadableException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">//@ResponseBody 把对象怎么写出去</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">writeInternal</span><span class="params">(Object methodReturnValue, HttpOutputMessage outputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotWritableException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//try-with写法，自动关流</span></span><br><span class="line">        <span class="keyword">try</span>(OutputStream os = outputMessage.getBody())&#123;</span><br><span class="line">            <span class="keyword">this</span>.objectMapper.writeValue(os,methodReturnValue);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="内容协商原理-HttpMessageConverter"><a href="#内容协商原理-HttpMessageConverter" class="headerlink" title="内容协商原理-HttpMessageConverter"></a>内容协商原理-HttpMessageConverter</h2><blockquote>
<ul>
<li><code>HttpMessageConverter</code> 怎么工作？何时工作？</li>
<li>定制 <code>HttpMessageConverter</code> 来实现多端内容协商</li>
<li>编写 <code>WebMvcConfigurer</code> 提供的 <code>configureMessageConverters</code> 方法，修改底层的 <code>HttpMessageConverter</code></li>
</ul>
</blockquote>
<h3 id="ResponseBody-由-HttpMessageConverter-处理"><a href="#ResponseBody-由-HttpMessageConverter-处理" class="headerlink" title="@ResponseBody 由 HttpMessageConverter 处理"></a><code>@ResponseBody</code> 由 <code>HttpMessageConverter</code> 处理</h3><blockquote>
<p>标注了 <code>@ResponseBody</code> 的返回值将会由支持它的 <code>HttpMessageConverter</code> 写给浏览器</p>
</blockquote>
<ul>
<li>如果controller方法的返回值标注了 <code>@ResponseBody</code> 注解<ul>
<li>请求先来到 <code>DispatcherServlet</code> 的 <code>doDispatch()</code> 方法进行处理</li>
<li>找到一个 <code>HandlerAdapter</code> 适配器，利用适配器执行目标方法</li>
<li><code>RequestMappingHandlerAdapter</code> 来执行，调用 <code>invokeHandlerMethod()</code> 方法来执行目标方法</li>
<li>目标方法执行之前，准备号两个东西<ul>
<li><code>HandlerMethodArgumentResolver</code> ：参数解析器，确定目标方法每个参数值</li>
<li><code>HandlerMethodReturnValueHandler</code> ：返回值处理器，确定目标方法的返回值该怎么处理</li>
</ul>
</li>
<li><code>RequestMappingHandlerAdapter</code> 里面的<code>invokeAndHandle()</code>真正执行目标方法</li>
<li>目标方法执行完成，会返回返<strong>回值对象</strong></li>
<li>找到一个合适的返回值处理器<code>HandlerMethodReturnValueHandler</code></li>
<li>最终找到 <code>RequestResponseBodyMethodProcessor</code> 能处理标注了<code>@ResponseBody</code>注解的方法</li>
<li><code>RequestResponseBodyMethodProcessor</code> 调用 <code>writeWithMessageConverters()</code>方法，利用<code>HttpMessageConverter</code>把返回值写出去</li>
</ul>
</li>
</ul>
<p><font color="#c00000">上面解释：<code>@ResponseBody</code> 由 <code>HttpMessageConverter</code> 处理</font></p>
<ul>
<li><code>HttpMessageConverter</code> 会先进行内容协商<ul>
<li>遍历所有的 <code>HttpMessageConverter</code> 看谁支持这种内容类型的数据</li>
<li>默认 <code>HttpMessageConverter</code> 有以下（其中最后两个xml的是新家的依赖，非默认）：</li>
<li><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-Web%E5%BC%80%E5%8F%91/%E9%BB%98%E8%AE%A4HttpMessageConverter%E5%9B%BE%E7%A4%BA.png" alt="默认HttpMessageConverter图示"></li>
<li>最终因为要 <code>json</code> 所以 <code>MappingJackson2HttpMessageConverter</code> 支持写出json</li>
<li>jackson用<code>ObjectMapper</code> 把对象写出去</li>
</ul>
</li>
</ul>
<h3 id="WebMvcAutoConfiguration-提供几种默认-HttpMessageConverter"><a href="#WebMvcAutoConfiguration-提供几种默认-HttpMessageConverter" class="headerlink" title="WebMvcAutoConfiguration 提供几种默认 HttpMessageConverter"></a><code>WebMvcAutoConfiguration</code> 提供几种默认 <code>HttpMessageConverter</code></h3><ul>
<li>在 <code>WebMvcAutoConfiguration</code> 中有一个静态配置类 <code>EnableWebMvcConfiguration</code> 继承了 <code>DelegatingWebMvcConfiguration</code> 又继承了<code>WebMvcConfigurationSupport</code></li>
<li><code>WebMvcConfigurationSupport</code> 通过 <code>WebMvcConfigurationSupport()</code> 方法添加了默认的 <code>HttpMessageConverter</code><ul>
<li><code>ByteArrayHttpMessageConverter</code> ：支持字节数据读写</li>
<li><code>StringHttpMessageConverter</code> ：支持字符串读写</li>
<li><code>ResourceHttpMessageConverter</code> ：支持资源读写</li>
<li><code>ResourceRegionHttpMessageConverter</code> ：支持分区资源读写</li>
<li><code>AllEncompassingFormHttpMessageConverter</code> ：支持表单xml/json读写</li>
<li><code>MappingJackson2HttpMessageConverter</code> ：支持请求响应体Json读写</li>
</ul>
</li>
</ul>
<p>默认8个:<br><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-Web%E5%BC%80%E5%8F%91/8%E4%B8%AA%E9%BB%98%E8%AE%A4HttpMessageConverter%E5%9B%BE%E7%A4%BA.png" alt="8个默认HttpMessageConverter图示"></p>
<blockquote>
<p>系统提供默认的<code>HttpMessageConverter</code>功能有限，见用于json或者普通返回数据，额外增加新的内容协商功能，需要增加新的<code>HttpMessageConverter</code></p>
</blockquote>
<h1 id="模板引擎"><a href="#模板引擎" class="headerlink" title="模板引擎"></a>模板引擎</h1><blockquote>
<ul>
<li>由于SpringBoot使用了嵌入式Servlet容器，所以JSP默认是不能使用的。</li>
<li>如果需要服务端页面渲染，优先考虑使用模板引擎。</li>
</ul>
</blockquote>
<p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-Web%E5%BC%80%E5%8F%91/%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F%E6%B5%81%E7%A8%8B%E5%AF%B9%E6%AF%94%E5%9B%BE.png" alt="开发模式流程对比图"></p>
<p>模板引擎页面默认是放在<code>src/main/resources/templates</code><br>SpringBoot包含以下模板引擎的自动配置</p>
<ul>
<li>FreeMarker</li>
<li>Groovy</li>
<li>Thymeleaf</li>
<li>Mustache<br>Thymeleaf官网：<a target="_blank" rel="noopener" href="https://www.thymeleaf.org/">Thymeleaf</a></li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Good Thymes Virtual Grocery<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">media</span>=<span class="string">&quot;all&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/css/gtvg.css&#125;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;#&#123;home.welcome&#125;&quot;</span>&gt;</span>Welcome to our grocery store!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&lt;/body</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Thymeleaf整合"><a href="#Thymeleaf整合" class="headerlink" title="Thymeleaf整合"></a>Thymeleaf整合</h2><p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>自动配置原理</p>
<ol>
<li>开启了<code>org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration</code>自动配置</li>
<li>属性绑定在<code>ThymeleafProperties</code>中，对应配置项<code>spring.thymeleaf</code>内容</li>
<li>所有的模板页面默认在<code>classpath:/templates/</code></li>
<li>默认效果<ul>
<li>所有模板页面在<code>classpath:/templates/</code>下面找</li>
<li>找后缀名为<code>.html</code>的页面<h2 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h2></li>
</ul>
</li>
</ol>
<h3 id="核心用法"><a href="#核心用法" class="headerlink" title="核心用法"></a>核心用法</h3><p><code>th:xxx</code>：<font color="#17365d">动态渲染指定的html标签属性，或者th指令（遍历、判断等）</font></p>
<ul>
<li><code>th:text</code>：标签内文本值渲染<ul>
<li><code>th:utext</code>：不会转义，显示为html原本的样子。</li>
</ul>
</li>
<li><code>th:属性</code>：标签指定属性渲染</li>
<li><code>th:attr</code>：标签任意属性渲染</li>
<li><code>th:if</code> <code>th:each</code> <code>...</code> ：其他th指令</li>
<li>例如<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;content&#125;&quot;</span>&gt;</span>原内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;../../images/gtvglogo.png&quot;</span> </span></span><br><span class="line"><span class="tag">     <span class="attr">th:attr</span>=<span class="string">&quot;src=@&#123;/images/gtvglogo.png&#125;,title=#&#123;logo&#125;,alt=#&#123;logo&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><code>表达式</code>：<font color="#17365d">用来动态入取值</font></p>
<ul>
<li><code>$&#123;&#125;</code>：变量取值；使用model共享给页面的值都直接使用<code>$&#123;&#125;</code></li>
<li><code>@&#123;&#125;</code>：url路径；</li>
<li><code>#&#123;&#125;</code>：国际化消息</li>
<li><code>~&#123;&#125;</code>：片段引用</li>
<li><code>*&#123;&#125;</code>：变量选择：需要配合<code>th:object</code>绑定对象</li>
</ul>
<p><code>系统工具&amp;内置对象</code>：<a target="_blank" rel="noopener" href="https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html#appendix-a-expression-basic-objects">详细文档</a></p>
<ul>
<li><code>param</code>：请求参数对象</li>
<li><code>session</code>：session对象</li>
<li><code>application</code>：application对象</li>
<li><code>#execInfo</code>：模板执行信息</li>
<li><code>#uris</code>：uri/url工具</li>
<li><code>#conversions</code>：类型转换工具</li>
<li><code>#dates</code>：日期工具，是<code>java.util.Date</code>对象的工具类</li>
<li><code>#calendars</code>：类似<code>#dates</code>，只不过是<code>java.util.Calender</code>对象的工具类</li>
<li><code>#temporals</code>：JDK8+ <code>java.time</code>API工具类</li>
<li><code>#numbers</code>：数字操作工具类</li>
<li><code>#strings</code>：字符串操作</li>
<li><code>#objects</code>：对象操作</li>
<li><code>#bools</code>：bool操作</li>
<li><code>#arrays</code>：array工具</li>
<li><code>#lists</code>：list工具</li>
<li><code>#sets</code>：set工具</li>
<li><code>#maps</code>：map工具</li>
<li><code>#aggregates</code>：集合聚合工具(sum、avg)</li>
<li><code>#ids</code>：id生成工具<h3 id="语法示例"><a href="#语法示例" class="headerlink" title="语法示例"></a>语法示例</h3></li>
</ul>
<p><strong>表达式：</strong></p>
<ul>
<li>变量取值：<code>$&#123;...&#125;</code></li>
<li>url取值：<code>@&#123;...&#125;</code></li>
<li>国际化消息：<code>#&#123;...&#125;</code></li>
<li>变量选择：<code>*&#123;...&#125;</code></li>
<li>片段引用：<code>~&#123;...&#125;</code></li>
</ul>
<p><strong>常见：</strong></p>
<ul>
<li>文本</li>
<li>数字</li>
<li>布尔</li>
<li>null</li>
<li>变量名</li>
</ul>
<p><strong>文本操作：</strong></p>
<ul>
<li>拼串：<code>+</code></li>
<li>文本替换：<code>|The name is $&#123;name&#125;</code></li>
</ul>
<p><strong>布尔操作：</strong></p>
<ul>
<li>二进制运算：<code>and</code> <code>or</code></li>
<li>取反：<code>!</code> <code>not</code></li>
</ul>
<p><strong>比较运算：</strong></p>
<ul>
<li>比较：<code>&gt;</code> <code>&lt;</code> <code>&lt;=</code> <code>&gt;=</code> (<code>gt</code> <code>lt</code> <code>ge</code> <code>le</code>)</li>
<li>等值运算：<code>==</code> <code>!=</code> (<code>eq</code> <code>ne</code>)</li>
</ul>
<p><strong>条件运算：</strong></p>
<ul>
<li>if-then：<code>(if)?(then)</code></li>
<li>if-then-else：<code>(if)?(then):(else)</code></li>
<li>default：<code>(value)?:(defauleValue)</code></li>
</ul>
<p><strong>特殊语法：</strong></p>
<ul>
<li>无操作：<code>_</code></li>
</ul>
<p><strong>所有以上都可以嵌套组合：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;User is of type &#x27; + ($&#123;user.isAdmin()&#125; ? &#x27;Administrator&#x27; : ($&#123;user.type&#125; ?: &#x27;Unknown&#x27;))</span><br></pre></td></tr></table></figure>
<h2 id="属性设置"><a href="#属性设置" class="headerlink" title="属性设置"></a>属性设置</h2><ol>
<li><code>th:href=&quot;@&#123;/product/list&#125;&quot;</code></li>
<li><code>th:attr=&quot;class=$&#123;active&#125;&quot;</code></li>
<li><code>th:attr=&quot;src=@&#123;/images/gtvglogo.png&#125;,title=$&#123;logo&#125;,alt=#&#123;logo&#125;&quot;</code></li>
<li><code>th:checked=&quot;$&#123;user.active&#125;&quot;</code></li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;content&#125;&quot;</span>&gt;</span>原内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;../../images/gtvglogo.png&quot;</span> </span></span><br><span class="line"><span class="tag">     <span class="attr">th:attr</span>=<span class="string">&quot;src=@&#123;/images/gtvglogo.png&#125;,title=#&#123;logo&#125;,alt=#&#123;logo&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h2><blockquote>
<p>语法：<code>th:each=&quot;元素名,迭代状态 : $&#123;集合&#125;&quot;</code></p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;prod : $&#123;prods&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.name&#125;&quot;</span>&gt;</span>Onions<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.price&#125;&quot;</span>&gt;</span>2.41<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.inStock&#125;? #&#123;true&#125; : #&#123;false&#125;&quot;</span>&gt;</span>yes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;prod,iterStat : $&#123;prods&#125;&quot;</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;iterStat.odd&#125;? &#x27;odd&#x27;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.name&#125;&quot;</span>&gt;</span>Onions<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.price&#125;&quot;</span>&gt;</span>2.41<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.inStock&#125;? #&#123;true&#125; : #&#123;false&#125;&quot;</span>&gt;</span>yes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>iterStat 有以下属性：</p>
<ul>
<li><code>index</code>：当前遍历元素的索引，从0开始</li>
<li><code>count</code>：当前遍历元素的索引，从1开始</li>
<li><code>size</code>：需要遍历元素的总数量</li>
<li><code>current</code>：当前正在遍历的元素对象</li>
<li><code>even</code>/<code>odd</code>：是否偶数/奇数行</li>
<li><code>first</code>：是否第一个元素</li>
<li><code>last</code>：是否最后一个元素</li>
</ul>
<h2 id="判断"><a href="#判断" class="headerlink" title="判断"></a>判断</h2><h3 id="th-if"><a href="#th-if" class="headerlink" title="th:if"></a>th:if</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag">  <span class="attr">href</span>=<span class="string">&quot;comments.html&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/product/comments(prodId=$&#123;prod.id&#125;)&#125;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #lists.isEmpty(prod.comments)&#125;&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span>view<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="th-switch"><a href="#th-switch" class="headerlink" title="th:switch"></a>th:switch</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:switch</span>=<span class="string">&quot;$&#123;user.role&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;&#x27;admin&#x27;&quot;</span>&gt;</span>User is an administrator<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;#&#123;roles.manager&#125;&quot;</span>&gt;</span>User is a manager<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;*&quot;</span>&gt;</span>User is some other thing<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="属性优先级"><a href="#属性优先级" class="headerlink" title="属性优先级"></a>属性优先级</h2><ul>
<li>片段</li>
<li>遍历</li>
<li>判断<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">&quot;item : $&#123;items&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;item.description&#125;&quot;</span>&gt;</span>Item description here...<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<table>
<thead>
<tr>
<th>Order</th>
<th>Feature</th>
<th>Attributes</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>片段包含</td>
<td>th:insert th:replace</td>
</tr>
<tr>
<td>2</td>
<td>遍历</td>
<td>th:each</td>
</tr>
<tr>
<td>3</td>
<td>判断</td>
<td>th:if th:unless th:switch th:case</td>
</tr>
<tr>
<td>4</td>
<td>定义本地变量</td>
<td>th:object th:with</td>
</tr>
<tr>
<td>5</td>
<td>通用方式属性修改</td>
<td>th:attr th:attrprepend th:attrappend</td>
</tr>
<tr>
<td>6</td>
<td>指定属性修改</td>
<td>th:value th:href th:src …</td>
</tr>
<tr>
<td>7</td>
<td>文本值</td>
<td>th:text th:utext</td>
</tr>
<tr>
<td>8</td>
<td>片段指定</td>
<td>th:fragment</td>
</tr>
<tr>
<td>9</td>
<td>片段移除</td>
<td>th:remove</td>
</tr>
</tbody></table>
<h2 id="行内写法"><a href="#行内写法" class="headerlink" title="行内写法"></a>行内写法</h2><p><code>[[...]]</code> or <code>[(...)]</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello, [[$&#123;session.user.name&#125;]]!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="变量选择"><a href="#变量选择" class="headerlink" title="变量选择"></a>变量选择</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;session.user&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Name: <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;firstName&#125;&quot;</span>&gt;</span>Sebastian<span class="tag">&lt;/<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Surname: <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;lastName&#125;&quot;</span>&gt;</span>Pepper<span class="tag">&lt;/<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Nationality: <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;nationality&#125;&quot;</span>&gt;</span>Saturn<span class="tag">&lt;/<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>等同于</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Name: <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.user.firstName&#125;&quot;</span>&gt;</span>Sebastian<span class="tag">&lt;/<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Surname: <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.user.lastName&#125;&quot;</span>&gt;</span>Pepper<span class="tag">&lt;/<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Nationality: <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.user.nationality&#125;&quot;</span>&gt;</span>Saturn<span class="tag">&lt;/<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&lt;/div</span><br></pre></td></tr></table></figure>

<h2 id="模板布局"><a href="#模板布局" class="headerlink" title="模板布局"></a>模板布局</h2><ul>
<li>定义模板： <code>th:fragment</code></li>
<li>引用模板：<code>~&#123;templatename::selector&#125;</code></li>
<li>插入模板：<code>th:insert</code>、<code>th:replace</code><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">th:fragment</span>=<span class="string">&quot;copy&quot;</span>&gt;</span><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">&quot;~&#123;footer :: copy&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">&quot;~&#123;footer :: copy&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  结果：</span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">footer</span>&gt;</span><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="国际化"><a href="#国际化" class="headerlink" title="国际化"></a>国际化</h1><p>国际化的自动配置参照<code>MessageSourceAutoConfiguration</code></p>
<p><strong>实现步骤</strong>：</p>
<ol>
<li>Spring Boot 在类路径根下查找messages资源绑定文件。文件名为：messages.properties</li>
<li>多语言可以定义多个消息文件，命名为<code>messages_区域代码.properties</code>。如：<ul>
<li><code>messages.properties</code>：默认</li>
<li><code>messages_zh_CN.properties</code>：中文环境</li>
<li><code>messages_en_US.properties</code>：英语环境</li>
</ul>
</li>
<li>在<strong>程序中</strong>可以自动注入 <code>MessageSource</code>组件，获取国际化的配置项值</li>
<li>在<strong>页面中</strong>可以使用表达式 <code>#&#123;&#125;</code>获取国际化的配置项值<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Autowired  //国际化取消息用的组件</span><br><span class="line">MessageSource messageSource;</span><br><span class="line">@GetMapping(&quot;/haha&quot;)</span><br><span class="line">public String haha(HttpServletRequest request)&#123;</span><br><span class="line"></span><br><span class="line">    Locale locale = request.getLocale();</span><br><span class="line">    //利用代码的方式获取国际化配置文件中指定的配置项的值</span><br><span class="line">    String login = messageSource.getMessage(&quot;login&quot;, null, locale);</span><br><span class="line">    return login;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h1><h2 id="默认机制"><a href="#默认机制" class="headerlink" title="默认机制"></a>默认机制</h2><blockquote>
<p>错误处理的自动偶配置都在<code>ErrorMvcAutoConfiguration</code>中，两大核心机制：</p>
<ul>
<li>SpringBoot会<font color="#c0504d">自适应</font>处理错误，<font color="#c0504d">响应页面</font>或<font color="#c0504d">JSON数据</font></li>
<li>SpringMVC的错误处理机制依然保留，MC处理不了，才会交给boot进行处理</li>
</ul>
</blockquote>
<p><img src="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-Web%E5%BC%80%E5%8F%91/springboot%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6%E5%9B%BE%E7%A4%BA.png" alt="springboot错误处理机制图示"></p>
<ul>
<li>发生错误以后，转发给<code>/error</code>路径，SpringBoot在底层写好了一个<code>BasicErrorController</code>的组件，专门处理这个请求</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回html</span></span><br><span class="line"><span class="meta">@RequestMapping(produces = MediaType.TEXT_HTML_VALUE)</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">errorHtml</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;  </span><br><span class="line">    HttpStatus status = getStatus(request);  </span><br><span class="line">    Map&lt;String, Object&gt; model = Collections  </span><br><span class="line">       .unmodifiableMap(getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.TEXT_HTML)));  </span><br><span class="line">    response.setStatus(status.value());  </span><br><span class="line">    ModelAndView modelAndView = resolveErrorView(request, response, status, model);  </span><br><span class="line">    <span class="keyword">return</span> (modelAndView != <span class="keyword">null</span>) ? modelAndView : <span class="keyword">new</span> ModelAndView(<span class="string">&quot;error&quot;</span>, model);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">//返回ResponseEntity，JSON</span></span><br><span class="line"><span class="meta">@RequestMapping</span>  </span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123;  </span><br><span class="line">    HttpStatus status = getStatus(request);  </span><br><span class="line">    <span class="keyword">if</span> (status == HttpStatus.NO_CONTENT) &#123;  </span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(status);  </span><br><span class="line">    &#125;  </span><br><span class="line">    Map&lt;String, Object&gt; body = getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.ALL));  </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(body, status);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>错误页面是怎么解析到的<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1、解析错误的自定义视图地址</span></span><br><span class="line">ModelAndView modelAndView = resolveErrorView(request, response, status, model);  </span><br><span class="line"><span class="comment">//2、如果解析不到错误页面的地址，默认的错误页面就是error</span></span><br><span class="line"><span class="keyword">return</span> (modelAndView != <span class="keyword">null</span>) ? modelAndView : <span class="keyword">new</span> ModelAndView(<span class="string">&quot;error&quot;</span>, model);  </span><br></pre></td></tr></table></figure></li>
</ul>
<p>容器中专门有一个错误视图解析器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>  </span><br><span class="line"><span class="meta">@ConditionalOnBean(DispatcherServlet.class)</span>  </span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(ErrorViewResolver.class)</span>  </span><br><span class="line"><span class="function">DefaultErrorViewResolver <span class="title">conventionErrorViewResolver</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DefaultErrorViewResolver(<span class="keyword">this</span>.applicationContext, <span class="keyword">this</span>.resources);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SpringBoot解析自定义错误页面的默认规则</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveErrorView</span><span class="params">(HttpServletRequest request, HttpStatus status, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//根据精确状态码查找</span></span><br><span class="line">    ModelAndView modelAndView = resolve(String.valueOf(status.value()), model);  </span><br><span class="line">    <span class="comment">//如果精确状态码找不到，就会尝试以非精确状态码找 4xx 5xx</span></span><br><span class="line">    <span class="keyword">if</span> (modelAndView == <span class="keyword">null</span> &amp;&amp; SERIES_VIEWS.containsKey(status.series())) &#123;  </span><br><span class="line">       modelAndView = resolve(SERIES_VIEWS.get(status.series()), model);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> modelAndView;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">private</span> ModelAndView <span class="title">resolve</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> </span>&#123;  </span><br><span class="line">	<span class="comment">//把状态码作为视图名称(状态码可能是精确或者不精确，先根据精确状态码找，找不到会根据非精确状态码找)，去模板目录下找 classpah:templates/error/404.html</span></span><br><span class="line">    String errorViewName = <span class="string">&quot;error/&quot;</span> + viewName;  </span><br><span class="line">    TemplateAvailabilityProvider provider = <span class="keyword">this</span>.templateAvailabilityProviders.getProvider(errorViewName,  </span><br><span class="line">          <span class="keyword">this</span>.applicationContext);  </span><br><span class="line">    <span class="keyword">if</span> (provider != <span class="keyword">null</span>) &#123;  </span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(errorViewName, model);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">//如果没有找到就尝试去静态文件目录下寻找</span></span><br><span class="line">    <span class="comment">//&quot;classpath:/META-INF/resources/&quot;, &quot;classpath:/resources/&quot;, &quot;classpath:/static/&quot;, &quot;classpath:/public/&quot;</span></span><br><span class="line">    <span class="keyword">return</span> resolveResource(errorViewName, model);  </span><br><span class="line">&#125;  </span><br><span class="line">  <span class="comment">//在静态文件目录下找</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> ModelAndView <span class="title">resolveResource</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">for</span> (String location : <span class="keyword">this</span>.resources.getStaticLocations()) &#123;  </span><br><span class="line">       <span class="keyword">try</span> &#123;  </span><br><span class="line">          Resource resource = <span class="keyword">this</span>.applicationContext.getResource(location);  </span><br><span class="line">          resource = resource.createRelative(viewName + <span class="string">&quot;.html&quot;</span>);  </span><br><span class="line">          <span class="keyword">if</span> (resource.exists()) &#123;  </span><br><span class="line">             <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="keyword">new</span> HtmlResourceView(resource), model);  </span><br><span class="line">          &#125;  </span><br><span class="line">       &#125;  </span><br><span class="line">       <span class="keyword">catch</span> (Exception ex) &#123;  </span><br><span class="line">       &#125;    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>容器中有一个默认的名字为<code>error</code>的view；提供了默认的白页功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line"><span class="meta">@Bean(name = &quot;error&quot;)</span>  </span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(name = &quot;error&quot;)</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">defaultErrorView</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.defaultErrorView;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>封装了JSON格式的错误信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>  </span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(value = ErrorAttributes.class, search = SearchStrategy.CURRENT)</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> DefaultErrorAttributes <span class="title">errorAttributes</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DefaultErrorAttributes();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>规则</strong></p>
<ul>
<li>解析一个错误页<ul>
<li>如果发生了500、404、503、403这些错误<ul>
<li>如果有模板引擎，默认在<code>classpath:/templates/error/精确码.html</code></li>
<li>如果没有模板引擎，或者没有找到，就去静态资源文件夹下找，<code>精确码.html</code></li>
</ul>
</li>
<li>如果匹配不到<code>精确码.html</code>这些精确的错误页，就去找<code>5xx.html</code> <code>4xx.html</code>模糊匹配<ul>
<li>如果有模板引擎默认在<code>classpath:/templates/error/5xx.html</code></li>
<li>如果没有模板引擎或者没找到，在静态资源文件夹下找<code>5xx.html</code></li>
</ul>
</li>
</ul>
</li>
<li>如果模板引擎路径<code>templates</code>有<code>error.html</code>页面就直接渲染</li>
</ul>
<h2 id="自定义错误响应"><a href="#自定义错误响应" class="headerlink" title="自定义错误响应"></a>自定义错误响应</h2><h3 id="自定义json响应"><a href="#自定义json响应" class="headerlink" title="自定义json响应"></a>自定义json响应</h3><blockquote>
<p>使用<code>@ControllerAdvice</code>或<code>@ControllerAdvice</code> 配合<code>@ExceptionHandler</code>进行统一异常处理</p>
</blockquote>
<h3 id="自定义页面响应"><a href="#自定义页面响应" class="headerlink" title="自定义页面响应"></a>自定义页面响应</h3><blockquote>
<p>根据boot的错误页面规则，自定义页面模板</p>
</blockquote>
<h2 id="最佳实战"><a href="#最佳实战" class="headerlink" title="最佳实战"></a>最佳实战</h2><ul>
<li>前后端分离<ul>
<li>后端发生的所有错误，<code>@ControllerAdvice</code>+<code>@ExceptionHandler</code>进行统一异常处理</li>
</ul>
</li>
<li>服务端页面渲染<ul>
<li>不可预知的一些，HTTP码表示的服务器或客户端错误<ul>
<li>给<code>classpath:/templates/error/</code>下面，放常用精确的错误码页面。<code>500.html</code> <code>404.html</code></li>
<li>给<code>classpath:/templates/error/</code>下面，放模糊匹配的错误码页面。<code>5xx.html</code> <code>4xx.html</code></li>
</ul>
</li>
<li>发生业务错误<ul>
<li><strong>核心业务</strong>，每一种错误，都应该代码控制，跳转到自己定制的错误页</li>
<li><strong>通用业务</strong>，<code>classpath:/templates/error.html</code>页面，显示错误信息<br>页面、JSON，可用的Model数据如下<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(WebRequest webRequest, ErrorAttributeOptions options)</span> </span>&#123;  </span><br><span class="line">    Map&lt;String, Object&gt; errorAttributes = getErrorAttributes(webRequest, options.isIncluded(Include.STACK_TRACE));  </span><br><span class="line">    <span class="keyword">if</span> (!options.isIncluded(Include.EXCEPTION)) &#123;  </span><br><span class="line">       errorAttributes.remove(<span class="string">&quot;exception&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">if</span> (!options.isIncluded(Include.STACK_TRACE)) &#123;  </span><br><span class="line">       errorAttributes.remove(<span class="string">&quot;trace&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">if</span> (!options.isIncluded(Include.MESSAGE) &amp;&amp; errorAttributes.get(<span class="string">&quot;message&quot;</span>) != <span class="keyword">null</span>) &#123;  </span><br><span class="line">       errorAttributes.remove(<span class="string">&quot;message&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">if</span> (!options.isIncluded(Include.BINDING_ERRORS)) &#123;  </span><br><span class="line">       errorAttributes.remove(<span class="string">&quot;errors&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> errorAttributes;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="嵌入式容器"><a href="#嵌入式容器" class="headerlink" title="嵌入式容器"></a>嵌入式容器</h1><blockquote>
<p><strong>Servlet容器</strong>：管理、运行Servlet组件（Servlet、Filter、listener）的环境，一般指服务器</p>
</blockquote>
<h2 id="自动配置原理"><a href="#自动配置原理" class="headerlink" title="自动配置原理"></a>自动配置原理</h2><blockquote>
<ul>
<li>SpringBoot默认嵌入Tomcat作为Servlet容器</li>
<li>自动配置类是<code>ServletWebServerFactoryAutoConfiguration</code>，<code>EmbeddedWebServerFactoryCustomizerAutoConfiguration</code></li>
<li>自动配置类开始分析功能，<code>xxxxAutoConfiguration</code></li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration(after = SslAutoConfiguration.class)</span>  </span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)</span>  </span><br><span class="line"><span class="meta">@ConditionalOnClass(ServletRequest.class)</span>  </span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span>  </span><br><span class="line"><span class="meta">@EnableConfigurationProperties(ServerProperties.class)</span>  </span><br><span class="line"><span class="meta">@Import(&#123; ServletWebServerFactoryAutoConfiguration.BeanPostProcessorsRegistrar.class,  </span></span><br><span class="line"><span class="meta">       ServletWebServerFactoryConfiguration.EmbeddedTomcat.class,  </span></span><br><span class="line"><span class="meta">       ServletWebServerFactoryConfiguration.EmbeddedJetty.class,  </span></span><br><span class="line"><span class="meta">       ServletWebServerFactoryConfiguration.EmbeddedUndertow.class &#125;)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServletWebServerFactoryAutoConfiguration</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><code>ServletWebServerFactoryAutoConfiguration</code>自动配置了嵌入式容器场景</li>
<li>绑定了<code>ServerProperties</code>配置类，所有和服务器有关的配置<code>server</code></li>
<li></li>
</ol>
<h2 id="自定义"><a href="#自定义" class="headerlink" title="自定义"></a>自定义</h2><h2 id="最佳实战-1"><a href="#最佳实战-1" class="headerlink" title="最佳实战"></a>最佳实战</h2><h1 id="全面接管SpringMVC"><a href="#全面接管SpringMVC" class="headerlink" title="全面接管SpringMVC"></a>全面接管SpringMVC</h1><h2 id="WebMvcAutoConfiguration到底自动配置了哪些规则"><a href="#WebMvcAutoConfiguration到底自动配置了哪些规则" class="headerlink" title="WebMvcAutoConfiguration到底自动配置了哪些规则"></a>WebMvcAutoConfiguration到底自动配置了哪些规则</h2><h2 id="WebMvcConfigurer-功能"><a href="#WebMvcConfigurer-功能" class="headerlink" title="WebMvcConfigurer 功能"></a>WebMvcConfigurer 功能</h2><h1 id="最佳实战-2"><a href="#最佳实战-2" class="headerlink" title="最佳实战"></a>最佳实战</h1><h2 id="三种方式"><a href="#三种方式" class="headerlink" title="三种方式"></a>三种方式</h2><table>
<thead>
<tr>
<th align="center">方式</th>
<th align="center">用法</th>
<th align="center"></th>
<th align="center">效果</th>
</tr>
</thead>
<tbody><tr>
<td align="center">全自动</td>
<td align="center">直接编写控制器逻辑</td>
<td align="center"></td>
<td align="center">全部使用自动配置默认效果</td>
</tr>
<tr>
<td align="center"><font color="#c00000">手自一体</font></td>
<td align="center"><code>@Configuration</code> +<br>配置<code>WebMvcConfigurer</code>+ <br> 配置 WebMvcRegistrations</td>
<td align="center"><strong>不要标注</strong><code>@EnableWebMvc</code></td>
<td align="center"><strong>保留自动配置效果</strong><br><strong>手动设置部分功能</strong><br>定义MVC底层组件</td>
</tr>
<tr>
<td align="center"><strong>全手动</strong></td>
<td align="center"><code>@Configuration</code> +<br>配置<code>WebMvcConfigurer</code></td>
<td align="center"><strong>标注</strong><code>@EnableWebMvc</code></td>
<td align="center">禁用自动配置效果<br>全手动设置</td>
</tr>
</tbody></table>
<p>总结：<br>给容器中写一个配置类<code>@Configuration</code>实现<code>WebMvcConfigurer</code>接口，但是不要标注<code>@EnableWebMvc</code>注解，实现手自一体的效果。</p>
<h2 id="两种模式"><a href="#两种模式" class="headerlink" title="两种模式"></a>两种模式</h2><ul>
<li>前后端分离模式：<code>@RestController1</code>响应JSON数据</li>
<li>前后不分离模式：<code>@Controller</code>+<code>Thymeleaf</code>模板引擎</li>
</ul>
<h1 id="Web新特性"><a href="#Web新特性" class="headerlink" title="Web新特性"></a>Web新特性</h1><h2 id="Problemdetails"><a href="#Problemdetails" class="headerlink" title="Problemdetails"></a>Problemdetails</h2><blockquote>
<p>RFC 7807 ：<a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc7807">RFC 7807: Problem Details for HTTP APIs (rfc-editor.org)</a><br>错误信息返回新格式</p>
</blockquote>
<p>原理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span>  </span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc.problemdetails&quot;, name = &quot;enabled&quot;, havingValue = &quot;true&quot;)</span>  </span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ProblemDetailsErrorHandlingConfiguration</span> </span>&#123;  </span><br><span class="line">    <span class="meta">@Bean</span>  </span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(ResponseEntityExceptionHandler.class)</span>  </span><br><span class="line">    <span class="meta">@Order(0)</span>  </span><br><span class="line">    <span class="function">ProblemDetailsExceptionHandler <span class="title">problemDetailsExceptionHandler</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> ProblemDetailsExceptionHandler();  </span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><code>ProblemDetailsExceptionHandler</code>是一个<code>@ControllerAdvice</code>集中处理系统异常</li>
<li>处理以下异常，如果系统出现以下异常，会被SpringBoot支持以<code>RFC 7807</code>规范方式反水错误数据<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(&#123;  </span></span><br><span class="line"><span class="meta">       HttpRequestMethodNotSupportedException.class,//请求方式不支持  </span></span><br><span class="line"><span class="meta">       HttpMediaTypeNotSupportedException.class,  </span></span><br><span class="line"><span class="meta">       HttpMediaTypeNotAcceptableException.class,  </span></span><br><span class="line"><span class="meta">       MissingPathVariableException.class,  </span></span><br><span class="line"><span class="meta">       MissingServletRequestParameterException.class,  </span></span><br><span class="line"><span class="meta">       MissingServletRequestPartException.class,  </span></span><br><span class="line"><span class="meta">       ServletRequestBindingException.class,  </span></span><br><span class="line"><span class="meta">       MethodArgumentNotValidException.class,  </span></span><br><span class="line"><span class="meta">       HandlerMethodValidationException.class,  </span></span><br><span class="line"><span class="meta">       NoHandlerFoundException.class,  </span></span><br><span class="line"><span class="meta">       NoResourceFoundException.class,  </span></span><br><span class="line"><span class="meta">       AsyncRequestTimeoutException.class,  </span></span><br><span class="line"><span class="meta">       ErrorResponseException.class,  </span></span><br><span class="line"><span class="meta">       MaxUploadSizeExceededException.class,  </span></span><br><span class="line"><span class="meta">       ConversionNotSupportedException.class,  </span></span><br><span class="line"><span class="meta">       TypeMismatchException.class,  </span></span><br><span class="line"><span class="meta">       HttpMessageNotReadableException.class,  </span></span><br><span class="line"><span class="meta">       HttpMessageNotWritableException.class,  </span></span><br><span class="line"><span class="meta">       MethodValidationException.class,  </span></span><br><span class="line"><span class="meta">       BindException.class  </span></span><br><span class="line"><span class="meta">    &#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>默认响应错误的json，状态码405</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;timestamp&quot;</span>: <span class="string">&quot;2023-04-18T11:13:05.515+00:00&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;status&quot;</span>: <span class="number">405</span>,</span><br><span class="line">    <span class="attr">&quot;error&quot;</span>: <span class="string">&quot;Method Not Allowed&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;trace&quot;</span>: <span class="string">&quot;org.springframework.web.HttpRequestMethodNotSupportedException: Request method &#x27;POST&#x27; is not supported\r\n\tat org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping.handleNoMatch(RequestMappingInfoHandlerMapping.java:265)\r\n\tat org.springframework.web.servlet.handler.AbstractHandlerMethodMapping.lookupHandlerMethod(AbstractHandlerMethodMapping.java:441)\r\n\tat org.springframework.web.servlet.handler.AbstractHandlerMethodMapping.getHandlerInternal(AbstractHandlerMethodMapping.java:382)\r\n\tat org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping.getHandlerInternal(RequestMappingInfoHandlerMapping.java:126)\r\n\tat org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping.getHandlerInternal(RequestMappingInfoHandlerMapping.java:68)\r\n\tat org.springframework.web.servlet.handler.AbstractHandlerMapping.getHandler(AbstractHandlerMapping.java:505)\r\n\tat org.springframework.web.servlet.DispatcherServlet.getHandler(DispatcherServlet.java:1275)\r\n\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1057)\r\n\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:974)\r\n\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1011)\r\n\tat org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)\r\n\tat jakarta.servlet.http.HttpServlet.service(HttpServlet.java:563)\r\n\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)\r\n\tat jakarta.servlet.http.HttpServlet.service(HttpServlet.java:631)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\r\n\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\r\n\tat org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\r\n\tat org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\r\n\tat org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\r\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:166)\r\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)\r\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:493)\r\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)\r\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)\r\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\r\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:341)\r\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:390)\r\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)\r\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:894)\r\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)\r\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)\r\n\tat org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)\r\n\tat org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)\r\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\r\n\tat java.base/java.lang.Thread.run(Thread.java:833)\r\n&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;Method &#x27;POST&#x27; is not supported.&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/list&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>开启ProblemDetails返回，使用新的MediaType<br><code>Content-type: application/problem+json</code>+额外扩展返回</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;about:blank&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Method Not Allowed&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;status&quot;</span>: <span class="number">405</span>,</span><br><span class="line">    <span class="attr">&quot;detail&quot;</span>: <span class="string">&quot;Method &#x27;POST&#x27; is not supported.&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;instance&quot;</span>: <span class="string">&quot;/list&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="函数式web"><a href="#函数式web" class="headerlink" title="函数式web"></a>函数式web</h2><blockquote>
<p><code>SpringMVC 5.2</code>以后允许我们使用函数式的方式，定义web的请求处理流程。<br>函数式接口<br>web请求处理的方式：</p>
<ol>
<li><code>@Controller</code>+<code>@RequestMapping</code>：耦合式（路由、业务耦合）</li>
<li>函数式web：分离式（路由、业务分离）</li>
</ol>
</blockquote>
<h3 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h3><p>场景：User RESTful - CRUD</p>
<ul>
<li>GET /user/1 获取1号用户</li>
<li>GET /users 获取所有用户</li>
<li>POST /user <strong>请求体</strong>携带JSON，新增一个用户</li>
<li>PUT /user/1 <strong>请求体</strong>携带JSON，修改1号用户</li>
<li>DELETE /user/1 <strong>删除</strong>1号用户</li>
</ul>
<h3 id="核心类"><a href="#核心类" class="headerlink" title="核心类"></a>核心类</h3><ul>
<li><strong>RouterFunction</strong>：定义路由信息。发什么请求，谁来处理 </li>
<li><strong>RequestPredicate</strong>：定义请求规则：请求谓语。请求方式（GET、POST）、请求参数  </li>
<li><strong>ServerRequest</strong>：封装请求完整数据  </li>
<li><strong>ServerResponse</strong>： 封装响应完整数据  </li>
</ul>
<p>函数式Web：<br> 1、给容器中放一个Bean：类型是 RouterFunction&lt;ServerResponse&gt;，集中所有路由信息<br> 2、每个业务准备一个自己的Handler  </p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.function.RequestPredicate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.function.RouterFunction;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.function.ServerResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.web.servlet.function.RequestPredicates.accept;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.web.servlet.function.RouterFunctions.route;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRoutingConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> RequestPredicate ACCEPT_JSON = accept(MediaType.APPLICATION_JSON);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="title">routerFunction</span><span class="params">(MyUserHandler userHandler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> route()</span><br><span class="line">                .GET(<span class="string">&quot;/&#123;user&#125;&quot;</span>, ACCEPT_JSON, userHandler::getUser)</span><br><span class="line">                .GET(<span class="string">&quot;/&#123;user&#125;/customers&quot;</span>, ACCEPT_JSON, userHandler::getUserCustomers)</span><br><span class="line">                .DELETE(<span class="string">&quot;/&#123;user&#125;&quot;</span>, ACCEPT_JSON, userHandler::deleteUser)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.function.ServerRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.function.ServerResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyUserHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServerResponse <span class="title">getUser</span><span class="params">(ServerRequest request)</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.ok().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServerResponse <span class="title">getUserCustomers</span><span class="params">(ServerRequest request)</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.ok().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServerResponse <span class="title">deleteUser</span><span class="params">(ServerRequest request)</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.ok().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/springboot3/" rel="tag"># springboot3</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" rel="prev" title="尚硅谷springboot3核心特性-快速入门(一)">
                  <i class="fa fa-angle-left"></i> 尚硅谷springboot3核心特性-快速入门(一)
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/12/19/spring/%E5%B0%9A%E7%A1%85%E8%B0%B7springboot3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/" rel="next" title="尚硅谷springboot3核心特性-数据访问(三)">
                  尚硅谷springboot3核心特性-数据访问(三) <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
<hr>
<div id="comment-container"></div>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script>
    new Valine({
        el: '#comment-container',
        appId: 'SsNHix8sOQXkmksOkIvo0jkf-gzGzoHsz',
        appKey: 'BCtPpmnU41TOE7Wr5O0CJFgS'
    })
</script>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">YS</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">787k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">23:52</span>
  </span>
</div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.2/anime.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.umd.js" integrity="sha256-ytMJGN3toR+a84u7g7NuHm91VIR06Q41kMWDr2pq7Zo=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>



  





</body>
</html>
