<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/ys_ico.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/ys_ico.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ysymj.gitee.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="黑马JVM课程学习笔记，http:&#x2F;&#x2F;yun.itheima.com&#x2F;course&#x2F;584.html，本章节主要是学习JVM虚拟机class字节码以及类加载相关内容">
<meta property="og:type" content="article">
<meta property="og:title" content="黑马JVM课程——类加载（三）">
<meta property="og:url" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/index.html">
<meta property="og:site_name" content="YS">
<meta property="og:description" content="黑马JVM课程学习笔记，http:&#x2F;&#x2F;yun.itheima.com&#x2F;course&#x2F;584.html，本章节主要是学习JVM虚拟机class字节码以及类加载相关内容">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/%E6%96%B9%E6%B3%95%E5%8C%BA%E5%AD%97%E8%8A%82%E7%A0%81%E8%BD%BD%E5%85%A5%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/%E4%B8%BB%E7%BA%BF%E7%A8%8B%E5%88%86%E9%85%8D%E6%A0%88%E5%B8%A7%E5%86%85%E5%AD%98%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA1.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA2.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA3.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA4.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA5.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA6.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA7.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA8.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA9.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA10.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA11.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA12.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA13.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA14.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA15.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA16.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA17.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA18.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/%E5%88%86%E6%9E%90%E5%9B%BE%E7%A4%BA1.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/%E5%88%86%E6%9E%90%E5%9B%BE%E7%A4%BA2.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/%E5%88%86%E6%9E%90%E5%9B%BE%E7%A4%BA3.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/%E5%88%86%E6%9E%90%E5%9B%BE%E7%A4%BA4.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/%E5%88%86%E6%9E%90%E5%9B%BE%E7%A4%BA5.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/%E5%88%86%E6%9E%90%E5%9B%BE%E7%A4%BA6.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220826210747224.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220826211136301.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220826211226285.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220826211519082.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220826211549138.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220827200010149.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220827201110213.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220827201623999.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220827202159236.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220827220420879.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220827220754264.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220827221154955.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220828193546824.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220829210956575.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220830211359736.png">
<meta property="og:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220902062543333.png">
<meta property="article:published_time" content="2022-08-20T07:07:13.000Z">
<meta property="article:modified_time" content="2023-04-08T05:42:50.251Z">
<meta property="article:author" content="YS">
<meta property="article:tag" content="黑马JVM课程">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0%E5%9B%BE%E7%A4%BA.png">

<link rel="canonical" href="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>黑马JVM课程——类加载（三） | YS</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">YS</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">学无止境</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://ysymj.gitee.io/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.png">
      <meta itemprop="name" content="YS">
      <meta itemprop="description" content="学海无涯苦作舟">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          黑马JVM课程——类加载（三）
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-08-20 15:07:13" itemprop="dateCreated datePublished" datetime="2022-08-20T15:07:13+08:00">2022-08-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-08 13:42:50" itemprop="dateModified" datetime="2023-04-08T13:42:50+08:00">2023-04-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JVM/" itemprop="url" rel="index"><span itemprop="name">JVM</span></a>
                </span>
            </span>

          
            <span id="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/" class="post-meta-item leancloud_visitors" data-flag-title="黑马JVM课程——类加载（三）" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="类文件结构"><a href="#类文件结构" class="headerlink" title="类文件结构"></a>类文件结构</h1><p>参考文档：<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html">Chapter 4. The class File Format (oracle.com)</a></p>
<p>以一个简单的 HelloWorld..java 为例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;hello world&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>执行 <code>javac -parameters -d . HelloWorld.java</code> 编译<ul>
<li>使用 <code>-parameters</code> 参数，可以在编译只保留方法参数的名称信息</li>
</ul>
</li>
</ul>
<ul>
<li><p>编译之后的class文件以16进制打开如下所示： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# od -t xC HelloWorld.class</span><br><span class="line">0000000 ca fe ba be 00 00 00 34 00 1f 0a 00 06 00 11 09</span><br><span class="line">0000020 00 12 00 13 08 00 14 0a 00 15 00 16 07 00 17 07</span><br><span class="line">0000040 00 18 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29</span><br><span class="line">0000060 56 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e</span><br><span class="line">0000100 75 6d 62 65 72 54 61 62 6c 65 01 00 04 6d 61 69</span><br><span class="line">0000120 6e 01 00 16 28 5b 4c 6a 61 76 61 2f 6c 61 6e 67</span><br><span class="line">0000140 2f 53 74 72 69 6e 67 3b 29 56 01 00 10 4d 65 74</span><br><span class="line">0000160 68 6f 64 50 61 72 61 6d 65 74 65 72 73 01 00 04</span><br><span class="line">0000200 61 72 67 73 01 00 0a 53 6f 75 72 63 65 46 69 6c</span><br><span class="line">0000220 65 01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 64 2e 6a</span><br><span class="line">0000240 61 76 61 0c 00 07 00 08 07 00 19 0c 00 1a 00 1b</span><br><span class="line">0000260 01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64 07 00</span><br><span class="line">0000300 1c 0c 00 1d 00 1e 01 00 21 63 6f 6d 2f 65 78 61</span><br><span class="line">0000320 6d 70 6c 65 2f 64 65 6d 6f 31 2f 74 65 73 74 2f</span><br><span class="line">0000340 48 65 6c 6c 6f 57 6f 72 6c 64 01 00 10 6a 61 76</span><br><span class="line">0000360 61 2f 6c 61 6e 67 2f 4f 62 6a 65 63 74 01 00 10</span><br><span class="line">0000400 6a 61 76 61 2f 6c 61 6e 67 2f 53 79 73 74 65 6d</span><br><span class="line">0000420 01 00 03 6f 75 74 01 00 15 4c 6a 61 76 61 2f 69</span><br><span class="line">0000440 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d 3b 01 00</span><br><span class="line">0000460 13 6a 61 76 61 2f 69 6f 2f 50 72 69 6e 74 53 74</span><br><span class="line">0000500 72 65 61 6d 01 00 07 70 72 69 6e 74 6c 6e 01 00</span><br><span class="line">0000520 15 28 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72</span><br><span class="line">0000540 69 6e 67 3b 29 56 00 21 00 05 00 06 00 00 00 00</span><br><span class="line">0000560 00 02 00 01 00 07 00 08 00 01 00 09 00 00 00 1d</span><br><span class="line">0000600 00 01 00 01 00 00 00 05 2a b7 00 01 b1 00 00 00</span><br><span class="line">0000620 01 00 0a 00 00 00 06 00 01 00 00 00 07 00 09 00</span><br><span class="line">0000640 0b 00 0c 00 02 00 09 00 00 00 25 00 02 00 01 00</span><br><span class="line">0000660 00 00 09 b2 00 02 12 03 b6 00 04 b1 00 00 00 01</span><br><span class="line">0000700 00 0a 00 00 00 0a 00 02 00 00 00 09 00 08 00 0a</span><br><span class="line">0000720 00 0d 00 00 00 05 01 00 0e 00 00 00 01 00 0f 00</span><br><span class="line">0000740 00 00 02 00 10</span><br><span class="line">0000745</span><br></pre></td></tr></table></figure></li>
<li><p>使用<code>javap -v HelloWorld.class</code>命令反编译后如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">Classfile /E:/project/java/demo2/src/main/java/com/example/demo1/test/com/example/demo1/test/HelloWorld.class</span><br><span class="line">  Last modified <span class="number">2022</span>-<span class="number">8</span>-<span class="number">20</span>; size <span class="number">485</span> bytes</span><br><span class="line">  MD5 checksum fceb30d0e6ac220c6aad48757e3affde</span><br><span class="line">  Compiled from <span class="string">&quot;HelloWorld.java&quot;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">com</span>.<span class="title">example</span>.<span class="title">demo1</span>.<span class="title">test</span>.<span class="title">HelloWorld</span></span></span><br><span class="line"><span class="class">  <span class="title">minor</span> <span class="title">version</span>: 0</span></span><br><span class="line"><span class="class">  <span class="title">major</span> <span class="title">version</span>: 52</span></span><br><span class="line"><span class="class">  <span class="title">flags</span>: <span class="title">ACC_PUBLIC</span>, <span class="title">ACC_SUPER</span></span></span><br><span class="line"><span class="class"><span class="title">Constant</span> <span class="title">pool</span>:</span></span><br><span class="line"><span class="class">   #1 </span>= Methodref          #<span class="number">6.</span>#<span class="number">17</span>         <span class="comment">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">   #<span class="number">2</span> = Fieldref           #<span class="number">18.</span>#<span class="number">19</span>        <span class="comment">// java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">   #<span class="number">3</span> = String             #<span class="number">20</span>            <span class="comment">// hello world</span></span><br><span class="line">   #<span class="number">4</span> = Methodref          #<span class="number">21.</span>#<span class="number">22</span>        <span class="comment">// java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">   #<span class="number">5</span> = Class              #<span class="number">23</span>            <span class="comment">// com/example/demo1/test/HelloWorld</span></span><br><span class="line">   #<span class="number">6</span> = Class              #<span class="number">24</span>            <span class="comment">// java/lang/Object</span></span><br><span class="line">   #<span class="number">7</span> = Utf8               &lt;init&gt;</span><br><span class="line">   #<span class="number">8</span> = Utf8               ()V</span><br><span class="line">   #<span class="number">9</span> = Utf8               Code</span><br><span class="line">  #<span class="number">10</span> = Utf8               LineNumberTable</span><br><span class="line">  #<span class="number">11</span> = Utf8               main</span><br><span class="line">  #<span class="number">12</span> = Utf8               ([Ljava/lang/String;)V</span><br><span class="line">  #<span class="number">13</span> = Utf8               MethodParameters</span><br><span class="line">  #<span class="number">14</span> = Utf8               args</span><br><span class="line">  #<span class="number">15</span> = Utf8               SourceFile</span><br><span class="line">  #<span class="number">16</span> = Utf8               HelloWorld.java</span><br><span class="line">  #<span class="number">17</span> = NameAndType        #<span class="number">7</span>:#<span class="number">8</span>          <span class="comment">// &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">  #<span class="number">18</span> = Class              #<span class="number">25</span>            <span class="comment">// java/lang/System</span></span><br><span class="line">  #<span class="number">19</span> = NameAndType        #<span class="number">26</span>:#<span class="number">27</span>        <span class="comment">// out:Ljava/io/PrintStream;</span></span><br><span class="line">  #<span class="number">20</span> = Utf8               hello world</span><br><span class="line">  #<span class="number">21</span> = Class              #<span class="number">28</span>            <span class="comment">// java/io/PrintStream</span></span><br><span class="line">  #<span class="number">22</span> = NameAndType        #<span class="number">29</span>:#<span class="number">30</span>        <span class="comment">// println:(Ljava/lang/String;)V</span></span><br><span class="line">  #<span class="number">23</span> = Utf8               com/example/demo1/test/HelloWorld</span><br><span class="line">  #<span class="number">24</span> = Utf8               java/lang/Object</span><br><span class="line">  #<span class="number">25</span> = Utf8               java/lang/System</span><br><span class="line">  #<span class="number">26</span> = Utf8               out</span><br><span class="line">  #<span class="number">27</span> = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #<span class="number">28</span> = Utf8               java/io/PrintStream</span><br><span class="line">  #<span class="number">29</span> = Utf8               println</span><br><span class="line">  #<span class="number">30</span> = Utf8               (Ljava/lang/String;)V</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> com.example.demo1.test.HelloWorld();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">7</span>: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[])</span></span>;</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: getstatic     #<span class="number">2</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">         <span class="number">3</span>: ldc           #<span class="number">3</span>                  <span class="comment">// String hello world</span></span><br><span class="line">         <span class="number">5</span>: invokevirtual #<span class="number">4</span>                  <span class="comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">         <span class="number">8</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">9</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">10</span>: <span class="number">8</span></span><br><span class="line">    MethodParameters:</span><br><span class="line">      Name                           Flags</span><br><span class="line">      args</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">&quot;HelloWorld.java&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>根据JVM规范，类文件结构如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ClassFile&#123;</span><br><span class="line">	u4               magic;<span class="comment">//魔数</span></span><br><span class="line">	u2               minor_version;<span class="comment">//小版本号</span></span><br><span class="line">	u2               major_version;<span class="comment">//注版本号</span></span><br><span class="line">	u2               constant_pool_count;<span class="comment">//常量池信息</span></span><br><span class="line">	cp_info          constant_pool[constant_pool_count-<span class="number">1</span>];<span class="comment">//常量池信息</span></span><br><span class="line">	u2               access_flags;<span class="comment">//访问修饰符</span></span><br><span class="line">	u2               this_class;<span class="comment">//当前类名信息</span></span><br><span class="line">	u2               super_class;<span class="comment">//父类信息</span></span><br><span class="line">	u2               interfaces_count;<span class="comment">//接口信息</span></span><br><span class="line">	u2               interfaces[interfaces_count];<span class="comment">//接口信息</span></span><br><span class="line">	u2               fields_count;<span class="comment">//类中成员变量信息</span></span><br><span class="line">	field_info       fields[fields_count];<span class="comment">//类中成员变量信息</span></span><br><span class="line">	u2               methods_count;<span class="comment">//类中方法信息</span></span><br><span class="line">	method_info      methods[methods_count];<span class="comment">//类中方法信息</span></span><br><span class="line">	u2               attributes_count;<span class="comment">//类中附加信息</span></span><br><span class="line">	attribute+info   attributes[attributes_count];<span class="comment">//类中附加信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="魔数"><a href="#魔数" class="headerlink" title="魔数"></a>魔数</h2><p>0-3字节，表示他是否是【class】类型的文件<br>0000000 <font color="red">ca fe ba be</font> 00 00 00 34 00 1f 0a 00 06 00 11 09</p>
<h2 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h2><p>4-7字节，表示类的版本，00 34（16进制，10进制为52，jdk8）表示jdk8<br>0-3字节，表示他是否是【class】类型的文件<br>0000000 ca fe ba be <font color="red">00 00 00 34</font> 00 1f 0a 00 06 00 11 09</p>
<h2 id="常量池"><a href="#常量池" class="headerlink" title="常量池"></a>常量池</h2><p><strong>常量池信息对照表</strong></p>
<table>
<thead>
<tr>
<th align="left">Content Type</th>
<th align="left">Value</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CONSTANT_Class</td>
<td align="left">7</td>
</tr>
<tr>
<td align="left">CONSTANT_Fielaref</td>
<td align="left">9</td>
</tr>
<tr>
<td align="left">CONSTANT_Methidref</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">CONSTANT_InterfaceMetodref</td>
<td align="left">11</td>
</tr>
<tr>
<td align="left">CONSTANT_String</td>
<td align="left">8</td>
</tr>
<tr>
<td align="left">CONSTANT_Integer</td>
<td align="left">3</td>
</tr>
<tr>
<td align="left">CONSTANT_Float</td>
<td align="left">4</td>
</tr>
<tr>
<td align="left">CONSTANT_Long</td>
<td align="left">5</td>
</tr>
<tr>
<td align="left">CONSTANT_Double</td>
<td align="left">6</td>
</tr>
<tr>
<td align="left">CONSTANT_NameAndType</td>
<td align="left">12</td>
</tr>
<tr>
<td align="left">CONSTANT_Utf8</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">CONSTANT_MethodHandle</td>
<td align="left">15</td>
</tr>
<tr>
<td align="left">CONSTANT_MethodType</td>
<td align="left">16</td>
</tr>
<tr>
<td align="left">CONSTANT_InvokeDynamic</td>
<td align="left">18</td>
</tr>
</tbody></table>
<h3 id="常量池长度"><a href="#常量池长度" class="headerlink" title="常量池长度"></a>常量池长度</h3><p>8~9字节，表示常量池的长度，00 1f（31）表示常量池有#1-#30项，注意，#0项不计入，也没有值<br>0000000 ca fe ba be 00 00 00 34 <font color="red">00 1f</font> 0a 00 06 00 11 09</p>
<h4 id="1"><a href="#1" class="headerlink" title="#1"></a>#1</h4><p>第#1项，0a（10）表示一个Method信息，00 06和 00 11（17） 表示它引用了常量池中#6和#17项来获得这个方法的【所属类】和【方法名】<br>0000000 ca fe ba be 00 00 00 34 00 1f <font color="red">0a 00 06 00 11</font> 09</p>
<h4 id="2"><a href="#2" class="headerlink" title="#2"></a>#2</h4><p>第#2项，09 表示一个Field信息，向后数4个字节，00 12（18）和 00 13（19） 表示它引用了常量池中#18和#19项来获得这个方法的【所属类】和【成员变量名】<br>0000000 ca fe ba be 00 00 00 34 00 1f 0a 00 06 00 11 <font color="red">09</font><br>0000020 <font color="red">00 12 00 13</font> 08 00 14 0a 00 15 00 16 07 00 17 07</p>
<h4 id="3"><a href="#3" class="headerlink" title="#3"></a>#3</h4><p>第#3项，08 表示一个字符串常量名称，向后数2个字节，00 14（20）， 表示它引用了常量池中#20项<br>0000020 00 12 00 13 <font color="red">08 00 14</font> 0a 00 15 00 16 07 00 17 07</p>
<h4 id="4"><a href="#4" class="headerlink" title="#4"></a>#4</h4><p>第#4项，0a（10）表示一个Method信息，00 15（21）和 00 16（22） 表示它引用了常量池中#21和#22项来获得这个方法的【所属类】和【方法名】<br>0000020 00 12 00 13 08 00 14 <font color="red">0a 00 15 00 16</font> 07 00 17 07</p>
<h4 id="5"><a href="#5" class="headerlink" title="#5"></a>#5</h4><p>第#5项，07 表示一个Class信息，00 17（23） 表示它引用了常量池中#23项<br>0000020 00 12 00 13 08 00 14 0a 00 15 00 16 <font color="red">07 00 17</font> 07</p>
<h4 id="6"><a href="#6" class="headerlink" title="#6"></a>#6</h4><p>第#6项，07 表示一个Class信息，00 18（24） 表示它引用了常量池中#24项<br>0000020 00 12 00 13 08 00 14 0a 00 15 00 16 07 00 17 <font color="red">07</font><br>0000040 <font color="red">00 18</font> 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29</p>
<h4 id="7"><a href="#7" class="headerlink" title="#7"></a>#7</h4><p>第#7项，01 表示一个UTF8串，00 06表示字符串的长度，【3c 69 6e 69 74 3e】=【&lt;init&gt;】<br>0000040 00 18 <font color="red">01 00 06 3c 69 6e 69 74 3e</font> 01 00 03 28 29</p>
<h4 id="8"><a href="#8" class="headerlink" title="#8"></a>#8</h4><p>第#8项，01 表示一个UTF8串，00 03表示字符串的长度，【28 29 56】=【()V】<br>0000040 00 18 01 00 06 3c 69 6e 69 74 3e <font color="red">01 00 03 28 29</font><br>0000060 <font color="red">56</font> 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e</p>
<h4 id="9"><a href="#9" class="headerlink" title="#9"></a>#9</h4><p>第#9项，01 表示一个UTF8串，00 04表示字符串的长度，【43 6f 64 65】=【Code】<br>0000060 56 <font color="red">01 00 04 43 6f 64 65</font> 01 00 0f 4c 69 6e 65 4e</p>
<h4 id="10"><a href="#10" class="headerlink" title="#10"></a>#10</h4><p>第#10项，01 表示一个UTF8串，00 0f（15）表示字符串的长度，【4c 69 6e 65 4e 75 6d 62 65 72 54 61 62 6c 65】=【LineNumberTable】<br>0000060 56 01 00 04 43 6f 64 65 <font color="red">01 00 0f 4c 69 6e 65 4e</font><br>0000100 <font color="red">75 6d 62 65 72 54 61 62 6c 65</font> 01 00 04 6d 61 69</p>
<h4 id="11"><a href="#11" class="headerlink" title="#11"></a>#11</h4><p>第#11项，01 表示一个UTF8串，00 04表示字符串的长度，【6d 61 69 6e】=【main】<br>0000100 75 6d 62 65 72 54 61 62 6c 65 <font color="red">01 00 04 6d 61 69</font><br>0000120 <font color="red">6e</font> 01 00 16 28 5b 4c 6a 61 76 61 2f 6c 61 6e 67</p>
<h4 id="12"><a href="#12" class="headerlink" title="#12"></a>#12</h4><p>第#12项，01 表示一个UTF8串，00 16（22）表示字符串的长度，【28 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b 29 56】=【([Ljava/lang/String;)V】<br>0000120 6e <font color="red">01 00 16 28 5b 4c 6a 61 76 61 2f 6c 61 6e 67</font><br>0000140 <font color="red">2f 53 74 72 69 6e 67 3b 29 56</font> 01 00 10 4d 65 74</p>
<h4 id="13"><a href="#13" class="headerlink" title="#13"></a>#13</h4><p>第#13项，01 表示一个UTF8串，00 10（16）表示字符串的长度，【4d 65 74 68 6f 64 50 61 72 61 6d 65 74 65 72 73】=【MethodParameters】<br>0000140 2f 53 74 72 69 6e 67 3b 29 56 <font color="red">01 00 10 4d 65 74</font><br>0000160 <font color="red">68 6f 64 50 61 72 61 6d 65 74 65 72 73</font> 01 00 04</p>
<h4 id="14"><a href="#14" class="headerlink" title="#14"></a>#14</h4><p>第#14项，01 表示一个UTF8串，00 04（16）表示字符串的长度，【61 72 67 73】=【args】<br>0000160 68 6f 64 50 61 72 61 6d 65 74 65 72 73 <font color="red">01 00 04</font><br>0000200 <font color="red">61 72 67 73</font> 01 00 0a 53 6f 75 72 63 65 46 69 6c</p>
<h4 id="15"><a href="#15" class="headerlink" title="#15"></a>#15</h4><p>第#15项，01 表示一个UTF8串，00 0a（10）表示字符串的长度，【53 6f 75 72 63 65 46 69 6c 65】=【SourceFile】<br>0000200 61 72 67 73 <font color="red">01 00 0a 53 6f 75 72 63 65 46 69 6c</font><br>0000220 <font color="red">65</font> 01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 64 2e 6a</p>
<h4 id="16"><a href="#16" class="headerlink" title="#16"></a>#16</h4><p>第#16项，01 表示一个UTF8串，00 0f（15）表示字符串的长度，【48 65 6c 6c 6f 57 6f 72 6c 64 2e 6a 61 76 61】=【HelloWorld.java】<br>0000220 65 <font color="red">01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 64 2e 6a</font><br>0000240 <font color="red">61 76 61</font> 0c 00 07 00 08 07 00 19 0c 00 1a 00 1b</p>
<h4 id="17"><a href="#17" class="headerlink" title="#17"></a>#17</h4><p>第#17项，0c（12） 表示一个NameAndType【名+类型】，00 07和00 08表示引用了常量池中的#7和#8项【&lt;init&gt;:()V】<br>0000240 61 76 61 <font color="red">0c 00 07 00 08</font> 07 00 19 0c 00 1a 00 1b</p>
<h4 id="18"><a href="#18" class="headerlink" title="#18"></a>#18</h4><p>第#18项，07 表示一个Class信息，00 19（25） 表示它引用了常量池中#25项<br>0000240 61 76 61 0c 00 07 00 08 <font color="red">07 00 19</font> 0c 00 1a 00 1b</p>
<h4 id="19"><a href="#19" class="headerlink" title="#19"></a>#19</h4><p>第#19项，0c（12） 表示一个NameAndType【名+类型】，00 1a（26）和00 1b（27）表示引用了常量池中的#26和#27项<br>0000240 61 76 61 0c 00 07 00 08 07 00 19 <font color="red">0c 00 1a 00 1b</font></p>
<h4 id="20"><a href="#20" class="headerlink" title="#20"></a>#20</h4><p>第#20项，01 表示一个UTF8串，00 0b（11）表示字符串的长度，【68 65 6c 6c 6f 20 77 6f 72 6c 64】=【hello world】<br>0000260  <font color="red">01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64</font> 07 00</p>
<h4 id="21"><a href="#21" class="headerlink" title="#21"></a>#21</h4><p>第#21项，07 表示一个Class信息，00 1c（28） 表示它引用了常量池中#28项<br>0000260  01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64 <font color="red">07 00</font><br>0000300 <font color="red">1c</font> 0c 00 1d 00 1e 01 00 21 63 6f 6d 2f 65 78 61</p>
<h4 id="22"><a href="#22" class="headerlink" title="#22"></a>#22</h4><p>第#22项，0c（12） 表示一个NameAndType【名+类型】，00 1d（29）和00 1e（30）表示引用了常量池中的#29和#30项<br>0000300 1c <font color="red">0c 00 1d 00 1e </font>01 00 21 63 6f 6d 2f 65 78 61</p>
<h4 id="23"><a href="#23" class="headerlink" title="#23"></a>#23</h4><p>第#23项，01 表示一个UTF8串，00 21（33）表示字符串的长度，【63 6f 6d 2f 65 78 61 6d 70 6c 65 2f 64 65 6d 6f 31 2f 74 65 73 74 2f 48 65 6c 6c 6f 57 6f 72 6c 64】=【com/example/demo1/test/HelloWorld】<br>0000300 1c 0c 00 1d 00 1e <font color="red">01 00 21 63 6f 6d 2f 65 78 61</font><br>0000320 <font color="red">6d 70 6c 65 2f 64 65 6d 6f 31 2f 74 65 73 74 2f</font><br>0000340 <font color="red">48 65 6c 6c 6f 57 6f 72 6c 64</font> 01 00 10 6a 61 76</p>
<h4 id="24"><a href="#24" class="headerlink" title="#24"></a>#24</h4><p>第#24项，01 表示一个UTF8串，00 10（16）表示字符串的长度，【6a 61 76 61 2f 6c 61 6e 67 2f 4f 62 6a 65 63 74】=【java/lang/Object】<br>0000340 48 65 6c 6c 6f 57 6f 72 6c 64 <font color="red">01 00 10 6a 61 76</font><br>0000360 <font color="red">61 2f 6c 61 6e 67 2f 4f 62 6a 65 63 74</font> 01 00 10</p>
<h4 id="25"><a href="#25" class="headerlink" title="#25"></a>#25</h4><p>第#25项，01 表示一个UTF8串，00 10（16）表示字符串的长度，【6a 61 76 61 2f 6c 61 6e 67 2f 53 79 73 74 65 6d】=【java/lang/System】<br>0000360 61 2f 6c 61 6e 67 2f 4f 62 6a 65 63 74 <font color="red">01 00 10</font><br>0000400 <font color="red">6a 61 76 61 2f 6c 61 6e 67 2f 53 79 73 74 65 6d</font></p>
<h4 id="26"><a href="#26" class="headerlink" title="#26"></a>#26</h4><p>第#26项，01 表示一个UTF8串，00 03（16）表示字符串的长度，【6f 75 74】=【out】<br>0000420 <font color="red">01 00 03 6f 75 74</font> 01 00 15 4c 6a 61 76 61 2f 69</p>
<h4 id="27"><a href="#27" class="headerlink" title="#27"></a>#27</h4><p>第#27项，01 表示一个UTF8串，00 15（21）表示字符串的长度，【4c 6a 61 76 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d 3b】=【Ljava/io/PrintStream;】<br>0000420 01 00 03 6f 75 74 <font color="red">01 00 15 4c 6a 61 76 61 2f 69</font><br>0000440 <font color="red">6f 2f 50 72 69 6e 74 53 74 72 65 61 6d 3b</font> 01 00</p>
<h4 id="28"><a href="#28" class="headerlink" title="#28"></a>#28</h4><p>第#28项，01 表示一个UTF8串，00 13（19）表示字符串的长度，【6a 61 76 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d】=【java/io/PrintStream】<br>0000440 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d 3b <font color="red">01 00</font><br>0000460 <font color="red">13 6a 61 76 61 2f 69 6f 2f 50 72 69 6e 74 53 74</font><br>0000500 <font color="red">72 65 61 6d</font> 01 00 07 70 72 69 6e 74 6c 6e 01 00</p>
<h4 id="29"><a href="#29" class="headerlink" title="#29"></a>#29</h4><p>第#29项，01 表示一个UTF8串，00 07表示字符串的长度，【70 72 69 6e 74 6c 6e】=【println】<br>0000500 72 65 61 6d <font color="red">01 00 07 70 72 69 6e 74 6c 6e</font> 01 00</p>
<h4 id="30"><a href="#30" class="headerlink" title="#30"></a>#30</h4><p>第#30项，01 表示一个UTF8串，00 15（21）表示字符串的长度，【28 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b 29 56】=【(Ljava/lang/String;)V】<br>0000500 72 65 61 6d 01 00 07 70 72 69 6e 74 6c 6e <font color="red">01 00</font><br>0000520 <font color="red">15 28 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72</font><br>0000540 <font color="red">69 6e 67 3b 29 56</font> 00 21 00 05 00 06 00 00 00 00</p>
<h2 id="访问标识与继承信息"><a href="#访问标识与继承信息" class="headerlink" title="访问标识与继承信息"></a>访问标识与继承信息</h2><table>
<thead>
<tr>
<th align="left">Flag Name</th>
<th align="left">Value</th>
<th align="left">Interpretation</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ACC_PUBLIC</td>
<td align="left">0x0001</td>
<td align="left">表示是公开的，public</td>
</tr>
<tr>
<td align="left">ACC_FINAL</td>
<td align="left">0x0010</td>
<td align="left">表示是final的</td>
</tr>
<tr>
<td align="left">ACC_SUPER</td>
<td align="left">0x0020</td>
<td align="left">表示是一个类</td>
</tr>
<tr>
<td align="left">ACC_INTERFACE</td>
<td align="left">0x0200</td>
<td align="left">表示是一个接口</td>
</tr>
<tr>
<td align="left">ACC_ABSTRACT</td>
<td align="left">0x0400</td>
<td align="left">表示是一个抽象的</td>
</tr>
<tr>
<td align="left">ACC_SYNTHETIC</td>
<td align="left">0x1000</td>
<td align="left">表示是人工合成的，不是原生的</td>
</tr>
<tr>
<td align="left">ACC_ANNOTATION</td>
<td align="left">0x2000</td>
<td align="left">表示是一个注解</td>
</tr>
<tr>
<td align="left">ACC_ENUM</td>
<td align="left">0X4000</td>
<td align="left">表示是一个枚举</td>
</tr>
</tbody></table>
<h3 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h3><p>00 21 表示（0x0001）+（0x0020），表示该class是一个公共的类<br>0000540 69 6e 67 3b 29 56 <font color="red">00 21</font> 00 05 00 06 00 00 00 00</p>
<h3 id="全限定名"><a href="#全限定名" class="headerlink" title="全限定名"></a>全限定名</h3><p>00 05 表示全限定名的位置，常量池中#5项的位置【com/example/demo1/test/HelloWorld】<br>0000540 69 6e 67 3b 29 56 00 21 <font color="red">00 05</font> 00 06 00 00 00 00</p>
<h3 id="父类全限定名"><a href="#父类全限定名" class="headerlink" title="父类全限定名"></a>父类全限定名</h3><p>00 06 表示父类全限定名的位置，常量池中#6项的位置【java/lang/Object】<br>0000540 69 6e 67 3b 29 56 00 21 00 05 <font color="red">00 06</font> 00 00 00 00</p>
<h3 id="接口信息"><a href="#接口信息" class="headerlink" title="接口信息"></a>接口信息</h3><p>00 00 表示该类继承的接口数量，现在表示没有继承接口，如果继承了接口，后面就会跟随接口的描述信息<br>0000540 69 6e 67 3b 29 56 00 21 00 05 00 06 <font color="red">00 00</font> 00 00</p>
<h2 id="成员变量信息-Field"><a href="#成员变量信息-Field" class="headerlink" title="成员变量信息(Field)"></a>成员变量信息(Field)</h2><p>00 00 表示该类的成员变量的数量，现在表示没有成员变量，如果有成员变量，后面会跟随成员变量的信息<br>0000540 69 6e 67 3b 29 56 00 21 00 05 00 06 00 00 <font color="red">00 00</font></p>
<table>
<thead>
<tr>
<th align="left">FieldType</th>
<th align="left">Type</th>
<th align="left">Interpretation</th>
</tr>
</thead>
<tbody><tr>
<td align="left">B</td>
<td align="left">byte</td>
<td align="left">字节类型</td>
</tr>
<tr>
<td align="left">C</td>
<td align="left">char</td>
<td align="left">字符类型</td>
</tr>
<tr>
<td align="left">D</td>
<td align="left">double</td>
<td align="left">双精度浮点类型</td>
</tr>
<tr>
<td align="left">F</td>
<td align="left">float</td>
<td align="left">单精度浮点类型</td>
</tr>
<tr>
<td align="left">I</td>
<td align="left">int</td>
<td align="left">整型</td>
</tr>
<tr>
<td align="left">J</td>
<td align="left">long</td>
<td align="left">长整型</td>
</tr>
<tr>
<td align="left">L ClassName;</td>
<td align="left">reference</td>
<td align="left">引用类型,例如【Ljava/io/PrintStream;】</td>
</tr>
<tr>
<td align="left">S</td>
<td align="left">short</td>
<td align="left">短整数</td>
</tr>
<tr>
<td align="left">Z</td>
<td align="left">boolean</td>
<td align="left">布尔类型</td>
</tr>
<tr>
<td align="left">[</td>
<td align="left">reference</td>
<td align="left">数组类型</td>
</tr>
</tbody></table>
<h2 id="方法信息（Method）"><a href="#方法信息（Method）" class="headerlink" title="方法信息（Method）"></a>方法信息（Method）</h2><h3 id="方法数量"><a href="#方法数量" class="headerlink" title="方法数量"></a>方法数量</h3><p>00 02 表示该类中的方法数量，当前类里面是有2个方法，【无参构造，main方法】<br>0000560 <font color="red">00 02</font> 00 01 00 07 00 08 00 01 00 09 00 00 00 1d</p>
<h3 id="方法组成"><a href="#方法组成" class="headerlink" title="方法组成"></a>方法组成</h3><p>一个方法由访问修饰符，名称，参数描述，方法属性数量，方法属性组成</p>
<h3 id="第一个方法的详细解析"><a href="#第一个方法的详细解析" class="headerlink" title="第一个方法的详细解析"></a>第一个方法的详细解析</h3><ul>
<li>蓝色部分的 00 01 表示方法的访问修饰，当前表示是一个公共方法</li>
<li>绿色部分的 00 07 表示要查询常量池中的第#7项得到方法的名字【&lt;init&gt;】</li>
<li>黄色部分的 00 08 表示要查询常量池中的#8项获得方法的参数和返回值信息【()V】（无参，返回值是void）</li>
<li>紫色部分的 00 01 表示方法的属性数量，当前是1个</li>
<li>剩下的红色部分代表方法属性<ul>
<li>00 09表示方法的属性名称，需要查询常量池中的#9 【Code】</li>
<li>00 00 00 1d 表示该属性占据的字节码长度是29</li>
<li>00 01 表示【操作数栈】最大深度</li>
<li>00 01 表示【局部变量表】最大槽（slot）数</li>
<li>00 00 00 05 表示【Code】属性内的（代码）字节码长度</li>
<li>2a b7 00 01 b1 方法内的具体代码</li>
<li>00 00 00 01 表示方法细节属性数量（code属性的有些子属性）</li>
<li>00 0a 表示引用了常量池中的#10项，发现是【LineNumberTable】属性（将字节码行号和java代码行号对应）<ul>
<li>00 00 00 06 【LineNumberTable】属性的字节码总长度，6</li>
<li>00 01 【LineNumberTable】属性的长度（有几对）</li>
<li>00 00 00 07，00 00 表示【字节码】行号，00 04 表示【java源码】行号</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>0000560 00 02 <font color="blue">00 01</font> <font color="green">00 07</font> <font color="yellow">00 08</font> <font color="purple">00 01</font> <font color="red">00 09 00 00 00 1d</font><br>0000600 <font color="red">00 01 00 01 00 00 00 05 2a b7 00 01 b1 00 00 00</font><br>0000620 <font color="red">01 00 0a 00 00 00 06 00 01 00 00 00 07</font> 00 09 00</p>
<h3 id="第二个方法的详细解析"><a href="#第二个方法的详细解析" class="headerlink" title="第二个方法的详细解析"></a>第二个方法的详细解析</h3><ul>
<li>蓝色部分的 00 09 表示方法的访问修饰，相当于是（08+01）08是静态，当前表示是一个静态公共方法</li>
<li>绿色部分的 00 0b (11)表示要查询常量池中的第#11项得到方法的名字【main】</li>
<li>黄色部分的 00 0c (12) 表示要查询常量池中的#12项获得方法的参数和返回值信息【([Ljava/lang/String;)V】（如此是引用数组类型，返回值是void）</li>
<li>紫色部分的 00 02 表示方法的属性数量，当前是2个</li>
<li>剩下的红色部分代表方法属性<ul>
<li>00 09表示方法的第一个属性名称，需要查询常量池中的#9 【Code】<ul>
<li>00 00 00 25 表示该属性的占据的字节码长度是37</li>
<li>00 02 表示【操作数栈】最大深度2</li>
<li>00 01 表示【局部变量表】最大槽（slot）数</li>
<li>00 00 00 09 表示【Code】属性内的（代码）字节码长度</li>
<li>b2 00 02 12 03 b6 00 04 b1 方法内的具体代码</li>
<li>00 00 00 01 表示方法细节属性数量（code属性的有些子属性）</li>
<li>00 0a 表示引用了常量池中的#10项，发现是【LineNumberTable】属性（将字节码行号和java代码行号对应）<ul>
<li>00 00 00 0a 【LineNumberTable】属性的字节码总长度，10</li>
<li>00 02 【LineNumberTable】属性的长度（有几对）</li>
<li>00 00 00 09，00 00 表示【字节码】行号，00 09 表示【java源码】行号</li>
<li>00 08 00 0a，00 08 表示【字节码】行号，00 0a (10) 表示【java源码】行号</li>
</ul>
</li>
</ul>
</li>
<li>00 0d(13)表示方法的第一个属性名称，需要查询常量池中的#13 【MethodParameters】<ul>
<li>00 00 00 05 表示该属性的占据的字节码长度是5</li>
<li>01 参数的数量</li>
<li>00 0e (14) 参数的名字，引用了常量池中的#14项，【args】</li>
<li>00 00 访问修饰符</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>0000620 01 00 0a 00 00 00 06 00 01 00 00 00 07 <font color="blue">00 09</font> <font color="green">00</font><br>0000640 <font color="green">0b</font> <font color="yellow">00 0c</font> <font color="purple">00 02</font> <font color="red">00 09 00 00 00 25 00 02 00 01 00</font><br>0000660 <font color="red">00 00 09 b2 00 02 12 03 b6 00 04 b1 00 00 00 01</font><br>0000700 <font color="red">00 0a 00 00 00 0a 00 02 00 00 00 09 00 08 00 0a</font><br>0000720 <font color="red">00 0d 00 00 00 05 01 00 0e 00 00</font> 00 01 00 0f 00</p>
<h2 id="附加属性"><a href="#附加属性" class="headerlink" title="附加属性"></a>附加属性</h2><ul>
<li>00 01 表示附加属性的数量</li>
<li>00 0f（15） 表示引用了常量池中的#15项【SourceFile】</li>
<li>00 00 00 02 表示此属性的长度</li>
<li>00 10（16） 表示引用了常量池#16项，【HelloWorld.java】</li>
</ul>
<p>0000720 00 0d 00 00 00 05 01 00 0e 00 00 <font color="red">00 01 00 0f 00</font><br>0000740 <font color="red">00 00 02 00 10</font><br>0000745</p>
<h1 id="字节码指令"><a href="#字节码指令" class="headerlink" title="字节码指令"></a>字节码指令</h1><h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><p>可参考文章：</p>
<ul>
<li><a href="https://ysymj.gitee.io/2021/11/16/java%E5%9F%BA%E7%A1%80/Java%E5%AD%97%E8%8A%82%E7%A0%81%E6%8C%87%E4%BB%A4%E5%A4%A7%E5%85%A8/">Java字节码指令大全 | YS (gitee.io)</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html">Chapter 6. The Java Virtual Machine Instruction Set (oracle.com)</a></li>
</ul>
<p>上面的方法编译后，留下了两组字节码指令没有讲解</p>
<p><strong>构造方法中的5个字节码指令</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2a b7 00 01 b1</span><br></pre></td></tr></table></figure>
<ul>
<li>2a =&gt; <code>aload_0</code>，从局部变量0中装载引用类型值入栈，及<code>this</code>，做为下面的 <code>invokespecial</code> 构造方法调用的参数</li>
<li>b7 =&gt; <code>invokespecial</code> ，编译时方法绑定调用方法（预备调用构造方法），调用那个方法？</li>
<li>00 01 引用常量池中 #1 项，即【Method java/lang/Object.&lt;init&gt;:()V】</li>
<li>b1 =&gt;return， viod函数返回</li>
</ul>
<p><strong>main方法中的9个字节码指令</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b2 00 02 12 03 b6 00 04 b1</span><br></pre></td></tr></table></figure>
<ul>
<li>b2 =&gt; <code>getstatic</code>，获取静态字段的值（加载静态变量），那个静态变量呢？</li>
<li>00 02 引用常量池中#2项，即【Field java/lang/System.out:Ljava/io/PrintStream;】</li>
<li>12 =&gt; <code>ldc</code>，常量池中的常量值入栈（加载参数），加载那个参数？</li>
<li>03 引用常量池中#3项，即【String hello world】</li>
<li>b6 =&gt; <code>invokvirtual</code>，运行时方法绑定调用方法（预备调用成员方法），调用那个方法？</li>
<li>00 04 引用常量池中#4项，即【Method java/io/PrintStream.println:(Ljava/lang/String;)V】</li>
<li>b1 =&gt;return， viod函数返回</li>
</ul>
<h2 id="javap-工具"><a href="#javap-工具" class="headerlink" title="javap 工具"></a>javap 工具</h2><ul>
<li>jdk提供了<code>javap</code>工具来进行反编译，具体操作方式，见上面内容</li>
</ul>
<h2 id="图解方法执行流程"><a href="#图解方法执行流程" class="headerlink" title="图解方法执行流程"></a>图解方法执行流程</h2><h3 id="原始java代码"><a href="#原始java代码" class="headerlink" title="原始java代码"></a>原始java代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">10</span>;  </span><br><span class="line">        <span class="keyword">int</span> b = Short.MAX_VALUE +<span class="number">1</span> ;  </span><br><span class="line">        <span class="keyword">int</span> c = a+b;  </span><br><span class="line">        System.out.println(c);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="编译后的字节码文件"><a href="#编译后的字节码文件" class="headerlink" title="编译后的字节码文件"></a>编译后的字节码文件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">Classfile /E:/project/java/demo2/src/main/java/com/example/demo1/test/com/example/demo1/test/Test1.class</span><br><span class="line">  Last modified <span class="number">2022</span>-<span class="number">8</span>-<span class="number">21</span>; size <span class="number">488</span> bytes</span><br><span class="line">  MD5 checksum b8a87685b4f2ed97f03db1e25823271e</span><br><span class="line">  Compiled from <span class="string">&quot;Test1.java&quot;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">com</span>.<span class="title">example</span>.<span class="title">demo1</span>.<span class="title">test</span>.<span class="title">Test1</span></span></span><br><span class="line"><span class="class">  <span class="title">minor</span> <span class="title">version</span>: 0</span></span><br><span class="line"><span class="class">  <span class="title">major</span> <span class="title">version</span>: 52</span></span><br><span class="line"><span class="class">  <span class="title">flags</span>: <span class="title">ACC_PUBLIC</span>, <span class="title">ACC_SUPER</span></span></span><br><span class="line"><span class="class"><span class="title">Constant</span> <span class="title">pool</span>:</span></span><br><span class="line"><span class="class">   #1 </span>= Methodref          #<span class="number">7.</span>#<span class="number">18</span>         <span class="comment">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">   #<span class="number">2</span> = Class              #<span class="number">19</span>            <span class="comment">// java/lang/Short</span></span><br><span class="line">   #<span class="number">3</span> = Integer            <span class="number">32768</span></span><br><span class="line">   #<span class="number">4</span> = Fieldref           #<span class="number">20.</span>#<span class="number">21</span>        <span class="comment">// java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">   #<span class="number">5</span> = Methodref          #<span class="number">22.</span>#<span class="number">23</span>        <span class="comment">// java/io/PrintStream.println:(I)V</span></span><br><span class="line">   #<span class="number">6</span> = Class              #<span class="number">24</span>            <span class="comment">// com/example/demo1/test/Test1</span></span><br><span class="line">   #<span class="number">7</span> = Class              #<span class="number">25</span>            <span class="comment">// java/lang/Object</span></span><br><span class="line">   #<span class="number">8</span> = Utf8               &lt;init&gt;</span><br><span class="line">   #<span class="number">9</span> = Utf8               ()V</span><br><span class="line">  #<span class="number">10</span> = Utf8               Code</span><br><span class="line">  #<span class="number">11</span> = Utf8               LineNumberTable</span><br><span class="line">  #<span class="number">12</span> = Utf8               main</span><br><span class="line">  #<span class="number">13</span> = Utf8               ([Ljava/lang/String;)V</span><br><span class="line">  #<span class="number">14</span> = Utf8               MethodParameters</span><br><span class="line">  #<span class="number">15</span> = Utf8               args</span><br><span class="line">  #<span class="number">16</span> = Utf8               SourceFile</span><br><span class="line">  #<span class="number">17</span> = Utf8               Test1.java</span><br><span class="line">  #<span class="number">18</span> = NameAndType        #<span class="number">8</span>:#<span class="number">9</span>          <span class="comment">// &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">  #<span class="number">19</span> = Utf8               java/lang/Short</span><br><span class="line">  #<span class="number">20</span> = Class              #<span class="number">26</span>            <span class="comment">// java/lang/System</span></span><br><span class="line">  #<span class="number">21</span> = NameAndType        #<span class="number">27</span>:#<span class="number">28</span>        <span class="comment">// out:Ljava/io/PrintStream;</span></span><br><span class="line">  #<span class="number">22</span> = Class              #<span class="number">29</span>            <span class="comment">// java/io/PrintStream</span></span><br><span class="line">  #<span class="number">23</span> = NameAndType        #<span class="number">30</span>:#<span class="number">31</span>        <span class="comment">// println:(I)V</span></span><br><span class="line">  #<span class="number">24</span> = Utf8               com/example/demo1/test/Test1</span><br><span class="line">  #<span class="number">25</span> = Utf8               java/lang/Object</span><br><span class="line">  #<span class="number">26</span> = Utf8               java/lang/System</span><br><span class="line">  #<span class="number">27</span> = Utf8               out</span><br><span class="line">  #<span class="number">28</span> = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #<span class="number">29</span> = Utf8               java/io/PrintStream</span><br><span class="line">  #<span class="number">30</span> = Utf8               println</span><br><span class="line">  #<span class="number">31</span> = Utf8               (I)V</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> com.example.demo1.test.Test1();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">7</span>: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[])</span></span>;</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">4</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: bipush        <span class="number">10</span></span><br><span class="line">         <span class="number">2</span>: istore_1</span><br><span class="line">         <span class="number">3</span>: ldc           #<span class="number">3</span>                  <span class="comment">// int 32768</span></span><br><span class="line">         <span class="number">5</span>: istore_2</span><br><span class="line">         <span class="number">6</span>: iload_1</span><br><span class="line">         <span class="number">7</span>: iload_2</span><br><span class="line">         <span class="number">8</span>: iadd</span><br><span class="line">         <span class="number">9</span>: istore_3</span><br><span class="line">        <span class="number">10</span>: getstatic     #<span class="number">4</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">        <span class="number">13</span>: iload_3</span><br><span class="line">        <span class="number">14</span>: invokevirtual #<span class="number">5</span>                  <span class="comment">// Method java/io/PrintStream.println:(I)V</span></span><br><span class="line">        <span class="number">17</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">9</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">10</span>: <span class="number">3</span></span><br><span class="line">        line <span class="number">11</span>: <span class="number">6</span></span><br><span class="line">        line <span class="number">12</span>: <span class="number">10</span></span><br><span class="line">        line <span class="number">13</span>: <span class="number">17</span></span><br><span class="line">    MethodParameters:</span><br><span class="line">      Name                           Flags</span><br><span class="line">      args</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">&quot;Test1.java&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="常量池载入运行时常量池"><a href="#常量池载入运行时常量池" class="headerlink" title="常量池载入运行时常量池"></a>常量池载入运行时常量池</h3><blockquote>
<p>一些比较小的数字，不会存储在常量池中，而是跟方法的字节码存在一起，比如<code>int a = 10;</code> 中10就是存在字节码中的<br> 而<code>b</code>的值<code>32768</code>则是存在常量池中的</p>
</blockquote>
<p><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0%E5%9B%BE%E7%A4%BA.png" alt="运行时常量池图示"></p>
<h3 id="方法字节码载入方法区"><a href="#方法字节码载入方法区" class="headerlink" title="方法字节码载入方法区"></a>方法字节码载入方法区</h3><blockquote>
<p>方法区域中的字节码，会载入到方法区</p>
</blockquote>
<p><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/%E6%96%B9%E6%B3%95%E5%8C%BA%E5%AD%97%E8%8A%82%E7%A0%81%E8%BD%BD%E5%85%A5%E5%9B%BE%E7%A4%BA.png" alt="方法区字节码载入图示"></p>
<h3 id="main-线程开始运行，分配栈帧内存"><a href="#main-线程开始运行，分配栈帧内存" class="headerlink" title="main 线程开始运行，分配栈帧内存"></a>main 线程开始运行，分配栈帧内存</h3><p>(stack=2, locals=4)<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/%E4%B8%BB%E7%BA%BF%E7%A8%8B%E5%88%86%E9%85%8D%E6%A0%88%E5%B8%A7%E5%86%85%E5%AD%98%E5%9B%BE%E7%A4%BA.png" alt="主线程分配栈帧内存图示"></p>
<h3 id="执行引擎开始执行字节码"><a href="#执行引擎开始执行字节码" class="headerlink" title="执行引擎开始执行字节码"></a>执行引擎开始执行字节码</h3><h4 id="bipush-10"><a href="#bipush-10" class="headerlink" title="bipush 10"></a>bipush 10</h4><ul>
<li>将一个<code>byte</code>压入操作数栈（操作数栈宽度是4，<code>byte</code>是1，不足的部分会补足），类似的指令还有<ul>
<li><code>sipush</code> 将一个<code>short</code> 压入操作数栈，（长度会补足4个字节）</li>
<li><code>ldc</code> 将一个<code>int</code> 压入操作数栈</li>
<li><code>ldc2_w</code> 将一个<code>long</code>压入操作数栈，（<code>long</code>为8字节，操作数栈4字节，会分两次压）</li>
<li>这里小的数字都是和字节码指令存在一起，超过<code>short</code>范围的数字存入了常量池 </li>
</ul>
</li>
</ul>
<p><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA1.png" alt="java代码运行图示1"></p>
<h4 id="istore-1"><a href="#istore-1" class="headerlink" title="istore_1"></a>istore_1</h4><ul>
<li>将操作数栈顶数据弹出，存入局部变量表的<code>slot_1</code></li>
</ul>
<p><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA2.png" alt="java代码运行图示2"></p>
<ul>
<li>实现给a变量赋值<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA3.png" alt="java代码运行图示3"></li>
</ul>
<h4 id="ldc-32"><a href="#ldc-32" class="headerlink" title="ldc #32"></a>ldc #32</h4><ul>
<li>从常量池中加载#3项数据到操作数栈</li>
<li><strong>注意</strong> <code>short.MAX_VALUE</code> 是 <code>32767</code>，所以<code>32768=Short.MAX_VALUE + 1</code>实际是在编译期间计算好的</li>
</ul>
<p><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA4.png" alt="java代码运行图示4"></p>
<h4 id="istore-2"><a href="#istore-2" class="headerlink" title="istore_2"></a>istore_2</h4><ul>
<li>将操作数栈顶数据弹出，放入局部变量表<code>slot_2</code><br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA5.png" alt="java代码运行图示5"></li>
<li>数据读取之后入图所示：<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA6.png" alt="java代码运行图示6"><h4 id="iload-1"><a href="#iload-1" class="headerlink" title="iload_1"></a>iload_1</h4></li>
<li>将局部变量表中1位置的变量读取到操作数栈<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA7.png" alt="java代码运行图示7"></li>
</ul>
<h4 id="iload-2"><a href="#iload-2" class="headerlink" title="iload_2"></a>iload_2</h4><ul>
<li>将局部变量表中2位置的变量读取到操作数栈<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA8.png" alt="java代码运行图示8"></li>
</ul>
<h4 id="iadd"><a href="#iadd" class="headerlink" title="iadd"></a>iadd</h4><ul>
<li>  将栈顶两int类型整数相加，结果入栈<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA9.png" alt="java代码运行图示9"></li>
</ul>
<p><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA10.png" alt="java代码运行图示10"></p>
<h4 id="istore-3"><a href="#istore-3" class="headerlink" title="istore_3"></a>istore_3</h4><ul>
<li>将操作数栈中的数据取出来存到局部变量表3的位置<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA11.png" alt="java代码运行图示11"></li>
<li>执行之后：<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA12.png" alt="java代码运行图示12"></li>
</ul>
<h4 id="getstatic-4"><a href="#getstatic-4" class="headerlink" title="getstatic #4"></a>getstatic #4</h4><ul>
<li>从常量池中找到对应类型，然后从堆中找到该类型的对象（或者创建对象），然后将引用放入操作数栈</li>
</ul>
<p><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA13.png" alt="java代码运行图示13"></p>
<ul>
<li>注意：放入操作数栈的并不是对象，而是对象的引用<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA14.png" alt="java代码运行图示14"></li>
</ul>
<h4 id="iload-3"><a href="#iload-3" class="headerlink" title="iload_3"></a>iload_3</h4><ul>
<li>将局部变量表3号位置的数据放入操作数栈<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA15.png" alt="java代码运行图示15"></li>
</ul>
<p><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA16.png" alt="java代码运行图示16"></p>
<h4 id="invokevirtual-5"><a href="#invokevirtual-5" class="headerlink" title="invokevirtual #5"></a>invokevirtual #5</h4><ul>
<li>找到常量池中#5项</li>
<li>定位到方法区 【java/io/PrintStream.println:(I)V】 方法</li>
<li>生成新的栈帧，（分配<code>locals</code>，<code>stack</code>等）</li>
<li>传递参数，执行新栈帧中的字节码<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA17.png" alt="java代码运行图示17"></li>
<li>执行完毕，弹出栈帧</li>
<li>清除main操作数栈内容<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/java%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%9B%BE%E7%A4%BA18.png" alt="java代码运行图示18"></li>
</ul>
<h4 id="return"><a href="#return" class="headerlink" title="return"></a>return</h4><ul>
<li>完成main方法调用，弹出main栈帧</li>
<li>程序结束</li>
</ul>
<h2 id="练习-分析-i"><a href="#练习-分析-i" class="headerlink" title="练习-分析 i++"></a>练习-分析 i++</h2><p>目的：从字节码角度分析 <code>a++</code> 相关题目<br>源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 从字节码角度分析  a++ 相关题目  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test2</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">10</span>;  </span><br><span class="line">        <span class="keyword">int</span> b = a++ + ++ a + a--;  </span><br><span class="line">        System.out.println(a);  </span><br><span class="line">        System.out.println(b);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">Classfile /E:/project/java/demo2/src/main/java/com/example/demo1/test/com/example/demo1/test/com/example/demo1/test/com/example/demo1/test/Test2.class</span><br><span class="line">  Last modified <span class="number">2022</span>-<span class="number">8</span>-<span class="number">21</span>; size <span class="number">500</span> bytes</span><br><span class="line">  MD5 checksum 540a55d259f5e8971e2576618da6c5b7</span><br><span class="line">  Compiled from <span class="string">&quot;Test2.java&quot;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">com</span>.<span class="title">example</span>.<span class="title">demo1</span>.<span class="title">test</span>.<span class="title">com</span>.<span class="title">example</span>.<span class="title">demo1</span>.<span class="title">test</span>.<span class="title">Test2</span></span></span><br><span class="line"><span class="class">  <span class="title">minor</span> <span class="title">version</span>: 0</span></span><br><span class="line"><span class="class">  <span class="title">major</span> <span class="title">version</span>: 52</span></span><br><span class="line"><span class="class">  <span class="title">flags</span>: <span class="title">ACC_PUBLIC</span>, <span class="title">ACC_SUPER</span></span></span><br><span class="line"><span class="class"><span class="title">Constant</span> <span class="title">pool</span>:</span></span><br><span class="line"><span class="class">   #1 </span>= Methodref          #<span class="number">5.</span>#<span class="number">16</span>         <span class="comment">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">   #<span class="number">2</span> = Fieldref           #<span class="number">17.</span>#<span class="number">18</span>        <span class="comment">// java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">   #<span class="number">3</span> = Methodref          #<span class="number">19.</span>#<span class="number">20</span>        <span class="comment">// java/io/PrintStream.println:(I)V</span></span><br><span class="line">   #<span class="number">4</span> = Class              #<span class="number">21</span>            <span class="comment">// com/example/demo1/test/com/example/demo1/test/Test2</span></span><br><span class="line">   #<span class="number">5</span> = Class              #<span class="number">22</span>            <span class="comment">// java/lang/Object</span></span><br><span class="line">   #<span class="number">6</span> = Utf8               &lt;init&gt;</span><br><span class="line">   #<span class="number">7</span> = Utf8               ()V</span><br><span class="line">   #<span class="number">8</span> = Utf8               Code</span><br><span class="line">   #<span class="number">9</span> = Utf8               LineNumberTable</span><br><span class="line">  #<span class="number">10</span> = Utf8               main</span><br><span class="line">  #<span class="number">11</span> = Utf8               ([Ljava/lang/String;)V</span><br><span class="line">  #<span class="number">12</span> = Utf8               MethodParameters</span><br><span class="line">  #<span class="number">13</span> = Utf8               args</span><br><span class="line">  #<span class="number">14</span> = Utf8               SourceFile</span><br><span class="line">  #<span class="number">15</span> = Utf8               Test2.java</span><br><span class="line">  #<span class="number">16</span> = NameAndType        #<span class="number">6</span>:#<span class="number">7</span>          <span class="comment">// &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">  #<span class="number">17</span> = Class              #<span class="number">23</span>            <span class="comment">// java/lang/System</span></span><br><span class="line">  #<span class="number">18</span> = NameAndType        #<span class="number">24</span>:#<span class="number">25</span>        <span class="comment">// out:Ljava/io/PrintStream;</span></span><br><span class="line">  #<span class="number">19</span> = Class              #<span class="number">26</span>            <span class="comment">// java/io/PrintStream</span></span><br><span class="line">  #<span class="number">20</span> = NameAndType        #<span class="number">27</span>:#<span class="number">28</span>        <span class="comment">// println:(I)V</span></span><br><span class="line">  #<span class="number">21</span> = Utf8               com/example/demo1/test/com/example/demo1/test/Test2</span><br><span class="line">  #<span class="number">22</span> = Utf8               java/lang/Object</span><br><span class="line">  #<span class="number">23</span> = Utf8               java/lang/System</span><br><span class="line">  #<span class="number">24</span> = Utf8               out</span><br><span class="line">  #<span class="number">25</span> = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #<span class="number">26</span> = Utf8               java/io/PrintStream</span><br><span class="line">  #<span class="number">27</span> = Utf8               println</span><br><span class="line">  #<span class="number">28</span> = Utf8               (I)V</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> com.example.demo1.test.com.example.demo1.test.Test2();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">11</span>: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[])</span></span>;</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">3</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: bipush        <span class="number">10</span></span><br><span class="line">         <span class="number">2</span>: istore_1</span><br><span class="line">         <span class="number">3</span>: iload_1</span><br><span class="line">         <span class="number">4</span>: iinc          <span class="number">1</span>, <span class="number">1</span></span><br><span class="line">         <span class="number">7</span>: iinc          <span class="number">1</span>, <span class="number">1</span></span><br><span class="line">        <span class="number">10</span>: iload_1</span><br><span class="line">        <span class="number">11</span>: iadd</span><br><span class="line">        <span class="number">12</span>: iload_1</span><br><span class="line">        <span class="number">13</span>: iinc          <span class="number">1</span>, -<span class="number">1</span></span><br><span class="line">        <span class="number">16</span>: iadd</span><br><span class="line">        <span class="number">17</span>: istore_2</span><br><span class="line">        <span class="number">18</span>: getstatic     #<span class="number">2</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">        <span class="number">21</span>: iload_1</span><br><span class="line">        <span class="number">22</span>: invokevirtual #<span class="number">3</span>                  <span class="comment">// Method java/io/PrintStream.println:(I)V</span></span><br><span class="line">        <span class="number">25</span>: getstatic     #<span class="number">2</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">        <span class="number">28</span>: iload_2</span><br><span class="line">        <span class="number">29</span>: invokevirtual #<span class="number">3</span>                  <span class="comment">// Method java/io/PrintStream.println:(I)V</span></span><br><span class="line">        <span class="number">32</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">13</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">14</span>: <span class="number">3</span></span><br><span class="line">        line <span class="number">15</span>: <span class="number">18</span></span><br><span class="line">        line <span class="number">16</span>: <span class="number">25</span></span><br><span class="line">        line <span class="number">17</span>: <span class="number">32</span></span><br><span class="line">    MethodParameters:</span><br><span class="line">      Name                           Flags</span><br><span class="line">      args</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">&quot;Test2.java&quot;</span></span><br></pre></td></tr></table></figure>

<p>分析：</p>
<ul>
<li>注意 <code>iinc</code> 指令是直接在局部变量<code>slot</code>上进行运算</li>
<li><code>a++</code> 和 <code>++a</code> 的区别是先执行<code>iload</code>还是先执行<code>iinc</code><ul>
<li><code>a++</code> 先执行<code> iload</code>，然后再<code>iinc</code>自增</li>
<li><code>++a</code> 先执行<code>iinc</code>自增，再执行<code>iload</code></li>
</ul>
</li>
</ul>
<h3 id="bipush-10-1"><a href="#bipush-10-1" class="headerlink" title="bipush 10"></a>bipush 10</h3><ul>
<li>把10先放到操作数栈<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/%E5%88%86%E6%9E%90%E5%9B%BE%E7%A4%BA1.png"></li>
</ul>
<h3 id="istore-1-1"><a href="#istore-1-1" class="headerlink" title="istore_1"></a>istore_1</h3><ul>
<li>把操作数栈中栈顶的数据弹出，存到局部变量表一号桶位<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/%E5%88%86%E6%9E%90%E5%9B%BE%E7%A4%BA2.png"></li>
</ul>
<h3 id="iload-1-1"><a href="#iload-1-1" class="headerlink" title="iload_1"></a>iload_1</h3><ul>
<li>把局部变量表一号槽位中的数据读取到操作数栈<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/%E5%88%86%E6%9E%90%E5%9B%BE%E7%A4%BA3.png"></li>
</ul>
<h3 id="iinc-1-1"><a href="#iinc-1-1" class="headerlink" title="iinc 1,1"></a>iinc 1,1</h3><ul>
<li>执行 <code>a++</code></li>
<li>局部变量表一号槽位数据自增1</li>
<li>前面的1表示局部变量表的槽位，后面的1表示自增1</li>
<li>该操作直接在局部变量表中完成，并不会影响操作数栈中的数据<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/%E5%88%86%E6%9E%90%E5%9B%BE%E7%A4%BA4.png"></li>
</ul>
<h3 id="iinc-1-1-1"><a href="#iinc-1-1-1" class="headerlink" title="iinc 1,1"></a>iinc 1,1</h3><ul>
<li>执行<code>++a</code></li>
<li>局部变量表一号槽位自增1（不会影响到操作数栈）<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/%E5%88%86%E6%9E%90%E5%9B%BE%E7%A4%BA5.png"></li>
</ul>
<h3 id="iload-1-2"><a href="#iload-1-2" class="headerlink" title="iload_1"></a>iload_1</h3><ul>
<li>把局部变量表一号槽位的数据加载到操作数栈（12加载到操作数栈）<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/%E5%88%86%E6%9E%90%E5%9B%BE%E7%A4%BA6.png"></li>
</ul>
<h3 id="iadd-1"><a href="#iadd-1" class="headerlink" title="iadd"></a>iadd</h3><ul>
<li>将栈顶两int类型整数相加，结果入栈<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220826210747224.png"></li>
</ul>
<h3 id="iload-1-3"><a href="#iload-1-3" class="headerlink" title="iload_1"></a>iload_1</h3><ul>
<li><code>a--</code> 先<code>iload</code>再<code>iinc</code></li>
<li>先将12放入操作数栈<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220826211136301.png"></li>
</ul>
<h3 id="iinc-1-1-2"><a href="#iinc-1-1-2" class="headerlink" title="iinc 1,-1"></a>iinc 1,-1</h3><ul>
<li>执行 <code>a--</code></li>
<li>局部变量表一号槽位增加-1，也就是减1<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220826211226285.png"><h3 id="iadd-2"><a href="#iadd-2" class="headerlink" title="iadd"></a>iadd</h3></li>
<li> 将栈顶两int类型整数相加，结果入栈<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220826211519082.png"></li>
</ul>
<h3 id="istore-2-1"><a href="#istore-2-1" class="headerlink" title="istore_2"></a>istore_2</h3><ul>
<li>把操作数栈顶的数据弹出到局部变了表2号槽位<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220826211549138.png"></li>
</ul>
<h2 id="条件判断指令"><a href="#条件判断指令" class="headerlink" title="条件判断指令"></a>条件判断指令</h2><p>详情见《Java字节码指令大全》&lt;1.11  控制流指令——条件跳转指令&gt;<br><a href="https://ysymj.gitee.io/2021/11/16/java%E5%9F%BA%E7%A1%80/Java%E5%AD%97%E8%8A%82%E7%A0%81%E6%8C%87%E4%BB%A4%E5%A4%A7%E5%85%A8/">Java字节码指令大全 | YS (gitee.io)</a></p>
<p><font color="red">说明:</font></p>
<ul>
<li>byte、short、char都会按 int 比较，因为操作数栈是4个字节</li>
<li>goto用来跳转到指定行号的字节码</li>
</ul>
<h3 id="循环控制指令"><a href="#循环控制指令" class="headerlink" title="循环控制指令"></a>循环控制指令</h3><ul>
<li>其实循环也是依靠上面的判断指令完成的<br>源码： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">      <span class="keyword">int</span> a = <span class="number">0</span>;  </span><br><span class="line">      <span class="keyword">while</span> (a &lt; <span class="number">10</span>)&#123;  </span><br><span class="line">          a++;  </span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>编译后的字节码如下：<br>iconst_0 准备一个0值入栈<br>istore_1 将操作数栈顶的数据，也就是刚刚的0值，存放到局部变量表1号位<br>iload_1 将局部变量表1号位，也就是刚刚的0值存入操作数栈<br>bipush 准备一个数字10入栈<br>if_icmpge 若栈顶两int类型值前大于等于后则跳转，也就说0所代表的变量大于等于10的时候，可以跳转到第14行字节码<br>iinc 局部变量表1号位自增1，也就是0值的位置，现在为1<br>goto 跳转到第2行字节码执行<br>然后会继续循环判断<br>以此实现循环，当满足条件的时候就会跳转到14行return</p>
</blockquote>
</li>
</ul>
<p>字节码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: iconst_0</span><br><span class="line"><span class="number">1</span>: istore_1</span><br><span class="line"><span class="number">2</span>: iload_1</span><br><span class="line"><span class="number">3</span>: bipush        <span class="number">10</span></span><br><span class="line"><span class="number">5</span>: if_icmpge     <span class="number">14</span></span><br><span class="line"><span class="number">8</span>: iinc          <span class="number">1</span>, <span class="number">1</span></span><br><span class="line"><span class="number">11</span>: goto          <span class="number">2</span></span><br><span class="line"><span class="number">14</span>: <span class="keyword">return</span></span><br></pre></td></tr></table></figure>

<h2 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h2><h3 id="lt-cinit-gt-V"><a href="#lt-cinit-gt-V" class="headerlink" title="&lt;cinit&gt;()V"></a>&lt;cinit&gt;()V</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test2</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> a = <span class="number">10</span>;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        a = <span class="number">20</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        a = <span class="number">30</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>静态变量的赋值操作和静态代码块的内容，最终会被合并成一个操作<br>编译器会按从上向下的顺序，收集所有static几台代码块和静态成员赋值的代码，合并为一个特殊的方法<br><code>&lt;cinit&gt;()V</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: bipush        <span class="number">10</span></span><br><span class="line"><span class="number">2</span>: putstatic     #<span class="number">2</span>                  <span class="comment">// Field a:I</span></span><br><span class="line"><span class="number">5</span>: bipush        <span class="number">20</span></span><br><span class="line"><span class="number">7</span>: putstatic     #<span class="number">2</span>                  <span class="comment">// Field a:I</span></span><br><span class="line"><span class="number">10</span>: bipush        <span class="number">30</span></span><br><span class="line"><span class="number">12</span>: putstatic     #<span class="number">2</span>                  <span class="comment">// Field a:I</span></span><br><span class="line"><span class="number">15</span>: <span class="keyword">return</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;cinit&gt;()V</code> 方法会在类加载的初始化阶段被调用</p>
<h3 id="lt-init-gt-V"><a href="#lt-init-gt-V" class="headerlink" title="&lt;init&gt;()V"></a>&lt;init&gt;()V</h3><p>源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test3</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> String a = <span class="string">&quot;S1&quot;</span>;  </span><br><span class="line">    &#123;  </span><br><span class="line">        b = <span class="number">20</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> b = <span class="number">10</span>;  </span><br><span class="line">    &#123;  </span><br><span class="line">        a = <span class="string">&quot;S2&quot;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test3</span><span class="params">(String a, <span class="keyword">int</span> b)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">this</span>.a = a;  </span><br><span class="line">        <span class="keyword">this</span>.b = b;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        Test3 test3 = <span class="keyword">new</span> Test3(<span class="string">&quot;S3&quot;</span>,<span class="number">30</span>);  </span><br><span class="line">        System.out.println(test3.a);  </span><br><span class="line">        System.out.println(test3.b);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>编译器会按从上到下的顺序，收集所有<code>&#123;&#125;</code>代码块和成员变量赋值的代码，形成新的构造方法，但原始构造方法内的代码总是在最后面<br>先调用父类<code>Object</code>类的<code>&lt;init&gt;</code>方法<br>然后给<code>this.a</code>赋值<code>S1</code><br>然后给<code>this.b</code>赋值为<code>20</code>（并不是先赋值初始化的<code>10</code>，而是处于上面的代码块的<code>20</code>）<br>然后给<code>this.b</code>赋值为<code>10</code><br>给<code>this.a</code>赋值为<code>S2</code><br>然后下面的是原本构造方法里面的代码<br>将局部变量表1号位的数据赋值给<code>this.a</code><br>将局部变量表2号位的数据赋值给<code>this.b</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> com.example.demo1.test1.Test3(java.lang.String, <span class="keyword">int</span>);</span><br><span class="line">   descriptor: (Ljava/lang/String;I)V</span><br><span class="line">   flags: ACC_PUBLIC</span><br><span class="line">   Code:</span><br><span class="line">     stack=<span class="number">2</span>, locals=<span class="number">3</span>, args_size=<span class="number">3</span></span><br><span class="line">        <span class="number">0</span>: aload_0</span><br><span class="line">        <span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">        <span class="number">4</span>: aload_0</span><br><span class="line">        <span class="number">5</span>: ldc           #<span class="number">2</span>                  <span class="comment">// String S1</span></span><br><span class="line">        <span class="number">7</span>: putfield      #<span class="number">3</span>                  <span class="comment">// Field a:Ljava/lang/String;</span></span><br><span class="line">       <span class="number">10</span>: aload_0</span><br><span class="line">       <span class="number">11</span>: bipush        <span class="number">20</span></span><br><span class="line">       <span class="number">13</span>: putfield      #<span class="number">4</span>                  <span class="comment">// Field b:I</span></span><br><span class="line">       <span class="number">16</span>: aload_0</span><br><span class="line">       <span class="number">17</span>: bipush        <span class="number">10</span></span><br><span class="line">       <span class="number">19</span>: putfield      #<span class="number">4</span>                  <span class="comment">// Field b:I</span></span><br><span class="line">       <span class="number">22</span>: aload_0</span><br><span class="line">       <span class="number">23</span>: ldc           #<span class="number">5</span>                  <span class="comment">// String S2</span></span><br><span class="line">       <span class="number">25</span>: putfield      #<span class="number">3</span>                  <span class="comment">// Field a:Ljava/lang/String;</span></span><br><span class="line">       <span class="number">28</span>: aload_0       <span class="comment">//---------------------------------------------------</span></span><br><span class="line">       <span class="number">29</span>: aload_1</span><br><span class="line">       <span class="number">30</span>: putfield      #<span class="number">3</span>                  <span class="comment">// Field a:Ljava/lang/String;</span></span><br><span class="line">       <span class="number">33</span>: aload_0</span><br><span class="line">       <span class="number">34</span>: iload_2</span><br><span class="line">       <span class="number">35</span>: putfield      #<span class="number">4</span>                  <span class="comment">// Field b:I</span></span><br><span class="line">       <span class="number">38</span>: <span class="keyword">return</span></span><br><span class="line">     LineNumberTable:</span><br><span class="line">       line <span class="number">17</span>: <span class="number">0</span></span><br><span class="line">       line <span class="number">8</span>: <span class="number">4</span></span><br><span class="line">       line <span class="number">10</span>: <span class="number">10</span></span><br><span class="line">       line <span class="number">12</span>: <span class="number">16</span></span><br><span class="line">       line <span class="number">14</span>: <span class="number">22</span></span><br><span class="line">       line <span class="number">18</span>: <span class="number">28</span></span><br><span class="line">       line <span class="number">19</span>: <span class="number">33</span></span><br><span class="line">       line <span class="number">20</span>: <span class="number">38</span></span><br><span class="line">   MethodParameters:</span><br><span class="line">     Name                           Flags</span><br><span class="line">     a</span><br><span class="line">     b</span><br></pre></td></tr></table></figure>

<h3 id="方法调用"><a href="#方法调用" class="headerlink" title="方法调用"></a>方法调用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test4</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test4</span><span class="params">()</span> </span>&#123;&#125;  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;&#125;  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;&#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span></span>&#123;&#125;  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span></span>&#123;&#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        Test4 t = <span class="keyword">new</span> Test4();<span class="comment">//调用构造方法  </span></span><br><span class="line">        t.test1();<span class="comment">//调用私有普通方法  </span></span><br><span class="line">        t.test2();<span class="comment">//调用final方法  </span></span><br><span class="line">        t.test3();<span class="comment">//调用公有普通方法  </span></span><br><span class="line">        t.test4();<span class="comment">//通过对象调用静态方法  </span></span><br><span class="line">        Test4.test4();<span class="comment">//通过类名调用静态方法  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通过字节码可以看出，调用<code>构造方法</code>和<code>私有普通方法</code>以及<code>final方法</code>，都是使用的<code>invokespecial</code>指令<br>调用<code>普通公共方法</code>使用的是<code>invokevirtual</code>指令<br>调用<code>静态方法</code>使用的是<code>invokestatic</code>指令</p>
<blockquote>
<p><code>invokespecial</code>：编译时方法绑定调用方法<br><code>invokestatic</code>：调用静态方法<br><code>invokevirtual</code>：运行时方法绑定调用方法<br><code> invokespecial</code>和<code>invokestatic</code>属于静态绑定，在字节码生成的时候，就已经知道需要找到那个类的那个方法了，性能相比之下会更高一点<br><code>invokevirtual</code>并不能在生成字节码的时候就知道调用的是那个类的，因为java多态的原因，方法可能会被重写，有可能调用的是父类的方法，也可能调用的是子类额方法</p>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: <span class="keyword">new</span>           #<span class="number">2</span>                  <span class="comment">// class com/example/demo1/test1/Test4</span></span><br><span class="line"><span class="number">3</span>: dup</span><br><span class="line"><span class="number">4</span>: invokespecial #<span class="number">3</span>                  <span class="comment">// Method &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line"><span class="number">7</span>: astore_1</span><br><span class="line"><span class="number">8</span>: aload_1</span><br><span class="line"><span class="number">9</span>: invokespecial #<span class="number">4</span>                  <span class="comment">// Method test1:()V</span></span><br><span class="line"><span class="number">12</span>: aload_1</span><br><span class="line"><span class="number">13</span>: invokespecial #<span class="number">5</span>                  <span class="comment">// Method test2:()V</span></span><br><span class="line"><span class="number">16</span>: aload_1</span><br><span class="line"><span class="number">17</span>: invokevirtual #<span class="number">6</span>                  <span class="comment">// Method test3:()V</span></span><br><span class="line"><span class="number">20</span>: aload_1</span><br><span class="line"> <span class="number">21</span>: pop</span><br><span class="line"><span class="number">22</span>: invokestatic  #<span class="number">7</span>                  <span class="comment">// Method test4:()V</span></span><br><span class="line"><span class="number">25</span>: invokestatic  #<span class="number">7</span>                  <span class="comment">// Method test4:()V </span></span><br><span class="line"><span class="number">28</span>: <span class="keyword">return</span></span><br></pre></td></tr></table></figure>

<h2 id="多态的原理"><a href="#多态的原理" class="headerlink" title="多态的原理"></a>多态的原理</h2><blockquote>
<p>示例代码如下，内容很简单<br>创建一个<code>Animal</code>的抽象类，他有两个子类实现了他的抽象方法<code>eat()</code><br>之后在<code>test()</code>方法中以父类去调用<code>eat()</code>，<code>main()</code>方法中传入不同的实现</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 演示多态原理，注意加上下面的 JVM 参数，禁止指针压缩  </span></span><br><span class="line"><span class="comment"> * -XX:-UseCompressedOops -XX:UseCompressedClassPointers  </span></span><br><span class="line"><span class="comment"> */</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test5</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(Animal animal)</span></span>&#123;  </span><br><span class="line">        animal.eat();  </span><br><span class="line">        System.out.println(animal.toString());  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;  </span><br><span class="line">        test(<span class="keyword">new</span> Dog());  </span><br><span class="line">        test(<span class="keyword">new</span> Cat());  </span><br><span class="line">        System.in.read();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span>;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我是&quot;</span>+<span class="keyword">this</span>.getClass().getSimpleName();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;啃骨头&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;吃鱼&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><ul>
<li>在方法启动的时候需要添加以下参数，禁止虚拟机自动压缩指针<ul>
<li><code>-XX:-UseCompressedOops -XX:-UseCompressedClassPointers </code></li>
</ul>
</li>
<li>使用<code>System.in.read();</code>暂停程序，然后使用<code>jps</code>命令获取进程id</li>
<li>运行HSDB工具<ul>
<li>进入JDK安装目录，执行下面的命令：</li>
<li><code>java -cp ./lib/sa-jdi.jar sun.jvm.hotspot.HSDB</code></li>
<li>进入图形界面输入程序的进程id</li>
</ul>
</li>
<li>打开图形界面，点击file再点击<code>Attach to HotSpot...</code>，之后输入进程id，就会连上当前进程</li>
<li>然后点击<code>Tools</code>，再点击<code>Find Object by Query</code>，之后输入查询语句，类似于sql语句<ul>
<li><code>select + 别名 + from + 需要查询的类的全限定名 + 别名</code></li>
<li>如：<code>select d from com.example.demo1.test1.Dog d</code><br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220827200010149.png"></li>
</ul>
</li>
<li>如下图所示，可以在<code>Inspector</code>框里面查看对象的相关信息，不过这些并不是对象的真正信息</li>
<li>点击标记1处，会弹出标记2处的框，然后使用mem指令查看对象头信息的地址信息</li>
<li><code>mem</code>命令后面跟随的是标记3处的地址信息，后面的2表示要查看几个mark word<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220827201110213.png"></li>
<li>在标记1处敲击回车，就会显示出类型的指针</li>
<li>然后再在<code>Tools</code>处打开一个<code>Inspector</code>框，使用刚刚查出来的类型指针查询</li>
<li>如标记2处，就是对象在虚拟机中完整的类型表示<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220827201623999.png"></li>
<li>类的多态方法都存在一个<code>vtable</code>表中，也就是最后一行箭头所指的位置</li>
<li><code>vtable</code>的和当前类型指针的偏移量是<code>1b8</code>，所以只需要以16进制将当前指针地址加上<code>1b8</code>就可以得到<code>vtable</code>的地址<ul>
<li><code>0x000000001c7c3ca0 + 1b8 = 0x000000001c7c3e58</code></li>
</ul>
</li>
<li>下面就是执行<code>mem</code>指令，从上面第二张图可以看到<code>vtable_len=6</code>，所以查6个mark<ul>
<li><code>eme 0x000000001c7c3e58 6</code><br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220827202159236.png"></li>
</ul>
</li>
<li>如图所示，查询出对应的work，一共有六个，<code>Dog</code>类对应的多态方法</li>
<li>可以通过<code>Class Browser</code>查询<code>Dog</code>类，对应一下这六个方法</li>
<li>从图中可以看出，<code>0x000000001c453c48</code> 对应的是<code>cat()</code>方法<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220827220420879.png"></li>
<li>如图所示，<code>0x000000001c453768</code> 对应的是<code>Dog</code>类的父类<code>Animal</code>类的<code>toString()</code>方法</li>
<li><code> toString()</code>方法也是一个多态方法，只不过<code>Dog</code>并没有重写这个方法，所以使用的是父类的方法<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220827220754264.png"></li>
<li>剩下的四个方法均来自<code>Animal</code>的父类<code>Object</code>，对应关系如下图所示</li>
<li><code>finalize()</code>：该方法并没有在<code>Animal</code>和<code>Dog</code>类中重写，所以使用的是所有类的超类<code>Object</code>类的</li>
<li><code>equals()</code>：该方法同样没有重写，使用的也是<code>Object</code>中的</li>
<li><code> hashCode()</code>：同样使用的是<code>Object</code>中的</li>
<li><code> clone()</code>：同样使用的是<code>Object</code>中的<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220827221154955.png"></li>
<li>虚方法表是在类加载链接阶段就会诞生的，所以就是说在类链接阶段，就已经配置好了每个方法需要调用的具体实现</li>
</ul>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>执行<code>invokevirtual</code>指令时</p>
<ul>
<li>先通过栈帧中的对象引用找到对象</li>
<li>分析对象头，找到对象的实际 <code>Class</code></li>
<li><code>Class</code> 结构中有 <code>vtable</code>，它在类加载的<code>链接阶段</code>就已经根据方法的重写规划生成好了</li>
<li>查表的到方法的具体地址</li>
<li>执行方法中的字节码</li>
</ul>
<h2 id="异常梳理"><a href="#异常梳理" class="headerlink" title="异常梳理"></a>异常梳理</h2><h3 id="try-catch"><a href="#try-catch" class="headerlink" title="try-catch"></a>try-catch</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test6</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            a = <span class="number">10</span>;  </span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;  </span><br><span class="line">            a = <span class="number">20</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>从下面的字节码中可以看出：</p>
<blockquote>
<p>0值入栈，然后放入局部变量表中，然后数值10入栈，然后赋值给局部变量表1号位，然后<code>goto</code>到12行<br>如果没有异常，那么执行到5行后就会跳转到12行结束</p>
</blockquote>
<p>不过可以看出，多出来了一个<code>Exception table</code>的结构，<code>[from，to)</code>是前闭后开的检测范围，一旦这个范围内的字节码执行出现了异常，则通过<code>type</code>匹配异常类型，如果一致则进入<code>target</code>所指示的行号<br>8行的字节码指令<code>astore_2</code>是将异常对象引用存入局部变量表的2号位</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[])</span></span>;</span><br><span class="line">  descriptor: ([Ljava/lang/String;)V</span><br><span class="line">  flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">  Code:</span><br><span class="line">    stack=<span class="number">1</span>, locals=<span class="number">3</span>, args_size=<span class="number">1</span></span><br><span class="line">       <span class="number">0</span>: iconst_0</span><br><span class="line">       <span class="number">1</span>: istore_1</span><br><span class="line">       <span class="number">2</span>: bipush        <span class="number">10</span></span><br><span class="line">       <span class="number">4</span>: istore_1</span><br><span class="line">       <span class="number">5</span>: goto          <span class="number">12</span></span><br><span class="line">       <span class="number">8</span>: astore_2</span><br><span class="line">       <span class="number">9</span>: bipush        <span class="number">20</span></span><br><span class="line">      <span class="number">11</span>: istore_1</span><br><span class="line">      <span class="number">12</span>: <span class="keyword">return</span></span><br><span class="line">    Exception table:</span><br><span class="line">       from    to  target type</span><br><span class="line">           <span class="number">2</span>     <span class="number">5</span>     <span class="number">8</span>   Class java/lang/Exception</span><br><span class="line">    LineNumberTable:</span><br><span class="line">      line <span class="number">9</span>: <span class="number">0</span></span><br><span class="line">      line <span class="number">11</span>: <span class="number">2</span></span><br><span class="line">      line <span class="number">14</span>: <span class="number">5</span></span><br><span class="line">      line <span class="number">12</span>: <span class="number">8</span></span><br><span class="line">      line <span class="number">13</span>: <span class="number">9</span></span><br><span class="line">      line <span class="number">15</span>: <span class="number">12</span></span><br><span class="line">    LocalVariableTable:</span><br><span class="line">      Start  Length  Slot  Name   Signature</span><br><span class="line">          <span class="number">9</span>       <span class="number">3</span>     <span class="number">2</span>     e   Ljava/lang/Exception;</span><br><span class="line">          <span class="number">0</span>      <span class="number">13</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">          <span class="number">2</span>      <span class="number">11</span>     <span class="number">1</span>     a   I</span><br><span class="line">    StackMapTable: number_of_entries = <span class="number">2</span></span><br><span class="line">      frame_type = <span class="number">255</span> <span class="comment">/* full_frame */</span></span><br><span class="line">        offset_delta = <span class="number">8</span></span><br><span class="line">        locals = [ <span class="class"><span class="keyword">class</span> &quot;[<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span></span>;<span class="string">&quot;, int ]</span></span><br><span class="line"><span class="string">        stack = [ class java/lang/Exception ]</span></span><br><span class="line"><span class="string">      frame_type = 3 /* same */</span></span><br><span class="line"><span class="string">  MethodParameters:</span></span><br><span class="line"><span class="string">    Name                           Flags</span></span><br><span class="line"><span class="string">    args</span></span><br></pre></td></tr></table></figure>

<h3 id="多个catch块的情况-single-catch"><a href="#多个catch块的情况-single-catch" class="headerlink" title="多个catch块的情况(single-catch)"></a>多个catch块的情况(single-catch)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test7</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            a = <span class="number">10</span>;  </span><br><span class="line">        &#125;<span class="keyword">catch</span> (ArithmeticException e)&#123;  </span><br><span class="line">            a = <span class="number">30</span>;  </span><br><span class="line">        &#125;<span class="keyword">catch</span> (NullPointerException e)&#123;  </span><br><span class="line">            a = <span class="number">40</span>;  </span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;  </span><br><span class="line">            a = <span class="number">50</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>从编译出的字节码中可以看出，多个<code>catch</code>一样都是监控的第2到5行字节码（不包含5）<br>区别在于后面的<code>type</code>，会根据<code>type</code>匹配到不同的异常之后，进行不同的跳转行（根据target判断跳转到哪一行）</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[])</span></span>;</span><br><span class="line">  descriptor: ([Ljava/lang/String;)V</span><br><span class="line">  flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">  Code:</span><br><span class="line">    stack=<span class="number">1</span>, locals=<span class="number">3</span>, args_size=<span class="number">1</span></span><br><span class="line">       <span class="number">0</span>: iconst_0</span><br><span class="line">       <span class="number">1</span>: istore_1</span><br><span class="line">       <span class="number">2</span>: bipush        <span class="number">10</span></span><br><span class="line">       <span class="number">4</span>: istore_1</span><br><span class="line">       <span class="number">5</span>: goto          <span class="number">26</span></span><br><span class="line">       <span class="number">8</span>: astore_2</span><br><span class="line">       <span class="number">9</span>: bipush        <span class="number">30</span></span><br><span class="line">      <span class="number">11</span>: istore_1</span><br><span class="line">      <span class="number">12</span>: goto          <span class="number">26</span></span><br><span class="line">      <span class="number">15</span>: astore_2</span><br><span class="line">      <span class="number">16</span>: bipush        <span class="number">40</span></span><br><span class="line">      <span class="number">18</span>: istore_1</span><br><span class="line">      <span class="number">19</span>: goto          <span class="number">26</span></span><br><span class="line">      <span class="number">22</span>: astore_2</span><br><span class="line">      <span class="number">23</span>: bipush        <span class="number">50</span></span><br><span class="line">      <span class="number">25</span>: istore_1</span><br><span class="line">      <span class="number">26</span>: <span class="keyword">return</span></span><br><span class="line">    Exception table:</span><br><span class="line">       from    to  target type</span><br><span class="line">           <span class="number">2</span>     <span class="number">5</span>     <span class="number">8</span>   Class java/lang/ArithmeticException</span><br><span class="line">           <span class="number">2</span>     <span class="number">5</span>    <span class="number">15</span>   Class java/lang/NullPointerException</span><br><span class="line">           <span class="number">2</span>     <span class="number">5</span>    <span class="number">22</span>   Class java/lang/Exception</span><br><span class="line">    LineNumberTable:</span><br><span class="line">      line <span class="number">9</span>: <span class="number">0</span></span><br><span class="line">      line <span class="number">11</span>: <span class="number">2</span></span><br><span class="line">      line <span class="number">18</span>: <span class="number">5</span></span><br><span class="line">      line <span class="number">12</span>: <span class="number">8</span></span><br><span class="line">      line <span class="number">13</span>: <span class="number">9</span></span><br><span class="line">      line <span class="number">18</span>: <span class="number">12</span></span><br><span class="line">      line <span class="number">14</span>: <span class="number">15</span></span><br><span class="line">      line <span class="number">15</span>: <span class="number">16</span></span><br><span class="line">      line <span class="number">18</span>: <span class="number">19</span></span><br><span class="line">      line <span class="number">16</span>: <span class="number">22</span></span><br><span class="line">      line <span class="number">17</span>: <span class="number">23</span></span><br><span class="line">      line <span class="number">19</span>: <span class="number">26</span></span><br><span class="line">    LocalVariableTable:</span><br><span class="line">      Start  Length  Slot  Name   Signature</span><br><span class="line">          <span class="number">9</span>       <span class="number">3</span>     <span class="number">2</span>     e   Ljava/lang/ArithmeticException;</span><br><span class="line">         <span class="number">16</span>       <span class="number">3</span>     <span class="number">2</span>     e   Ljava/lang/NullPointerException;</span><br><span class="line">      frame_type = <span class="number">70</span> <span class="comment">/* same_locals_1_stack_item */</span></span><br><span class="line">        stack = [ <span class="class"><span class="keyword">class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Exception</span> ]</span></span><br><span class="line"><span class="class">      <span class="title">frame_type</span> </span>= <span class="number">3</span> <span class="comment">/* same */</span></span><br><span class="line">  MethodParameters:</span><br><span class="line">    Name                           Flags</span><br><span class="line">    args</span><br></pre></td></tr></table></figure>

<h3 id="multi-catch的情况"><a href="#multi-catch的情况" class="headerlink" title="multi-catch的情况"></a>multi-catch的情况</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test8</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Method test = Test8.class.getMethod(<span class="string">&quot;test&quot;</span>);  </span><br><span class="line">            test.invoke(<span class="keyword">null</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException | NoSuchMethodException | IllegalAccessException e) &#123;  </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;OK&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>编译后的字节码如下所示：<br>三个异常监控的范围都是<code>0-22</code>，然后根据<code>type</code>去进行匹配，如果匹配到了就会跳转到<code>25</code>行<br>和多个<code>catch</code>块的形式唯一的区别就是匹配到异常之后跳转的位置是相同的</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[])</span></span>;</span><br><span class="line">  descriptor: ([Ljava/lang/String;)V</span><br><span class="line">  flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">  Code:</span><br><span class="line">    stack=<span class="number">3</span>, locals=<span class="number">2</span>, args_size=<span class="number">1</span></span><br><span class="line">       <span class="number">0</span>: ldc           #<span class="number">2</span>                  <span class="comment">// class com/example/demo1/test1/Test8</span></span><br><span class="line">       <span class="number">2</span>: ldc           #<span class="number">3</span>                  <span class="comment">// String test</span></span><br><span class="line">       <span class="number">4</span>: iconst_0</span><br><span class="line">       <span class="number">5</span>: anewarray     #<span class="number">4</span>                  <span class="comment">// class java/lang/Class</span></span><br><span class="line">       <span class="number">8</span>: invokevirtual #<span class="number">5</span>                  <span class="comment">// Method java/lang/Class.getMethod:(Ljava/lang/String;[Ljava/lang/Class;)Ljava/lang/reflect/Method;</span></span><br><span class="line">      <span class="number">11</span>: astore_1</span><br><span class="line">      <span class="number">12</span>: aload_1</span><br><span class="line">      <span class="number">13</span>: aconst_null</span><br><span class="line">      <span class="number">14</span>: iconst_0</span><br><span class="line">      <span class="number">15</span>: anewarray     #<span class="number">6</span>                  <span class="comment">// class java/lang/Object</span></span><br><span class="line">      <span class="number">18</span>: invokevirtual #<span class="number">7</span>                  <span class="comment">// Method java/lang/reflect/Method.invoke:(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object;</span></span><br><span class="line">      <span class="number">21</span>: pop</span><br><span class="line">      <span class="number">22</span>: goto          <span class="number">35</span></span><br><span class="line">      <span class="number">25</span>: astore_1</span><br><span class="line">      <span class="number">26</span>: <span class="keyword">new</span>           #<span class="number">11</span>                 <span class="comment">// class java/lang/RuntimeException</span></span><br><span class="line">      <span class="number">29</span>: dup</span><br><span class="line">      <span class="number">30</span>: aload_1</span><br><span class="line">      <span class="number">31</span>: invokespecial #<span class="number">12</span>                 <span class="comment">// Method java/lang/RuntimeException.&quot;&lt;init&gt;&quot;:(Ljava/lang/Throwable;)V</span></span><br><span class="line">      <span class="number">34</span>: athrow</span><br><span class="line">      <span class="number">35</span>: <span class="keyword">return</span></span><br><span class="line">    Exception table:</span><br><span class="line">       from    to  target type</span><br><span class="line">           <span class="number">0</span>    <span class="number">22</span>    <span class="number">25</span>   Class java/lang/reflect/InvocationTargetException</span><br><span class="line">           <span class="number">0</span>    <span class="number">22</span>    <span class="number">25</span>   Class java/lang/NoSuchMethodException</span><br><span class="line">           <span class="number">0</span>    <span class="number">22</span>    <span class="number">25</span>   Class java/lang/IllegalAccessException</span><br><span class="line">    LineNumberTable:</span><br><span class="line">      line <span class="number">13</span>: <span class="number">0</span></span><br><span class="line">      line <span class="number">14</span>: <span class="number">12</span></span><br><span class="line">      line <span class="number">17</span>: <span class="number">22</span></span><br><span class="line">      line <span class="number">15</span>: <span class="number">25</span></span><br><span class="line">      line <span class="number">16</span>: <span class="number">26</span></span><br><span class="line">      line <span class="number">18</span>: <span class="number">35</span></span><br><span class="line">    LocalVariableTable:</span><br><span class="line">      Start  Length  Slot  Name   Signature</span><br><span class="line">         <span class="number">12</span>      <span class="number">10</span>     <span class="number">1</span>  test   Ljava/lang/reflect/Method;</span><br><span class="line">       <span class="number">3</span>: ldc           #<span class="number">14</span>                 <span class="comment">// String OK</span></span><br><span class="line">       <span class="number">5</span>: invokevirtual #<span class="number">15</span>                 <span class="comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">       <span class="number">8</span>: <span class="keyword">return</span></span><br><span class="line">    LineNumberTable:</span><br><span class="line">      line <span class="number">20</span>: <span class="number">0</span></span><br><span class="line">      line <span class="number">21</span>: <span class="number">8</span></span><br></pre></td></tr></table></figure>

<h3 id="finally"><a href="#finally" class="headerlink" title="finally"></a>finally</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test9</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            a = <span class="number">10</span>;  </span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;  </span><br><span class="line">            a = <span class="number">20</span>;  </span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;  </span><br><span class="line">            a = <span class="number">30</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>从下面的字节码中可以看出，<code>finally</code>的代码块其实就是在编译的时候复制到每一个代码块的最后位置<br>如，<code>try</code>，最后两行的字节码就是<code>finally</code>里面的内容<br><code>catch</code>里面的也是一样<br>不过从异常表中可以看出，多了两个<code>any</code>的异常监控，<code>any</code>表示所有异常<br><code>any</code>监控<code>2-5</code>行，则是为了防止有超出<code>Exception</code>的异常发生，比如<code>Exception</code>的父类或者兄弟类<br>监控<code>11-15</code>行，这时为了防止执行<code>Exception</code>的<code>catch</code>块的时候再发生异常<br>通过字节码来控制，保证每一块代码块跳转之前都会执行<code>finally</code>里面的异常，即便是发生了未知的异常，也能够跳转到<code>finally</code>的代码块中执行<br>整个字节码一共有三个分支：</p>
<blockquote>
<p>1.try分支<br>2.catch分支<br>3.catch没有匹配到的异常的分支（最后会把异常再上抛）</p>
</blockquote>
<p>如果在<code>finally</code>中<code>return</code>，将会吞掉代码块中的异常</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[])</span></span>;</span><br><span class="line">  descriptor: ([Ljava/lang/String;)V</span><br><span class="line">  flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">  Code:</span><br><span class="line">    stack=<span class="number">1</span>, locals=<span class="number">4</span>, args_size=<span class="number">1</span></span><br><span class="line">       <span class="number">0</span>: iconst_0</span><br><span class="line">       <span class="number">1</span>: istore_1             <span class="comment">// 0 -&gt; a</span></span><br><span class="line">       <span class="number">2</span>: bipush        <span class="number">10</span>     <span class="comment">// try ---------------------------</span></span><br><span class="line">       <span class="number">4</span>: istore_1             <span class="comment">// 10 -&gt; a                       |</span></span><br><span class="line">       <span class="number">5</span>: bipush        <span class="number">30</span>     <span class="comment">// finally                       |</span></span><br><span class="line">       <span class="number">7</span>: istore_1             <span class="comment">// 30 -&gt; a                       |</span></span><br><span class="line">       <span class="number">8</span>: goto          <span class="number">27</span>     <span class="comment">// return-------------------------</span></span><br><span class="line">      <span class="number">11</span>: astore_2             <span class="comment">// catch Exception -&gt; e-----------</span></span><br><span class="line">      <span class="number">12</span>: bipush        <span class="number">20</span>     <span class="comment">//                               |</span></span><br><span class="line">      <span class="number">14</span>: istore_1             <span class="comment">// 20 -&gt; a                       |</span></span><br><span class="line">      <span class="number">15</span>: bipush        <span class="number">30</span>     <span class="comment">// finally                       |</span></span><br><span class="line">      <span class="number">17</span>: istore_1             <span class="comment">// 30 -&gt; a                       |</span></span><br><span class="line">      <span class="number">18</span>: goto          <span class="number">27</span>     <span class="comment">// return-------------------------</span></span><br><span class="line">      <span class="number">21</span>: astore_3             <span class="comment">// catch any -&gt; slot 3 -----------</span></span><br><span class="line">      <span class="number">22</span>: bipush        <span class="number">30</span>     <span class="comment">// finally                       |</span></span><br><span class="line">      <span class="number">24</span>: istore_1             <span class="comment">// 30 -&gt; a                       |</span></span><br><span class="line">      <span class="number">25</span>: aload_3              <span class="comment">// &lt;- slot 3                     |</span></span><br><span class="line">      <span class="number">26</span>: athrow               <span class="comment">// throw--------------------------</span></span><br><span class="line">      <span class="number">27</span>: <span class="keyword">return</span></span><br><span class="line">    Exception table:</span><br><span class="line">       from    to  target type</span><br><span class="line">           <span class="number">2</span>     <span class="number">5</span>    <span class="number">11</span>   Class java/lang/Exception</span><br><span class="line">           <span class="number">2</span>     <span class="number">5</span>    <span class="number">21</span>   any</span><br><span class="line">          <span class="number">11</span>    <span class="number">15</span>    <span class="number">21</span>   any</span><br><span class="line">    LineNumberTable:</span><br><span class="line">      line <span class="number">9</span>: <span class="number">0</span></span><br><span class="line">      line <span class="number">11</span>: <span class="number">2</span></span><br><span class="line">      line <span class="number">15</span>: <span class="number">5</span></span><br><span class="line">      line <span class="number">16</span>: <span class="number">8</span></span><br><span class="line">      line <span class="number">12</span>: <span class="number">11</span></span><br><span class="line">      frame_type = <span class="number">73</span> <span class="comment">/* same_locals_1_stack_item */</span></span><br><span class="line">        stack = [ <span class="class"><span class="keyword">class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Throwable</span> ]</span></span><br><span class="line"><span class="class">      <span class="title">frame_type</span> </span>= <span class="number">5</span> <span class="comment">/* same */</span></span><br><span class="line">  MethodParameters:</span><br><span class="line">    Name                           Flags</span><br><span class="line">    args</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        Object lock = <span class="keyword">new</span> Object();  </span><br><span class="line">        <span class="keyword">synchronized</span> (lock)&#123;  </span><br><span class="line">            System.out.println(<span class="string">&quot;OK&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>字节码如下所示，其实和finally的字节码类似<br>会将一份普通代码分为两个分支，一个是正常结束的分支，一个是异常结束的分支，无论在哪个分支上，都会复制一份解锁的字节码，以保证加锁后肯定能够解锁</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[])</span></span>;</span><br><span class="line">  descriptor: ([Ljava/lang/String;)V</span><br><span class="line">  flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">  Code:</span><br><span class="line">    stack=<span class="number">2</span>, locals=<span class="number">4</span>, args_size=<span class="number">1</span></span><br><span class="line">       <span class="number">0</span>: <span class="keyword">new</span>           #<span class="number">2</span>                  <span class="comment">// class java/lang/Object</span></span><br><span class="line">       <span class="number">3</span>: dup</span><br><span class="line">       <span class="number">4</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">       <span class="number">7</span>: astore_1</span><br><span class="line">       <span class="number">8</span>: aload_1</span><br><span class="line">       <span class="number">9</span>: dup</span><br><span class="line">      <span class="number">10</span>: astore_2</span><br><span class="line">      <span class="number">11</span>: monitorenter</span><br><span class="line">      <span class="number">12</span>: getstatic     #<span class="number">3</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">      <span class="number">15</span>: ldc           #<span class="number">4</span>                  <span class="comment">// String OK</span></span><br><span class="line">      <span class="number">17</span>: invokevirtual #<span class="number">5</span>                  <span class="comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">      <span class="number">20</span>: aload_2</span><br><span class="line">      <span class="number">21</span>: monitorexit</span><br><span class="line">      <span class="number">22</span>: goto          <span class="number">30</span></span><br><span class="line">      <span class="number">25</span>: astore_3</span><br><span class="line">      <span class="number">26</span>: aload_2</span><br><span class="line">      <span class="number">27</span>: monitorexit</span><br><span class="line">      <span class="number">28</span>: aload_3</span><br><span class="line">      <span class="number">29</span>: athrow</span><br><span class="line">    StackMapTable: number_of_entries = <span class="number">2</span></span><br><span class="line">      frame_type = <span class="number">255</span> <span class="comment">/* full_frame */</span></span><br><span class="line">        offset_delta = <span class="number">25</span></span><br><span class="line">        locals = [ <span class="class"><span class="keyword">class</span> &quot;[<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span></span>;<span class="string">&quot;, class java/lang/Object, class java/lang/Object ]</span></span><br><span class="line"><span class="string">        stack = [ class java/lang/Throwable ]</span></span><br><span class="line"><span class="string">      frame_type = 250 /* chop */</span></span><br><span class="line"><span class="string">        offset_delta = 4</span></span><br><span class="line"><span class="string">  MethodParameters:</span></span><br><span class="line"><span class="string">    Name                           Flags</span></span><br><span class="line"><span class="string">    args</span></span><br></pre></td></tr></table></figure>


<h1 id="编译期处理"><a href="#编译期处理" class="headerlink" title="编译期处理"></a>编译期处理</h1><blockquote>
<p>所谓的语法糖，其实就是指<code>java</code> 编译器把<code>*.java</code>源代码编译为<code>*.class</code>字节码的过程中，自动生成和转换的一些代码，主要是为了减轻程序员的负担，算是<code>java</code>编译器给我们的一个额外福利<br>注意：以下代码的分析，借助了<code>javap</code>工具，idea的反编译功能，idea插件<code>jclasslib</code>等工具。另外，编译器转换的结果直接就是class字节码，只是为了便于阅读，给出了几乎等价的java源码方式，并不是编译器还会转换出中间的java源码，切记。</p>
</blockquote>
<h2 id="默认构造器"><a href="#默认构造器" class="headerlink" title="默认构造器"></a>默认构造器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> </span>&#123;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>编译成class之后：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> </span>&#123;  </span><br><span class="line">    <span class="comment">//这个无参构造器就是编译器帮助我们加上的</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test1</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">	    <span class="comment">//即调用父类Object的无参构造，调用java/lang/Object.&lt;init&gt;:()V</span></span><br><span class="line">	    <span class="keyword">super</span>();</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="自动拆装箱"><a href="#自动拆装箱" class="headerlink" title="自动拆装箱"></a>自动拆装箱</h2><ul>
<li>这个特性是JDk5开始加入的，代码片段1：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test2</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        Integer x = <span class="number">1</span>;  </span><br><span class="line">        <span class="keyword">int</span> y = x;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>在JDK5之前按照上面这样写是无法进行编译的，必须写成下面代码片段2的形式：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test2</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        Integer x = Integer.valueOf(<span class="number">1</span>);  </span><br><span class="line">        <span class="keyword">int</span> y = x.intValue();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="泛型集合取值"><a href="#泛型集合取值" class="headerlink" title="泛型集合取值"></a>泛型集合取值</h2><ul>
<li>泛型也是在JDK5开始加入的特性，但java在编译泛型代码后，会执行泛型擦除的动作，即泛型信息在编译为字节码之后就丢失了，实际的类型都是当做了Object类型来处理的</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test3</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();  </span><br><span class="line">        list.add(<span class="number">10</span>);<span class="comment">//实际调用的List.add(Object o)  </span></span><br><span class="line">        Integer x = list.get(<span class="number">0</span>);<span class="comment">//实际调用的是Object o = List.get(int index);  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>所以在取值时，编译器真正生成的字节码中，还要额外做一个类型转换操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//需要将 Object 转换成 Integer</span></span><br><span class="line">Integer x = (Integer)list.get(<span class="number">0</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>如果前面的x变量类型修改为int基本类型，那么最终生成的字节码是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//需要将 Object 转换成 Integer ,并执行拆箱操作</span></span><br><span class="line"><span class="keyword">int</span> x = (Integer)list.get(<span class="number">0</span>).intValue();</span><br></pre></td></tr></table></figure></li>
<li><p>下面是编译之后的字节码</p>
<ul>
<li>第11行对应的就是<code>list.add(10)</code>，因为<code>list</code>要放的是包装类型，<code>10</code>是基本类型，所以先调用了<code>Integer.valueOf()</code>方法把<code>10</code>转换成了<code>Integer</code>类型</li>
<li>第14行可以看到，其实调用的就是<code>list.add(Object o)</code>方法，并没有泛型的类型</li>
<li>第22行也可以看到，获取数据调用的<code>List.get()</code>的返回值也是一个<code>Object</code>类型</li>
<li>第27行，<code>checkcast</code>表示强转，将<code>get</code>的<code>Object</code>类型强转成<code>Integer</code>类型</li>
</ul>
</li>
<li><p>泛型擦除掉的是字节码上的泛型信息，可以看到<code>LocalVariableTypeTable</code>仍然保留了方法参数泛型的信息</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[])</span></span>;</span><br><span class="line">  descriptor: ([Ljava/lang/String;)V</span><br><span class="line">  flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">  Code:</span><br><span class="line">    stack=<span class="number">2</span>, locals=<span class="number">3</span>, args_size=<span class="number">1</span></span><br><span class="line">       <span class="number">0</span>: <span class="keyword">new</span>           #<span class="number">2</span>                  <span class="comment">// class java/util/ArrayList</span></span><br><span class="line">       <span class="number">3</span>: dup</span><br><span class="line">       <span class="number">4</span>: invokespecial #<span class="number">3</span>                  <span class="comment">// Method java/util/ArrayList.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">       <span class="number">7</span>: astore_1</span><br><span class="line">       <span class="number">8</span>: aload_1</span><br><span class="line">       <span class="number">9</span>: bipush        <span class="number">10</span></span><br><span class="line">      <span class="number">11</span>: invokestatic  #<span class="number">4</span>                  <span class="comment">// Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;</span></span><br><span class="line">      <span class="number">14</span>: invokeinterface #<span class="number">5</span>,  <span class="number">2</span>            <span class="comment">// InterfaceMethod java/util/List.add:(Ljava/lang/Object;)Z</span></span><br><span class="line">      <span class="number">19</span>: pop</span><br><span class="line">      <span class="number">20</span>: aload_1</span><br><span class="line">      <span class="number">21</span>: iconst_0</span><br><span class="line">      <span class="number">22</span>: invokeinterface #<span class="number">6</span>,  <span class="number">2</span>            <span class="comment">// InterfaceMethod java/util/List.get:(I)Ljava/lang/Object;</span></span><br><span class="line">      <span class="number">27</span>: checkcast     #<span class="number">7</span>                  <span class="comment">// class java/lang/Integer</span></span><br><span class="line">      <span class="number">30</span>: astore_2</span><br><span class="line">      <span class="number">31</span>: <span class="keyword">return</span></span><br><span class="line">    LineNumberTable:</span><br><span class="line">      line <span class="number">12</span>: <span class="number">0</span></span><br><span class="line">      line <span class="number">13</span>: <span class="number">8</span></span><br><span class="line">      line <span class="number">14</span>: <span class="number">20</span></span><br><span class="line">      line <span class="number">15</span>: <span class="number">31</span></span><br><span class="line">    LocalVariableTable:</span><br><span class="line">      Start  Length  Slot  Name   Signature</span><br><span class="line">          <span class="number">0</span>      <span class="number">32</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">          <span class="number">8</span>      <span class="number">24</span>     <span class="number">1</span>  list   Ljava/util/List;</span><br><span class="line">         <span class="number">31</span>       <span class="number">1</span>     <span class="number">2</span>     x   Ljava/lang/Integer;</span><br><span class="line">    LocalVariableTypeTable:</span><br><span class="line">      Start  Length  Slot  Name   Signature</span><br><span class="line">          <span class="number">8</span>      <span class="number">24</span>     <span class="number">1</span>  list   Ljava/util/List&lt;Ljava/lang/Integer;&gt;;</span><br><span class="line">  MethodParameters:</span><br><span class="line">    Name                           Flags</span><br><span class="line">    args</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>方法上的泛型信息，可以通过反射 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;Integer&gt; <span class="title">test</span><span class="params">(List&lt;String&gt; list, Map&lt;Integer,Object&gt; map)</span></span>&#123;<span class="keyword">return</span> <span class="keyword">null</span>;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    Method test = Test4.class.getMethod(<span class="string">&quot;test&quot;</span>,List.class,Map.class);  </span><br><span class="line">    Type[] types = test.getGenericParameterTypes();  </span><br><span class="line">    <span class="keyword">for</span> (Type type : types) &#123;  </span><br><span class="line">        <span class="keyword">if</span> (type <span class="keyword">instanceof</span> ParameterizedType)&#123;  </span><br><span class="line">            ParameterizedType parameterizedType = (ParameterizedType)type;  </span><br><span class="line">            System.out.println(<span class="string">&quot;原始类型 - &quot;</span>+parameterizedType.getRawType());  </span><br><span class="line">            Type[] arguments = parameterizedType.getActualTypeArguments();  </span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arguments.length; i++) &#123;  </span><br><span class="line">                System.out.printf(<span class="string">&quot;泛型参数【%d】-%s\n&quot;</span>,i,arguments[i]);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">原始类型 - interface java.util.List</span><br><span class="line">泛型参数【0】-class java.lang.String</span><br><span class="line">原始类型 - interface java.util.Map</span><br><span class="line">泛型参数【0】-class java.lang.Integer</span><br><span class="line">泛型参数【1】-class java.lang.Object</span><br></pre></td></tr></table></figure>

<h2 id="可变参数"><a href="#可变参数" class="headerlink" title="可变参数"></a>可变参数</h2><ul>
<li><p>可变参数也是JDk5开始加入的新特性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test5</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(String... args)</span></span>&#123;  </span><br><span class="line">        String[] array = args;<span class="comment">//直接赋值  </span></span><br><span class="line">        System.out.println(array);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        foo(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;world&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>可变参数<code>String... args</code>其实就是一个<code>String[] args</code>，从代码中的赋值语句就可以看出来</p>
</li>
<li><p>同样java编译会在编译期间将上述代码转换为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test5</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(String[] args)</span></span>&#123;  </span><br><span class="line">        String[] array = args;<span class="comment">//直接赋值  </span></span><br><span class="line">        System.out.println(array);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        foo(<span class="keyword">new</span> String[]&#123;<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;world&quot;</span>&#125;);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>注意</strong>：<br>如果调用了<code>foo()</code>无参，则等价代码为<code>foo(new String[]&#123;&#125;)</code>，创建了一个空的数组，而不会传递<code>null</code>进去</p>
<h2 id="foreach循环"><a href="#foreach循环" class="headerlink" title="foreach循环"></a>foreach循环</h2><ul>
<li><p>在JDK5开始引入的语法糖，数组循环：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test6</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">int</span>[] array = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;<span class="comment">//数组赋值的简化写法，也是语法糖  </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i : array) &#123;  </span><br><span class="line">            System.out.println(i);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>会被编译转换为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test6</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">int</span>[] array = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length(); i++) &#123;</span><br><span class="line">	        <span class="keyword">int</span> e = array[i];  </span><br><span class="line">            System.out.println(e);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>而集合的循环：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test7</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);  </span><br><span class="line">        <span class="keyword">for</span> (Integer i : list) &#123;  </span><br><span class="line">            System.out.println(i);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>实际会被编译器转换为迭代器调用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test7</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);  </span><br><span class="line">        Iterator var2 = list.iterator();  </span><br><span class="line">        <span class="keyword">while</span>(var2.hasNext()) &#123;  </span><br><span class="line">            Integer i = (Integer)var2.next();  </span><br><span class="line">            System.out.println(i);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：<br><code>foreach</code>循环写法，能够配合数组，以及所有实现了<code>Iterable</code>接口的集合类一起使用，其中<code>Iterable</code>用来获取集合的迭代器(<code>Iterable</code>)</p>
<h2 id="switch-字符串"><a href="#switch-字符串" class="headerlink" title="switch 字符串"></a>switch 字符串</h2><ul>
<li>从JDK7开始，switch可以用于字符串和枚举类，这个功能其实也是语法糖，例如：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test8</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">choose</span><span class="params">(String str)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">switch</span> (str) &#123;  </span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;hello&quot;</span>:  </span><br><span class="line">                System.out.println(<span class="string">&quot;H&quot;</span>);  </span><br><span class="line">                <span class="keyword">break</span>;            <span class="keyword">case</span> <span class="string">&quot;world&quot;</span>:  </span><br><span class="line">                System.out.println(<span class="string">&quot;W&quot;</span>);  </span><br><span class="line">                <span class="keyword">break</span>;        </span><br><span class="line">            &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>注意：</strong><br>switch配合String和枚举使用时，变量不能为null，原因分析完语法糖转换后的代码自然清楚</p>
<p>上面的代码会被编译器转换成：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test8</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        System.out.println( <span class="string">&quot;hello&quot;</span>.hashCode());  </span><br><span class="line">        System.out.println( <span class="string">&quot;world&quot;</span>.hashCode());  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">choose</span><span class="params">(String str)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">byte</span> x = -<span class="number">1</span>;  </span><br><span class="line">        <span class="keyword">switch</span> (str.hashCode())&#123;  </span><br><span class="line">            <span class="keyword">case</span> <span class="number">99162322</span>: <span class="comment">//hello的hashCode  </span></span><br><span class="line">                <span class="keyword">if</span> (str.equals(<span class="string">&quot;hello&quot;</span>))&#123;  </span><br><span class="line">                    x = <span class="number">0</span>;  </span><br><span class="line">                &#125;  </span><br><span class="line">                <span class="keyword">break</span>;  </span><br><span class="line">            <span class="keyword">case</span> <span class="number">113318802</span>:<span class="comment">//world的hashCode  </span></span><br><span class="line">                <span class="keyword">if</span> (str.equals(<span class="string">&quot;world&quot;</span>))&#123;  </span><br><span class="line">                    x = <span class="number">1</span>;  </span><br><span class="line">                &#125;  </span><br><span class="line">                <span class="keyword">break</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">switch</span> (x) &#123;  </span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:  </span><br><span class="line">                System.out.println(<span class="string">&quot;H&quot;</span>);  </span><br><span class="line">                <span class="keyword">break</span>;            </span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:  </span><br><span class="line">                System.out.println(<span class="string">&quot;W&quot;</span>);  </span><br><span class="line">                <span class="keyword">break</span>;        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>从上面的代码可以看到，字符串使用<code>switch</code>其实是被拆成了两个整数的<code>switch</code>来执行的，第一遍是根据字符串的<code>hashCode</code>和<code>equals</code>将字符串转换成对应<code>byte</code>类型，第二遍才是利用<code>byte</code>执行进行比较<br>为什么第一遍时必须比较<code>hashCode</code>又利用<code>equals</code>比较呢？</p>
<blockquote>
<p><code>hashCode</code>是为了提高效率，减少可能的比较，而<code>equals</code>是为了防止<code>hashCode</code>冲突，例如<code>BM</code>和<code>C.</code>，这两个字符串的<code>hashCode</code>都是<code>2123</code></p>
</blockquote>
</blockquote>
<h2 id="switch-枚举"><a href="#switch-枚举" class="headerlink" title="switch 枚举"></a>switch 枚举</h2><p><code>switch</code> 枚举的例子，原始代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(Sex sex)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">switch</span> (sex)&#123;  </span><br><span class="line">            <span class="keyword">case</span> MALE:  </span><br><span class="line">                System.out.println(<span class="string">&quot;男&quot;</span>);  </span><br><span class="line">                <span class="keyword">break</span>;            <span class="keyword">case</span> FEMALE:  </span><br><span class="line">                System.out.println(<span class="string">&quot;女&quot;</span>);  </span><br><span class="line">                <span class="keyword">break</span>;        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>转换后代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> </span>&#123;  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * 定义一个合成类(仅JVM使用，对我们不可见)  </span></span><br><span class="line"><span class="comment">     * 用来映射枚举的 ordinal 与数组元素的关系  </span></span><br><span class="line"><span class="comment">     * 枚举的 ordinal 表示枚举对象的序号，从0开始  </span></span><br><span class="line"><span class="comment">     * 即 MALE 的 ordinal()=0,FEMALE 的 ordinal() = 1  </span></span><br><span class="line"><span class="comment">     */</span>    <span class="comment">//com/example/demo1/test3/Test$1.$SwitchMap$com$example$demo1$test3$Sex  </span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> $<span class="title">MAP</span></span>&#123;  </span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span>[] map = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];  </span><br><span class="line">        <span class="keyword">static</span> &#123;  </span><br><span class="line">            map[Sex.MALE.ordinal()] = <span class="number">1</span>;  </span><br><span class="line">            map[Sex.FEMALE.ordinal()] = <span class="number">2</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(Sex sex)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">int</span> x = $MAP.map[sex.ordinal()];  </span><br><span class="line">        <span class="keyword">switch</span> (x)&#123;  </span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:  </span><br><span class="line">                System.out.println(<span class="string">&quot;男&quot;</span>);  </span><br><span class="line">                <span class="keyword">break</span>;            <span class="keyword">case</span> <span class="number">2</span>:  </span><br><span class="line">                System.out.println(<span class="string">&quot;女&quot;</span>);  </span><br><span class="line">                <span class="keyword">break</span>;        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="枚举类"><a href="#枚举类" class="headerlink" title="枚举类"></a>枚举类</h2><p>JDK7新增了枚举类，以前面的性别枚举为例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Sex</span> </span>&#123;  </span><br><span class="line">    MALE,FEMALE;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Sex</span> <span class="keyword">extends</span> <span class="title">Enum</span>&lt;<span class="title">Sex</span>&gt; </span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Sex MALE;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Sex FEMALE;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Sex[] $VALUES;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        MALE = <span class="keyword">new</span> Sex(<span class="string">&quot;MALE&quot;</span>,<span class="number">0</span>);  </span><br><span class="line">        FEMALE = <span class="keyword">new</span> Sex(<span class="string">&quot;FEMALE&quot;</span>,<span class="number">1</span>);  </span><br><span class="line">        $VALUES = <span class="keyword">new</span> Sex[]&#123;MALE,FEMALE&#125;;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Sex1</span><span class="params">(String name, <span class="keyword">int</span> ordinal)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">super</span>(name, ordinal);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Sex[] values()&#123;  </span><br><span class="line">        <span class="keyword">return</span> $VALUES.clone();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Sex <span class="title">valueOf</span><span class="params">(String name)</span></span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> Enum.valueOf(Sex.class,name);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="try-with-resources"><a href="#try-with-resources" class="headerlink" title="try-with-resources"></a>try-with-resources</h2><p>JDK7开始新增了对需要关闭的资源处理的特殊语法 <code>try-with-resources</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>(资源变量 = 创建资源对象)&#123;</span><br><span class="line">	</span><br><span class="line">&#125;<span class="keyword">catch</span>()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中资源对象需要实现AutoCloseable接口，例如 <code>InputStream</code>、<code>OutputStream</code>等接口都实现了AutoCloseable接口，使用<code>try-with-resources</code>可以不写finally语句块，编译器会帮助生成关闭资源代码，例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test2</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">try</span> (InputStream inputStream = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;&quot;</span>))&#123;  </span><br><span class="line">            System.out.println(inputStream);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译转换后：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test2</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            InputStream inputStream = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;&quot;</span>);  </span><br><span class="line">            Throwable var2 = <span class="keyword">null</span>;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                System.out.println(inputStream);  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable var12) &#123;  </span><br><span class="line">	            <span class="comment">// var2就是我们业务代码块运行的时候可能出现的异常</span></span><br><span class="line">                var2 = var12;  </span><br><span class="line">                <span class="keyword">throw</span> var12;  </span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">	            <span class="comment">//判断资源不为空，否则不用关闭</span></span><br><span class="line">                <span class="keyword">if</span> (inputStream != <span class="keyword">null</span>) &#123;  </span><br><span class="line">	                <span class="comment">//如果我们的业务代码块有异常</span></span><br><span class="line">                    <span class="keyword">if</span> (var2 != <span class="keyword">null</span>) &#123;  </span><br><span class="line">                        <span class="keyword">try</span> &#123;  </span><br><span class="line">                            inputStream.close();  </span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Throwable var11) &#123;  </span><br><span class="line">	                        <span class="comment">//如果我们的业务代码块有异常，并且关闭资源的时候也出现了异常，会作为被压制异常添加(保证两个异常都不会丢失)</span></span><br><span class="line">                            var2.addSuppressed(var11);  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">	                    <span class="comment">//如果我们的业务代码块没有异常，直接关闭资源，如果关闭资源出现了异常，那么该异常就是最后的异常，可能会被catch捕捉</span></span><br><span class="line">                        inputStream.close();  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var14) &#123;  </span><br><span class="line">            var14.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为什么要设计一个<code>addSuppressed(Throwable e)</code>(添加被压制异常)的方法呢？<br>是为了防止异常信息丢失，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test3</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">try</span> (MyResource myResource = <span class="keyword">new</span> MyResource())&#123;  </span><br><span class="line">            <span class="keyword">int</span> a = <span class="number">1</span>/<span class="number">0</span>;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResource</span> <span class="keyword">implements</span> <span class="title">AutoCloseable</span></span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;close 异常&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：<br>除0异常和手动抛出来的close异常都未丢失</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java.lang.ArithmeticException: / by zero</span><br><span class="line">	at com.example.demo1.test3.Test3.main(Test3.java:<span class="number">10</span>)</span><br><span class="line">	Suppressed: java.lang.Exception: close 异常</span><br><span class="line">		at com.example.demo1.test3.MyResource.close(Test3.java:<span class="number">20</span>)</span><br><span class="line">		at com.example.demo1.test3.Test3.main(Test3.java:<span class="number">11</span>)</span><br></pre></td></tr></table></figure>

<h2 id="方法重写时的桥接方法"><a href="#方法重写时的桥接方法" class="headerlink" title="方法重写时的桥接方法"></a>方法重写时的桥接方法</h2><p>一般来说方法重写分两种情况：</p>
<ul>
<li>父类和子类返回值完全一致</li>
<li>子类返回值可以是父类返回值的子类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">B</span></span>&#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">m</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Number <span class="title">m</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于子类，java编译器会做如下处理：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">B</span></span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">m</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">//此方法才是真正重写了父类，public Number m()方法  </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> synthetic bridge Number <span class="title">m</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> m();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中桥接方法比较特殊，仅对java虚拟机可见，并且与原来的public Number m()没有命名冲突，可以使用下面的反射代码来验证：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">for</span> (Method method : A.class.getDeclaredMethods()) &#123;  </span><br><span class="line">        System.out.println(method);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> java.lang.Integer com.example.demo1.test3.A.m()</span><br><span class="line"><span class="keyword">public</span> java.lang.Number com.example.demo1.test3.A.m()</span><br></pre></td></tr></table></figure>

<h2 id="匿名内部类"><a href="#匿名内部类" class="headerlink" title="匿名内部类"></a>匿名内部类</h2><p>源代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test5</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        Runnable runnable = <span class="keyword">new</span> Runnable() &#123;  </span><br><span class="line">            <span class="meta">@Override</span>  </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">                System.out.println(<span class="string">&quot;OK&quot;</span>);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>转换后代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//额外生成的一个类</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Test5</span>$1 <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    Test5$<span class="number">1</span>() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;OK&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test5</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        Runnable runnable = <span class="keyword">new</span> Test5$<span class="number">1</span>();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>引用局部变量的匿名内部类，源代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test5</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> a)</span> </span>&#123;  </span><br><span class="line">        Runnable runnable = <span class="keyword">new</span> Runnable() &#123;  </span><br><span class="line">            <span class="meta">@Override</span>  </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">                System.out.println(<span class="string">&quot;OK&quot;</span>+a);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>转换后代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//额外生成的代码</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Test5</span>$1 <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> val$a;</span><br><span class="line">    Test5$<span class="number">1</span>(<span class="keyword">final</span> <span class="keyword">int</span> val$a) &#123;</span><br><span class="line">        <span class="keyword">this</span>.val$a = val$a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;OK&quot;</span> + <span class="keyword">this</span>.val$a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test5</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> a)</span> </span>&#123;  </span><br><span class="line">        Runnable runnable = <span class="keyword">new</span> Test5$<span class="number">1</span>(a);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong><br>这同时解释了为什么匿名内部类引用局部变量时，局部变量必须是final的原因<br>    因为在创建<code>Test5$1</code>对象时，将<code>a</code>的值赋值给了<code>Test5$1</code>对象的<code>val$a</code>属性，所以<code>a</code>不应该再发生变化了，如果变化，那么<code>val$a</code>属性就没有机会再跟着一起变化</p>
<h1 id="类加载阶段"><a href="#类加载阶段" class="headerlink" title="类加载阶段"></a>类加载阶段</h1><h2 id="加载"><a href="#加载" class="headerlink" title="加载"></a>加载</h2><ul>
<li>将类的字节码载入方法区中，内部采用<code>C++</code>的<code>instanceKlass</code>描述<code>java</code>类，他的重要<code>field</code>有：<ul>
<li><code>_java_mirror</code>即<code>java</code>的类镜像，例如对<code>String</code>来说，<code>String.class</code>，作用就是把<code>klass</code>暴露给<code>java</code>使用</li>
<li><code>_super</code> 即父类</li>
<li><code>_fields</code>即成员变量</li>
<li><code>_methods</code> 即方法</li>
<li><code>_constants</code> 即常量池</li>
<li><code>_class_loader</code> 即类加载器</li>
<li><code>_vtable</code> 虚方法表</li>
<li><code>_itable</code> 接口方法表</li>
</ul>
</li>
<li>如果这个类还有父类没有加载，先加载父类</li>
<li>加载和链接可能是交替运行的</li>
</ul>
<p><strong>注意：</strong></p>
<ul>
<li><code>instanceKlass</code> 这样的【元数据】是存储在方法区的（jdk1.8之后的元空间），但<code>_java_mirror</code>是存储在堆中的</li>
<li>可以通过前面介绍的<code>HSDB</code>工具查看</li>
<li>类加载之后，会在堆中保留一份信息，也就是类对象，类对象中会有地址指向元空间中的元数据，元空间中<code>_java_mirror</code>也会有指针指向堆中的元数据，可以通过类对象创建实例对象，创建出来的实例对象中，对象头里面会保留类对象信息<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220828193546824.png"></li>
</ul>
<h2 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h2><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><ul>
<li>验证类是否符合JVM规范，安全性检查<br>用可以编辑16进制文件的工具修改编译后的class内容，然后在控制台运行：<br>(报错内容为magic魔数部分值不正确)<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Error: A JNI error has occurred, please check your installation and <span class="keyword">try</span> again</span><br><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.ClassFormatError: Incompatible magic value <span class="number">3405691578</span> in <span class="class"><span class="keyword">class</span> <span class="title">file</span> <span class="title">com</span>/<span class="title">example</span>/<span class="title">demo1</span>/<span class="title">test3</span>/<span class="title">Test6</span></span></span><br><span class="line"><span class="class">        <span class="title">at</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">ClassLoader</span>.<span class="title">defineClass1</span>(<span class="title">Native</span> <span class="title">Method</span>)</span></span><br><span class="line"><span class="class">        <span class="title">at</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">ClassLoader</span>.<span class="title">defineClass</span>(<span class="title">ClassLoader</span>.<span class="title">java</span>:763)</span></span><br><span class="line"><span class="class">        <span class="title">at</span> <span class="title">java</span>.<span class="title">security</span>.<span class="title">SecureClassLoader</span>.<span class="title">defineClass</span>(<span class="title">SecureClassLoader</span>.<span class="title">java</span>:142)</span></span><br><span class="line"><span class="class">        <span class="title">at</span> <span class="title">java</span>.<span class="title">net</span>.<span class="title">URLClassLoader</span>.<span class="title">defineClass</span>(<span class="title">URLClassLoader</span>.<span class="title">java</span>:467)</span></span><br><span class="line"><span class="class">        <span class="title">at</span> <span class="title">java</span>.<span class="title">net</span>.<span class="title">URLClassLoader</span>.<span class="title">access</span>$100(<span class="title">URLClassLoader</span>.<span class="title">java</span>:73)</span></span><br><span class="line"><span class="class">        <span class="title">at</span> <span class="title">java</span>.<span class="title">net</span>.<span class="title">URLClassLoader</span>$1.<span class="title">run</span>(<span class="title">URLClassLoader</span>.<span class="title">java</span>:368)</span></span><br><span class="line"><span class="class">        <span class="title">at</span> <span class="title">java</span>.<span class="title">net</span>.<span class="title">URLClassLoader</span>$1.<span class="title">run</span>(<span class="title">URLClassLoader</span>.<span class="title">java</span>:362)</span></span><br><span class="line"><span class="class">        <span class="title">at</span> <span class="title">java</span>.<span class="title">security</span>.<span class="title">AccessController</span>.<span class="title">doPrivileged</span>(<span class="title">Native</span> <span class="title">Method</span>)</span></span><br><span class="line"><span class="class">        <span class="title">at</span> <span class="title">java</span>.<span class="title">net</span>.<span class="title">URLClassLoader</span>.<span class="title">findClass</span>(<span class="title">URLClassLoader</span>.<span class="title">java</span>:361)</span></span><br><span class="line"><span class="class">        <span class="title">at</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">ClassLoader</span>.<span class="title">loadClass</span>(<span class="title">ClassLoader</span>.<span class="title">java</span>:424)</span></span><br><span class="line"><span class="class">        <span class="title">at</span> <span class="title">sun</span>.<span class="title">misc</span>.<span class="title">Launcher</span>$<span class="title">AppClassLoader</span>.<span class="title">loadClass</span>(<span class="title">Launcher</span>.<span class="title">java</span>:338)</span></span><br><span class="line"><span class="class">        <span class="title">at</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">ClassLoader</span>.<span class="title">loadClass</span>(<span class="title">ClassLoader</span>.<span class="title">java</span>:357)</span></span><br><span class="line"><span class="class">        <span class="title">at</span> <span class="title">sun</span>.<span class="title">launcher</span>.<span class="title">LauncherHelper</span>.<span class="title">checkAndLoadMain</span>(<span class="title">LauncherHelper</span>.<span class="title">java</span>:495)</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><ul>
<li>为<code>static</code>变量分配空间，设置默认值<ul>
<li><code>static</code> 变量在JDK7之前存储于<code>instanceKlass</code>末尾，从JDK7开始，存储于<code>_java_mirror</code>末尾</li>
<li><code>static</code> 变量分配空间和赋值是两个步骤，分配空间在准备阶段完成，赋值在初始化阶段完成</li>
<li>如果<code>static</code>变量是<code>final</code>的基本类型，以及字符串常量，那么编译阶段值就确定了，赋值在准备阶段完成</li>
<li>如果<code>static</code>变量是<code>final</code>的，但属于引用类型，那么赋值也会在初始化阶段完成</li>
</ul>
</li>
</ul>
<h3 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h3><ul>
<li>将常量池中的符号引用解析为直接引用</li>
<li>符号引用替换为直接引用的理解：<ul>
<li>符号引用：比如一个类中引用了其他类，但是JVM不知道实际引用的其他类地址会在哪，所以就会用符号引用代表，等到解析的时候，再根据唯一符号引用去找到其他类的地址，不止是其他类的代表，符号引用也可以代表方法，字段等，主要注意的是符号引用与虚拟机布局无关，引用的目标不一定已经加载到内存</li>
<li>直接引用：直接引用与虚拟机布局有关，如果使用直接引用，那么引用的目标一定已经加载到内存中</li>
<li>符号引用要转换成直接引用才有效，这也说明直接引用的效率要比符号引用高，那么为什么要用符号引用呢？这时 因为类加载之前，javac会将源代码编译成class文件，这个时候javac是不知道被编译的类中所引用的类、方法或者变量他们的引用地址在哪，所以只能用符号引用来代表，当然，符号引用也是要准备JVM虚拟机规范的</li>
</ul>
</li>
</ul>
<h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><h3 id="lt-cinit-gt-V-方法"><a href="#lt-cinit-gt-V-方法" class="headerlink" title="&lt;cinit&gt;()V 方法"></a>&lt;cinit&gt;()V 方法</h3><p>初始化即调用<code>&lt;cinit&gt;()V</code>，虚拟机会保证这个类【构造方法】的线程安全</p>
<h3 id="发生的时机"><a href="#发生的时机" class="headerlink" title="发生的时机"></a>发生的时机</h3><p>类的初始化是懒惰的，并不会在程序启动的时候全部初始化，而是等需要的时候初始化</p>
<p><strong>会导致初始化的情况：</strong></p>
<ul>
<li><code>main</code>方法所在的类，总是被首先初始化</li>
<li>首次访问这个类的静态变量或者静态方法时</li>
<li>子类初始化，如果父类还没有初始化，会引发</li>
<li>子类访问父类静态变量，只会触发父类的初始化</li>
<li><code>Class.forName()</code></li>
<li><code>new</code> 会导致初始化</li>
</ul>
<p><strong>不会导致初始化的情况</strong>：</p>
<ul>
<li>访问类的<code>static final</code>静态常量（基本类型和字符串类型）不会触初始化</li>
<li><code>类对象.class</code>不会触发初始化</li>
<li>创建该类的数组不会触发初始化</li>
<li>类加载器的 <code>loadClass </code>方法</li>
<li><code> Class.forName()</code>方法的参数2为<code>false</code>时</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        <span class="comment">//main方法所在的类，总是会被初始化  </span></span><br><span class="line">        System.out.println(<span class="string">&quot;main init&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;  </span><br><span class="line">        <span class="comment">//1.静态常量不会触发初始化  </span></span><br><span class="line"><span class="comment">//        System.out.println(B.b);  </span></span><br><span class="line">        <span class="comment">//2.类对象.class不会触发初始化  </span></span><br><span class="line"><span class="comment">//        System.out.println(B.class);  </span></span><br><span class="line">        <span class="comment">// 3.创建该类的数组，不会导致初始化  </span></span><br><span class="line"><span class="comment">//        System.out.println(new B[0]);  </span></span><br><span class="line">        <span class="comment">//4.不会初始化类B，但是会加载 B、A  </span></span><br><span class="line"><span class="comment">//        ClassLoader classLoader = Thread.currentThread().getContextClassLoader();  </span></span><br><span class="line"><span class="comment">//        classLoader.loadClass(&quot;com.example.demo1.test5.B&quot;);  </span></span><br><span class="line">        <span class="comment">//5. 不会初始化类B，但是会加载 B、A  </span></span><br><span class="line"><span class="comment">//        ClassLoader classLoader = Thread.currentThread().getContextClassLoader();  </span></span><br><span class="line"><span class="comment">//        Class.forName(&quot;com.example.demo1.test5.B&quot;,false,classLoader);  </span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 1.首次访问这个类的静态变量或者静态方法时，会初始化  </span></span><br><span class="line"><span class="comment">//        System.out.println(A.a);  </span></span><br><span class="line">        <span class="comment">//2. 子类初始化，如果父类还没有初始化，会引发  </span></span><br><span class="line"><span class="comment">//        System.out.println(B.c);  </span></span><br><span class="line">        <span class="comment">//3.子类访问父类静态变量，只会初始化父类  </span></span><br><span class="line"><span class="comment">//        System.out.println(B.a);  </span></span><br><span class="line">        <span class="comment">//4.会初始化类B，并且先初始化类A  </span></span><br><span class="line"><span class="comment">//        Class.forName(&quot;com.example.demo1.test5.B&quot;);  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;  </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> a = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;a init&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span></span>&#123;  </span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">double</span> b = <span class="number">5.0</span>;  </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">boolean</span> c = <span class="keyword">false</span>;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;b init&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="类加载器"><a href="#类加载器" class="headerlink" title="类加载器"></a>类加载器</h1><p>以JDK8为例：</p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">描述</th>
<th align="center">加载目录</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Bootstrap ClassLoader</td>
<td align="center">启动类加载器</td>
<td align="center">JAVA_HOME/jre/lib</td>
<td align="center">无法直接访问</td>
</tr>
<tr>
<td align="center">Extension ClassLoader</td>
<td align="center">扩展类加载器</td>
<td align="center">JAVA_HOME/jre/lib/ext</td>
<td align="center">上级为Bootstrap，显示为null</td>
</tr>
<tr>
<td align="center">Application ClassLoader</td>
<td align="center">应用程序类加载器</td>
<td align="center">classpath</td>
<td align="center">上级为Extension</td>
</tr>
<tr>
<td align="center">自定义类加载器</td>
<td align="center">自定义</td>
<td align="center">自定义类加载器</td>
<td align="center">上级为Application</td>
</tr>
</tbody></table>
<h2 id="启动类加载器"><a href="#启动类加载器" class="headerlink" title="启动类加载器"></a>启动类加载器</h2><p>使用Bootstrap类加载器加载类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">F</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;F init&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;  </span><br><span class="line">        Class&lt;?&gt; aClass = Class.forName(<span class="string">&quot;com.example.demo1.test5.F&quot;</span>);  </span><br><span class="line">        System.out.println(aClass.getClassLoader());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ java -Xbootclasspath/a:. com.example.demo1.test5.Test1</span><br><span class="line">F init</span><br><span class="line">null</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-Xbootclasspath</code> 表示设置 <code>bootclasspath</code></li>
<li>其中<code>/a:.</code> 表示将当前目录追加至 <code>bootclasspath</code> 之后</li>
<li>可以使用这个方法替换核心类<ul>
<li><code>java -Xbootclasspath:&lt;new bootclasspath&gt;</code>   完全替换路径</li>
<li><code>java -Xbootclasspath/a:&lt;向后追加路径&gt;</code></li>
<li><code>java -Xbootclasspath/p:&lt;向前追加路径&gt;</code></li>
</ul>
</li>
</ul>
<h2 id="扩展类加载器"><a href="#扩展类加载器" class="headerlink" title="扩展类加载器"></a>扩展类加载器</h2><p>源代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">G</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;classpath G init&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test2</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;  </span><br><span class="line">        Class&lt;?&gt; aClass = Class.forName(<span class="string">&quot;com.example.demo1.test5.G&quot;</span>);  </span><br><span class="line">        System.out.println(aClass.getClassLoader());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">classpath G init</span><br><span class="line">sun.misc.Launcher$AppClassLoader@18b4aac2</span><br></pre></td></tr></table></figure>
<ul>
<li>可以看到，默认情况下使用的是 <code>AppClassLoader</code> 类加载器</li>
<li>那么怎么才能使用扩展类加载器加载呢？<ul>
<li>将对应的类，打成jar包，放到扩展目录下</li>
</ul>
</li>
</ul>
<p>源代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">G</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;ext G init&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更改输出内容，打包放入扩展目录，可以根据输出内容的不同，判断是加载的哪一个类<br>使用命令打包 <code>jar -cvf my.jar com/example/demo1/test5/G.class</code><br>将jar包放入JAVA_HOME/jre/lib/ext目录下后，改回类中的输出内容，再次运行代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ext G init</span><br><span class="line">sun.misc.Launcher$ExtClassLoader@69663380</span><br></pre></td></tr></table></figure>
<p>从输出的内容可以看出，使用的是 <code>ExtClassLoader</code> 类加载器 </p>
<h2 id="双亲委派模式"><a href="#双亲委派模式" class="headerlink" title="双亲委派模式"></a>双亲委派模式</h2><p>所谓双亲委派，就是指调用类加载器的<code>loadClass</code>方法时，查找类的规则</p>
<blockquote>
<p><strong>注意：</strong><br>    这里的双亲，翻译为上级似乎更为合适，因为他们并没有继承关系</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="keyword">boolean</span> resolve)  </span><br><span class="line">    <span class="keyword">throws</span> ClassNotFoundException  &#123;  </span><br><span class="line">    <span class="keyword">synchronized</span> (getClassLoadingLock(name)) &#123;  </span><br><span class="line">        <span class="comment">// 检查该类加载器中有没有已经加载过</span></span><br><span class="line">        Class&lt;?&gt; c = findLoadedClass(name);  </span><br><span class="line">        <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;  <span class="comment">// 如果没有加载过</span></span><br><span class="line">            <span class="keyword">long</span> t0 = System.nanoTime();  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;  </span><br><span class="line">                <span class="comment">// 有上级的话，委派上级 loadClass</span></span><br><span class="line">                    c = parent.loadClass(name, <span class="keyword">false</span>);  </span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                <span class="comment">// 如果上级为空（ExtClassLoader），则委派 BootstrapClassLoader</span></span><br><span class="line">                    c = findBootstrapClassOrNull(name);  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;  </span><br><span class="line">            &#125;  </span><br><span class="line">  </span><br><span class="line">            <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;  </span><br><span class="line">                <span class="comment">// 如果上一层找不到，调用 findClass方法（每个类加载器自己扩展）来加载</span></span><br><span class="line">                <span class="comment">// 对于ExtClassLoader和AppClassLoader来说，如果上级找不到，会调用自己的findClass方法来寻找</span></span><br><span class="line">                c = findClass(name);  </span><br><span class="line">  </span><br><span class="line">                <span class="comment">// 记录耗时 </span></span><br><span class="line">                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);  </span><br><span class="line">                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);  </span><br><span class="line">                sun.misc.PerfCounter.getFindClasses().increment();  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (resolve) &#123;  </span><br><span class="line">            resolveClass(c);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> c;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="线程上下文类加载器（SPI）"><a href="#线程上下文类加载器（SPI）" class="headerlink" title="线程上下文类加载器（SPI）"></a>线程上下文类加载器（SPI）</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String url = <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">Connection conn = DriverManager.getConnection(url,username,password);</span><br></pre></td></tr></table></figure>
<p>上面是获取数据库连接，并没有写去加载哪一个数据库驱动<br>不需要<code>Class.forName(&quot;com.mysql.jdbc.Driver&quot;)</code>来加载，也可以正确加载驱动</p>
<p>代码中并没有指定使用的是哪一个数据库驱动，是如何做到的呢？</p>
<p>源码：(代码中省略了部分代码，只保留了需要观察的部分)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DriverManager</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 注册驱动集合</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> CopyOnWriteArrayList&lt;DriverInfo&gt; registeredDrivers = <span class="keyword">new</span> CopyOnWriteArrayList&lt;&gt;();</span><br><span class="line">	<span class="comment">// 初始化驱动</span></span><br><span class="line">	<span class="keyword">static</span> &#123;  </span><br><span class="line">    loadInitialDrivers();  </span><br><span class="line">    println(<span class="string">&quot;JDBC DriverManager initialized&quot;</span>);  </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从代码中可以看出，静态代码块中主要逻辑在 <code>loadInitialDrivers();</code>方法中，那我们来看一下 <code>loadInitialDrivers();</code>的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loadInitialDrivers</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    String drivers;  </span><br><span class="line">    <span class="keyword">try</span> &#123;  </span><br><span class="line">        drivers = AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction&lt;String&gt;() &#123;  </span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">run</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">                <span class="keyword">return</span> System.getProperty(<span class="string">&quot;jdbc.drivers&quot;</span>);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;);  </span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123;  </span><br><span class="line">        drivers = <span class="keyword">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">      <span class="comment">// 1)使用 ServiceLoader 机制加载驱动， 即SPI</span></span><br><span class="line">    AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction&lt;Void&gt;() &#123;  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> Void <span class="title">run</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">            ServiceLoader&lt;Driver&gt; loadedDrivers = ServiceLoader.load(Driver.class);  </span><br><span class="line">            Iterator&lt;Driver&gt; driversIterator = loadedDrivers.iterator();  </span><br><span class="line">	        <span class="keyword">try</span>&#123;  </span><br><span class="line">                <span class="keyword">while</span>(driversIterator.hasNext()) &#123;  </span><br><span class="line">                    driversIterator.next();  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125; <span class="keyword">catch</span>(Throwable t) &#123;  </span><br><span class="line">            <span class="comment">// Do nothing  </span></span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;);  </span><br><span class="line">  </span><br><span class="line">    println(<span class="string">&quot;DriverManager.initialize: jdbc.drivers = &quot;</span> + drivers);  </span><br><span class="line">	  <span class="comment">//2) 使用 jdbc.drivers 定义的驱动名加载驱动</span></span><br><span class="line">    <span class="keyword">if</span> (drivers == <span class="keyword">null</span> || drivers.equals(<span class="string">&quot;&quot;</span>)) &#123;  </span><br><span class="line">        <span class="keyword">return</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    String[] driversList = drivers.split(<span class="string">&quot;:&quot;</span>);  </span><br><span class="line">    println(<span class="string">&quot;number of Drivers:&quot;</span> + driversList.length);  </span><br><span class="line">    <span class="keyword">for</span> (String aDriver : driversList) &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">        <span class="comment">// 这里  ClassLoader.getSystemClassLoader() 就是应用程序类加载器</span></span><br><span class="line">            println(<span class="string">&quot;DriverManager.Initialize: loading &quot;</span> + aDriver);  </span><br><span class="line">            Class.forName(aDriver, <span class="keyword">true</span>,  </span><br><span class="line">                    ClassLoader.getSystemClassLoader());  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;  </span><br><span class="line">            println(<span class="string">&quot;DriverManager.Initialize: load failed: &quot;</span> + ex);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>上面代码标记1处的<code>ServiceLoader </code>就是大名鼎鼎的<code> Service Provider Interface (SPI)</code></li>
<li>约定如下：<ul>
<li>在jar包的<code>META-INF/service</code>包下，以接口全限定名为文件名，文件内容是实现类名称</li>
</ul>
</li>
</ul>
<p>如图，mysql的驱动：<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220829210956575.png"></p>
<ul>
<li><p>这样就可以通过下面的方法使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ServiceLoader&lt;接口类型&gt; loader = ServiceLoader.load(接口类型.class);  </span><br><span class="line">Iterator&lt;接口类型&gt; iterator = loader.iterator();  </span><br><span class="line"><span class="keyword">while</span> (iterator.hasNext())&#123;  </span><br><span class="line">    iterator.next();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>接着看<code>ServiceLoader.load()</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;S&gt; <span class="function">ServiceLoader&lt;S&gt; <span class="title">load</span><span class="params">(Class&lt;S&gt; service)</span> </span>&#123;  </span><br><span class="line">		<span class="comment">// 获取线程上下文类加载器</span></span><br><span class="line">    ClassLoader cl = Thread.currentThread().getContextClassLoader();  </span><br><span class="line">    <span class="keyword">return</span> ServiceLoader.load(service, cl);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>线程上下文类加载器是当前线程使用的类加载器，默认就是应用程序加载器，它内部又是由<code>Class.forName()</code>调用了线程上下文类加载器完成类加载，具体代码在 <code>ServiceLoader</code> 的内部类 <code>LazyIterator</code> 中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> S <span class="title">nextService</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (!hasNextService())  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();  </span><br><span class="line">    String cn = nextName;  </span><br><span class="line">    nextName = <span class="keyword">null</span>;  </span><br><span class="line">    Class&lt;?&gt; c = <span class="keyword">null</span>;  </span><br><span class="line">    <span class="keyword">try</span> &#123;  </span><br><span class="line">        c = Class.forName(cn, <span class="keyword">false</span>, loader);  </span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;  </span><br><span class="line">        fail(service,  </span><br><span class="line">             <span class="string">&quot;Provider &quot;</span> + cn + <span class="string">&quot; not found&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">if</span> (!service.isAssignableFrom(c)) &#123;  </span><br><span class="line">        fail(service,  </span><br><span class="line">             <span class="string">&quot;Provider &quot;</span> + cn  + <span class="string">&quot; not a subtype&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">try</span> &#123;  </span><br><span class="line">        S p = service.cast(c.newInstance());  </span><br><span class="line">        providers.put(cn, p);  </span><br><span class="line">        <span class="keyword">return</span> p;  </span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable x) &#123;  </span><br><span class="line">        fail(service,  </span><br><span class="line">             <span class="string">&quot;Provider &quot;</span> + cn + <span class="string">&quot; could not be instantiated&quot;</span>,  </span><br><span class="line">             x);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> Error();          <span class="comment">// This cannot happen  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="自定义类加载器"><a href="#自定义类加载器" class="headerlink" title="自定义类加载器"></a>自定义类加载器</h2><h3 id="什么时候需要自定义类加载器？"><a href="#什么时候需要自定义类加载器？" class="headerlink" title="什么时候需要自定义类加载器？"></a>什么时候需要自定义类加载器？</h3><ul>
<li>想要加载非 <code>classpath</code> 随意路径中的类文件</li>
<li>都是通过接口来实现，希望解耦时，常用在框架设计</li>
<li>这些类希望予以隔离，不同应用的同名类都可以加载，不冲突，常见于 tomcat 容器</li>
</ul>
<h3 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h3><ul>
<li>继承 <code>ClassLoader</code> 类</li>
<li>要准从双亲委派机制，重写 <code>findClass</code> 方法<ul>
<li>注意不是重写<code>loadClass</code>方法，否则不会走双亲委派机制</li>
</ul>
</li>
<li>读取类文件的字节码</li>
<li>调用父类的 <code>defineClass</code> 方法来加载类 </li>
<li>使用者调用该类加载器的 <code>loadClass</code> 方法 </li>
</ul>
<p>如下所示，MyClassLoader 就是我们自定义的类加载器，可以到自定义的目录下进行类加载：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;  </span><br><span class="line">        MyClassLoader myClassLoader = <span class="keyword">new</span> MyClassLoader();  </span><br><span class="line">        Class&lt;?&gt; c1 = myClassLoader.loadClass(<span class="string">&quot;MapImpl1&quot;</span>);  </span><br><span class="line">        Class&lt;?&gt; c2 = myClassLoader.loadClass(<span class="string">&quot;MapImpl1&quot;</span>);  </span><br><span class="line">        System.out.println(c2 == c1);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClassLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span></span>&#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;  </span><br><span class="line">        String path = <span class="string">&quot;D:\\myclasspath\\&quot;</span>+name+<span class="string">&quot;.class&quot;</span>;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            ByteArrayOutputStream os = <span class="keyword">new</span> ByteArrayOutputStream();  </span><br><span class="line">            Files.copy(Paths.get(path), os);  </span><br><span class="line">            <span class="keyword">byte</span>[] bytes = os.toByteArray();  </span><br><span class="line">            <span class="keyword">return</span> defineClass(name, bytes, <span class="number">0</span>, bytes.length);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException(<span class="string">&quot;未找到对应的类文件&quot;</span>,e);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="运行期优化"><a href="#运行期优化" class="headerlink" title="运行期优化"></a>运行期优化</h1><h2 id="即时编译"><a href="#即时编译" class="headerlink" title="即时编译"></a>即时编译</h2><h3 id="分层编译"><a href="#分层编译" class="headerlink" title="分层编译"></a>分层编译</h3><p>运行下面的例子，可以看到，每次创建的一千个对象的时间，会从最开始的每次<code>31000</code>纳秒，到二百次之后降低到<code>11900</code>左右</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">200</span>; i++) &#123;  </span><br><span class="line">            <span class="keyword">long</span> start = System.nanoTime();  </span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">1000</span>; j++) &#123;  </span><br><span class="line">                <span class="keyword">new</span> Object();  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">long</span> end = System.nanoTime();  </span><br><span class="line">            System.out.println(i+<span class="string">&quot;   &quot;</span>+(end-start));  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>原因是什么？</strong></p>
<p>** JVM将执行状态分成了5个层次：**</p>
<ul>
<li>0层：解释执行（Interpreter）</li>
<li>1层：使用C1即时编译器编译执行（不带profiling）</li>
<li>2层：使用C1即时编译器编译执行（带基本的profiling）</li>
<li>3层：使用C1即时编译器编译执行（带完全的profiling）</li>
<li>4层：使用C2即时编译器编译执行</li>
</ul>
<blockquote>
<p><code>profiling</code> 是指在运行过程中收集一些程序执行状态的数据，例如【方法的调用次数】，【循环的回放次数】等</p>
</blockquote>
<p><strong>即时编译器（JIT）和解释器的区别：</strong></p>
<ul>
<li>解释器是将字节码解释为机器码，下次即使遇到相同的字节码，仍会执行重复的解释</li>
<li>JIT是将一些字节码编译为机器码，并存入<code>Code Cache</code>，下次遇到相同的代码，直接执行，无需编译</li>
<li>解释器是将字节码解释为针对所有平台都通用的机器码</li>
<li>JIT会根据平台类型，生成平台特定的机器码</li>
</ul>
<blockquote>
<p>对于占据大部分的不常用的代码，我们无需耗费时间将其编译成机器码，而是采取解释执行的方式运行；<br>另一方面，对于占据小部分的热点代码，我们则可以将其编译成机器码，以达到理想的运行速度；<br>执行效率上简单比较一下 <code>Interpreter &lt; C1 &lt; c2</code><br>总的目标是发现热点代码（hotspot名称的由来），优化之</p>
</blockquote>
<blockquote>
<p>上面的一种优化手段称之为【逃逸分析】，检查新创建的对象是否逃逸。<br>可以使用<code>-XX:-DoEscapeAnalysis</code>关闭逃逸分析，再运行刚才的示例观察结果<br>如果开启逃逸分析，编译器发现新创建的对象在循环外面没有调用，那么就会选择不创建对象</p>
</blockquote>
<h3 id="方法内联"><a href="#方法内联" class="headerlink" title="方法内联"></a>方法内联</h3><p>（Inlining）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">square</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> i)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> i * i;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(square(<span class="number">9</span>));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果发现<code>square()</code>方法是热点方法，并且长度不太长，会进行内联，所谓的内联就是把方法内代码拷贝、黏贴到调用者的位置</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="number">9</span> * <span class="number">9</span>);</span><br></pre></td></tr></table></figure>

<p>还能够进行常量折叠（<code>constant folding</code>）的优化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="number">81</span>);</span><br></pre></td></tr></table></figure>

<p>可以使用参数打印内联信息<code>-XX:+UnlockDiagnosticVMOptions -XX:+PrintInlining</code><br>从输出的结果可以看到，自定义的 <code>square()</code> 方法已经内联优化<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220830211359736.png"></p>
<p>也可以使用参数禁用内联<code>-XX:CompileCommand=dontinline,*Test.square</code>   （*号表示所有包下的Test类中的square方法）</p>
<h3 id="字段优化"><a href="#字段优化" class="headerlink" title="字段优化"></a>字段优化</h3><p>JWH基准测试请参考 ： <a target="_blank" rel="noopener" href="https://openjdk.org/projects/code-tools/jmh/">OpenJDK: jmh</a></p>
<p>创建Maven工程，添加以下依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.openjdk.jmh<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jmh-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.35<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.openjdk.jmh<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jmh-generator-annprocess<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.35<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>编写基准测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//预热，预热2伦，每次间隔1毫秒  </span></span><br><span class="line"><span class="meta">@Warmup(iterations = 2,time = 1)</span>  </span><br><span class="line"><span class="comment">//进5伦测试，每次间隔1毫秒  </span></span><br><span class="line"><span class="meta">@Measurement(iterations = 5,time = 1)</span>  </span><br><span class="line"><span class="meta">@State(Scope.Benchmark)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">int</span>[] elements = randomInts(<span class="number">1000</span>);  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>[] randomInts(<span class="keyword">int</span> size)&#123;  </span><br><span class="line">        Random random = ThreadLocalRandom.current();  </span><br><span class="line">        <span class="keyword">int</span>[] values = <span class="keyword">new</span> <span class="keyword">int</span>[size];  </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;  </span><br><span class="line">            values[i] = random.nextInt();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> values;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Benchmark</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; elements.length; i++) &#123;  </span><br><span class="line">            doSum(elements[i]);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Benchmark</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">int</span>[] local = <span class="keyword">this</span>.elements;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; local.length; i++) &#123;  </span><br><span class="line">            doSum(local[i]);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Benchmark</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> element : elements) &#123;  </span><br><span class="line">            doSum(element);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> sum = <span class="number">0</span>;  </span><br><span class="line">    <span class="meta">@CompilerControl(CompilerControl.Mode.INLINE)</span>  </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">doSum</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;  </span><br><span class="line">        sum+=x;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> RunnerException </span>&#123;  </span><br><span class="line">        Options options = <span class="keyword">new</span> OptionsBuilder()  </span><br><span class="line">                .include(Test.class.getSimpleName())  </span><br><span class="line">                .forks(<span class="number">1</span>).build();  </span><br><span class="line">        <span class="keyword">new</span> Runner(options).run();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面代码运行之后，输出结果：<br>Score项为评分，可以看到，三种循环方式，评分并没有太大的差异</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Benchmark    Mode  Cnt        Score        Error  Units</span><br><span class="line">Test.test1  thrpt    5  4152019.656 ±  43675.816  ops/s</span><br><span class="line">Test.test2  thrpt    5  4128473.418 ± 228612.603  ops/s</span><br><span class="line">Test.test3  thrpt    5  4130624.821 ± 180536.674  ops/s</span><br></pre></td></tr></table></figure>

<p>可以把<code>doSum()</code>方法上的注解参数修改为<code>@CompilerControl(CompilerControl.Mode.DONT_INLINE)</code>，禁止方法内联<br>再次运行代码：<br>可以看出，得分比较与第一次，全都有了大幅度下降</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Benchmark    Mode  Cnt       Score       Error  Units</span><br><span class="line">Test.test1  thrpt    5  210418.245 ± 40126.738  ops/s</span><br><span class="line">Test.test2  thrpt    5  627385.384 ± 27072.723  ops/s</span><br><span class="line">Test.test3  thrpt    5  640138.597 ± 11598.502  ops/s</span><br></pre></td></tr></table></figure>

<p><strong>分析：</strong><br>在刚才的示例中，<code>doSum()</code>方法是否内联会影响<code>elements</code>成员变量读取的优化<br>如果<code>doSum()</code>方法内联了，刚才的<code>test1</code>方法会被优化成下面的样子（伪代码）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Benchmark</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;  </span><br><span class="line"> <span class="comment">//elements.length 首次读取会缓存起来，后续的所有操作都是从缓存中进行的 --&gt; int[] local</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; elements.length; i++) &#123;   <span class="comment">//后续999次求长度 &lt;-- local</span></span><br><span class="line">        doSum(elements[i]);  <span class="comment">// 1000 次取下标 i 的元素 &lt;-- local </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>可以省去 <code>1999</code> 次<code>Field</code>读取操作<br>但如果<code>doSum()</code>方法没有内联，则不会有上面的优化</p>
<h3 id="反射优化"><a href="#反射优化" class="headerlink" title="反射优化"></a>反射优化</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;foo...&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException, IOException </span>&#123;  </span><br><span class="line">        Method foo = Test.class.getMethod(<span class="string">&quot;foo&quot;</span>);  </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">16</span>; i++) &#123;  </span><br><span class="line">            System.out.printf(<span class="string">&quot;%d\t&quot;</span>,i);  </span><br><span class="line">            foo.invoke(<span class="keyword">null</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">        System.in.read();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <code>foo.invoke()</code>前面0-15次调用，使用的是 MethodAccessor 的 NativeMethodAccessorImpl 实现<br> 之后会生成一个新的实现<br>下面的代码是 <code>NativeMethodAccessorImpl</code> 类删减之后的内容<br>可以看到，每次调用<code> this.numInvocations</code> 都会加一，当大于<code>ReflectionFactory.inflationThreshold()</code>的结果时就会进入判断中的内容，而判断中会通过字节码技术，重新生成一个 <code>MethodAccessorImpl</code> 的实现类 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NativeMethodAccessorImpl</span> <span class="keyword">extends</span> <span class="title">MethodAccessorImpl</span> </span>&#123;  </span><br><span class="line">	......</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object var1, Object[] var2)</span> <span class="keyword">throws</span> IllegalArgumentException, InvocationTargetException </span>&#123;  </span><br><span class="line">        <span class="keyword">if</span> (++<span class="keyword">this</span>.numInvocations &gt; ReflectionFactory.inflationThreshold() &amp;&amp; !ReflectUtil.isVMAnonymousClass(<span class="keyword">this</span>.method.getDeclaringClass())) &#123;  </span><br><span class="line">            MethodAccessorImpl var3 = (MethodAccessorImpl)(<span class="keyword">new</span> MethodAccessorGenerator()).generateMethod(<span class="keyword">this</span>.method.getDeclaringClass(), <span class="keyword">this</span>.method.getName(), <span class="keyword">this</span>.method.getParameterTypes(), <span class="keyword">this</span>.method.getReturnType(), <span class="keyword">this</span>.method.getExceptionTypes(), <span class="keyword">this</span>.method.getModifiers());  </span><br><span class="line">            <span class="keyword">this</span>.parent.setDelegate(var3);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> invoke0(<span class="keyword">this</span>.method, var1, var2);  </span><br><span class="line">    &#125;  </span><br><span class="line">	  ........</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> Object <span class="title">invoke0</span><span class="params">(Method var0, Object var1, Object[] var2)</span></span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以通过 阿里巴巴提供的工具包 arthas-boot 来查看通过字节码技术生成的类  下载路径：   <a target="_blank" rel="noopener" href="https://arthas.gitee.io/arthas-boot.jar">https://arthas.gitee.io/arthas-boot.jar</a><br><code>java -jar .\arthas-boot.jar</code><br>工具启动后会列出来对应的程序，主要选择自己想要查看的程序即可<br><img src="/2022/08/20/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E7%B1%BB%E5%8A%A0%E8%BD%BD/image-20220902062543333.png"></p>
<p>然后使用 <code>jad sun.reflect.GeneratedMethodAccessor1</code> 命令，后面是需要查看的类的全限定名称<br>下面是自动生成的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Decompiled with CFR.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Could not load the following classes:</span></span><br><span class="line"><span class="comment"> *  com.example.demo1.test11.Test</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> sun.reflect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo1.test11.Test;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> sun.reflect.MethodAccessorImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneratedMethodAccessor1</span></span></span><br><span class="line"><span class="class"><span class="keyword">extends</span> <span class="title">MethodAccessorImpl</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Loose catch block</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object object, Object[] objectArray)</span> <span class="keyword">throws</span> InvocationTargetException </span>&#123;</span><br><span class="line">		    <span class="comment">//如果有参数，直接抛出非法参数异常</span></span><br><span class="line">		    <span class="comment">//会根据调用方法的实际情况来生成，如果方法有一个参数，则会限制为1个参数</span></span><br><span class="line">		    <span class="comment">//如果方法为普通方法，object为对象，会使用object.fangfa()调用</span></span><br><span class="line">        block4: &#123;</span><br><span class="line">            <span class="keyword">if</span> (objectArray == <span class="keyword">null</span> || objectArray.length == <span class="number">0</span>) <span class="keyword">break</span> block4;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">	        <span class="comment">//可以看到，这里已经是使用直接调用了</span></span><br><span class="line">            Test.foo();</span><br><span class="line">            <span class="comment">//没有返回值</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InvocationTargetException(throwable);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (ClassCastException | NullPointerException runtimeException) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="keyword">super</span>.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>注意：</em><br>通过查看 <code>ReflectionFactory</code> 源码可以知道：</p>
<ul>
<li><code>sun.reflect.noInflation</code> 可以用来禁止膨胀（直接生成 <code>sun.reflect.GeneratedMethodAccessor1</code>，但是首次生成比较耗时，如果反射只使用一次，不划算）</li>
<li><code>sun.reflect.inflationThreshold</code> 可以修改膨胀阀值</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/" rel="tag"><i class="fa fa-tag"></i> 黑马JVM课程</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/08/13/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" rel="prev" title="黑马JVM课程——垃圾回收（二）">
      <i class="fa fa-chevron-left"></i> 黑马JVM课程——垃圾回收（二）
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/09/02/JVM/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B/%E9%BB%91%E9%A9%ACJVM%E8%AF%BE%E7%A8%8B%E2%80%94%E2%80%94JAVA%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/" rel="next" title="黑马JVM课程——JAVA内存模型（四）">
      黑马JVM课程——JAVA内存模型（四） <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B1%BB%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="nav-number">1.</span> <span class="nav-text">类文件结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AD%94%E6%95%B0"><span class="nav-number">1.1.</span> <span class="nav-text">魔数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%88%E6%9C%AC"><span class="nav-number">1.2.</span> <span class="nav-text">版本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E9%87%8F%E6%B1%A0"><span class="nav-number">1.3.</span> <span class="nav-text">常量池</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E9%87%8F%E6%B1%A0%E9%95%BF%E5%BA%A6"><span class="nav-number">1.3.1.</span> <span class="nav-text">常量池长度</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">#1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">#2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3"><span class="nav-number">1.3.1.3.</span> <span class="nav-text">#3</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4"><span class="nav-number">1.3.1.4.</span> <span class="nav-text">#4</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5"><span class="nav-number">1.3.1.5.</span> <span class="nav-text">#5</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6"><span class="nav-number">1.3.1.6.</span> <span class="nav-text">#6</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7"><span class="nav-number">1.3.1.7.</span> <span class="nav-text">#7</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8"><span class="nav-number">1.3.1.8.</span> <span class="nav-text">#8</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9"><span class="nav-number">1.3.1.9.</span> <span class="nav-text">#9</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10"><span class="nav-number">1.3.1.10.</span> <span class="nav-text">#10</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11"><span class="nav-number">1.3.1.11.</span> <span class="nav-text">#11</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#12"><span class="nav-number">1.3.1.12.</span> <span class="nav-text">#12</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#13"><span class="nav-number">1.3.1.13.</span> <span class="nav-text">#13</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#14"><span class="nav-number">1.3.1.14.</span> <span class="nav-text">#14</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#15"><span class="nav-number">1.3.1.15.</span> <span class="nav-text">#15</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#16"><span class="nav-number">1.3.1.16.</span> <span class="nav-text">#16</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#17"><span class="nav-number">1.3.1.17.</span> <span class="nav-text">#17</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#18"><span class="nav-number">1.3.1.18.</span> <span class="nav-text">#18</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#19"><span class="nav-number">1.3.1.19.</span> <span class="nav-text">#19</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#20"><span class="nav-number">1.3.1.20.</span> <span class="nav-text">#20</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#21"><span class="nav-number">1.3.1.21.</span> <span class="nav-text">#21</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#22"><span class="nav-number">1.3.1.22.</span> <span class="nav-text">#22</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#23"><span class="nav-number">1.3.1.23.</span> <span class="nav-text">#23</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#24"><span class="nav-number">1.3.1.24.</span> <span class="nav-text">#24</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#25"><span class="nav-number">1.3.1.25.</span> <span class="nav-text">#25</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#26"><span class="nav-number">1.3.1.26.</span> <span class="nav-text">#26</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#27"><span class="nav-number">1.3.1.27.</span> <span class="nav-text">#27</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#28"><span class="nav-number">1.3.1.28.</span> <span class="nav-text">#28</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#29"><span class="nav-number">1.3.1.29.</span> <span class="nav-text">#29</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#30"><span class="nav-number">1.3.1.30.</span> <span class="nav-text">#30</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E6%A0%87%E8%AF%86%E4%B8%8E%E7%BB%A7%E6%89%BF%E4%BF%A1%E6%81%AF"><span class="nav-number">1.4.</span> <span class="nav-text">访问标识与继承信息</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="nav-number">1.4.1.</span> <span class="nav-text">修饰符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A8%E9%99%90%E5%AE%9A%E5%90%8D"><span class="nav-number">1.4.2.</span> <span class="nav-text">全限定名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%88%B6%E7%B1%BB%E5%85%A8%E9%99%90%E5%AE%9A%E5%90%8D"><span class="nav-number">1.4.3.</span> <span class="nav-text">父类全限定名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3%E4%BF%A1%E6%81%AF"><span class="nav-number">1.4.4.</span> <span class="nav-text">接口信息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%E4%BF%A1%E6%81%AF-Field"><span class="nav-number">1.5.</span> <span class="nav-text">成员变量信息(Field)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%BF%A1%E6%81%AF%EF%BC%88Method%EF%BC%89"><span class="nav-number">1.6.</span> <span class="nav-text">方法信息（Method）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E6%95%B0%E9%87%8F"><span class="nav-number">1.6.1.</span> <span class="nav-text">方法数量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E7%BB%84%E6%88%90"><span class="nav-number">1.6.2.</span> <span class="nav-text">方法组成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E6%96%B9%E6%B3%95%E7%9A%84%E8%AF%A6%E7%BB%86%E8%A7%A3%E6%9E%90"><span class="nav-number">1.6.3.</span> <span class="nav-text">第一个方法的详细解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E6%96%B9%E6%B3%95%E7%9A%84%E8%AF%A6%E7%BB%86%E8%A7%A3%E6%9E%90"><span class="nav-number">1.6.4.</span> <span class="nav-text">第二个方法的详细解析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%99%84%E5%8A%A0%E5%B1%9E%E6%80%A7"><span class="nav-number">1.7.</span> <span class="nav-text">附加属性</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%97%E8%8A%82%E7%A0%81%E6%8C%87%E4%BB%A4"><span class="nav-number">2.</span> <span class="nav-text">字节码指令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%A5%E9%97%A8"><span class="nav-number">2.1.</span> <span class="nav-text">入门</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#javap-%E5%B7%A5%E5%85%B7"><span class="nav-number">2.2.</span> <span class="nav-text">javap 工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%BE%E8%A7%A3%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="nav-number">2.3.</span> <span class="nav-text">图解方法执行流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E5%A7%8Bjava%E4%BB%A3%E7%A0%81"><span class="nav-number">2.3.1.</span> <span class="nav-text">原始java代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E5%90%8E%E7%9A%84%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6"><span class="nav-number">2.3.2.</span> <span class="nav-text">编译后的字节码文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E9%87%8F%E6%B1%A0%E8%BD%BD%E5%85%A5%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0"><span class="nav-number">2.3.3.</span> <span class="nav-text">常量池载入运行时常量池</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E5%AD%97%E8%8A%82%E7%A0%81%E8%BD%BD%E5%85%A5%E6%96%B9%E6%B3%95%E5%8C%BA"><span class="nav-number">2.3.4.</span> <span class="nav-text">方法字节码载入方法区</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#main-%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%A7%8B%E8%BF%90%E8%A1%8C%EF%BC%8C%E5%88%86%E9%85%8D%E6%A0%88%E5%B8%A7%E5%86%85%E5%AD%98"><span class="nav-number">2.3.5.</span> <span class="nav-text">main 线程开始运行，分配栈帧内存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%BC%80%E5%A7%8B%E6%89%A7%E8%A1%8C%E5%AD%97%E8%8A%82%E7%A0%81"><span class="nav-number">2.3.6.</span> <span class="nav-text">执行引擎开始执行字节码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#bipush-10"><span class="nav-number">2.3.6.1.</span> <span class="nav-text">bipush 10</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#istore-1"><span class="nav-number">2.3.6.2.</span> <span class="nav-text">istore_1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ldc-32"><span class="nav-number">2.3.6.3.</span> <span class="nav-text">ldc #32</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#istore-2"><span class="nav-number">2.3.6.4.</span> <span class="nav-text">istore_2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#iload-1"><span class="nav-number">2.3.6.5.</span> <span class="nav-text">iload_1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#iload-2"><span class="nav-number">2.3.6.6.</span> <span class="nav-text">iload_2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#iadd"><span class="nav-number">2.3.6.7.</span> <span class="nav-text">iadd</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#istore-3"><span class="nav-number">2.3.6.8.</span> <span class="nav-text">istore_3</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getstatic-4"><span class="nav-number">2.3.6.9.</span> <span class="nav-text">getstatic #4</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#iload-3"><span class="nav-number">2.3.6.10.</span> <span class="nav-text">iload_3</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#invokevirtual-5"><span class="nav-number">2.3.6.11.</span> <span class="nav-text">invokevirtual #5</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#return"><span class="nav-number">2.3.6.12.</span> <span class="nav-text">return</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0-%E5%88%86%E6%9E%90-i"><span class="nav-number">2.4.</span> <span class="nav-text">练习-分析 i++</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#bipush-10-1"><span class="nav-number">2.4.1.</span> <span class="nav-text">bipush 10</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#istore-1-1"><span class="nav-number">2.4.2.</span> <span class="nav-text">istore_1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iload-1-1"><span class="nav-number">2.4.3.</span> <span class="nav-text">iload_1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iinc-1-1"><span class="nav-number">2.4.4.</span> <span class="nav-text">iinc 1,1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iinc-1-1-1"><span class="nav-number">2.4.5.</span> <span class="nav-text">iinc 1,1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iload-1-2"><span class="nav-number">2.4.6.</span> <span class="nav-text">iload_1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iadd-1"><span class="nav-number">2.4.7.</span> <span class="nav-text">iadd</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iload-1-3"><span class="nav-number">2.4.8.</span> <span class="nav-text">iload_1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iinc-1-1-2"><span class="nav-number">2.4.9.</span> <span class="nav-text">iinc 1,-1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iadd-2"><span class="nav-number">2.4.10.</span> <span class="nav-text">iadd</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#istore-2-1"><span class="nav-number">2.4.11.</span> <span class="nav-text">istore_2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E6%8C%87%E4%BB%A4"><span class="nav-number">2.5.</span> <span class="nav-text">条件判断指令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AA%E7%8E%AF%E6%8E%A7%E5%88%B6%E6%8C%87%E4%BB%A4"><span class="nav-number">2.5.1.</span> <span class="nav-text">循环控制指令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="nav-number">2.6.</span> <span class="nav-text">构造方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#lt-cinit-gt-V"><span class="nav-number">2.6.1.</span> <span class="nav-text">&lt;cinit&gt;()V</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lt-init-gt-V"><span class="nav-number">2.6.2.</span> <span class="nav-text">&lt;init&gt;()V</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8"><span class="nav-number">2.6.3.</span> <span class="nav-text">方法调用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E6%80%81%E7%9A%84%E5%8E%9F%E7%90%86"><span class="nav-number">2.7.</span> <span class="nav-text">多态的原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E6%9E%90"><span class="nav-number">2.7.1.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">2.7.2.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E6%A2%B3%E7%90%86"><span class="nav-number">2.8.</span> <span class="nav-text">异常梳理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#try-catch"><span class="nav-number">2.8.1.</span> <span class="nav-text">try-catch</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E4%B8%AAcatch%E5%9D%97%E7%9A%84%E6%83%85%E5%86%B5-single-catch"><span class="nav-number">2.8.2.</span> <span class="nav-text">多个catch块的情况(single-catch)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#multi-catch%E7%9A%84%E6%83%85%E5%86%B5"><span class="nav-number">2.8.3.</span> <span class="nav-text">multi-catch的情况</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#finally"><span class="nav-number">2.8.4.</span> <span class="nav-text">finally</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#synchronized"><span class="nav-number">2.8.5.</span> <span class="nav-text">synchronized</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E6%9C%9F%E5%A4%84%E7%90%86"><span class="nav-number">3.</span> <span class="nav-text">编译期处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E6%9E%84%E9%80%A0%E5%99%A8"><span class="nav-number">3.1.</span> <span class="nav-text">默认构造器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E6%8B%86%E8%A3%85%E7%AE%B1"><span class="nav-number">3.2.</span> <span class="nav-text">自动拆装箱</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%9B%E5%9E%8B%E9%9B%86%E5%90%88%E5%8F%96%E5%80%BC"><span class="nav-number">3.3.</span> <span class="nav-text">泛型集合取值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0"><span class="nav-number">3.4.</span> <span class="nav-text">可变参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#foreach%E5%BE%AA%E7%8E%AF"><span class="nav-number">3.5.</span> <span class="nav-text">foreach循环</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#switch-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">3.6.</span> <span class="nav-text">switch 字符串</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#switch-%E6%9E%9A%E4%B8%BE"><span class="nav-number">3.7.</span> <span class="nav-text">switch 枚举</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%9A%E4%B8%BE%E7%B1%BB"><span class="nav-number">3.8.</span> <span class="nav-text">枚举类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#try-with-resources"><span class="nav-number">3.9.</span> <span class="nav-text">try-with-resources</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E9%87%8D%E5%86%99%E6%97%B6%E7%9A%84%E6%A1%A5%E6%8E%A5%E6%96%B9%E6%B3%95"><span class="nav-number">3.10.</span> <span class="nav-text">方法重写时的桥接方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8C%BF%E5%90%8D%E5%86%85%E9%83%A8%E7%B1%BB"><span class="nav-number">3.11.</span> <span class="nav-text">匿名内部类</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E9%98%B6%E6%AE%B5"><span class="nav-number">4.</span> <span class="nav-text">类加载阶段</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD"><span class="nav-number">4.1.</span> <span class="nav-text">加载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%93%BE%E6%8E%A5"><span class="nav-number">4.2.</span> <span class="nav-text">链接</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81"><span class="nav-number">4.2.1.</span> <span class="nav-text">验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87"><span class="nav-number">4.2.2.</span> <span class="nav-text">准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90"><span class="nav-number">4.2.3.</span> <span class="nav-text">解析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">4.3.</span> <span class="nav-text">初始化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#lt-cinit-gt-V-%E6%96%B9%E6%B3%95"><span class="nav-number">4.3.1.</span> <span class="nav-text">&lt;cinit&gt;()V 方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%91%E7%94%9F%E7%9A%84%E6%97%B6%E6%9C%BA"><span class="nav-number">4.3.2.</span> <span class="nav-text">发生的时机</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="nav-number">5.</span> <span class="nav-text">类加载器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="nav-number">5.1.</span> <span class="nav-text">启动类加载器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="nav-number">5.2.</span> <span class="nav-text">扩展类加载器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%BC%8F"><span class="nav-number">5.3.</span> <span class="nav-text">双亲委派模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%EF%BC%88SPI%EF%BC%89"><span class="nav-number">5.4.</span> <span class="nav-text">线程上下文类加载器（SPI）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="nav-number">5.5.</span> <span class="nav-text">自定义类加载器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E9%9C%80%E8%A6%81%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%EF%BC%9F"><span class="nav-number">5.5.1.</span> <span class="nav-text">什么时候需要自定义类加载器？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="nav-number">5.5.2.</span> <span class="nav-text">实现步骤</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%9C%9F%E4%BC%98%E5%8C%96"><span class="nav-number">6.</span> <span class="nav-text">运行期优化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%B3%E6%97%B6%E7%BC%96%E8%AF%91"><span class="nav-number">6.1.</span> <span class="nav-text">即时编译</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E5%B1%82%E7%BC%96%E8%AF%91"><span class="nav-number">6.1.1.</span> <span class="nav-text">分层编译</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E5%86%85%E8%81%94"><span class="nav-number">6.1.2.</span> <span class="nav-text">方法内联</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E6%AE%B5%E4%BC%98%E5%8C%96"><span class="nav-number">6.1.3.</span> <span class="nav-text">字段优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E4%BC%98%E5%8C%96"><span class="nav-number">6.1.4.</span> <span class="nav-text">反射优化</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="YS"
      src="/images/author.png">
  <p class="site-author-name" itemprop="name">YS</p>
  <div class="site-description" itemprop="description">学海无涯苦作舟</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">54</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">YS</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'SsNHix8sOQXkmksOkIvo0jkf-gzGzoHsz',
      appKey     : 'BCtPpmnU41TOE7Wr5O0CJFgS',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
