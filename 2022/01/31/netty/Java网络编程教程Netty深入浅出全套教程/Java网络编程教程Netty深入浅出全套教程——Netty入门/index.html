<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/ys_ico.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/ys_ico.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ysymj.gitee.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="é»‘é©¬ã€ŠJavaç½‘ç»œç¼–ç¨‹æ•™ç¨‹|Nettyæ·±å…¥æµ…å‡ºå…¨å¥—æ•™ç¨‹ã€‹é¢‘å­¦ä¹ ç¬”è®°ï¼ˆhttp:&#x2F;&#x2F;yun.itheima.com&#x2F;course&#x2F;855.htmlï¼‰ANDï¼ˆhttps:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1py4y1E7oAï¼‰">
<meta property="og:type" content="article">
<meta property="og:title" content="Javaç½‘ç»œç¼–ç¨‹æ•™ç¨‹|Nettyæ·±å…¥æµ…å‡ºå…¨å¥—æ•™ç¨‹â€”â€”Nettyå…¥é—¨ï¼ˆäºŒï¼‰">
<meta property="og:url" content="http://ysymj.gitee.io/2022/01/31/netty/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%95%99%E7%A8%8BNetty%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%85%A8%E5%A5%97%E6%95%99%E7%A8%8B/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%95%99%E7%A8%8BNetty%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%85%A8%E5%A5%97%E6%95%99%E7%A8%8B%E2%80%94%E2%80%94Netty%E5%85%A5%E9%97%A8/index.html">
<meta property="og:site_name" content="YS">
<meta property="og:description" content="é»‘é©¬ã€ŠJavaç½‘ç»œç¼–ç¨‹æ•™ç¨‹|Nettyæ·±å…¥æµ…å‡ºå…¨å¥—æ•™ç¨‹ã€‹é¢‘å­¦ä¹ ç¬”è®°ï¼ˆhttp:&#x2F;&#x2F;yun.itheima.com&#x2F;course&#x2F;855.htmlï¼‰ANDï¼ˆhttps:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1py4y1E7oAï¼‰">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ystest-bucket.s3.cn-north-1.jdcloud-oss.com/Netty%E7%9A%84%E4%BD%9C%E8%80%85%E5%9B%BE.png">
<meta property="og:image" content="https://ystest-bucket.s3.cn-north-1.jdcloud-oss.com/EventLoop%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="https://ystest-bucket.s3.cn-north-1.jdcloud-oss.com/NioEventLoop%E5%A4%84%E7%90%86%E4%BA%8B%E4%BB%B6%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="https://ystest-bucket.s3.cn-north-1.jdcloud-oss.com/EventLoop%E7%BB%91%E5%AE%9A%E7%BA%BF%E7%A8%8B%E5%9B%BE%E7%A4%BA2.png">
<meta property="og:image" content="https://ystest-bucket.s3.cn-north-1.jdcloud-oss.com/Pipeline%E7%BB%93%E6%9E%84%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="https://ystest-bucket.s3.cn-north-1.jdcloud-oss.com/%E6%9C%8D%E5%8A%A1%E7%AB%AFpipeline%E8%A7%A6%E5%8F%91%E7%9A%84%E5%8E%9F%E5%A7%8B%E6%B5%81%E7%A8%8B.png">
<meta property="og:image" content="https://ystest-bucket.s3.cn-north-1.jdcloud-oss.com/ByteBuf%E7%BB%84%E6%88%90%E7%BB%93%E6%9E%84%E5%9B%BE.png">
<meta property="og:image" content="https://ystest-bucket.s3.cn-north-1.jdcloud-oss.com/slice%E5%9B%BE%E7%A4%BA.png">
<meta property="og:image" content="https://ystest-bucket.s3.cn-north-1.jdcloud-oss.com/duplicate%E5%9B%BE%E7%A4%BA.png">
<meta property="article:published_time" content="2022-01-31T04:58:03.000Z">
<meta property="article:modified_time" content="2023-03-23T02:06:27.474Z">
<meta property="article:author" content="YS">
<meta property="article:tag" content="Javaç½‘ç»œç¼–ç¨‹æ•™ç¨‹-Nettyæ·±å…¥æµ…å‡ºå…¨å¥—æ•™ç¨‹">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ystest-bucket.s3.cn-north-1.jdcloud-oss.com/Netty%E7%9A%84%E4%BD%9C%E8%80%85%E5%9B%BE.png">

<link rel="canonical" href="http://ysymj.gitee.io/2022/01/31/netty/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%95%99%E7%A8%8BNetty%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%85%A8%E5%A5%97%E6%95%99%E7%A8%8B/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%95%99%E7%A8%8BNetty%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%85%A8%E5%A5%97%E6%95%99%E7%A8%8B%E2%80%94%E2%80%94Netty%E5%85%A5%E9%97%A8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Javaç½‘ç»œç¼–ç¨‹æ•™ç¨‹|Nettyæ·±å…¥æµ…å‡ºå…¨å¥—æ•™ç¨‹â€”â€”Nettyå…¥é—¨ï¼ˆäºŒï¼‰ | YS</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">YS</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">å­¦æ— æ­¢å¢ƒ</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://ysymj.gitee.io/2022/01/31/netty/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%95%99%E7%A8%8BNetty%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%85%A8%E5%A5%97%E6%95%99%E7%A8%8B/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%95%99%E7%A8%8BNetty%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%85%A8%E5%A5%97%E6%95%99%E7%A8%8B%E2%80%94%E2%80%94Netty%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.png">
      <meta itemprop="name" content="YS">
      <meta itemprop="description" content="å­¦æµ·æ— æ¶¯è‹¦ä½œèˆŸ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Javaç½‘ç»œç¼–ç¨‹æ•™ç¨‹|Nettyæ·±å…¥æµ…å‡ºå…¨å¥—æ•™ç¨‹â€”â€”Nettyå…¥é—¨ï¼ˆäºŒï¼‰
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2022-01-31 12:58:03" itemprop="dateCreated datePublished" datetime="2022-01-31T12:58:03+08:00">2022-01-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-03-23 10:06:27" itemprop="dateModified" datetime="2023-03-23T10:06:27+08:00">2023-03-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/netty/" itemprop="url" rel="index"><span itemprop="name">netty</span></a>
                </span>
            </span>

          
            <span id="/2022/01/31/netty/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%95%99%E7%A8%8BNetty%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%85%A8%E5%A5%97%E6%95%99%E7%A8%8B/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%95%99%E7%A8%8BNetty%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%85%A8%E5%A5%97%E6%95%99%E7%A8%8B%E2%80%94%E2%80%94Netty%E5%85%A5%E9%97%A8/" class="post-meta-item leancloud_visitors" data-flag-title="Javaç½‘ç»œç¼–ç¨‹æ•™ç¨‹|Nettyæ·±å…¥æµ…å‡ºå…¨å¥—æ•™ç¨‹â€”â€”Nettyå…¥é—¨ï¼ˆäºŒï¼‰" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/2022/01/31/netty/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%95%99%E7%A8%8BNetty%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%85%A8%E5%A5%97%E6%95%99%E7%A8%8B/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%95%99%E7%A8%8BNetty%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%85%A8%E5%A5%97%E6%95%99%E7%A8%8B%E2%80%94%E2%80%94Netty%E5%85%A5%E9%97%A8/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/31/netty/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%95%99%E7%A8%8BNetty%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%85%A8%E5%A5%97%E6%95%99%E7%A8%8B/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%95%99%E7%A8%8BNetty%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%85%A8%E5%A5%97%E6%95%99%E7%A8%8B%E2%80%94%E2%80%94Netty%E5%85%A5%E9%97%A8/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><h2 id="Nettyæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Nettyæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Nettyæ˜¯ä»€ä¹ˆï¼Ÿ"></a>Nettyæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>Nettyæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€åŸºäºäº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ç½‘ç»œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯  </p>
<h2 id="Nettyçš„ä½œè€…"><a href="#Nettyçš„ä½œè€…" class="headerlink" title="Nettyçš„ä½œè€…"></a>Nettyçš„ä½œè€…</h2><p><img src="https://ystest-bucket.s3.cn-north-1.jdcloud-oss.com/Netty%E7%9A%84%E4%BD%9C%E8%80%85%E5%9B%BE.png" alt="Nettyçš„ä½œè€…å›¾"><br>ä»–è¿˜æ˜¯å¦ä¸€ä¸ªè‘—åç½‘ç»œåº”ç”¨æ¡†æ¶Minaçš„é‡è¦è´¡çŒ®è€…  </p>
<h2 id="Nettyçš„åœ°ä½"><a href="#Nettyçš„åœ°ä½" class="headerlink" title="Nettyçš„åœ°ä½"></a>Nettyçš„åœ°ä½</h2><p>Nettyåœ¨javaç½‘ç»œåº”ç”¨æ¡†æ¶ä¸­çš„åœ°ä½å°±å¥½æ¯”Springæ¡†æ¶åœ¨JavaEEå¼€å‘ä¸­çš„åœ°ä½<br>ä»¥ä¸‹çš„æ¡†æ¶éƒ½ä½¿ç”¨äº†Nettyï¼Œå› ä¸ºå®ƒä»¬ç”±ç½‘ç»œé€šä¿¡éœ€æ±‚</p>
<ul>
<li>Cassandra - nosqlæ•°æ®åº“</li>
<li>Spark - å¤§æ•°æ®åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶</li>
<li>Hadoop - å¤§æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨æ¡†æ¶</li>
<li>RocketMQ - ali å¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—</li>
<li>ElasticSearch - æœç´¢å¼•æ“</li>
<li>gREC - rpcæ¡†æ¶</li>
<li>Dubbo - rpcæ¡†æ¶</li>
<li>Spring 5.x - flux apiå®Œå…¨æŠ›å¼ƒäº†tomcatï¼Œä½¿ç”¨nettyä½œä¸ºæœåŠ¡ç«¯</li>
<li>Zookeeper - åˆ†å¸ƒå¼åè°ƒæ¡†æ¶</li>
</ul>
<h2 id="Nettyçš„ä¼˜åŠ¿"><a href="#Nettyçš„ä¼˜åŠ¿" class="headerlink" title="Nettyçš„ä¼˜åŠ¿"></a>Nettyçš„ä¼˜åŠ¿</h2><ul>
<li>Netty vs NIOï¼Œå·¥ä½œé‡å¤§ï¼Œbugå¤š<ul>
<li>éœ€è¦è‡ªå·±æ„å»ºåè®®</li>
<li>è§£å†³TCPä¼ è¾“é—®é¢˜ï¼Œå¦‚é»åŒ…ã€åŠåŒ…</li>
<li>epollç©ºè½®è¯¢å¯¼è‡´CPU 100%</li>
<li>å¯¹APIè¿›è¡Œå¢å¼ºï¼Œä½¿ä¹‹æ›´æ˜“ç”¨ï¼Œå¦‚<code>FastThreadLocal</code> =&gt; <code>ThreadLocal</code>ï¼Œ<code>ByteBuf</code> =&gt; <code>ByteBuffer</code></li>
</ul>
</li>
<li>Netty vs å…¶ä»–ç½‘ç»œåº”ç”¨æ¡†æ¶<ul>
<li>Minaç”±apacheç»´æŠ¤ï¼Œå°†æ¥3.xç‰ˆæœ¬å¯èƒ½ä¼šç”±è¾ƒå¤§é‡æ„ï¼Œç ´åAPIå‘ä¸‹å…¼å®¹æ€§ï¼ŒNettyçš„å¼€å‘è¿­ä»£æ›´è¿…é€Ÿï¼ŒAPIæ›´ç®€ä»‹ã€æ–‡æ¡£æ›´ä¼˜ç§€</li>
<li>ä¹…ç»è€ƒéªŒï¼Œ16å¹´ï¼ŒNettyç‰ˆæœ¬<ul>
<li>2.x 2004</li>
<li>3.x 2008</li>
<li>4.x 2013</li>
<li>5.x å·²åºŸå¼ƒï¼ˆæ²¡æœ‰æ˜æ˜¾æ€§èƒ½æå‡ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼‰</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h1><h2 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h2><p>å¼€å‘ä¸€ä¸ªç®€å•çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯</p>
<ul>
<li>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ helloã€world</li>
<li>æœåŠ¡ç«¯ä»…æ¥æ”¶ï¼Œä¸åå›</li>
</ul>
<p>åŠ å…¥ä¾èµ–  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.72.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="æœåŠ¡å™¨ç«¯"><a href="#æœåŠ¡å™¨ç«¯" class="headerlink" title="æœåŠ¡å™¨ç«¯"></a>æœåŠ¡å™¨ç«¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.å¯åŠ¨å™¨ï¼Œè´Ÿè´£ç»„è£… netty ç»„ä»¶ï¼Œå¯åŠ¨æœåŠ¡</span></span><br><span class="line">        <span class="keyword">new</span> ServerBootstrap()</span><br><span class="line">                <span class="comment">//2. BossEventLoopã€WorkerEventLoop(selector,thread),group ç»„</span></span><br><span class="line">                <span class="comment">//ç±»ä¼¼äºå¤šçº¿ç¨‹ç‰ˆNIOä¸­çš„åˆ†ç»„ï¼Œä¸åŒçš„ç»„è´Ÿè´£ä¸åŒçš„ä»»åŠ¡ç±»å‹ï¼Œé‡Œé¢åŒ…å«selectorå’Œçº¿ç¨‹thread</span></span><br><span class="line">                <span class="comment">//åˆ›å»ºNioEventLoopGroupï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºçº¿ç¨‹æ± +selector</span></span><br><span class="line">                .group(<span class="keyword">new</span> NioEventLoopGroup())</span><br><span class="line">                <span class="comment">//3.é€‰æ‹© æœåŠ¡å™¨ ServerSocketChannel å®ç°</span></span><br><span class="line">                <span class="comment">//é€‰æ‹© Socket å®ç°ç±»ï¼Œå…¶ä¸­NioServerSocketChannel è¡¨ç¤ºåŸºäºNIOçš„æœåŠ¡å™¨ç«¯å®ç°ï¼Œå…¶ä»–çš„å®ç°è¿˜æœ‰</span></span><br><span class="line">                <span class="comment">//EpollServerSocketChannel KQueueServerSocketChannel OioServerSocketChannel</span></span><br><span class="line">                .channel(NioServerSocketChannel.class)</span><br><span class="line">                <span class="comment">//4.boss è´Ÿè´£å¤„ç†è¿æ¥ worker(child) è´Ÿè´£å¤„ç†è¯»å†™ï¼Œå†³å®šäº†worker(child)èƒ½æ‰§è¡Œé‚£äº›æ“ä½œ(handler)</span></span><br><span class="line">                <span class="comment">//ä¸ºå•¥æ–¹æ³•å« childHandler ï¼Œæ˜¯æ¥ä¸‹æ¥æ·»åŠ çš„å¤„ç†å™¨éƒ½æ˜¯ç»™ SocketChannel ç”¨çš„ï¼Œè€Œä¸æ˜¯ç»™ ServerSocketChannel</span></span><br><span class="line">                <span class="comment">//ChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œä»–çš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel æ–¹æ³•ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨</span></span><br><span class="line">                .childHandler(</span><br><span class="line">                        <span class="comment">//5.channel ä»£è¡¨å’Œå®¢æˆ·ç«¯è¿›è¡Œæ•°æ®è¯»å†™çš„é€šé“</span></span><br><span class="line">                        <span class="comment">//Initializer åˆå§‹åŒ–ï¼Œè´Ÿè´£æ·»åŠ åˆ«çš„ handler</span></span><br><span class="line">                        <span class="keyword">new</span> ChannelInitializer&lt;NioSocketChannel&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(NioSocketChannel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        <span class="comment">//6.æ·»åŠ å…·ä½“çš„ handler</span></span><br><span class="line">                        <span class="comment">//å°†ByteBufè½¬æ¢æˆå­—ç¬¦ä¸²</span></span><br><span class="line">                        <span class="comment">//SocketChannelçš„å¤„ç†å™¨ï¼Œè§£ç  ByteBuf =&gt; String</span></span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> StringDecoder());</span><br><span class="line">                        <span class="comment">//è‡ªå®šä¹‰ handler</span></span><br><span class="line">                        <span class="comment">//SocketChannelçš„ä¸šåŠ¡å¤„ç†å™¨ï¼Œä½¿ç”¨ä¸Šä¸€ä¸ªå¤„ç†å™¨çš„å¤„ç†ç»“æœ</span></span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> ChannelInboundHandlerAdapter()&#123;</span><br><span class="line">                            <span class="meta">@Override</span></span><br><span class="line">                            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                                <span class="comment">//æ‰“å°ä¸Šä¸€æ­¥è½¬æ¢çš„å­—ç¬¦ä¸²</span></span><br><span class="line">                                System.out.println(msg);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="comment">//7.ç»‘å®šç›‘å¬ç«¯å£</span></span><br><span class="line">                <span class="comment">//ServerSocketChannel ç»‘å®šç›‘å¬ç«¯å£</span></span><br><span class="line">                .bind(<span class="number">8080</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//å¯åŠ¨ç±»</span></span><br><span class="line">        <span class="keyword">new</span> Bootstrap()</span><br><span class="line">               <span class="comment">//2.æ·»åŠ  EventLoop</span></span><br><span class="line">                <span class="comment">// åˆ›å»º NioEventLoopGroup åŒserver</span></span><br><span class="line">                .group(<span class="keyword">new</span> NioEventLoopGroup())</span><br><span class="line">                <span class="comment">//3. é€‰æ‹©å®¢æˆ·ç«¯channel</span></span><br><span class="line">                <span class="comment">//é€‰æ‹©å®¢æˆ·ç«¯Socketå®ç°ç±»ï¼ŒNioSocketChannel è¡¨ç¤ºåŸºäºNIOçš„å®¢æˆ·ç«¯å®ç°å…¶ä»–å®ç°è¿˜æœ‰</span></span><br><span class="line">                .channel(NioSocketChannel.class)</span><br><span class="line">                <span class="comment">//4.æ·»åŠ å¤„ç†å™¨</span></span><br><span class="line">                <span class="comment">//æ·»åŠ  SocketChannel çš„å¤„ç†å™¨ï¼ŒChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰</span></span><br><span class="line">                <span class="comment">//å®ƒçš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel æ–¹æ³•ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨</span></span><br><span class="line">                .handler(<span class="keyword">new</span> ChannelInitializer&lt;NioSocketChannel&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span> <span class="comment">//åœ¨è¿æ¥å»ºç«‹åè¢«è°ƒç”¨</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(NioSocketChannel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        <span class="comment">//æ¶ˆæ¯ä¼šç»è¿‡é€šé“handlerå¤„ç†ï¼Œè¿™é‡Œæ˜¯å°†String =&gt; ByteBufå‘å‡º</span></span><br><span class="line">                        <span class="comment">//æ•°æ®ç»è¿‡ç½‘ç»œä¼ è¾“ï¼Œåˆ°è¾¾æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨ç«¯çš„handlerå¤„ç†å™¨å…ˆåè¢«è§¦å‘ï¼Œèµ°å®Œä¸€ä¸ªæµç¨‹</span></span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> StringEncoder());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="comment">//5.è¿æ¥æœåŠ¡å™¨</span></span><br><span class="line">                <span class="comment">//æŒ‡å®šè¦è¿æ¥çš„æœåŠ¡å™¨å’Œç«¯å£</span></span><br><span class="line">                .connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">8080</span>))</span><br><span class="line">                <span class="comment">//Nettyä¸­å¾ˆå¤šæ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå¦‚connectï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨syncæ–¹æ³•ç­‰å¾…connectå»ºç«‹è¿æ¥å®Œæ¯•</span></span><br><span class="line">                .sync()</span><br><span class="line">                <span class="comment">//è·å– channel å¯¹è±¡ï¼Œå®ƒå³ä¸ºé€šé“æŠ½è±¡ï¼Œå¯ä»¥è¿›è¡Œæ•°è¯»å†™æ“ä½œ</span></span><br><span class="line">                .channel()</span><br><span class="line">                <span class="comment">//6.å‘æœåŠ¡ç«¯å‘é€æ•°æ®</span></span><br><span class="line">                <span class="comment">//å†™å…¥æ¶ˆæ¯å¹¶æ¸…ç©ºç¼“å†²åŒº</span></span><br><span class="line">                .writeAndFlush(<span class="string">&quot;hello, world&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ğŸ’¡ æç¤º</strong><br>ä¸€å¼€å§‹éœ€è¦æ ‘ç«‹æ­£ç¡®çš„è§‚å¿µ  </p>
<ul>
<li>æŠŠ<code>channel</code>ç†è§£ä¸ºæ•°æ®çš„é€šé“</li>
<li>æŠŠmsgç†è§£ä¸ºæµåŠ¨çš„æ•°æ®ï¼Œæœ€å¼€å§‹è¾“å…¥æ˜¯<code>ByteBuf</code>ï¼Œä½†ç»è¿‡<code>pipeline</code>çš„åŠ å·¥ï¼Œä¼šå˜æˆå…¶ä»–ç±»å‹å¯¹è±¡ï¼Œæœ€åè¾“å‡ºåˆå˜æˆ<code>ByteBuf</code></li>
<li>æŠŠ<code>handler</code>ç†è§£ä¸ºæ•°æ®çš„å¤„ç†å·¥åº<ul>
<li>å·¥åºç”±å¤šé“ï¼Œåˆåœ¨ä¸€èµ·å°±æ˜¯<code>pipeline</code>ï¼Œ<code>pipeline</code>è´Ÿè´£å‘å¸ƒäº‹ä»¶ï¼ˆè¯»ã€è¯»å–å®Œæˆâ€¦ï¼‰ä¼ æ’­ç»™æ¯ä¸ª<code>handler</code>ï¼Œ<code>handler</code>å¯¹è‡ªå·±æ„Ÿå…´è¶£çš„äº‹ä»¶è¿›è¡Œå¤„ç†ï¼ˆé‡å†™äº†ç›¸åº”äº‹ä»¶å¤„ç†æ–¹æ³•ï¼‰</li>
<li><code>handler</code>åˆ†<code>Inbound</code>å’Œ<code>Outbound</code>ä¸¤ç±»</li>
</ul>
</li>
<li>æŠŠ<code>eventLoop</code>ç†è§£ä¸ºå¤„ç†æ•°æ®çš„å·¥äºº<ul>
<li>å·¥äººå¯ä»¥ç®¡ç†å¤šä¸ª<code>channel</code>çš„ioæ“ä½œï¼Œå¹¶ä¸”ä¸€æ—¦å·¥äººè´Ÿè´£äº†æŸä¸ª<code>channel</code>ï¼Œå°±è¦è´Ÿè´£åˆ°åº•ï¼ˆç»‘å®šï¼‰</li>
<li>å·¥äººæ—¢å¯ä»¥æ‰§è¡Œioæ“ä½œï¼Œä¹Ÿå¯ä»¥è¿›è¡Œä»»åŠ¡å¤„ç†ï¼Œæ¯ä½å·¥äººæœ‰ä»»åŠ¡é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—é‡Œå¯ä»¥å †æ”¾å¤šä¸ª<code>channel</code>çš„å¾…å¤„ç†ä»»åŠ¡ï¼Œä»»åŠ¡åˆ†ä¸ºæ™®é€šä»»åŠ¡ã€å®šæ—¶ä»»åŠ¡</li>
<li>å·¥äººæŒ‰ç…§<code>pipeline</code>é¡ºåºï¼Œä»¥æ¬¡æŒ‰ç…§<code>handler</code>çš„è§„åˆ’ï¼ˆä»£ç ï¼‰å¤„ç†æ•°æ®ï¼Œå¯ä»¥ä¸ºæ¯é“å·¥åºæŒ‡å®šä¸åŒçš„å·¥äºº  </li>
</ul>
</li>
</ul>
<h1 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a>ç»„ä»¶</h1><h2 id="EventLoop"><a href="#EventLoop" class="headerlink" title="EventLoop"></a><code>EventLoop</code></h2><p>äº‹ä»¶å¾ªç¯å¯¹è±¡<br><code>EventLoop</code>æœ¬è´¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œå™¨(åŒæ—¶ç»´æŠ¤äº†ä¸€ä¸ª<code>selector</code>)ï¼Œé‡Œé¢æœ‰<code>run</code>æ–¹æ³•å¤„ç†<code>Channel</code>ä¸Šæºæºä¸æ–­çš„ io äº‹ä»¶<br>å®ƒçš„ç»§æ‰¿å…³ç³»æ¯”è¾ƒå¤æ‚  </p>
<ul>
<li>ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ª<code>j.u.c.ScheduledExecutorService</code> å› æ­¤åŒ…å«äº†çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„æ–¹æ³•</li>
<li>å¦ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ªnettyè‡ªå·±çš„<code>OrderedEventExecutor</code><ul>
<li>æä¾›äº† <code>boolean inEventLoop(Thread thread)</code>æ–¹æ³•åˆ¤æ–­ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦æ˜¯å±äºæ­¤<code>EventLoop</code></li>
<li>æä¾›äº†<code>parent</code>æ–¹æ³•æ¥çœ‹çœ‹è‡ªå·±å±äºå“ªä¸ª<code>EventLoop</code></li>
</ul>
</li>
</ul>
<p><img src="https://ystest-bucket.s3.cn-north-1.jdcloud-oss.com/EventLoop%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB%E5%9B%BE%E7%A4%BA.png" alt="EventLoopç»§æ‰¿å…³ç³»å›¾ç¤º"></p>
<p><strong><code>EventLoopGroup</code></strong><br>äº‹ä»¶å¾ªç¯ç»„<br><code>EventLoopGroup</code>æ˜¯ä¸€ç»„<code>EventLoop</code>ï¼Œ<code>Channel</code>ä¸€èˆ¬ä¼šè°ƒç”¨<code>EventLoopGroup</code>çš„<code>register</code>æ–¹æ³•æ¥ç»‘å®šå…¶ä¸­ä¸€ä¸ª<code>EventLoop</code>ï¼Œåç»­æ•´ä¸ª<code>Channel</code>ä¸Šçš„ioäº‹ä»¶éƒ½ç”±æ­¤<code>EventLoop</code>æ¥å¤„ç†ï¼ˆä¿è¯äº†ioäº‹ä»¶å¤„ç†æ—¶çš„çº¿ç¨‹å®‰å…¨ï¼‰</p>
<ul>
<li>ç»§æ‰¿è‡ªnettyè‡ªå·±çš„<code>EventExecutorGroup</code><ul>
<li>å®ç°äº†<code>Iterable</code>æ¥å£æä¾›éå†<code>EventLoop</code>çš„èƒ½åŠ›</li>
<li>å¦æœ‰<code>next</code>æ–¹æ³•è·å–é›†åˆä¸­ä¸‹ä¸€ä¸ª<code>EventLoop</code></li>
</ul>
</li>
</ul>
<p>ä»¥ä¸€ä¸ªç®€å•çš„å®ç°ä¸ºä¾‹ï¼š  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// å†…éƒ¨åˆ›å»ºäº†ä¸¤ä¸ª EventLoop, æ¯ä¸ª EventLoop ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹</span><br><span class="line">DefaultEventLoopGroup group = new DefaultEventLoopGroup(2);</span><br><span class="line">System.out.println(group.next());</span><br><span class="line">System.out.println(group.next());</span><br><span class="line">System.out.println(group.next());</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">io.netty.channel.DefaultEventLoop@60f82f98</span><br><span class="line">io.netty.channel.DefaultEventLoop@35f983a6</span><br><span class="line">io.netty.channel.DefaultEventLoop@60f82f98</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨forå¾ªç¯è°ƒç”¨ï¼š </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DefaultEventLoopGroup group = new DefaultEventLoopGroup(2);</span><br><span class="line">for (EventExecutor eventLoop : group) &#123;</span><br><span class="line">    System.out.println(eventLoop);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»“è®ºï¼š<br>è°ƒç”¨<code>group.next()</code>è·å–äº‹ä»¶å¾ªç¯å¯¹è±¡ï¼Œå¯ä»¥å¾ªç¯è·å–ï¼Œæ¯”å¦‚ç°åœ¨å¤šæ¬¡è°ƒç”¨è·å–å¯¹è±¡ï¼Œç¬¬ä¸€æ¬¡å’Œç¬¬ä¸‰æ¬¡è·å–çš„æ˜¯ä¸€æ ·çš„ï¼Œç¬¬äºŒæ¬¡å’Œç¬¬å››æ¬¡æ˜¯ä¸€æ ·çš„ï¼Œä»¥æ¬¡ç±»æ¨ï¼Œå®ç°äº†ä¸€ä¸ªè½®è¯¢çš„æ•ˆæœ</p>
<p><strong>æ‰§è¡Œæ™®é€šä»»åŠ¡å’Œå®šæ—¶ä»»åŠ¡</strong><br><code>EventLoopGroup</code>ç»§æ‰¿äº†çº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œæ‰€ä»¥æœ¬èº«å°±ç›¸å½“äºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œæ‰§è¡Œæ™®é€šä»»åŠ¡ç›´æ¥ä½¿ç”¨<code>submit</code>æ–¹æ³•æˆ–è€…<code>execute</code>æ–¹æ³•æäº¤ä»»åŠ¡å³å¯ï¼Œå®šæ—¶ä»»åŠ¡è°ƒç”¨<code>scheduleAtFixedRate</code>æ–¹æ³•æ‰§è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestEventLoop</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.åˆ›å»ºäº‹ä»¶å¾ªç¯ç»„</span></span><br><span class="line">        EventLoopGroup group = <span class="keyword">new</span> NioEventLoopGroup(<span class="number">2</span>);<span class="comment">//ioäº‹ä»¶ï¼Œæ™®é€šä»»åŠ¡ï¼Œå®šæ—¶ä»»åŠ¡</span></span><br><span class="line">                             <span class="comment">//new DefaultEventLoopGroup();//æ™®é€šä»»åŠ¡ï¼Œå®šæ—¶ä»»åŠ¡</span></span><br><span class="line">        <span class="comment">//2.è·å–ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯å¯¹è±¡</span></span><br><span class="line">        <span class="comment">//è°ƒç”¨group.next()è·å–äº‹ä»¶å¾ªç¯å¯¹è±¡ï¼Œå¯ä»¥å¾ªç¯è·å–ï¼Œæ¯”å¦‚ç°åœ¨å¤šæ¬¡è°ƒç”¨è·å–å¯¹è±¡ï¼Œç¬¬ä¸€æ¬¡å’Œç¬¬ä¸‰æ¬¡è·å–çš„æ˜¯ä¸€æ ·çš„ï¼Œç¬¬äºŒæ¬¡å’Œç¬¬å››æ¬¡æ˜¯ä¸€æ ·çš„ï¼Œä»¥æ¬¡ç±»æ¨ï¼Œå®ç°äº†ä¸€ä¸ªè½®è¯¢çš„æ•ˆæœ</span></span><br><span class="line">        System.out.println(group.next());</span><br><span class="line">        System.out.println(group.next());</span><br><span class="line">        System.out.println(group.next());</span><br><span class="line">        System.out.println(group.next());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.æ‰§è¡Œæ™®é€šä»»åŠ¡</span></span><br><span class="line">        group.next().submit(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                log.debug(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.æŒ‡å®šå®šæ—¶ä»»åŠ¡</span></span><br><span class="line">        group.next().scheduleAtFixedRate(()-&gt;&#123;</span><br><span class="line">            log.debug(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">        &#125;,<span class="number">0</span>,<span class="number">1</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">        log.debug(<span class="string">&quot;main&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ğŸ’¡ ä¼˜é›…åœ°å…³é—­</strong><br>ä¼˜é›…åœ°å…³é—­ï¼Œéœ€è¦è°ƒç”¨<code>group</code>çš„<code>group.shutdownGracefully()</code>æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šé¦–å…ˆåˆ‡æ¢<code>EventLoopGroup</code>åˆ°å…³é—­çŠ¶æ€ä»è€Œæ‹’ç»æ–°çš„ä»»åŠ¡åŠ å…¥ï¼Œç„¶ååœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡éƒ½å¤„ç†å®Œæˆåï¼Œåœæ­¢çº¿ç¨‹çš„è¿è¡Œï¼Œä»è€Œç¡®ä¿æ•´ä½“åº”ç”¨æ˜¯åœ¨æ­£å¸¸æœ‰åºçš„çŠ¶æ€ä¸‹é€€å‡ºçš„  </p>
<p><strong><code>NioEventLoop</code> å¤„ç†IOäº‹ä»¶</strong>  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventLoopServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">new</span> ServerBootstrap()</span><br><span class="line">            <span class="comment">//boss å’Œ worker</span></span><br><span class="line">            <span class="comment">//ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯bossï¼Œåªè´Ÿè´£ ServerSocketChannel ä¸Šçš„ accept äº‹ä»¶</span></span><br><span class="line">            <span class="comment">//ç¬¬äºŒä¸ªå‚æ•°æ˜¯worker è´Ÿè´£ SocketChannel ä¸Šçš„è¯»å†™äº‹ä»¶</span></span><br><span class="line">            .group(<span class="keyword">new</span> NioEventLoopGroup(), <span class="keyword">new</span> NioEventLoopGroup(<span class="number">2</span>))</span><br><span class="line">            .channel(NioServerSocketChannel.class)</span><br><span class="line">            .childHandler(<span class="keyword">new</span> ChannelInitializer&lt;NioSocketChannel&gt;() &#123;</span><br><span class="line">              <span class="meta">@Override</span></span><br><span class="line">              <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(NioSocketChannel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                ch.pipeline().addLast(<span class="keyword">new</span> ChannelInboundHandlerAdapter() &#123;</span><br><span class="line">                  <span class="meta">@Override</span></span><br><span class="line">                  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                    ByteBuf buf = (ByteBuf) msg;</span><br><span class="line">                    log.debug(buf.toString(Charset.defaultCharset()));</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;).bind(<span class="number">8080</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®¢æˆ·ç«¯å¯åŠ¨å¤šæ¬¡ï¼Œä½¿ç”¨dubugæ¨¡å¼å¤šæ¬¡è°ƒç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventLoopClient</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Channel channel = <span class="keyword">new</span> Bootstrap()</span><br><span class="line">                .group(<span class="keyword">new</span> NioEventLoopGroup())</span><br><span class="line">                .channel(NioSocketChannel.class)</span><br><span class="line">                .handler(<span class="keyword">new</span> ChannelInitializer&lt;NioSocketChannel&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(NioSocketChannel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> StringEncoder());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8080</span>))</span><br><span class="line">                .sync()</span><br><span class="line">                .channel();</span><br><span class="line">        System.out.println(channel);</span><br><span class="line">        System.out.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">11:37:14 [DEBUG] [nioEventLoopGroup-3-1] c.y.n.c.EventLoopServer - 1</span><br><span class="line">11:37:31 [DEBUG] [nioEventLoopGroup-3-2] c.y.n.c.EventLoopServer - 2</span><br><span class="line">11:37:46 [DEBUG] [nioEventLoopGroup-3-1] c.y.n.c.EventLoopServer - 3</span><br><span class="line">11:37:49 [DEBUG] [nioEventLoopGroup-3-1] c.y.n.c.EventLoopServer - 3</span><br><span class="line">11:37:57 [DEBUG] [nioEventLoopGroup-3-2] c.y.n.c.EventLoopServer - 2</span><br><span class="line">11:37:57 [DEBUG] [nioEventLoopGroup-3-2] c.y.n.c.EventLoopServer - 2</span><br><span class="line">11:38:01 [DEBUG] [nioEventLoopGroup-3-1] c.y.n.c.EventLoopServer - 1</span><br><span class="line">11:38:01 [DEBUG] [nioEventLoopGroup-3-1] c.y.n.c.EventLoopServer - 1</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ˜¯ä¸¤ä¸ªäººå·¥äººè½®æµå¤„ç†<code>channel</code>çš„äº‹ä»¶ï¼Œå¹¶ä¸”æ¯ä¸ª<code>channel</code>æ˜¯å’Œçº¿ç¨‹è¿›è¡Œç»‘å®šçš„ï¼Œå¤šæ¬¡è°ƒç”¨ä¹Ÿæ˜¯ä½¿ç”¨åŒä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†<br><img src="https://ystest-bucket.s3.cn-north-1.jdcloud-oss.com/NioEventLoop%E5%A4%84%E7%90%86%E4%BA%8B%E4%BB%B6%E5%9B%BE%E7%A4%BA.png" alt="NioEventLoopå¤„ç†äº‹ä»¶å›¾ç¤º"></p>
<p><strong>åœ¨å¢åŠ ä¸¤ä¸ªénioçš„å·¥äºº</strong>  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventLoopServer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//ç»†åˆ†2ï¼šåˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„EventLoopGroup</span></span><br><span class="line">        EventLoopGroup group = <span class="keyword">new</span> DefaultEventLoopGroup();</span><br><span class="line">        <span class="keyword">new</span> ServerBootstrap()</span><br><span class="line">                <span class="comment">//boss å’Œ worker</span></span><br><span class="line">                <span class="comment">//ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯bossï¼Œåªè´Ÿè´£ ServerSocketChannel ä¸Šçš„ accept äº‹ä»¶</span></span><br><span class="line">                <span class="comment">//ç¬¬äºŒä¸ªå‚æ•°æ˜¯worker è´Ÿè´£ SocketChannel ä¸Šçš„è¯»å†™äº‹ä»¶</span></span><br><span class="line">                .group(<span class="keyword">new</span> NioEventLoopGroup(),<span class="keyword">new</span> NioEventLoopGroup(<span class="number">2</span>))</span><br><span class="line">                .channel(NioServerSocketChannel.class)</span><br><span class="line">                .childHandler(<span class="keyword">new</span> ChannelInitializer&lt;NioSocketChannel&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(NioSocketChannel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        ch.pipeline().addLast(<span class="string">&quot;handler1&quot;</span>,<span class="keyword">new</span> ChannelInboundHandlerAdapter()&#123;</span><br><span class="line">                            <span class="meta">@Override</span></span><br><span class="line">                            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                                ByteBuf buf = (ByteBuf)msg;</span><br><span class="line">                                log.debug(buf.toString(Charset.defaultCharset()));</span><br><span class="line">                                ctx.fireChannelRead(msg);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;).addLast(group,<span class="string">&quot;handler2&quot;</span>,<span class="keyword">new</span> ChannelInboundHandlerAdapter()&#123;</span><br><span class="line">                            <span class="meta">@Override</span></span><br><span class="line">                            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                                ByteBuf buf = (ByteBuf)msg;</span><br><span class="line">                                log.debug(buf.toString(Charset.defaultCharset()));</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).bind(<span class="number">8080</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®¢æˆ·ç«¯ä»£ç ä¸å˜ï¼Œå¯åŠ¨å¤šæ¬¡ï¼Œå¤šæ¬¡è°ƒç”¨ï¼Œç»“æœå¦‚ä¸‹ï¼š    </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">11:42:57 [DEBUG] [nioEventLoopGroup-4-1] c.y.n.c.EventLoopServer - 1</span><br><span class="line">11:42:57 [DEBUG] [defaultEventLoopGroup-2-1] c.y.n.c.EventLoopServer - 1</span><br><span class="line">11:43:10 [DEBUG] [nioEventLoopGroup-4-2] c.y.n.c.EventLoopServer - 2</span><br><span class="line">11:43:10 [DEBUG] [defaultEventLoopGroup-2-2] c.y.n.c.EventLoopServer - 2</span><br><span class="line">11:43:23 [DEBUG] [nioEventLoopGroup-4-1] c.y.n.c.EventLoopServer - 3</span><br><span class="line">11:43:23 [DEBUG] [defaultEventLoopGroup-2-3] c.y.n.c.EventLoopServer - 3</span><br><span class="line">11:43:24 [DEBUG] [nioEventLoopGroup-4-1] c.y.n.c.EventLoopServer - 3</span><br><span class="line">11:43:24 [DEBUG] [defaultEventLoopGroup-2-3] c.y.n.c.EventLoopServer - 3</span><br><span class="line">11:43:24 [DEBUG] [nioEventLoopGroup-4-1] c.y.n.c.EventLoopServer - 3</span><br><span class="line">11:43:24 [DEBUG] [defaultEventLoopGroup-2-3] c.y.n.c.EventLoopServer - 3</span><br><span class="line">11:43:27 [DEBUG] [nioEventLoopGroup-4-2] c.y.n.c.EventLoopServer - 2</span><br><span class="line">11:43:27 [DEBUG] [defaultEventLoopGroup-2-2] c.y.n.c.EventLoopServer - 2</span><br><span class="line">11:43:27 [DEBUG] [nioEventLoopGroup-4-2] c.y.n.c.EventLoopServer - 2</span><br><span class="line">11:43:27 [DEBUG] [defaultEventLoopGroup-2-2] c.y.n.c.EventLoopServer - 2</span><br><span class="line">11:43:29 [DEBUG] [nioEventLoopGroup-4-1] c.y.n.c.EventLoopServer - 1</span><br><span class="line">11:43:29 [DEBUG] [defaultEventLoopGroup-2-1] c.y.n.c.EventLoopServer - 1</span><br><span class="line">11:43:30 [DEBUG] [nioEventLoopGroup-4-1] c.y.n.c.EventLoopServer - 1</span><br><span class="line">11:43:30 [DEBUG] [defaultEventLoopGroup-2-1] c.y.n.c.EventLoopServer - 1</span><br></pre></td></tr></table></figure>
<p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œnioçš„å·¥äººå’Œénioçš„å·¥äººéƒ½ç»‘å®šäº†<code>channel</code>ï¼Œä¼šæŒ‰ç…§ç»‘å®šçš„é¡ºåºä»¥æ¬¡æ‰§è¡Œï¼Œå®¢æˆ·ç«¯çš„æ¯æ¬¡è°ƒç”¨åŒæ ·ç»‘å®šäº†<code>EventLoop</code>ä¹Ÿå°±æ˜¯çº¿ç¨‹<br>ä¸åŒ<code>handler</code>ä¹‹é—´ä»»åŠ¡çš„ä¼ é€’é€šè¿‡ <code>ctx.fireChannelRead(msg)</code> æ–¹æ³•å®ç°ï¼Œä¸Šä¸€ä¸ª<code>handler</code>éœ€è¦è°ƒç”¨ä¸‹ä¸€ä¸ª<code>handler</code>çš„æ—¶å€™æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œä¸ç„¶æ— æ³•å®ç°è°ƒç”¨<br><img src="https://ystest-bucket.s3.cn-north-1.jdcloud-oss.com/EventLoop%E7%BB%91%E5%AE%9A%E7%BA%BF%E7%A8%8B%E5%9B%BE%E7%A4%BA2.png" alt="EventLoopç»‘å®šçº¿ç¨‹å›¾ç¤º2"></p>
<p><strong>ğŸ’¡ <code>handler</code>æ‰§è¡Œä¸­å¦‚ä½•æ¢äºº</strong><br>ä¸Šä¸€ä¸ª<code>handler</code>å¦‚ä½•å°†ä»»åŠ¡ä¼ é€’ç»™ä¸‹ä¸€ä¸ª<code>handler</code>æ‰§è¡Œï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š<br><code>io.netty.channel.AbstractChannelHandlerContext#invokeChannelRead()</code>  </p>
<ul>
<li>å¦‚æœä¸¤ä¸ª<code>handler</code>ç»‘å®šçš„æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ç›´æ¥è°ƒç”¨  </li>
<li>å¦åˆ™ï¼ŒæŠŠè¦è°ƒç”¨çš„ä»£ç å°è£…ä¸ºä¸€ä¸ªä»»åŠ¡å¯¹è±¡ï¼Œç”±ä¸‹ä¸€ä¸ª<code>handler</code>çš„çº¿ç¨‹æ¥è°ƒç”¨  </li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">static void invokeChannelRead(final AbstractChannelHandlerContext next, Object msg) &#123;</span><br><span class="line">    final Object m = next.pipeline.touch(ObjectUtil.checkNotNull(msg, &quot;msg&quot;), next);</span><br><span class="line">    // ä¸‹ä¸€ä¸ª handler çš„äº‹ä»¶å¾ªç¯æ˜¯å¦ä¸å½“å‰çš„äº‹ä»¶å¾ªç¯æ˜¯åŒä¸€ä¸ªçº¿ç¨‹</span><br><span class="line">    //è·å–ä¸‹ä¸€ä¸ªhandleräº‹ä»¶å¾ªç¯å¯¹è±¡ï¼ˆEventLoopï¼‰</span><br><span class="line">    EventExecutor executor = next.executor();</span><br><span class="line">    </span><br><span class="line">    // æ˜¯ï¼Œç›´æ¥è°ƒç”¨ï¼Œå¦‚æœä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯å¯¹è±¡ä¹Ÿå°±æ˜¯EventLoopæ˜¯å½“å‰å¯¹è±¡ï¼ˆçº¿ç¨‹ï¼‰ï¼Œç›´æ¥åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œæ–¹æ³•</span><br><span class="line">    if (executor.inEventLoop()) &#123;</span><br><span class="line">        next.invokeChannelRead(m);</span><br><span class="line">    &#125; </span><br><span class="line">    // ä¸æ˜¯ï¼Œå°†è¦æ‰§è¡Œçš„ä»£ç ä½œä¸ºä»»åŠ¡æäº¤ç»™ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯å¤„ç†ï¼ˆæ¢äººï¼‰</span><br><span class="line">    //å¦‚æœä¸æ˜¯ï¼Œéœ€è¦å°†ä»»åŠ¡æäº¤åˆ°å¦å¤–çš„çº¿ç¨‹ä¸­</span><br><span class="line">    else &#123;</span><br><span class="line">        executor.execute(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                next.invokeChannelRead(m);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a><code>Channel</code></h2><p><code>channel</code>çš„ä¸»è¦ä½œç”¨  </p>
<ul>
<li><code>close()</code>å¯ä»¥ç”¨æ¥å…³é—­<code>channel</code></li>
<li><code>closeFuture()</code>ç”¨æ¥å¤„ç†<code>channel</code>çš„å…³é—­ï¼ˆè°ƒç”¨<code>close()</code>æ–¹æ³•ä¹‹åçš„å–„åå¤„ç†ï¼‰<ul>
<li><code>sync()</code>æ–¹æ³•ä½œç”¨æ˜¯åŒæ­¥ç­‰å¾…<code>channel</code>å…³é—­</li>
<li>è€Œ<code>addListener</code>æ–¹æ³•æ˜¯å¼‚æ­¥ç­‰å¾…<code>channel</code>å…³é—­</li>
</ul>
</li>
<li><code>pipeline()</code>æ–¹æ³•æ·»åŠ å¤„ç†å™¨  </li>
<li><code>write()</code>æ–¹æ³•å°†æ•°æ®å†™å…¥ï¼ˆä¼šå°†æ•°æ®å†™å…¥<code>channel</code>çš„ç¼“å†²åŒºï¼Œå¹¶ä¸ä¼šç«‹åˆ»å‘å‡ºï¼Œé™¤éè°ƒç”¨äº†<code>flush</code>æ–¹æ³•æˆ–è€…ç¼“å†²åŒºæ•°æ®è¾¾åˆ°ä¸€å®šå®¹é‡ï¼‰</li>
<li><code>writeAndFlush()</code>æ–¹æ³•å°†æ•°æ®å†™å…¥å¹¶åˆ·å‡º</li>
</ul>
<h3 id="ChannelFuture"><a href="#ChannelFuture" class="headerlink" title="ChannelFuture"></a>ChannelFuture</h3><blockquote>
<p>ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œå½“è°ƒç”¨äº†<code>connect</code>æ–¹æ³•å»ºç«‹è¿æ¥ï¼Œä¼šè¿”å›ä¸€ä¸ª<code>ChannelFuture</code>å¯¹è±¡<br>å¯ä»¥é€šè¿‡<code>ChannelFuture</code>å¯¹è±¡è·å–<code>channel</code>å¯¹è±¡å‘é€æ•°æ®<br>ä½†å¦‚æœè°ƒç”¨äº†<code>connect</code>æ–¹æ³•åï¼Œç«‹å³è·å–<code>Channel</code>å¯¹è±¡ï¼Œæ­¤æ—¶çš„<code>Channel</code>å¯¹è±¡æ˜¯ä¸å®Œæ•´çš„<br>å› ä¸º<code>connect</code>æ–¹æ³•å»ºç«‹è¿æ¥å¹¶ä¸æ˜¯åœ¨å½“å‰çº¿ç¨‹å»åˆ›å»ºè¿æ¥çš„ï¼Œè€Œæ˜¯ä¼šå¼‚æ­¥å¤„ç†ï¼Œä¹Ÿå°±æ˜¯å‘é€ç»™<code>BoosEventLoopGroup</code>å¤„ç†<br>å¯ä»¥é€šè¿‡è°ƒç”¨<code>ChannelFuture</code>çš„<code>sync()</code>æ–¹æ³•ç­‰å¾…è¿æ¥å»ºç«‹å®Œæ¯•ï¼Œæ­¤æ–¹æ³•ä¼šå°†çº¿ç¨‹é™·å…¥é˜»å¡ï¼Œç›´åˆ°è¿æ¥å»ºç«‹å®Œæ¯•<br>æˆ–è€…ä½¿ç”¨<code>ChannelFuture</code>çš„<code>addListener()</code>æ–¹æ³•ï¼Œå°è£…ä¸€ä¸ªä»»åŠ¡å¯¹è±¡é€šè¿‡è¯¥æ–¹æ³•ä¼ å…¥ï¼Œä¼šç­‰å¾…è¿æ¥å»ºç«‹å®Œæ¯•ä¹‹åæ‰§è¡Œä»»åŠ¡  </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        ChannelFuture channelFuture = <span class="keyword">new</span> Bootstrap()</span><br><span class="line">                .group(<span class="keyword">new</span> NioEventLoopGroup())</span><br><span class="line">                .channel(NioSocketChannel.class)</span><br><span class="line">                .handler(<span class="keyword">new</span> ChannelInitializer&lt;NioSocketChannel&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(NioSocketChannel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> StringEncoder());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8080</span>));</span><br><span class="line"><span class="comment">//        channelFuture.sync();</span></span><br><span class="line"><span class="comment">//        channelFuture.channel();</span></span><br><span class="line">        channelFuture.addListener(<span class="keyword">new</span> ChannelFutureListener() &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationComplete</span><span class="params">(ChannelFuture future)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            Channel channel = channelFuture.channel();</span><br><span class="line">            System.out.println(channel);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CloseFuture"><a href="#CloseFuture" class="headerlink" title="CloseFuture"></a><code>CloseFuture</code></h3><blockquote>
<p>æœåŠ¡ç«¯ä»£ç ä¸å˜ï¼Œå®¢æˆ·ç«¯ä»£ç å¦‚ä¸‹æ‰€ç¤º<br>å…³é—­<code>channel</code>çš„æ—¶å€™ç›´æ¥è°ƒç”¨<code>close</code>æ–¹æ³•ï¼Œå¹¶ä¸ä¼šç«‹å³å…³é—­ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•<br>å¯ä»¥å…ˆé€šè¿‡<code>Channel</code>çš„ <code>channel.closeFuture()</code> æ–¹æ³•è·å– <code>CloseFuture</code> å¯¹è±¡<br>ç„¶åå¯ä»¥å†é€šè¿‡<code>CloseFuture</code>å¯¹è±¡çš„<code>sync()</code>æ–¹æ³•è¿›è¡ŒåŒæ­¥å…³é—­ï¼Œæˆ–è€…é€šè¿‡ <code>addListener</code> æ–¹æ³•è¿›è¡Œå¼‚æ­¥å…³é—­<br><code>sync()</code>æ–¹æ³•ä¼šé˜»å¡å½“å‰çš„è°ƒç”¨çº¿ç¨‹ï¼Œç›´åˆ°channelå…³é—­ç»“æŸå<br><code>addListener()</code>æ–¹æ³•åˆ™å¯ä»¥å°†éœ€è¦<code>Channel</code>å…³é—­åå¤„ç†çš„é€»è¾‘å°è£…æˆä»»åŠ¡å¯¹è±¡ï¼Œç­‰å®Œå…¨å…³é—­ä¹‹åä¼šè¿›è¡Œå›è°ƒæ‰§è¡Œä»»åŠ¡  </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CloseFutureClient</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        NioEventLoopGroup group = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line">        ChannelFuture channelFuture = <span class="keyword">new</span> Bootstrap()</span><br><span class="line">                .group(group)</span><br><span class="line">                .channel(NioSocketChannel.class)</span><br><span class="line">                .handler(<span class="keyword">new</span> ChannelInitializer&lt;NioSocketChannel&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(NioSocketChannel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> LoggingHandler(LogLevel.DEBUG));</span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> StringEncoder());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8080</span>));</span><br><span class="line">        Channel channel = channelFuture.sync().channel();</span><br><span class="line">        log.debug(<span class="string">&quot;&#123;&#125;&quot;</span>, channel);</span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">                String line = scanner.nextLine();</span><br><span class="line">                <span class="keyword">if</span> (line.equals(<span class="string">&quot;q&quot;</span>))&#123;</span><br><span class="line">                    channel.close();<span class="comment">//close å¼‚æ­¥æ“ä½œ</span></span><br><span class="line">                    <span class="comment">//log.debug(&quot;å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ&quot;);//ä¸èƒ½åœ¨è¿™é‡Œå–„å</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                channel.writeAndFlush(line);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="comment">//è·å– CloseFutureå¯¹è±¡ 1.åŒæ­¥å¤„ç†å…³é—­ï¼Œ2.å¼‚æ­¥å¤„ç†å…³é—­</span></span><br><span class="line">        ChannelFuture closeFuture = channel.closeFuture();</span><br><span class="line">        <span class="comment">/*log.debug(&quot;waiting close ...&quot;);</span></span><br><span class="line"><span class="comment">        closeFuture.sync();</span></span><br><span class="line"><span class="comment">        log.debug(&quot;å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ&quot;);*/</span></span><br><span class="line"></span><br><span class="line">        closeFuture.addListener(<span class="keyword">new</span> ChannelFutureListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationComplete</span><span class="params">(ChannelFuture future)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                log.debug(<span class="string">&quot;å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ&quot;</span>);</span><br><span class="line">                group.shutdownGracefully();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ğŸ’¡å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ</strong>  </p>
<ul>
<li>å¼‚æ­¥æå‡çš„ä¸æ˜¯æ•ˆç‡è€Œæ˜¯ååé‡</li>
<li>å•çº¿ç¨‹æ²¡æ³•å¼‚æ­¥æå‡æ•ˆç‡ï¼Œå¿…é¡»é…åˆå¤šçº¿ç¨‹ã€å¤šæ ¸cpuæ‰èƒ½å‘æŒ¥å¼‚æ­¥çš„ä¼˜åŠ¿</li>
<li>å¼‚æ­¥å¹¶æ²¡æœ‰ç¼©çŸ­å“åº”äº‹ä»¶ï¼Œåè€Œæœ‰æ‰€å¢åŠ </li>
<li>åˆç†è¿›è¡Œä»»åŠ¡æ‹†åˆ†ï¼Œä¹Ÿç®—åˆ©ç”¨å¼‚æ­¥çš„å…³é”®  </li>
</ul>
<h3 id="Future-amp-Promise"><a href="#Future-amp-Promise" class="headerlink" title="Future &amp; Promise"></a><code>Future</code> &amp; <code>Promise</code></h3><p>åœ¨å¼‚æ­¥å¤„ç†çš„æ—¶å€™ï¼Œç»å¸¸ä¼šç”¨åˆ°è¿™ä¸ªä¸¤ä¸ªæ¥å£</p>
<p>é¦–å…ˆè¦è¯´æ˜nettyä¸­çš„<code>Future</code>ä¸jdkä¸­çš„<code>Future</code>åŒåï¼Œä½†æ˜¯æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¥å£ï¼Œnettyçš„<code>Future</code>ç»§æ‰¿è‡ªjdkçš„<code>Future</code>ï¼Œè€Œ<code>Promise</code>åˆå¯¹nettyçš„<code>Future</code>è¿›è¡Œäº†æ‰©å±•  </p>
<ul>
<li><code>jdk Future</code>åªèƒ½åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸï¼ˆæˆ–æˆåŠŸã€æˆ–å¤±è´¥ï¼‰æ‰èƒ½å¾—åˆ°ç»“æœ</li>
<li><code>netty Future</code>å¯ä»¥åŒæ­¥ç­‰å¾…ä»»åŠ¡æ¥å£å¾—åˆ°ç»“æœï¼Œä¹Ÿå¯ä»¥å¼‚æ­¥æ–¹å¼å¾—åˆ°ç»“æœï¼Œä½†éƒ½æ˜¯è¦ç­‰åˆ°ä»»åŠ¡ç»“æŸ</li>
<li><code>netty Promise</code>ä¸ä»…æœ‰<code>netty Future</code>çš„åŠŸèƒ½ï¼Œè€Œä¸”è„±ç¦»äº†ä»»åŠ¡ç‹¬ç«‹å­˜åœ¨ï¼Œåªä½œä¸ºæ¥ç»™ä½ ä¸ªçº¿ç¨‹é—´ä¼ é€’ç»“æœçš„å®¹å™¨</li>
</ul>
<table>
<thead>
<tr>
<th align="center">åŠŸèƒ½/åç§°</th>
<th align="center">jdk Future</th>
<th align="center">netty Future</th>
<th align="center">Promise</th>
</tr>
</thead>
<tbody><tr>
<td align="center">cancel</td>
<td align="center">å–æ¶ˆä»»åŠ¡</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">isCanceled</td>
<td align="center">ä»»åŠ¡æ˜¯å¦å–æ¶ˆ</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">isDone</td>
<td align="center">ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œä¸èƒ½åŒºåˆ†æˆåŠŸå¤±è´¥</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">get</td>
<td align="center">è·å–ä»»åŠ¡ç»“æœï¼Œé˜»å¡ç­‰å¾…</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">getNow</td>
<td align="center">-</td>
<td align="center">è·å–ä»»åŠ¡ç»“æœï¼Œéé˜»å¡ï¼Œè¿˜æœªäº§ç”Ÿç»“æœæ—¶è¿”å›null</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">await</td>
<td align="center">-</td>
<td align="center">ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼Œä¸ä¼šæŠ›å¼‚å¸¸ï¼Œè€Œæ˜¯é€šè¿‡isSuccessåˆ¤æ–­</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">sync</td>
<td align="center">-</td>
<td align="center">ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">isSuccess</td>
<td align="center">-</td>
<td align="center">åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æˆåŠŸ</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">cause</td>
<td align="center">-</td>
<td align="center">è·å–å¤±è´¥ä¿¡æ¯ï¼Œéé˜»å¡ï¼Œå¦‚æœæ²¡æœ‰å¤±è´¥ï¼Œè¿”å›null</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">addLinstenter</td>
<td align="center">-</td>
<td align="center">æ·»åŠ å›è°ƒï¼Œå¼‚æ­¥æ¥æ”¶ç»“æœ</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">setSuccess</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">è®¾ç½®æˆåŠŸç»“æœ</td>
</tr>
<tr>
<td align="center">setFailure</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">è®¾ç½®å¤±è´¥ç»“æœ</td>
</tr>
</tbody></table>
<p><strong>jdk Future</strong>   </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestHJdkFuture</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//1.å…ˆåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± </span></span><br><span class="line">        ExecutorService service = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line">        <span class="comment">//2.æäº¤ä»»åŠ¡</span></span><br><span class="line">        Future&lt;Integer&gt; future = service.submit(<span class="keyword">new</span> Callable&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                log.debug(<span class="string">&quot;æ‰§è¡Œè®¡ç®—&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">50</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//3.ä¸»çº¿ç¨‹é€šè¿‡Futureæ¥è·å–ç»“æœ</span></span><br><span class="line">        log.debug(<span class="string">&quot;ç­‰å¾…ç»“æœ&quot;</span>);</span><br><span class="line">        log.debug(<span class="string">&quot;ç»“æœæ˜¯ &#123;&#125;&quot;</span>,future.get());</span><br><span class="line">        service.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>netty Future</strong>  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestNettyFuture</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        NioEventLoopGroup group = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line">        EventLoop eventLoop = group.next();</span><br><span class="line">        Future&lt;Integer&gt; future = eventLoop.submit(<span class="keyword">new</span> Callable&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                log.debug(<span class="string">&quot;æ‰§è¡Œè®¡ç®—&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">50</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"><span class="comment">//        log.debug(&quot;ç­‰å¾…ç»“æœ&quot;);</span></span><br><span class="line"><span class="comment">//        log.debug(&quot;ç»“æœæ˜¯ &#123;&#125;&quot;,future.get());</span></span><br><span class="line"><span class="comment">//        group.shutdownGracefully();</span></span><br><span class="line">        future.addListener(<span class="keyword">new</span> GenericFutureListener&lt;Future&lt;? <span class="keyword">super</span> Integer&gt;&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationComplete</span><span class="params">(Future&lt;? <span class="keyword">super</span> Integer&gt; future)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                log.debug(<span class="string">&quot;ç»“æœæ˜¯ &#123;&#125;&quot;</span>,future.getNow());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Netty Promise</strong>  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestNettyPromise</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//1.å‡†å¤‡ EventLoop å¯¹è±¡</span></span><br><span class="line">        NioEventLoopGroup group = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line">        EventLoop eventLoop = group.next();</span><br><span class="line">        <span class="comment">//2.å¯ä»¥ä¸»åŠ¨åˆ›å»ºPromise</span></span><br><span class="line">        DefaultPromise&lt;Integer&gt; promise = <span class="keyword">new</span> DefaultPromise&lt;&gt;(eventLoop);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.ä»»æ„ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè®¡ç®—ï¼Œè®¡ç®—å®Œæ¯•åå‘ promise å¡«å……ç»“æœ</span></span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            log.debug(<span class="string">&quot;å¼€å§‹è®¡ç®—....&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            promise.setSuccess(<span class="number">80</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.æ¥æ”¶ç»“æœçš„çº¿ç¨‹</span></span><br><span class="line">        log.debug(<span class="string">&quot;ç­‰å¾…ç»“æœ....&quot;</span>);</span><br><span class="line">        log.debug(<span class="string">&quot;ç»“æœæ˜¯ï¼š&#123;&#125;&quot;</span>,promise.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Handler-amp-Pipeline"><a href="#Handler-amp-Pipeline" class="headerlink" title="Handler &amp; Pipeline"></a><code>Handler</code> &amp; <code>Pipeline</code></h3><p><code>ChannelHandler</code> ç”¨æ¥å¤„ç†<code>Channel</code> ä¸Šçš„å„ç§äº‹ä»¶ï¼Œåˆ†ä¸ºå…¥ç«™ã€å‡ºç«™ä¸¤ç§ï¼Œæ‰€æœ‰<code>ChannelHandler</code>è¢«è¿æˆä¸€ä¸²ï¼Œå°±æ˜¯<code>Pipeline</code></p>
<ul>
<li>å…¥ç«™å¤„ç†å™¨é€šå¸¸æ˜¯<code>ChannelInboundHandlerAdapter</code> çš„å­ç±»ï¼Œä¸»è¦ç”¨æ¥è¯»å–å®¢æˆ·ç«¯æ•°æ®ï¼Œå†™å›ç»“æœ  </li>
<li>å‡ºç«™å¤„ç†å™¨é€šå¸¸æ˜¯<code>ChannelOutboundHandlerAdapter</code>çš„å­ç±»ï¼Œä¸»è¦å¯¹å†™å›ç»“æœè¿›è¡ŒåŠ å·¥</li>
</ul>
<p>æœåŠ¡ç«¯ä»£ç ï¼š </p>
<blockquote>
<p>å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼Œä¸€å…±è®¾ç½®äº†6ä¸ªå¤„ç†å™¨ï¼Œå…¶ä¸­1ã€2ã€3å·å¤„ç†å™¨æ˜¯å…¥ç«™å¤„ç†å™¨ï¼Œ4ã€5ã€6å·å¤„ç†å™¨æ˜¯å‡ºç«™å¤„ç†å™¨<br>å½“å®¢æˆ·ç«¯å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œä¼šè§¦å‘1ã€2ã€3å·å¤„ç†å™¨ï¼Œå½“æœåŠ¡ç«¯è¦å‘å®¢æˆ·ç«¯å†™å‡ºä¸€æ¡æ•°æ®ï¼Œä¼šè§¦å‘4ã€5ã€6å·å¤„ç†å™¨<br>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œå…¥ç«™å¤„ç†å™¨æ˜¯æŒ‰ç…§addLastçš„é¡ºåºè¿›è¡Œè°ƒç”¨çš„ï¼ˆ1-&gt;2-&gt;3ï¼‰ï¼Œè€Œå‡ºç«™å¤„ç†å™¨æ˜¯ä»å°¾éƒ¨å‘å‰è°ƒç”¨çš„ï¼ˆ6-&gt;5-&gt;4ï¼‰<br>å¯ä»¥ä»ä»£ç ä¸­çœ‹åˆ°ï¼Œä¸ºäº†æ¨¡æ‹Ÿå†™å‡ºï¼Œæ˜¯åœ¨ç¬¬ä¸‰ä¸ªå…¥ç«™å¤„ç†å™¨ä¸­è°ƒç”¨äº† <code>ch.writeAndFlush()</code> æ–¹æ³•è¿›è¡Œå†™å‡ºçš„<br>è°ƒç”¨<code>channel</code>çš„å†™å‡ºæ–¹æ³•ï¼Œæ˜¯ä»<code>pipeline</code>çš„å°¾éƒ¨å¼€å§‹æ‰¾å‡ºç«™å¤„ç†å™¨çš„<br>å¦‚æœè°ƒç”¨å…¥ç«™å¤„ç†å™¨çš„å‚æ•°ï¼Œä¹Ÿå°± <code>ctx(ChannelHandlerContext)</code> çš„å†™å‡ºæ–¹æ³•ï¼Œåˆ™ä¼šä»å½“å‰å¤„ç†å™¨çš„ä½ç½®å‘å‰å¯»æ‰¾å‡ºç«™å¤„ç†å™¨   </p>
</blockquote>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>ChannelInboundHandlerAdapter</code>æ˜¯æŒ‰ç…§<code>addLast</code>çš„é¡ºåºæ‰§è¡Œçš„ï¼Œè€Œ<code>ChannelOutboundHandlerAdapter</code>æ˜¯æŒ‰ç…§<code>addLast</code>çš„é€†åºæ‰§è¡Œçš„ã€‚<br><code>ChannelPipeline</code>çš„å®ç°æ˜¯ä¸€ä¸ª<code>ChannelHandlerContext</code>(åŒ…è£…äº†<code>ChannelHHandler</code>)ç»„æˆçš„åŒå‘é“¾è¡¨<br><img src="https://ystest-bucket.s3.cn-north-1.jdcloud-oss.com/Pipeline%E7%BB%93%E6%9E%84%E5%9B%BE%E7%A4%BA.png" alt="Pipelineç»“æ„å›¾ç¤º"></p>
<ul>
<li>å…¥ç«™å¤„ç†å™¨ä¸­ï¼Œ<code>ctx.fireChannelRead(msg)</code>æ˜¯è°ƒç”¨ä¸‹ä¸€ä¸ªå…¥ç«™å¤„ç†å™¨<ul>
<li>å¦‚æœæ³¨é‡Šæ‰ï¼Œå°±ä¸ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªå…¥ç«™å¤„ç†å™¨  </li>
</ul>
</li>
<li><code>ctx.channel().write(msg)</code>ä¼šä»å°¾éƒ¨å¼€å§‹å‡ºå‘åç»­å‡ºç«™å¤„ç†å™¨çš„æ‰§è¡Œ<ul>
<li>å¦‚æœæ³¨é‡Šæ‰ï¼Œä¸ä¼šæ‰“å°åé¢çš„å‡ºç«™å¤„ç†å™¨æ–¹æ³•</li>
</ul>
</li>
<li>ç±»ä¼¼çš„ï¼Œå‡ºç«™å¤„ç†å™¨ä¸­ï¼Œ<code>ctx.write(msg, promise)</code>çš„è°ƒç”¨ï¼Œä¹Ÿä¼šè§¦å‘ä¸Šä¸€ä¸ªå‡ºç«™å¤„ç†å™¨<ul>
<li>å¦‚æœæ³¨é‡Šæ‰ï¼Œåˆ™ä¸ä¼šè°ƒç”¨åç»­çš„å‡ºç«™å¤„ç†å™¨</li>
</ul>
</li>
<li><code>ctx.channel().write(msg)</code> vs <code>ctx.write(msg)</code><ul>
<li>éƒ½æ˜¯è§¦å‘å‡ºç«™å¤„ç†å™¨çš„æ‰§è¡Œ</li>
<li><code>ctx.channel().write(msg)/(ch.write(msg))</code>ä»å°¾éƒ¨å¼€å§‹æŸ¥æ‰¾å‡ºç«™å¤„ç†å™¨</li>
<li><code>ctx.write(msg)</code>æ˜¯ä»å½“å‰èŠ‚ç‚¹å‘ä¸Šæ‰¾ä¸Šä¸€ä¸ªå‡ºç«™å¤„ç†å™¨</li>
<li>3 å¤„çš„ <code>ctx.channel().write(msg)</code> å¦‚æœæ”¹ä¸º <code>ctx.write(msg)</code> ä»…ä¼šæ‰“å° 1 2 3ï¼Œå› ä¸ºèŠ‚ç‚¹3 ä¹‹å‰æ²¡æœ‰å…¶å®ƒå‡ºç«™å¤„ç†å™¨äº†</li>
<li>6 å¤„çš„ <code>ctx.write(msg, promise)</code> å¦‚æœæ”¹ä¸º <code>ctx.channel().write(msg)</code> ä¼šæ‰“å° 1 2 3 6 6 6â€¦ å› ä¸º <code>ctx.channel().write()</code> æ˜¯ä»å°¾éƒ¨å¼€å§‹æŸ¥æ‰¾ï¼Œç»“æœåˆæ˜¯èŠ‚ç‚¹6 è‡ªå·±<br><img src="https://ystest-bucket.s3.cn-north-1.jdcloud-oss.com/%E6%9C%8D%E5%8A%A1%E7%AB%AFpipeline%E8%A7%A6%E5%8F%91%E7%9A%84%E5%8E%9F%E5%A7%8B%E6%B5%81%E7%A8%8B.png" alt="æœåŠ¡ç«¯pipelineè§¦å‘çš„åŸå§‹æµç¨‹"></li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPipeline</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> ServerBootstrap()</span><br><span class="line">                .group(<span class="keyword">new</span> NioEventLoopGroup())</span><br><span class="line">                .channel(NioServerSocketChannel.class)</span><br><span class="line">                .childHandler(<span class="keyword">new</span> ChannelInitializer&lt;NioSocketChannel&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(NioSocketChannel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        <span class="comment">//1.é€šè¿‡ channel æ‹¿åˆ° pipeline</span></span><br><span class="line">                        ChannelPipeline pipeline = ch.pipeline();</span><br><span class="line">                        <span class="comment">//2.æ·»åŠ å¤„ç†å™¨ head -&gt; h1 -&gt; h2 -&gt; h3 -&gt; tail</span></span><br><span class="line">                        <span class="comment">//netty ä¼šè‡ªåŠ¨æ·»åŠ ä¸¤ä¸ªå¤„ç†å™¨ï¼Œåˆ†åˆ«æ”¾åœ¨æœ€å‰é¢å’Œæœ€åé¢ï¼Œå…¶ä»–æ·»åŠ çš„éƒ½æ˜¯åœ¨è¿™ä¸¤ä¸ªä¸­é—´ head    tail</span></span><br><span class="line">                        pipeline.addLast(<span class="string">&quot;h1&quot;</span>,<span class="keyword">new</span> ChannelInboundHandlerAdapter()&#123;</span><br><span class="line">                            <span class="meta">@Override</span></span><br><span class="line">                            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                                log.debug(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">                                <span class="keyword">super</span>.channelRead(ctx, msg);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                        pipeline.addLast(<span class="string">&quot;h2&quot;</span>,<span class="keyword">new</span> ChannelInboundHandlerAdapter()&#123;</span><br><span class="line">                            <span class="meta">@Override</span></span><br><span class="line">                            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                                log.debug(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">                                <span class="keyword">super</span>.channelRead(ctx, msg);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                        pipeline.addLast(<span class="string">&quot;h3&quot;</span>,<span class="keyword">new</span> ChannelInboundHandlerAdapter()&#123;</span><br><span class="line">                            <span class="meta">@Override</span></span><br><span class="line">                            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                                log.debug(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">                                <span class="keyword">super</span>.channelRead(ctx, msg);</span><br><span class="line">                                ch.writeAndFlush(ctx.alloc().buffer().writeBytes(<span class="string">&quot;server...&quot;</span>.getBytes()));</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                        pipeline.addLast(<span class="string">&quot;h4&quot;</span>,<span class="keyword">new</span> ChannelOutboundHandlerAdapter()&#123;</span><br><span class="line">                            <span class="meta">@Override</span></span><br><span class="line">                            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                                log.debug(<span class="string">&quot;4&quot;</span>);</span><br><span class="line">                                <span class="keyword">super</span>.write(ctx, msg, promise);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                        pipeline.addLast(<span class="string">&quot;h5&quot;</span>,<span class="keyword">new</span> ChannelOutboundHandlerAdapter()&#123;</span><br><span class="line">                            <span class="meta">@Override</span></span><br><span class="line">                            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                                log.debug(<span class="string">&quot;5&quot;</span>);</span><br><span class="line">                                <span class="keyword">super</span>.write(ctx, msg, promise);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                        pipeline.addLast(<span class="string">&quot;h6&quot;</span>,<span class="keyword">new</span> ChannelOutboundHandlerAdapter()&#123;</span><br><span class="line">                            <span class="meta">@Override</span></span><br><span class="line">                            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                                log.debug(<span class="string">&quot;6&quot;</span>);</span><br><span class="line">                                <span class="keyword">super</span>.write(ctx, msg, promise);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).bind(<span class="number">8080</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">16:48:27 [DEBUG] [nioEventLoopGroup-2-2] c.y.n.c.TestPipeline - 1</span><br><span class="line">16:48:27 [DEBUG] [nioEventLoopGroup-2-2] c.y.n.c.TestPipeline - 2</span><br><span class="line">16:48:27 [DEBUG] [nioEventLoopGroup-2-2] c.y.n.c.TestPipeline - 3</span><br><span class="line">16:48:27 [DEBUG] [nioEventLoopGroup-2-2] c.y.n.c.TestPipeline - 6</span><br><span class="line">16:48:27 [DEBUG] [nioEventLoopGroup-2-2] c.y.n.c.TestPipeline - 5</span><br><span class="line">16:48:27 [DEBUG] [nioEventLoopGroup-2-2] c.y.n.c.TestPipeline - 4</span><br></pre></td></tr></table></figure>

<h2 id="ByteBuf"><a href="#ByteBuf" class="headerlink" title="ByteBuf"></a><code>ByteBuf</code></h2><p>æ˜¯å¯¹å­—èŠ‚æ•°æ®çš„å°è£…  </p>
<h3 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ByteBuf buf = ByteBufAllocator.DEFAULT.buffer();</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºäº†ä¸€ä¸ªé»˜è®¤çš„<code>ByteBuf</code>ï¼Œå®¹é‡ä¸ºnettyé»˜è®¤256ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‚æ•°è®¾ç½®åˆå§‹å®¹é‡  </p>
<p>å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•æ¯”è¾ƒæ–¹ä¾¿çš„æŸ¥çœ‹<code>ByteBuf</code>ä¸­çš„æ•°æ®  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">private static void log(ByteBuf buffer) &#123;</span><br><span class="line">    int length = buffer.readableBytes();</span><br><span class="line">    int rows = length / 16 + (length % 15 == 0 ? 0 : 1) + 4;</span><br><span class="line">    StringBuilder buf = new StringBuilder(rows * 80 * 2)</span><br><span class="line">        .append(&quot;read index:&quot;).append(buffer.readerIndex())</span><br><span class="line">        .append(&quot; write index:&quot;).append(buffer.writerIndex())</span><br><span class="line">        .append(&quot; capacity:&quot;).append(buffer.capacity())</span><br><span class="line">        .append(NEWLINE);</span><br><span class="line">    appendPrettyHexDump(buf, buffer);</span><br><span class="line">    System.out.println(buf.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ç›´æ¥å†…å­˜-VS-å †å†…å­˜"><a href="#ç›´æ¥å†…å­˜-VS-å †å†…å­˜" class="headerlink" title="ç›´æ¥å†…å­˜ VS å †å†…å­˜"></a>ç›´æ¥å†…å­˜ VS å †å†…å­˜</h3><p><font color='red'>Nettyé»˜è®¤æ˜¯ä½¿ç”¨ç›´æ¥å†…å­˜</font><br>å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ¥åˆ›å»ºæ± åŒ–åŸºäºå †å¾— ByteBuf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ByteBuf buf = ByteBufAllocator.DEFAULT.heapBuffer();</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ¥åˆ›å»ºæ± åŒ–åŸºäºç›´æ¥å†…å­˜çš„ <code>ByteBuf</code>  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ByteBuf buf = ByteBufAllocator.DEFAULT.directBuffer();</span><br></pre></td></tr></table></figure>
<ul>
<li>ç›´æ¥å†…å­˜åˆ›å»ºå’Œé”€æ¯çš„ä»£ä»·æ˜‚è´µï¼Œä½†è¯»å†™æ€§èƒ½é«˜(å°‘ä¸€æ¬¡å†…å­˜å¤åˆ¶)ï¼Œé€‚åˆé…åˆæ± åŒ–åŠŸèƒ½ä¸€èµ·ç”¨  </li>
<li>ç›´æ¥å†…å­˜å¯¹GCå‹åŠ›å°ï¼Œå› ä¸ºè¿™éƒ¨åˆ†å†…å­˜ä¸å—JVMåƒåœ¾å›æ”¶çš„ç®¡ç†ï¼Œä½†ä¹Ÿè¦æ³¨æ„åŠæ—¶ä¸»åŠ¨é‡Šæ”¾  </li>
</ul>
<h3 id="æ± åŒ–-VS-éæ± åŒ–"><a href="#æ± åŒ–-VS-éæ± åŒ–" class="headerlink" title="æ± åŒ– VS éæ± åŒ–"></a>æ± åŒ– VS éæ± åŒ–</h3><p>æ± åŒ–çš„æœ€å¤§æ„ä¹‰åœ¨äºå¯ä»¥é‡ç”¨<code>ByteBuf</code>ï¼Œä¼˜ç‚¹æœ‰  </p>
<ul>
<li>æ²¡æœ‰æ± åŒ–ï¼Œåˆ™æ¯æ¬¡éƒ½å¾—åˆ›å»ºæ–°çš„<code>ByteBuf</code>å®ä¾‹ï¼Œè¿™ä¸ªæ“ä½œå¯¹ç›´æ¥å†…å­˜ä»£ä»·æ˜‚è´µï¼Œå°±ç®—æ˜¯å †å†…å­˜ï¼Œä¹Ÿä¼šå¢åŠ GCå‹åŠ›</li>
<li>æœ‰äº†æ± åŒ–ï¼Œåˆ™å¯ä»¥é‡ç”¨æ± ä¸­<code>ByteBuf</code>å®ä¾‹ï¼Œå¹¶ä¸”é‡‡ç”¨äº†ä¸jemallocç±»ä¼¼çš„å†…å­˜åˆ†é…ç®—æ³•æå‡åˆ†é…æ•ˆç‡</li>
<li>é«˜å¹¶å‘æ—¶ï¼Œæ± åŒ–åŠŸèƒ½æ›´èŠ‚çº¦å†…å­˜ï¼Œå‡å°‘å†…å­˜æº¢å‡ºçš„å¯èƒ½  </li>
</ul>
<p>æ± åŒ–åŠŸèƒ½æ˜¯å¦å¼€å¯ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„ç³»ç»Ÿç¯å¢ƒå˜é‡æ¥è®¾ç½®  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dio.netty.allocator.type=&#123;unpooled|pooled&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>4.1ä»¥åï¼ŒéAndroidå¹³å°é»˜è®¤å¯ç”¨æ± åŒ–å®ç°ï¼ŒAndroidå¹³å°å¯ç”¨éæ± åŒ–å®ç°</li>
<li>4.1ä¹‹å‰ï¼Œæ± åŒ–åŠŸèƒ½è¿˜ä¸æˆç†Ÿï¼Œé»˜è®¤æ˜¯éæ± åŒ–å®ç°  </li>
</ul>
<h3 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h3><p><code>ByteBuf</code>ç”±å››éƒ¨åˆ†ç»„æˆ</p>
<ul>
<li>å¯æ‰©å®¹å­—èŠ‚ï¼šåœ¨<code>ByteBuf</code>å½“å‰å®¹é‡å’Œæœ€å¤§å®¹é‡ä¹‹é—´çš„åŒºåŸŸï¼Œéƒ½æ˜¯å¯æ‰©å®¹å­—èŠ‚ï¼Œæœ€å¤§å®¹é‡é»˜è®¤æ˜¯<code>Integer.MaxValue</code>,å¯è‡ªå®šä¹‰è®¾ç½®</li>
<li>å¯å†™å­—èŠ‚ï¼šåˆå§‹æ—¶ï¼Œæ•´ä¸ª<code>ByteBuf</code>éƒ½æ˜¯å¯å†™éƒ¨åˆ†ï¼Œéšç€æ•°æ®çš„å†™å…¥ï¼Œå¯å†™éƒ¨åˆ†æ…¢æ…¢å˜å°‘ï¼Œæœ€åè§¦å‘æ‰©å®¹  </li>
<li>å¯è¯»å­—èŠ‚ï¼šæ•°æ®å†™å…¥åï¼Œå·²ç»å†™å…¥çš„éƒ¨åˆ†ï¼Œéƒ½æ˜¯å¯è¯»éƒ¨åˆ†</li>
<li>åºŸå¼ƒå­—èŠ‚ï¼šæ•°æ®è¯»å–ä¹‹åçš„ï¼Œæ˜¯åºŸå¼ƒéƒ¨åˆ†</li>
</ul>
<p><img src="https://ystest-bucket.s3.cn-north-1.jdcloud-oss.com/ByteBuf%E7%BB%84%E6%88%90%E7%BB%93%E6%9E%84%E5%9B%BE.png" alt="ByteBufç»„æˆç»“æ„å›¾"></p>
<h3 id="å†™å…¥"><a href="#å†™å…¥" class="headerlink" title="å†™å…¥"></a>å†™å…¥</h3><p>æ–¹æ³•åˆ—è¡¨ï¼Œçœç•¥ä¸€äº›ä¸é‡è¦çš„æ–¹æ³•  </p>
<table>
<thead>
<tr>
<th align="center">æ–¹æ³•ç­¾å</th>
<th align="center">å«ä¹‰</th>
<th align="center">å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td align="center">writeBoolean(boolean value)</td>
<td align="center">å†™å…¥ä¸€ä¸ªbooleanå€¼</td>
<td align="center">ç”¨ä¸€ä¸ªå­—èŠ‚01&#124;00ä»£è¡¨true&#124;false</td>
</tr>
<tr>
<td align="center">writeByte(int value)</td>
<td align="center">å†™å…¥byteå€¼</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">writeShort(int value)</td>
<td align="center">å†™å…¥shortå€¼</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">writeInt(int value)</td>
<td align="center">å†™å…¥intå€¼</td>
<td align="center">Big Endianï¼Œå³0x250,å†™å…¥å00 00 02 05</td>
</tr>
<tr>
<td align="center">writeIntLE(int value)</td>
<td align="center">å†™å…¥intå€¼</td>
<td align="center">Little Endianï¼Œå³0x250ï¼Œå†™å…¥å50 02 00 00</td>
</tr>
<tr>
<td align="center">writeLong(long value)</td>
<td align="center">å†™å…¥ long å€¼</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">writeChar(int value)</td>
<td align="center">å†™å…¥ char å€¼</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">writeFloat(float value)</td>
<td align="center">å†™å…¥ float å€¼</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">writeDouble(double value)</td>
<td align="center">å†™å…¥ double å€¼</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">writeBytes(ByteBuf src)</td>
<td align="center">å†™å…¥ netty çš„ ByteBuf</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">writeBytes(byte[] src)</td>
<td align="center">å†™å…¥ byte[]</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">writeBytes(ByteBuffer src)</td>
<td align="center">å†™å…¥ nio çš„ ByteBuffer</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">int writeCharSequence(CharSequence sequence, Charset charset)</td>
<td align="center">å†™å…¥å­—ç¬¦ä¸²</td>
<td align="center">éœ€è¦æŒ‡å®šå­—ç¬¦é›†</td>
</tr>
</tbody></table>
<p><font color='red'>æ³¨æ„ï¼š</font>  </p>
<blockquote>
<p>è¿™äº›æ–¹æ³•ä¸ºæŒ‡æ˜è¿”å›å€¼çš„ï¼Œå…¶è¿”å›å€¼éƒ½æ˜¯<code>ByteBuf</code>ï¼Œæ„å‘³ç€å¯ä»¥é“¾å¼è°ƒç”¨<br>ç½‘ç»œä¼ è¾“ï¼Œé»˜è®¤ä¹ æƒ¯ç”¨ <code>Big Endian</code></p>
</blockquote>
<p>åˆ›å»ºä¸€ä¸ª<code>ByteBuf</code><br>å…ˆå†™å…¥4ä¸ªå­—èŠ‚  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buf.writeBytes(new byte[]&#123;1,2,3,4&#125;);</span><br></pre></td></tr></table></figure>
<p>ç»“æœæ˜¯ï¼š  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">read index:0 write index:4 capacity:10</span><br><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 01 02 03 04                                     |....            |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br></pre></td></tr></table></figure>
<p>å†å†™å…¥ä¸€ä¸ªintæ•´æ•°ï¼Œä¹Ÿæ˜¯4ä¸ªå­—èŠ‚ </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buf.writeInt(5);</span><br></pre></td></tr></table></figure>
<p>ç»“æœï¼š  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">read index:0 write index:8 capacity:10</span><br><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 01 02 03 04 00 00 00 05                         |........        |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸€ç±»æ–¹æ³•æ˜¯setå¼€å¤´çš„ä¸€ç³»åˆ—æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å†™å…¥æ•°æ®ï¼Œä½†ä¸ä¼šæ”¹å˜æŒ‡é’ˆä½ç½®  </p>
<h3 id="æ‰©å®¹"><a href="#æ‰©å®¹" class="headerlink" title="æ‰©å®¹"></a>æ‰©å®¹</h3><p>å†å†™å…¥ä¸€ä¸ªintæ•´æ•°æ—¶ï¼Œå®¹é‡ä¸å¤Ÿäº†ï¼ˆåˆå§‹å®¹é‡æ˜¯10ï¼‰ï¼Œè¿™æ—¶ä¼šå¼•å‘æ‰©å®¹ </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buf.writeInt(6);</span><br></pre></td></tr></table></figure>
<p><strong>æ‰©å®¹è§„åˆ™æ˜¯</strong>ï¼š  </p>
<ul>
<li>å¦‚æœå†™å…¥åæ•°æ®å¤§å°æœªè¶…è¿‡512ï¼Œåˆ™é€‰æ‹©ä¸‹ä¸€ä¸ª16çš„æ•´æ•°å€ï¼Œä¾‹å¦‚å†™å…¥åå¤§å°ä¸º12ï¼Œåˆ™æ‰©å®¹å<code>capacity</code>æ˜¯16</li>
<li>å¦‚æœå†™å…¥åæ•°æ®å¤§å°è¶…è¿‡512ï¼Œåˆ™é€‰æ‹©ä¸‹ä¸€ä¸ª2^n(2çš„næ¬¡æ–¹)ï¼Œä¾‹å¦‚å†™å…¥åå¤§å°ä¸º513ï¼Œåˆ™æ‰©å®¹å<code>capacity</code>æ˜¯2^10=1024(2^9=512å·²ç»ä¸å¤Ÿäº†)</li>
<li>æ‰©å®¹ä¸èƒ½è¶…è¿‡ <code>max capacity</code>ï¼Œå¦åˆ™ä¼šæŠ¥é”™</li>
</ul>
<p>ç»“æœæ˜¯ï¼š </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">read index:0 write index:12 capacity:16</span><br><span class="line">+-------------------------------------------------+</span><br><span class="line">|  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 01 02 03 04 00 00 00 05 00 00 00 06             |............    |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br></pre></td></tr></table></figure>

<h3 id="è¯»å–"><a href="#è¯»å–" class="headerlink" title="è¯»å–"></a>è¯»å–</h3><p>ä¾‹å¦‚è¯»äº†4æ¬¡ï¼Œæ¯æ¬¡ä¸€ä¸ªå­—èŠ‚  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(buffer.readByte());</span><br><span class="line">System.out.println(buffer.readByte());</span><br><span class="line">System.out.println(buffer.readByte());</span><br><span class="line">System.out.println(buffer.readByte());</span><br></pre></td></tr></table></figure>
<p>è¯»è¿‡çš„å†…å®¹ï¼Œå°±å±äºåºŸå¼ƒéƒ¨åˆ†äº†ï¼Œå†è¯»å°±åªèƒ½è¯»é‚£äº›å°šæœªè¯»å–çš„éƒ¨åˆ†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">read index:4 write index:12 capacity:16</span><br><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 00 00 00 05 00 00 00 06                         |........        |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br></pre></td></tr></table></figure>
<p>å¦‚æœéœ€è¦é‡å¤è¯»å–intæ•´æ•°5<br>å¯ä»¥å†<code>read</code>å‰å…ˆåšä¸ªæ ‡è®°<code>mark</code>  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">buffer.markReaderIndex();</span><br><span class="line">System.out.println(buffer.readInt());</span><br></pre></td></tr></table></figure>
<p>ç»“æœ  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">read index:8 write index:12 capacity:16</span><br><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 00 00 00 06                                     |....            |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶å¦‚æœæƒ³è¦é‡å¤è¯»å–çš„è¯ï¼Œé‡ç½®æ ‡è®°ä½ç½®<code>rest</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buffer.resetReaderIndex();</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶ï¼š  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">read index:4 write index:12 capacity:16</span><br><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 00 00 00 05 00 00 00 06                         |........        |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰ç§åŠæ³•æ˜¯é‡‡ç”¨<code>get</code>å¼€å¤´çš„ä¸€ç³»åˆ—æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¸ä¼šæ”¹å˜<code>read index</code>  </p>
<h3 id="retain-amp-release"><a href="#retain-amp-release" class="headerlink" title="retain &amp; release"></a><code>retain</code> &amp; <code>release</code></h3><p>ç”±äºNettyä¸­æœ‰å †å¤–å†…å­˜çš„<code>ByteBuf</code>å®ç°ï¼Œå †å¤–å†…å­˜æœ€å¥½æ˜¯æ‰‹åŠ¨æ¥é‡Šæ”¾ï¼Œè€Œä¸æ˜¯ç­‰GCåƒåœ¾å›æ”¶  </p>
<ul>
<li><code>UnpooledHeapByteBuf</code> ä½¿ç”¨çš„æ˜¯ JVM å†…å­˜ï¼Œåªéœ€ç­‰ GC å›æ”¶å†…å­˜å³å¯</li>
<li><code>UnpooledDirectByteBuf</code> ä½¿ç”¨çš„å°±æ˜¯ç›´æ¥å†…å­˜äº†ï¼Œéœ€è¦ç‰¹æ®Šçš„æ–¹æ³•æ¥å›æ”¶å†…å­˜</li>
<li><code>PooledByteBuf</code> å’Œå®ƒçš„å­ç±»ä½¿ç”¨äº†æ± åŒ–æœºåˆ¶ï¼Œéœ€è¦æ›´å¤æ‚çš„è§„åˆ™æ¥å›æ”¶å†…å­˜</li>
</ul>
<p>å›æ”¶å†…å­˜çš„æºç å®ç°ï¼Œè¯·å…³æ³¨ä¸‹é¢æ–¹æ³•çš„ä¸åŒå®ç°ï¼ˆä¸åŒå®ç°é‡Šæ”¾æ–¹å¼ä¸åŒï¼‰  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protected abstract void deallocate()</span><br></pre></td></tr></table></figure>
<p>Nettyè¿™é‡Œé‡‡ç”¨äº†å¼•ç”¨è®¡æ•°æ³•æ¥æ§åˆ¶å›æ”¶å†…å­˜ï¼Œæ¯ä¸ª<code>ByteBuf</code>éƒ½å®ç°äº†<code>ReferenceCounted</code> æ¥å£  </p>
<ul>
<li>æ¯ä¸ª<code>ByteBuf</code>å¯¹è±¡çš„åˆå§‹è®¡æ•°ä¸º1</li>
<li>è°ƒç”¨<code>release</code>æ–¹æ³•è®¡æ•°å‡1ï¼Œå¦‚æœè®¡æ•°ä¸º0ï¼Œ<code>ByteBuf</code>å†…å­˜è¢«å›æ”¶  </li>
<li>è°ƒç”¨<code>retain</code>æ–¹æ³•è®¡æ•°åŠ 1ï¼Œè¡¨ç¤ºè°ƒç”¨è€…æ²¡ç”¨å®Œä¹‹å‰ï¼Œå…¶ä»–<code>handler</code>å³ä½¿è°ƒç”¨äº†<code>release</code>ä¹Ÿä¸ä¼šé€ æˆå›æ”¶</li>
<li>å½“è®¡æ•°ä¸º0æ—¶ï¼Œåº•å±‚å†…å­˜ä¼šè¢«å›æ”¶ï¼Œè¿™æ—¶å³ä½¿<code>ByteBuf</code>å¯¹è±¡è¿˜åœ¨ï¼Œå…¶å„ä¸ªæ–¹æ³•å‡æ— æ³•æ­£å¸¸ä½¿ç”¨  </li>
</ul>
<p>å› ä¸º<code>pipeline</code>çš„å­˜åœ¨ï¼Œä¸€èˆ¬éœ€è¦å°†<code>ByteBuf</code>ä¼ é€’ç»™ä¸‹ä¸€ä¸ª<code>ChannelHandler</code>ï¼Œå¦‚æœåœ¨æ¯ä¸ªå¤„ç†å™¨ä¸­é‡Šæ”¾ï¼Œå°±å¤±å»äº†ä¼ é€’æ€§ï¼ˆå½“ç„¶ï¼Œå¦‚æœåœ¨è¿™ä¸ª<code>ChannelHandler</code>å†…è¿™ä¸ª<code>ByteBuf</code>å·²ç»å®Œæˆäº†å®ƒçš„ä½¿å‘½ï¼Œé‚£ä¹ˆä¾¿æ— é¡»å†ä¼ é€’ï¼‰  </p>
<p>åŸºæœ¬è§„åˆ™æ˜¯ï¼š<strong>è°æ˜¯æœ€åä½¿ç”¨è€…ï¼Œè°è´Ÿè´£release</strong>ï¼Œè¯¦ç»†åˆ†æ  </p>
<ul>
<li>èµ·ç‚¹ï¼Œå¯¹äºNIOå®ç°ï¼Œåœ¨ <code>io.netty.channel.nio.AbstractNioByteChannel.NioByteUnsafe#read</code> æ–¹æ³•ä¸­é¦–æ¬¡åˆ›å»º<code>ByteBuf</code>æ”¾å…¥<code>pipeline</code>ï¼ˆline 163 pipeline.fireChannelRead(byteBuf)ï¼‰</li>
<li>å…¥ç«™<code>ByteBuf</code>å¤„ç†åŸåˆ™<ul>
<li>å¯¹åŸå§‹<code>ByteBuf</code>ä¸åšå¤„ç†ï¼Œè°ƒç”¨<code>ctx.fireChannelRead(msg)</code>å‘åä¼ é€’ï¼Œè¿™æ—¶æ— é¡»<code>release</code></li>
<li>å°†åŸå§‹<code>ByteBuf</code>è½¬æ¢ä¸ºå…¶ä»–ç±»å‹çš„Javaå¯¹è±¡ï¼Œè¿™æ—¶<code>ByteBuf</code>å°±æ²¡ç”¨äº†ï¼Œå¿…é¡»<code>release</code></li>
<li>å¦‚æœä¸è°ƒç”¨<code>ctx.fireChannelRead(msg)</code>å‘åä¼ é€’ï¼Œé‚£ä¹ˆä¹Ÿå¿…é¡»<code>release</code></li>
<li>æ³¨æ„å„ç§å¼‚å¸¸ï¼Œå¦‚æœ<code>ByteBuf</code>æ²¡æœ‰æˆåŠŸä¼ é€’åˆ°ä¸‹ä¸€ä¸ª<code>ChannelHandler</code>ï¼Œå¿…é¡»<code>release</code></li>
<li>å‡è®¾æ¶ˆæ¯ä¸€ç›´å‘åä¼ ï¼Œé‚£ä¹ˆ<code>TailContext</code>ä¼šè´Ÿè´£é‡Šæ”¾æœªå¤„ç†æ¶ˆæ¯ï¼ˆåŸå§‹çš„<code>ByteBuf</code>ï¼‰</li>
</ul>
</li>
<li>å‡ºç«™<code>ByteBuf</code>å¤„ç†åŸåˆ™<ul>
<li>æœ‰æ—¶å€™ä¸æ¸…æ¥š<code>ByteBuf</code>è¢«å¼•ç”¨äº†å¤šå°‘æ¬¡ï¼Œä½†åˆå¿…é¡»å½»åº•é‡Šæ”¾ï¼Œå¯ä»¥å¾ªç¯è°ƒç”¨<code>release</code>ç›´åˆ°è¿”å›true</li>
</ul>
</li>
</ul>
<p><code>TailContext</code>é‡Šæ”¾æœªå¤„ç†æ¶ˆæ¯é€»è¾‘  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// io.netty.channel.DefaultChannelPipeline#onUnhandledInboundMessage(java.lang.Object)</span><br><span class="line">protected void onUnhandledInboundMessage(Object msg) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        logger.debug(</span><br><span class="line">            &quot;Discarded inbound message &#123;&#125; that reached at the tail of the pipeline. &quot; +</span><br><span class="line">            &quot;Please check your pipeline configuration.&quot;, msg);</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        ReferenceCountUtil.release(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…·ä½“ä»£ç   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// io.netty.util.ReferenceCountUtil#release(java.lang.Object)</span><br><span class="line">public static boolean release(Object msg) &#123;</span><br><span class="line">    if (msg instanceof ReferenceCounted) &#123;</span><br><span class="line">        return ((ReferenceCounted) msg).release();</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="slice"><a href="#slice" class="headerlink" title="slice"></a><code>slice</code></h3><p>ã€é›¶æ‹·è´ã€‘çš„ä½“ç°ä¹‹ä¸€ï¼Œå¯¹åŸå§‹<code>ByteBuf</code>è¿›è¡Œåˆ‡ç‰‡æˆå¤šä¸ª<code>ByteBuf</code>ï¼Œåˆ‡ç‰‡åçš„<code>ByteBuf</code>å¹¶æ²¡æœ‰å‘ç”Ÿå†…å­˜å¤åˆ¶ï¼Œè¿˜æ˜¯ä½¿ç”¨åŸå§‹<code>ByteBuf</code>çš„å†…å­˜ï¼Œåˆ‡ç‰‡åçš„<code>ByteBuf</code>ç»´æŠ¤ç‹¬ç«‹çš„<code>read</code>ã€<code>write</code>æŒ‡é’ˆ<br><img src="https://ystest-bucket.s3.cn-north-1.jdcloud-oss.com/slice%E5%9B%BE%E7%A4%BA.png" alt="sliceå›¾ç¤º"></p>
<p>è°ƒç”¨<code>slice</code>è¿›è¡Œåˆ‡ç‰‡ï¼Œæ— å‚<code>slice</code>æ˜¯ä»åŸå§‹<code>ByteBuf</code>çš„<code>read index</code>åˆ°<code>write index</code>ä¹‹é—´çš„å†…å®¹è¿›è¡Œåˆ‡ç‰‡ï¼Œåˆ‡ç‰‡åçš„<code>max capacity</code> è¢«å›ºå®šä¸ºè¿™ä¸ªåŒºé—´çš„å¤§å°ï¼Œå› æ­¤ä¸èƒ½è¿½åŠ <code>write</code>  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ByteBuf slice = origin.slice();</span><br><span class="line">System.out.println(ByteBufUtil.prettyHexDump(slice));</span><br><span class="line">// slice.writeByte(5); å¦‚æœæ‰§è¡Œï¼Œä¼šæŠ¥ IndexOutOfBoundsException å¼‚å¸¸</span><br></pre></td></tr></table></figure>
<p>å¸¦å‚æ•°çš„<code>slice</code>æ–¹æ³•ï¼Œåˆ™æ˜¯æ ¹æ®å‚æ•°æŒ‡å®šçš„ä¸‹æ ‡å’Œé•¿åº¦è¿›è¡Œåˆ‡åˆ†<br>å› ä¸ºåˆ‡åˆ†åçš„<code>ByteBuf</code>å’ŒåŸ<code>ByteBuf</code>ä½¿ç”¨çš„æ˜¯åŒä¸€å—å†…å­˜ï¼Œæ‰€ä»¥åˆ‡åˆ†åçš„<code>ByteBuf</code>å¦‚æœå†…å®¹æ›´æ”¹ï¼ŒåŸ<code>ByteBuf</code>å†…å®¹ä¹Ÿä¼šæ›´æ”¹ï¼Œå¦‚æœåŸ<code>ByteBuf</code>æŒ‡å®š<code>release</code>æ–¹æ³•å›æ”¶å†…å­˜ï¼Œåˆ‡åˆ†çš„ä¹Ÿä¼šè¢«å›æ”¶å†…å­˜  </p>
<h3 id="duplicate"><a href="#duplicate" class="headerlink" title="duplicate"></a><code>duplicate</code></h3><p>ã€é›¶æ‹·è´ã€‘çš„ä½“ç°ä¹‹ä¸€ï¼Œå°±å¥½æ¯”æˆªå–äº†åŸå§‹<code>ByteBuf</code>æ‰€æœ‰å†…å®¹ï¼Œå¹¶ä¸”æ²¡æœ‰<code>max capacity</code>çš„é™åˆ¶ï¼Œä¹Ÿæ˜¯ä¸åŸå§‹<code>ByteBuf</code>ä½¿ç”¨åŒä¸€å—åº•å±‚å†…å­˜ï¼Œåªæ˜¯è¯»å†™æŒ‡é’ˆæ˜¯ç‹¬ç«‹çš„<br><img src="https://ystest-bucket.s3.cn-north-1.jdcloud-oss.com/duplicate%E5%9B%BE%E7%A4%BA.png" alt="duplicateå›¾ç¤º"></p>
<h3 id="copy"><a href="#copy" class="headerlink" title="copy"></a><code>copy</code></h3><p>ä¼šå°†åº•å±‚å†…å­˜æ•°æ®è¿›è¡Œæ·±æ‹·è´ï¼Œå› æ­¤æ— è®ºè¯»å†™ï¼Œéƒ½ä¸åŸå§‹<code>ByteBuf</code>æ— å…³  </p>
<h3 id="CompositeByteBuf"><a href="#CompositeByteBuf" class="headerlink" title="CompositeByteBuf"></a><code>CompositeByteBuf</code></h3><p>ã€é›¶æ‹·è´ã€‘çš„ä½“ç°ä¹‹ä¸€ï¼Œå¯ä»¥å°†å¤šä¸ª<code>ByteBuf</code>åˆå¹¶æˆä¸€ä¸ªé€»è¾‘ä¸Šçš„<code>ByteBuf</code>ï¼Œé¿å…æ‹·è´<br>æœ‰ä¸¤ä¸ª<code>ByteBuf</code>å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ByteBuf buf1 = ByteBufAllocator.DEFAULT.buffer(5);</span><br><span class="line">buf1.writeBytes(new byte[]&#123;1, 2, 3, 4, 5&#125;);</span><br><span class="line">ByteBuf buf2 = ByteBufAllocator.DEFAULT.buffer(5);</span><br><span class="line">buf2.writeBytes(new byte[]&#123;6, 7, 8, 9, 10&#125;);</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 01 02 03 04 05                                  |.....           |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 06 07 08 09 0a                                  |.....           |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br></pre></td></tr></table></figure>
<p>åˆå¹¶æˆä¸€ä¸ª<code>ByteBuf</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CompositeByteBuf buf3 = ByteBufAllocator.DEFAULT.compositeBuffer();</span><br><span class="line">// true è¡¨ç¤ºå¢åŠ æ–°çš„ ByteBuf è‡ªåŠ¨é€’å¢ write index, å¦åˆ™ write index ä¼šå§‹ç»ˆä¸º 0</span><br><span class="line">buf3.addComponents(true, buf1, buf2);</span><br></pre></td></tr></table></figure>
<p>ç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br></pre></td></tr></table></figure>
<p><code>CompositeByteBuf</code> æ˜¯ä¸€ä¸ªç»„åˆ<code>ByteBuf</code>ï¼Œå®ƒå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª<code>Component</code>æ•°ç»„ï¼Œæ¯ä¸ª<code>Component</code>ç®¡ç†ä¸€ä¸ª<code>ByteBuf</code>ï¼Œè®°å½•äº†è¿™ä¸ª<code>ByteBuf</code>ç›¸å¯¹äºæ•´ä½“åç§»é‡ç­‰ä¿¡æ¯ï¼Œä»£è¡¨ç€æ•´ä½“ä¸­æŸä¸€æ®µæ•°æ®  </p>
<ul>
<li>ä¼˜ç‚¹ï¼šå¯¹å¤–æ˜¯ä¸€ä¸ªè™šæ‹Ÿè§†å›¾ï¼Œç»„åˆè¿™äº›<code>ByteBuf</code>ä¸ä¼šäº§ç”Ÿå†…å­˜å¤åˆ¶</li>
<li>ç¼ºç‚¹ï¼Œå¤æ‚äº†å¾ˆå¤šï¼Œå¤šæ¬¡æ“ä½œä¼šå¸¦æ¥æ€§èƒ½çš„æŸè€—</li>
</ul>
<h3 id="Unpooled"><a href="#Unpooled" class="headerlink" title="Unpooled"></a><code>Unpooled</code></h3><p><code>Unpooled</code>æ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œç±»å¦‚å…¶åï¼Œæä¾›äº†éæ± åŒ–çš„<code>ByteBuf</code>åˆ›å»ºã€ç»„åˆã€å¤åˆ¶ç­‰æ“ä½œ  </p>
<p>è¿™é‡Œä»…ä»‹ç»å…¶è·Ÿã€é›¶æ‹·è´ã€‘ç›¸å…³çš„<code>wrappedBuffer</code> æ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥åŒ…è£…<code>ByteBuf</code>  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ByteBuf buf1 = ByteBufAllocator.DEFAULT.buffer(5);</span><br><span class="line">buf1.writeBytes(new byte[]&#123;1, 2, 3, 4, 5&#125;);</span><br><span class="line">ByteBuf buf2 = ByteBufAllocator.DEFAULT.buffer(5);</span><br><span class="line">buf2.writeBytes(new byte[]&#123;6, 7, 8, 9, 10&#125;);</span><br><span class="line"></span><br><span class="line">// å½“åŒ…è£… ByteBuf ä¸ªæ•°è¶…è¿‡ä¸€ä¸ªæ—¶, åº•å±‚ä½¿ç”¨äº† CompositeByteBuf</span><br><span class="line">ByteBuf buf3 = Unpooled.wrappedBuffer(buf1, buf2);</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ç”¨æ¥åŒ…è£…æ™®é€šå­—èŠ‚æ•°ç»„ï¼Œåº•å±‚ä¹Ÿä¸ä¼šæœ‰æ‹·è´æ“ä½œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ByteBuf buf4 = Unpooled.wrappedBuffer(new byte[]&#123;1, 2, 3&#125;, new byte[]&#123;4, 5, 6&#125;);</span><br><span class="line">System.out.println(buf4.getClass());</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class io.netty.buffer.CompositeByteBuf</span><br><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 01 02 03 04 05 06                               |......          |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br></pre></td></tr></table></figure>
<h3 id="ğŸ’¡ByteBufä¼˜åŠ¿"><a href="#ğŸ’¡ByteBufä¼˜åŠ¿" class="headerlink" title="ğŸ’¡ByteBufä¼˜åŠ¿"></a>ğŸ’¡<code>ByteBuf</code>ä¼˜åŠ¿</h3><ul>
<li>æ± åŒ–-å¯ä»¥é‡ç”¨æ± ä¸­<code>ByteBuf</code>å®ä¾‹ï¼Œæ›´èŠ‚çº¦å†…å­˜ï¼Œå‡å°‘å†…å­˜æº¢å‡ºçš„å¯èƒ½  </li>
<li>è¯»å†™æŒ‡é’ˆåˆ†ç¦»ï¼Œä¸éœ€è¦æƒ³<code>ByteBuf</code>ä¸€æ ·åˆ‡æ¢è¯»å†™æ¨¡å¼</li>
<li>å¯ä»¥è‡ªåŠ¨æ‰©å®¹</li>
<li>æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œä½¿ç”¨æ›´æµç•…</li>
<li>å¾ˆå¤šåœ°æ–¹ä½“ç°é›¶æ‹·è´ï¼Œä¾‹å¦‚ <code>slice</code>ã€<code>duplicate</code>ã€<code>CompositeByteBuf</code></li>
</ul>
<h1 id="åŒå‘é€šä¿¡"><a href="#åŒå‘é€šä¿¡" class="headerlink" title="åŒå‘é€šä¿¡"></a>åŒå‘é€šä¿¡</h1><p>å®ç°ä¸€ä¸ª echo server</p>
<p>æœåŠ¡ç«¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">new ServerBootstrap()</span><br><span class="line">    .group(new NioEventLoopGroup())</span><br><span class="line">    .channel(NioServerSocketChannel.class)</span><br><span class="line">    .childHandler(new ChannelInitializer&lt;NioSocketChannel&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        protected void initChannel(NioSocketChannel ch) &#123;</span><br><span class="line">            ch.pipeline().addLast(new ChannelInboundHandlerAdapter()&#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void channelRead(ChannelHandlerContext ctx, Object msg) &#123;</span><br><span class="line">                    ByteBuf buffer = (ByteBuf) msg;</span><br><span class="line">                    System.out.println(buffer.toString(Charset.defaultCharset()));</span><br><span class="line"></span><br><span class="line">                    // å»ºè®®ä½¿ç”¨ ctx.alloc() åˆ›å»º ByteBuf</span><br><span class="line">                    ByteBuf response = ctx.alloc().buffer();</span><br><span class="line">                    response.writeBytes(buffer);</span><br><span class="line">                    ctx.writeAndFlush(response);</span><br><span class="line"></span><br><span class="line">                    // æ€è€ƒï¼šéœ€è¦é‡Šæ”¾ buffer å—</span><br><span class="line">                    // æ€è€ƒï¼šéœ€è¦é‡Šæ”¾ response å—</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).bind(8080);</span><br></pre></td></tr></table></figure>
<p>å®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">NioEventLoopGroup group = new NioEventLoopGroup();</span><br><span class="line">Channel channel = new Bootstrap()</span><br><span class="line">    .group(group)</span><br><span class="line">    .channel(NioSocketChannel.class)</span><br><span class="line">    .handler(new ChannelInitializer&lt;NioSocketChannel&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        protected void initChannel(NioSocketChannel ch) throws Exception &#123;</span><br><span class="line">            ch.pipeline().addLast(new StringEncoder());</span><br><span class="line">            ch.pipeline().addLast(new ChannelInboundHandlerAdapter() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void channelRead(ChannelHandlerContext ctx, Object msg) &#123;</span><br><span class="line">                    ByteBuf buffer = (ByteBuf) msg;</span><br><span class="line">                    System.out.println(buffer.toString(Charset.defaultCharset()));</span><br><span class="line"></span><br><span class="line">                    // æ€è€ƒï¼šéœ€è¦é‡Šæ”¾ buffer å—</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).connect(&quot;127.0.0.1&quot;, 8080).sync().channel();</span><br><span class="line"></span><br><span class="line">channel.closeFuture().addListener(future -&gt; &#123;</span><br><span class="line">    group.shutdownGracefully();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">new Thread(() -&gt; &#123;</span><br><span class="line">    Scanner scanner = new Scanner(System.in);</span><br><span class="line">    while (true) &#123;</span><br><span class="line">        String line = scanner.nextLine();</span><br><span class="line">        if (&quot;q&quot;.equals(line)) &#123;</span><br><span class="line">            channel.close();</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        channel.writeAndFlush(line);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).start();</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ’¡è¯»å’Œå†™çš„è¯¯è§£"><a href="#ğŸ’¡è¯»å’Œå†™çš„è¯¯è§£" class="headerlink" title="ğŸ’¡è¯»å’Œå†™çš„è¯¯è§£"></a>ğŸ’¡è¯»å’Œå†™çš„è¯¯è§£</h2><p>æˆ‘æœ€åˆåœ¨è®¤è¯†ä¸Šæœ‰è¿™æ ·çš„è¯¯åŒºï¼Œè®¤ä¸ºåªæœ‰åœ¨ nettyï¼Œnio è¿™æ ·çš„å¤šè·¯å¤ç”¨ IO æ¨¡å‹æ—¶ï¼Œè¯»å†™æ‰ä¸ä¼šç›¸äº’é˜»å¡ï¼Œæ‰å¯ä»¥å®ç°é«˜æ•ˆçš„åŒå‘é€šä¿¡ï¼Œä½†å®é™…ä¸Šï¼ŒJava Socket æ˜¯å…¨åŒå·¥çš„ï¼šåœ¨ä»»æ„æ—¶åˆ»ï¼Œçº¿è·¯ä¸Šå­˜åœ¨A åˆ° B å’Œ B åˆ° A çš„åŒå‘ä¿¡å·ä¼ è¾“ã€‚å³ä½¿æ˜¯é˜»å¡ IOï¼Œè¯»å’Œå†™æ˜¯å¯ä»¥åŒæ—¶è¿›è¡Œçš„ï¼Œåªè¦åˆ†åˆ«é‡‡ç”¨è¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹å³å¯ï¼Œè¯»ä¸ä¼šé˜»å¡å†™ã€å†™ä¹Ÿä¸ä¼šé˜»å¡è¯»</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%95%99%E7%A8%8B-Netty%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%85%A8%E5%A5%97%E6%95%99%E7%A8%8B/" rel="tag"><i class="fa fa-tag"></i> Javaç½‘ç»œç¼–ç¨‹æ•™ç¨‹-Nettyæ·±å…¥æµ…å‡ºå…¨å¥—æ•™ç¨‹</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/01/22/netty/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%95%99%E7%A8%8BNetty%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%85%A8%E5%A5%97%E6%95%99%E7%A8%8B/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%95%99%E7%A8%8BNetty%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%85%A8%E5%A5%97%E6%95%99%E7%A8%8B%E2%80%94%E2%80%94NIO%E5%9F%BA%E7%A1%80/" rel="prev" title="Javaç½‘ç»œç¼–ç¨‹æ•™ç¨‹|Nettyæ·±å…¥æµ…å‡ºå…¨å¥—æ•™ç¨‹â€”â€”NIOåŸºç¡€ï¼ˆä¸€ï¼‰">
      <i class="fa fa-chevron-left"></i> Javaç½‘ç»œç¼–ç¨‹æ•™ç¨‹|Nettyæ·±å…¥æµ…å‡ºå…¨å¥—æ•™ç¨‹â€”â€”NIOåŸºç¡€ï¼ˆä¸€ï¼‰
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/02/03/netty/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%95%99%E7%A8%8BNetty%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%85%A8%E5%A5%97%E6%95%99%E7%A8%8B/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%95%99%E7%A8%8BNetty%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%85%A8%E5%A5%97%E6%95%99%E7%A8%8B%E2%80%94%E2%80%94Netty%E8%BF%9B%E9%98%B6/" rel="next" title="Javaç½‘ç»œç¼–ç¨‹æ•™ç¨‹|Nettyæ·±å…¥æµ…å‡ºå…¨å¥—æ•™ç¨‹â€”â€”Nettyè¿›é˜¶ï¼ˆä¸‰ï¼‰">
      Javaç½‘ç»œç¼–ç¨‹æ•™ç¨‹|Nettyæ·±å…¥æµ…å‡ºå…¨å¥—æ•™ç¨‹â€”â€”Nettyè¿›é˜¶ï¼ˆä¸‰ï¼‰ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">æ¦‚è¿°</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Netty%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="nav-number">1.1.</span> <span class="nav-text">Nettyæ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Netty%E7%9A%84%E4%BD%9C%E8%80%85"><span class="nav-number">1.2.</span> <span class="nav-text">Nettyçš„ä½œè€…</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Netty%E7%9A%84%E5%9C%B0%E4%BD%8D"><span class="nav-number">1.3.</span> <span class="nav-text">Nettyçš„åœ°ä½</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Netty%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="nav-number">1.4.</span> <span class="nav-text">Nettyçš„ä¼˜åŠ¿</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Hello-World"><span class="nav-number">2.</span> <span class="nav-text">Hello World</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87"><span class="nav-number">2.1.</span> <span class="nav-text">ç›®æ ‡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF"><span class="nav-number">2.2.</span> <span class="nav-text">æœåŠ¡å™¨ç«¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">2.3.</span> <span class="nav-text">å®¢æˆ·ç«¯</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%84%E4%BB%B6"><span class="nav-number">3.</span> <span class="nav-text">ç»„ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#EventLoop"><span class="nav-number">3.1.</span> <span class="nav-text">EventLoop</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Channel"><span class="nav-number">3.2.</span> <span class="nav-text">Channel</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ChannelFuture"><span class="nav-number">3.2.1.</span> <span class="nav-text">ChannelFuture</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CloseFuture"><span class="nav-number">3.2.2.</span> <span class="nav-text">CloseFuture</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Future-amp-Promise"><span class="nav-number">3.2.3.</span> <span class="nav-text">Future &amp; Promise</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Handler-amp-Pipeline"><span class="nav-number">3.2.4.</span> <span class="nav-text">Handler &amp; Pipeline</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ByteBuf"><span class="nav-number">3.3.</span> <span class="nav-text">ByteBuf</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA"><span class="nav-number">3.3.1.</span> <span class="nav-text">åˆ›å»º</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98-VS-%E5%A0%86%E5%86%85%E5%AD%98"><span class="nav-number">3.3.2.</span> <span class="nav-text">ç›´æ¥å†…å­˜ VS å †å†…å­˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B1%A0%E5%8C%96-VS-%E9%9D%9E%E6%B1%A0%E5%8C%96"><span class="nav-number">3.3.3.</span> <span class="nav-text">æ± åŒ– VS éæ± åŒ–</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E6%88%90"><span class="nav-number">3.3.4.</span> <span class="nav-text">ç»„æˆ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%99%E5%85%A5"><span class="nav-number">3.3.5.</span> <span class="nav-text">å†™å…¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A9%E5%AE%B9"><span class="nav-number">3.3.6.</span> <span class="nav-text">æ‰©å®¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%BB%E5%8F%96"><span class="nav-number">3.3.7.</span> <span class="nav-text">è¯»å–</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#retain-amp-release"><span class="nav-number">3.3.8.</span> <span class="nav-text">retain &amp; release</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#slice"><span class="nav-number">3.3.9.</span> <span class="nav-text">slice</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#duplicate"><span class="nav-number">3.3.10.</span> <span class="nav-text">duplicate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#copy"><span class="nav-number">3.3.11.</span> <span class="nav-text">copy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CompositeByteBuf"><span class="nav-number">3.3.12.</span> <span class="nav-text">CompositeByteBuf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Unpooled"><span class="nav-number">3.3.13.</span> <span class="nav-text">Unpooled</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%92%A1ByteBuf%E4%BC%98%E5%8A%BF"><span class="nav-number">3.3.14.</span> <span class="nav-text">ğŸ’¡ByteBufä¼˜åŠ¿</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%8C%E5%90%91%E9%80%9A%E4%BF%A1"><span class="nav-number">4.</span> <span class="nav-text">åŒå‘é€šä¿¡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%92%A1%E8%AF%BB%E5%92%8C%E5%86%99%E7%9A%84%E8%AF%AF%E8%A7%A3"><span class="nav-number">4.1.</span> <span class="nav-text">ğŸ’¡è¯»å’Œå†™çš„è¯¯è§£</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="YS"
      src="/images/author.png">
  <p class="site-author-name" itemprop="name">YS</p>
  <div class="site-description" itemprop="description">å­¦æµ·æ— æ¶¯è‹¦ä½œèˆŸ</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">53</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">YS</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'SsNHix8sOQXkmksOkIvo0jkf-gzGzoHsz',
      appKey     : 'BCtPpmnU41TOE7Wr5O0CJFgS',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
